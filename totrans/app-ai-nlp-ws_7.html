<html><head></head><body>
		<div id="_idContainer327" class="Content">
			<h1 id="_idParaDest-152"><a id="_idTextAnchor155"/>Appendix</h1>
		</div>
		<div id="_idContainer429" class="Content">
			<h1 id="_idParaDest-153"><a id="_idTextAnchor156"/>1. An Introduction to AWS</h1>
			<h2 id="_idParaDest-154"><a id="_idTextAnchor157"/>Activity 1.01: Putting the Data into S3 with the CLI</h2>
			<p><strong class="bold">Solution:</strong></p>
			<ol>
				<li>Verify the configuration is correct by executing <strong class="source-inline">aws s3 ls</strong> to output your bucket name (the bucket name will be unique):<div id="_idContainer328" class="IMG---Figure"><img src="image/B16061_01_46.jpg" alt="Figure 1.46: Command line showing the list of files in an S3 bucket&#13;&#10;"/></div><p class="figure-caption">Figure 1.46: Command line showing the list of files in an S3 bucket</p><p class="callout-heading">Note</p><p class="callout">The list you will see maybe a little different from the preceding screenshot. It depends on what activities or exercises you have done; you might see a few more files in S3.</p></li>
				<li>Let's create a new S3 bucket. <strong class="source-inline">mb</strong> is the command for creating a bucket:<p class="source-code">aws s3 mb s3://lesson1-text-files-20200217</p><div id="_idContainer329" class="IMG---Figure"><img src="image/B16061_01_47.jpg" alt="Figure 1.47: Command to create an S3 bucket&#13;&#10;"/></div><p class="figure-caption">Figure 1.47: Command to create an S3 bucket</p><p>If it is successful, you will see the <strong class="source-inline">make_bucket : message</strong>.</p><p class="callout-heading">Note</p><p class="callout">Your bucket name needs to be unique, so it is easier to append YYYYMMDD to the name (or something similar) to make it so. You will see this technique in later chapters as well. If you take a look at the earlier <strong class="source-inline">ls</strong> command, you will see the bucket names used — even used YYYYMMDDHHMM to ensure the names were unique. Refer to the S3 "Rules for Bucket Naming" for specific details <a href="https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-s3-bucket-naming-requirements.html">https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-s3-bucket-naming-requirements.html</a>).</p></li>
				<li>Import your text file into the S3 bucket.<p>For these exercises, we have prepared some fun-sounding text excerpts for you from Dracula and Peter Pan. These files are on GitHub <a href="https://packt.live/31WESlK">https://packt.live/31WESlK</a> Assuming you have cloned the repository locally, navigate to the local directory using the command line. In our case, the files are in <strong class="source-inline">~/Documents/aws-book</strong>:</p><div id="_idContainer330" class="IMG---Figure"><img src="image/B16061_01_48.jpg" alt="Figure 1.48: Navigating to the local directory in the command line&#13;&#10;"/></div><p class="figure-caption">Figure 1.48: Navigating to the local directory in the command line</p></li>
				<li>To copy the files from the local directory to S3, use the command <strong class="source-inline">aws s3 cp pos_sentiment__leaves_of_grass.txt s3://lesson1-text-files-20200217</strong> to import the text file into your S3 bucket as shown at the end of <em class="italic">Figure 1.48</em>:</li>
				<li>Similarly, export the <strong class="source-inline">neg_sentiment__dracula.txt</strong> and <strong class="source-inline">peter_pan.txt</strong> files to the S3 bucket:<div id="_idContainer331" class="IMG---Figure"><img src="image/B16061_01_49.jpg" alt="Figure 1.49: Copying the file from the local directory in the command line&#13;&#10;"/></div><p class="figure-caption">Figure 1.49: Copying the file from the local directory in the command line</p></li>
				<li>Navigate to your desktop in the command line. Create a new local folder named <strong class="source-inline">s3_exported_files</strong> with the <strong class="source-inline">mkdir s3_exported_files</strong> command:<div id="_idContainer332" class="IMG---Figure"><img src="image/B16061_01_50.jpg" alt="in"/></div><p class="figure-caption">Figure 1.50: Navigating to the desktop in the command line</p></li>
				<li>Next, recursively export both files (<strong class="source-inline">neg_sentiment__dracula.txt</strong> and <strong class="source-inline">peter_pan.txt</strong>) from the S3 bucket to your local directory with the <strong class="source-inline">- -recursive</strong> parameter. The following is the output of the command:<div id="_idContainer333" class="IMG---Figure"><img src="image/B16061_01_51.jpg" alt="Figure 1.51: Command line to copy files from an S3 bucket&#13;&#10;"/></div><p class="figure-caption">Figure 1.51: Command line to copy files from an S3 bucket</p></li>
				<li>Verify the objects were exported successfully to your local folder with the <strong class="source-inline">dir</strong> or <strong class="source-inline">ls</strong> command, as shown in the following screenshot. This is the expected output:<div id="_idContainer334" class="IMG---Figure"><img src="image/B16061_01_52.jpg" alt="Figure 1.52: Output of the multi-file copy from the S3 bucket&#13;&#10;"/></div></li>
			</ol>
			<p class="figure-caption">Figure 1.52: Output of the multi-file copy from the S3 bucket</p>
			<h1 id="_idParaDest-155"><a id="_idTextAnchor158"/>2. Analyzing Documents and Text with Natural Language Processing</h1>
			<h2 id="_idParaDest-156">Activity 2.01: Integra<a id="_idTextAnchor159"/>ting Lambda with Amazon Comprehend to Perform Text Analysis</h2>
			<p><strong class="bold">Solution</strong>:</p>
			<ol>
				<li value="1">Upload the <strong class="source-inline">test_s3trigger_configured.txt</strong> file to our S3 bucket to verify the Lambda <strong class="source-inline">s3_trigger</strong> function was configured successfully.</li>
				<li>Navigate to the S3 page: <a href="https://console.aws.amazon.com/s3/">https://console.aws.amazon.com/s3/</a>.</li>
				<li>Click the bucket name you are using to test the <strong class="source-inline">s3_trigger</strong> function (in my case, <strong class="source-inline">aws-ml-s3-trigger-202001181023</strong>):<div id="_idContainer335" class="IMG---Figure"><img src="image/B16061_02_55.jpg" alt="Figure 2.55: S3 bucket list&#13;&#10;"/></div><p class="figure-caption">Figure 2.55: S3 bucket list</p></li>
				<li>Click <strong class="source-inline">Upload</strong>:<div id="_idContainer336" class="IMG---Figure"><img src="image/B16061_02_56.jpg" alt="Figure 2.56: S3 bucket list upload screen&#13;&#10;"/></div><p class="figure-caption">Figure 2.56: S3 bucket list upload screen</p><p>The following screen will display:</p><div id="_idContainer337" class="IMG---Figure"><img src="image/B16061_02_57.jpg" alt="Figure 2.57: S3 Upload bucket Add files screen&#13;&#10;"/></div><p class="figure-caption">Figure 2.57: S3 Upload bucket Add files screen</p></li>
				<li>Click <strong class="source-inline">Add files</strong>:<div id="_idContainer338" class="IMG---Figure"><img src="image/B16061_02_58.jpg" alt="Figure 2.58: S3 Add files selection screen&#13;&#10;"/></div><p class="figure-caption">Figure 2.58: S3 Add files selection screen</p></li>
				<li>Navigate to the <strong class="source-inline">test_s3trigger_configured.txt</strong> file location. Select the file.<p>The file contains the following text:</p><p class="source-code">I am a test file to verify the s3 trigger was successfully configured on 1/20/2020 at 1:34 PM and tried 3 times!</p><p>Before we execute the <strong class="source-inline">s3_trigger</strong>, consider the output based on the following aspects of the text: sentiment (positive, negative, or neutral), entities (quantity, person, place, and so on), and key phrases.</p><p class="callout-heading">Note</p><p class="callout"><strong class="source-inline">test_s3trigger_configured.txt</strong> is available at the following GitHub repository: <a href="https://packt.live/3gAxqku">https://packt.live/3gAxqku</a>.</p></li>
				<li>Click <strong class="source-inline">Upload</strong>, then <strong class="source-inline">Next</strong>:<div id="_idContainer339" class="IMG---Figure"><img src="image/B16061_02_59.jpg" alt="Figure 2.59: S3 file added to the bucket for the Lambda trigger test&#13;&#10;"/></div><p class="figure-caption">Figure 2.59: S3 file added to the bucket for the Lambda trigger test</p></li>
				<li>Click <strong class="source-inline">Next</strong> in the Set Permissions tab:<div id="_idContainer340" class="IMG---Figure"><img src="image/B16061_02_60.jpg" alt="Figure 2.60: S3 file added to the bucket for the Lambda trigger test—object permissions&#13;&#10;"/></div><p class="figure-caption">Figure 2.60: S3 file added to the bucket for the Lambda trigger test—object permissions</p></li>
				<li>Keep the default <strong class="source-inline">Standard</strong> <strong class="source-inline">Storage class</strong> and click <strong class="source-inline">Next</strong>:<div id="_idContainer341" class="IMG---Figure"><img src="image/B16061_02_61.jpg" alt="Figure 2.61: S3 file added to the bucket for the Lambda trigger test—Storage class&#13;&#10;"/></div><p class="figure-caption">Figure 2.61: S3 file added to the bucket for the Lambda trigger test—Storage class</p></li>
				<li>Select <strong class="source-inline">Upload</strong>:<div id="_idContainer342" class="IMG---Figure"><img src="image/B16061_02_62.jpg" alt="Figure 2.62: S3 file added to the bucket for the Lambda trigger test—Upload&#13;&#10;"/></div><p class="figure-caption">Figure 2.62: S3 file added to the bucket for the Lambda trigger test—Upload</p></li>
				<li>You will see the file in the file list:<div id="_idContainer343" class="IMG---Figure"><img src="image/B16061_02_63.jpg" alt="Figure 2.63: S3 file added to the bucket for the Lambda trigger test – file list&#13;&#10;"/></div><p class="figure-caption">Figure 2.63: S3 file added to the bucket for the Lambda trigger test – file list</p></li>
				<li>Now let's see if our Lambda was triggered. Navigate back to the Lambda via <strong class="source-inline">Services&gt;Compute&gt;Lambda&gt;Functions&gt;s3_trigger</strong>. Click <strong class="source-inline">Monitoring</strong>:<div id="_idContainer344" class="IMG---Figure"><img src="image/B16061_02_64.jpg" alt="Figure 2.64: Select the Monitoring tab&#13;&#10;"/></div><p class="figure-caption">Figure 2.64: Select the Monitoring tab</p></li>
				<li>Click <strong class="source-inline">View logs in CloudWatch</strong>:<div id="_idContainer345" class="IMG---Figure"><img src="image/B16061_02_65.jpg" alt="Figure 2.65: Select View logs in CloudWatch&#13;&#10;"/></div><p class="figure-caption">Figure 2.65: Select View logs in CloudWatch</p></li>
				<li>Click the log stream:<div id="_idContainer346" class="IMG---Figure"><img src="image/B16061_02_66.jpg" alt="Figure 2.66: Select the log stream&#13;&#10;"/></div><p class="figure-caption">Figure 2.66: Select the log stream</p></li>
				<li>Select the radio button next to <strong class="source-inline">Text</strong> to expand the output:<div id="_idContainer347" class="IMG---Figure"><img src="image/B16061_02_67.jpg" alt="Figure 2.67: Click the radio button to expand the Lambda output&#13;&#10;"/></div><p class="figure-caption">Figure 2.67: Click the radio button to expand the Lambda output</p><p>The following is the first few lines of the output. To see the entire output, you need to scroll down to view all of the results (see the following). We will interpret the total output in the next step:</p><div id="_idContainer348" class="IMG---Figure"><img src="image/B16061_02_68.jpg" alt="Figure 2.68: The top portion of the s3_trigger output&#13;&#10;"/></div><p class="figure-caption">Figure 2.68: The top portion of the s3_trigger output</p><p class="callout-heading">Note</p><p class="callout">If you encounter permission errors, check the permissions for <strong class="source-inline">s3TriggerRole</strong> from <strong class="source-inline">Services&gt;Security, Identity, &amp; Compliance-IAM-Roles</strong>. The policy list should look as follows. If one of them is missing, you can add them.</p></li>
				<li>Also, if you delete and recreate your Lambda, you can reuse the role—just select <strong class="source-inline">Use an existing role</strong> instead of <strong class="source-inline">Create a new role</strong>. It is always good to play around with the various configurations and understand how they all fit together:<div id="_idContainer349" class="IMG---Figure"><img src="image/B16061_02_69.jpg" alt="Figure 2.69: The policies for s3TriggerRole&#13;&#10;"/></div><p class="figure-caption">Figure 2.69: The policies for s3TriggerRole</p></li>
				<li>Now let's examine the results of our Lambda from AWS Comprehend. You might see slightly different confidence levels because Amazon trains its algorithms periodically.<p><strong class="source-inline">Sentiment_response</strong> -&gt; Classified as <strong class="source-inline">51.0</strong>% likely to be neutral. This is a statement, so neutral is fine.</p><p><strong class="source-inline">Sentiment_response</strong>:</p><p class="source-code">{ {'Sentiment': 'NEUTRAL', </p><p class="source-code">   'SentimentScore': {'Positive': 0.21022377908229828, </p><p class="source-code">                      'Negative': 0.27646979689598083, </p><p class="source-code">                      'Neutral': 0.5132954716682434, </p><p class="source-code">                      'Mixed': 1.0932244549621828e-05},</p><p><strong class="source-inline">entity_response</strong> -&gt; It did find the date and the quantity from the text</p><p><strong class="source-inline">entity_response</strong>:</p><p class="source-code">{ 'Entities': [{'Score': 0.9891313314437866, </p><p class="source-code">                'Type': 'DATE', 'Text': '1/20/2020 at 1:34 PM', </p><p class="source-code">                'BeginOffset': 76, 'EndOffset': 96}, </p><p class="source-code">               {'Score': 0.9999986290931702, 'Type': 'QUANTITY', </p><p class="source-code">                'Text': '3 times', 'BeginOffset': 107, </p><p class="source-code">                'EndOffset': 114}], </p><p><strong class="source-inline">key_phases_response</strong> -&gt; It found the key phrases and the scores are close to 100% confidence</p><p><strong class="source-inline">key_phases_response</strong>:</p><p class="source-code">{'KeyPhrases': [{'Score': 0.9992266297340393, </p><p class="source-code">                 'Text': 'a test file', 'BeginOffset': 8, </p><p class="source-code">                 'EndOffset': 19}, </p><p class="source-code">                {'Score': 0.9999999403953552, </p><p class="source-code">                 'Text': 'the s3 trigger', 'BeginOffset': 30, </p><p class="source-code">                 'EndOffset': 44}, </p><p class="source-code">                {'Score': 0.9999963045120239, </p><p class="source-code">                 'Text': '1/20/2020', 'BeginOffset': 76, </p><p class="source-code">                 'EndOffset': 85}, </p><p class="source-code">                {'Score': 0.9960731863975525, </p><p class="source-code">                 'Text': '1:34 PM', 'BeginOffset': 89, </p><p class="source-code">                 'EndOffset': 96}, </p><p class="source-code">                {'Score': 0.9999966621398926, 'Text': '3 times', </p><p class="source-code">                 'BeginOffset': 107, 'EndOffset': 114}],</p></li>
			</ol>
			<h1 id="_idParaDest-157"><a id="_idTextAnchor160"/>3. Topic Modeling and Theme Extraction</h1>
			<h2 id="_idParaDest-158"><a id="_idTextAnchor161"/>Activity 3.01: Performing Topic Modeling on a Set of Documents with Unknown Topics</h2>
			<p><strong class="bold">Solution</strong>:</p>
			<ol>
				<li value="1">For this activity, we are going to use 1,000 movie review files. Navigate to the following link (or to your local directory where you have downloaded the GitHub files) to obtain the text data files that contain movie review comments: <a href="https://packt.live/3gISDZL">https://packt.live/3gISDZL</a>. It is definitely better to download the GitHub repository rather than download 1,000 files by hand.</li>
				<li>Navigate to the S3 dashboard at <a href="https://s3.console.aws.amazon.com/s3/home">https://s3.console.aws.amazon.com/s3/home</a>.</li>
				<li>Click the bucket that you created earlier (in my case, it is "<strong class="source-inline">aws-ml-input-for-topic-modeling-20200301</strong>"):<div id="_idContainer350" class="IMG---Figure"><img src="image/B16061_03_50.jpg" alt="Figure 3.50: The S3 home screen for ‘input-for-topic-modeling’&#13;&#10;"/></div><p class="figure-caption">Figure 3.50: The S3 home screen for 'input-for-topic-modeling'</p></li>
				<li>Click <strong class="source-inline">Create folder</strong>:<div id="_idContainer351" class="IMG---Figure"><img src="image/B16061_03_51.jpg" alt="Figure 3.51: Clicking on Create folder&#13;&#10;"/></div><p class="figure-caption">Figure 3.51: Clicking on Create folder</p></li>
				<li>Type <strong class="source-inline">movie_review_files</strong> and click <strong class="source-inline">Save</strong>:<div id="_idContainer352" class="IMG---Figure"><img src="image/B16061_03_52.jpg" alt="Figure 3.52: Clicking Save&#13;&#10;"/></div><p class="figure-caption">Figure 3.52: Clicking Save</p><p class="callout-heading">Note</p><p class="callout">For this step, you may either follow along with the exercise and type in the code in a Jupyter notebook or obtain the notebook file (<strong class="source-inline">text_files_to_s3.ipynb</strong>) from the source code folder for this chapter: <a href="https://packt.live/2W077MR">https://packt.live/2W077MR</a>. Copy the file and paste it into the editor. </p></li>
				<li>First, you will import the <strong class="source-inline">os</strong> and <strong class="source-inline">boto3</strong> packages using the following command:<p class="source-code">import os</p><p class="source-code">import boto3</p></li>
				<li>Create an S3 client:<p class="source-code"># Create an S3 client</p><p class="source-code">s3 = boto3.client('s3')</p></li>
				<li>Next, type in your unique bucket name in the highlighted space:<p class="source-code">BUCKET_NAME = '<strong class="bold">&lt;insert a unique bucket name&gt;</strong>'</p><p class="source-code">BUCKET_FOLDER = 'movie_review_files/'</p></li>
				<li>Next, get the working directory of the local path to the text files:<p class="source-code">LOCAL_PATH = os.getcwd() +'\\<strong class="bold">local_folder_movie_review_files</strong>\\'</p><p class="callout-heading">Note</p><p class="callout">The <strong class="source-inline">os.getcwd()</strong> command will get the current path. Ensure that the movie review files are in a folder located at the same path. Based on the folder name, you have to change the highlighted value. Alternatively, you can assign a custom path to <strong class="source-inline">LOCAL_PATH</strong> as well.</p></li>
				<li>Create a list of all the text files:<p class="source-code">text_files_list = [f for f in os.listdir(LOCAL_PATH) \</p><p class="source-code">                   if f.endswith('.txt')]</p></li>
				<li>Iterate on all files, and upload each to <strong class="source-inline">s3</strong>:<p class="source-code">file_count = 0</p><p class="source-code">for filename in text_files_list:</p><p class="source-code">  # print(filename)</p><p class="source-code">  file_count += 1</p><p class="source-code">s3.upload_file(LOCAL_PATH + filename, BUCKET_NAME, \</p><p class="source-code">               BUCKET_FOLDER + filename)</p><p class="source-code">print(F"Completed uploading {file_count} files.")</p></li>
				<li>Press <em class="italic">Shift </em>+ <em class="italic">Enter</em> to run the cell.</li>
				<li>This will take a few minutes. The result is 1,000 text files uploaded to the S3 <strong class="source-inline">movie_review_files</strong> folder:<div id="_idContainer353" class="IMG---Figure"><img src="image/B16061_03_53.jpg" alt="Figure 3.53: movie_review_files uploaded to S3&#13;&#10;"/></div><p class="figure-caption">Figure 3.53: movie_review_files uploaded to S3</p></li>
				<li>Refer to the following figure for the top few lines of the S3 output:<div id="_idContainer354" class="IMG---Figure"><img src="image/B16061_03_54.jpg" alt="Figure 3.54: movie_review_files in S3&#13;&#10;"/></div><p class="figure-caption">Figure 3.54: movie_review_files in S3</p></li>
				<li>Next, navigate to AWS Comprehend via the Comprehend link: <a href="https://aws.amazon.com/comprehend/">https://aws.amazon.com/comprehend/</a>. You can also get there from <a href="https://aws.amazon.com/">https://aws.amazon.com/</a>, then clicking <strong class="source-inline">My account</strong> and selecting <strong class="source-inline">AWS Management Console</strong>. In the console, select <strong class="source-inline">services</strong> and then click <strong class="source-inline">Amazon Comprehend</strong> in the machine learning category.</li>
				<li>Then, click <strong class="source-inline">Launch Amazon Comprehend</strong>:<div id="_idContainer355" class="IMG---Figure"><img src="image/B16061_03_55.jpg" alt="Figure 3.55: The Amazon Comprehend home screen&#13;&#10;"/></div><p class="figure-caption">Figure 3.55: The Amazon Comprehend home screen</p></li>
				<li>Now, click <strong class="source-inline">Analysis jobs</strong>, the first item on the left-hand toolbar:<div id="_idContainer356" class="IMG---Figure"><img src="image/B16061_03_56.jpg" alt="Figure 3.56: Selecting Analysis jobs&#13;&#10;"/></div><p class="figure-caption">Figure 3.56: Selecting Analysis jobs</p></li>
				<li>Now, click <strong class="source-inline">Create job</strong>:<div id="_idContainer357" class="IMG---Figure"><img src="image/B16061_03_57.jpg" alt="Figure 3.57: Clicking Create job&#13;&#10;"/></div><p class="figure-caption">Figure 3.57: Clicking Create job</p></li>
				<li>Now, type <strong class="source-inline">unknown_topic_structure_job</strong> in the <strong class="source-inline">Name</strong> input field:<div id="_idContainer358" class="IMG---Figure"><img src="image/B16061_03_58.jpg" alt="Figure 3.58: Entering unknown_topic_structure_job&#13;&#10;"/></div><p class="figure-caption">Figure 3.58: Entering unknown_topic_structure_job</p></li>
				<li>Select <strong class="source-inline">Topic modeling</strong> in the analysis type drop-down box:<div id="_idContainer359" class="IMG---Figure"><img src="image/B16061_03_59.jpg" alt="Figure 3.59: Choosing the Topic Modeling analysis type&#13;&#10;"/></div><p class="figure-caption">Figure 3.59: Choosing the Topic Modeling analysis type</p></li>
				<li>Now, scroll down to the <strong class="source-inline">Input data</strong> section and click <strong class="source-inline">Browse S3</strong>:<div id="_idContainer360" class="IMG---Figure"><img src="image/B16061_03_60.jpg" alt="Figure 3.60: Selecting the Browse S3 button&#13;&#10;"/></div><p class="figure-caption">Figure 3.60: Selecting the Browse S3 button</p></li>
				<li>Click the radio button next to the bucket you selected to input files for Topic Modeling (<strong class="source-inline">aws-ml-input-for-topic-modeling-20200301</strong>) and then click the bucket name:<div id="_idContainer361" class="IMG---Figure"><img src="image/B16061_03_61.jpg" alt="Figure 3.61: Expanding the S3 bucket sub-folders&#13;&#10;"/></div><p class="figure-caption">Figure 3.61: Expanding the S3 bucket sub-folders</p></li>
				<li>Click the radio button next to the "<strong class="source-inline">movie_review_files</strong>" folder:<div id="_idContainer362" class="IMG---Figure"><img src="image/B16061_03_62.jpg" alt="Figure 3.62: Selecting the movie_review_files folder&#13;&#10;"/></div><p class="figure-caption">Figure 3.62: Selecting the movie_review_files folder</p></li>
				<li>Now, click the <strong class="source-inline">Choose</strong> button.<p>The following figure shows the S3 location for the input data selected:</p><div id="_idContainer363" class="IMG---Figure"><img src="image/B16061_03_63.jpg" alt="Figure 3.63: S3 location for the input data selected&#13;&#10;"/></div><p class="figure-caption">Figure 3.63: S3 location for the input data selected</p></li>
				<li>Select <strong class="source-inline">One document per file</strong> from the <strong class="source-inline">Input format</strong> dropdown:<div id="_idContainer364" class="IMG---Figure"><img src="image/B16061_03_64.jpg" alt="Figure 3.64: Selecting the One document per file option&#13;&#10;"/></div><p class="figure-caption">Figure 3.64: Selecting the One document per file option</p></li>
				<li>Next, enter <strong class="source-inline">40</strong> in the <strong class="source-inline">Number of topics</strong> input field:<div id="_idContainer365" class="IMG---Figure"><img src="image/B16061_03_65.jpg" alt="Figure 3.65: Entering 40 topics&#13;&#10;"/></div><p class="figure-caption">Figure 3.65: Entering 40 topics</p></li>
				<li>Scroll down to choose the output location, and then click <strong class="source-inline">Browse S3</strong>:<div id="_idContainer366" class="IMG---Figure"><img src="image/B16061_03_66.jpg" alt="Figure 3.66: Clicking Browse S3&#13;&#10;"/></div><p class="figure-caption">Figure 3.66: Clicking Browse S3</p></li>
				<li>Select the output bucket you uniquely named for the Topic Modeling output and click on <strong class="source-inline">Choose</strong>:<div id="_idContainer367" class="IMG---Figure"><img src="image/B16061_03_67.jpg" alt="Figure 3.67: Selecting the S3 bucket for the Topic Modeling output&#13;&#10;"/></div><p class="figure-caption">Figure 3.67: Selecting the S3 bucket for the Topic Modeling output</p></li>
				<li>Scroll down to <strong class="source-inline">Access Permissions</strong> and select <strong class="source-inline">Use an existing IAM role</strong>, as shown:<div id="_idContainer368" class="IMG---Figure"><img src="image/B16061_03_68.jpg" alt="Figure 3.68: Selecting Use an existing IAM role in Access permissions&#13;&#10;"/></div><p class="figure-caption">Figure 3.68: Selecting Use an existing IAM role in Access permissions</p></li>
				<li>In the <strong class="source-inline">Role Name</strong> dropdown, select <strong class="source-inline">AmazonComprehendServiceRole-myTopicModelingRole</strong>:<div id="_idContainer369" class="IMG---Figure"><img src="image/B16061_03_69.jpg" alt="Figure 3.69: Selecting an existing IAM role&#13;&#10;"/></div><p class="figure-caption">Figure 3.69: Selecting an existing IAM role</p></li>
				<li>The final screen should look like the following:<div id="_idContainer370" class="IMG---Figure"><img src="image/B16061_03_70.jpg" alt="Figure 3.70: Selecting an existing IAM role&#13;&#10;"/></div><p class="figure-caption">Figure 3.70: Selecting an existing IAM role</p></li>
				<li>Click the <strong class="source-inline">Create job</strong> button. The Topic Modeling job status will first display <strong class="source-inline">Submitted</strong>:<div id="_idContainer371" class="IMG---Figure"><img src="image/B16061_03_71.jpg" alt="Figure 3.71: Status as Submitted&#13;&#10;"/></div><p class="figure-caption">Figure 3.71: Status as Submitted</p></li>
				<li>The Topic Modeling job status will next display <strong class="source-inline">In progress</strong>. The Topic Modeling job takes about 20 minutes:<div id="_idContainer372" class="IMG---Figure"><img src="image/B16061_03_72.jpg" alt="Figure 3.72: Status as In progress&#13;&#10;"/></div><p class="figure-caption">Figure 3.72: Status as In progress</p></li>
				<li>When the status changes to <strong class="source-inline">Completed</strong>, click the <strong class="source-inline">unknown_topic_structure_job</strong> link:<div id="_idContainer373" class="IMG---Figure"><img src="image/B16061_03_73.jpg" alt="Figure 3.73: Selecting the hyperlinked Topic Modeling link&#13;&#10;"/></div><p class="figure-caption">Figure 3.73: Selecting the hyperlinked Topic Modeling link</p><p class="callout-heading">Note</p><p class="callout">As you can see, we didn't get it right the first time and the status showed <strong class="source-inline">Failed</strong>. It might take a few attempts for you. If a job fails, click <strong class="source-inline">Copy</strong> (the button to the left of <strong class="source-inline">Create job</strong>) and then correct the errors. As you can't have duplicate jobs, a good process would be to append the job name with a sequence number, for example, <strong class="source-inline">unknown_topic_structure_job_01</strong>.</p></li>
				<li>Scroll down and click the Topic Modeling output hyperlink (yours will display a different unique Topic Modeling job alphanumeric character string):<div id="_idContainer374" class="IMG---Figure"><img src="image/B16061_03_74.jpg" alt="Figure 3.74: Clicking the Topic Modeling output S3 location&#13;&#10;"/></div><p class="figure-caption">Figure 3.74: Clicking the Topic Modeling output S3 location</p></li>
				<li>You will be directed to the actual file in the S3 output folder for the Topic Modeling job. Click <strong class="source-inline">Download</strong>:<div id="_idContainer375" class="IMG---Figure"><img src="image/B16061_03_75.jpg" alt="Figure 3.75: Clicking Download on the output file&#13;&#10;"/></div><p class="figure-caption">Figure 3.75: Clicking Download on the output file</p></li>
				<li>Save the file to a local directory; usually, the <strong class="source-inline">Downloads</strong> folder or the desktop is fine:<div id="_idContainer376" class="IMG---Figure"><img src="image/B16061_03_76.jpg" alt="Figure 3.76: Saving the downloaded output file from S3&#13;&#10;"/></div><p class="figure-caption">Figure 3.76: Saving the downloaded output file from S3</p></li>
				<li>Navigate to the directory where you have downloaded the file and extract the CSV files by double-clicking. In Windows, right-click the <strong class="source-inline">output.tar.gz</strong> file and select <strong class="source-inline">Extract Here</strong>:<div id="_idContainer377" class="IMG---Figure"><img src="image/B16061_03_77.jpg" alt="Figure 3.77: Selecting Extract Here&#13;&#10;"/></div><p class="figure-caption">Figure 3.77: Selecting Extract Here</p><p>The result is two CSV files: <strong class="source-inline">doc-topics.csv</strong> and <strong class="source-inline">topic-terms.csv</strong>.</p><p>For reference, the extracted CSV files are available in the following GitHub directories and where you downloaded them in the local directory (in my case, this is <strong class="source-inline">/Users/ksankar/Documents/aws_book/The-Applied-AI-and-Natural-Language-Processing-with-AWS/Chapter03/Activity3.01</strong>):</p><p><a href="https://packt.live/2AIccSw">https://packt.live/2AIccSw</a>.</p><p><a href="https://packt.live/3eaGdry">https://packt.live/3eaGdry</a>.</p><p>We have completed Part 1: Performing Topic Modeling, for this activity. Now, let's move to Part 2: Analysis of Unknown Topics.</p><p class="callout-heading">Note</p><p class="callout">For this step, you may either follow along with the exercise and type in the code on a Jupyter notebook or obtain the <strong class="source-inline">local_csv_to_s3_for_analysis.ipynb</strong> file from the GitHub folder where you have downloaded the repository and paste it into the Jupyter editor. For reference, the source code is available via GitHub in the following repository: <a href="https://packt.live/3gDErks">https://packt.live/3gDErks</a>.</p></li>
				<li>Firstly, we will import <strong class="source-inline">boto3</strong>:<p class="source-code">import boto3</p></li>
				<li>Next, import <strong class="source-inline">pandas</strong>:<p class="source-code">import pandas as pd</p></li>
				<li>Create the S3 client object.<p class="source-code">region = 'us-west-2'</p><p class="source-code">s3 = boto3.client('s3',region_name = region)</p></li>
				<li>Next, create a unique name for the S3 bucket to store your source CSV files. Here, the bucket is named <strong class="source-inline">unknown-tm-analysis-20200302</strong>, but you will need to create a unique name:<p class="source-code">#'&lt;insert a unique bucket name&gt;'</p><p class="source-code">bucket_name = 'unknown-tm-analysis-20200302'</p></li>
				<li>Next, create a new bucket:<p class="source-code"># Create a location Constraint</p><p class="source-code">location = {'LocationConstraint': region}</p><p class="source-code"># Creates a new bucket </p><p class="source-code">s3.create_bucket(Bucket=bucket_name,\</p><p class="source-code">                 CreateBucketConfiguration=location)</p></li>
				<li>Create a list of the CSV filenames to import:<p class="source-code">filenames_list = ['doc-topics.csv', 'topic-terms.csv']</p></li>
				<li>Iterate on each file to upload to S3:<p class="source-code">for filename in filenames_list: </p><p class="source-code">    s3.upload_file(filename, bucket_name, filename)</p></li>
				<li>Next, check whether the filename is <strong class="source-inline">'doc-topics.csv'</strong>:<p class="source-code">if filename == 'doc-topics.csv':</p></li>
				<li>Now, get the <strong class="source-inline">doc-topics.csv</strong> file object and assign it to the <strong class="source-inline">obj</strong> variable:<p class="source-code">obj = s3.get_object(Bucket=bucket_name, Key=filename)</p></li>
				<li>Next, read the <strong class="source-inline">csv</strong> object and assign it to the <strong class="source-inline">doc_topics variable</strong>:<p class="source-code">doc_topics = pd.read_csv(obj['Body']) else:</p><p class="source-code">obj = s3.get_object(Bucket=bucket_name, Key=filename) \</p><p class="source-code">                    topic_terms = pd.read_csv(obj['Body'])</p></li>
				<li>Merge files on the Topic column to obtain the most common terms for each document:<p class="source-code">merged_df = pd.merge(doc_topics, topic_terms, on='topic')</p></li>
				<li>Print the <strong class="source-inline">merged_df</strong> to the console:<p class="source-code">print(merged_df)</p></li>
				<li>Next, execute the notebook cells using <em class="italic">Shift </em>+ <em class="italic">Enter</em>.</li>
				<li>The console output is a merged DataFrame that provides the docnames with their respective terms and the terms' weights (refer to the following):<div id="_idContainer378" class="IMG---Figure"><img src="image/B16061_03_78.jpg" alt="Figure 3.78: Output from the S3 Create bucket call&#13;&#10;"/></div></li>
			</ol>
			<p class="figure-caption">Figure 3.78: Output from the S3 Create bucket call</p>
			<div>
				<div id="_idContainer379" class="IMG---Figure">
					<img src="image/B16061_03_79.jpg" alt="Figure 3.79: Activity merged Topic Modeling output&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 3.79: Activity merged Topic Modeling output</p>
			<h1 id="_idParaDest-159"><a id="_idTextAnchor162"/>5. Using Speech with the Chatbot</h1>
			<h2 id="_idParaDest-160"><a id="_idTextAnchor163"/>Activity 5.01: Creating a Custom Bot and Connecting the Bot with Amazon Connect</h2>
			<p><strong class="bold">Solution:</strong></p>
			<p>This is an activity that combines what we learned in the previous chapters. Try to complete the activity on your own and refer to the solution as needed. You will make mistakes and will encounter things that do not seem to work. This is all part of learning an interesting domain. If you build and test it incrementally, the development will be easier and there will be fewer moving parts.</p>
			<p><strong class="bold">Step 1: Creating an S3 Bucket and storing balance.txt</strong></p>
			<ol>
				<li value="1">First, navigate to the Amazon S3 service from https://aws.amazon.com/, and then navigate to <strong class="source-inline">My Account – AWS management Console-Services-Storage-S3</strong>. Click <strong class="source-inline">Create bucket</strong>:<div id="_idContainer380" class="IMG---Figure"><img src="image/B16061_05_35.jpg" alt="Figure 5.35: S3 bucket creation for user account balance&#13;&#10;"/></div><p class="figure-caption">Figure 5.35: S3 bucket creation for user account balance</p><p>For the <strong class="source-inline">Bucket name</strong>, type in <strong class="source-inline">account-balance</strong>, and then click <strong class="source-inline">Create</strong>.</p><p class="callout-heading">Note</p><p class="callout">The bucket names in AWS have to be unique. Otherwise, you will get a <strong class="source-inline">Bucket name already exists</strong> error. One easy way to get a unique name is to append the bucket name with today's date plus the time, say, YYYYMMDDHHMM. While writing this chapter, we created an <strong class="source-inline">account-balance-202001241911</strong> bucket and it worked.</p></li>
				<li>Your bucket will be created, and you will be redirected to the bucket list:<div id="_idContainer381" class="IMG---Figure"><img src="image/B16061_05_36.jpg" alt="Figure 5.36: S3 bucket list screen&#13;&#10;"/></div><p class="figure-caption">Figure 5.36: S3 bucket list screen</p></li>
				<li>Click the bucket name you are using (in our case, <strong class="source-inline">account-balance-202001241911</strong>) and then click <strong class="source-inline">Upload</strong>:<div id="_idContainer382" class="IMG---Figure"><img src="image/B16061_05_37.jpg" alt="Figure 5.37: S3 bucket list on the Upload screen&#13;&#10;"/></div><p class="figure-caption">Figure 5.37: S3 bucket list on the Upload screen</p><p>The following screen will display:</p><div id="_idContainer383" class="IMG---Figure"><img src="image/B16061_05_38.jpg" alt="Figure 5.38: S3 Upload bucket Add files screen&#13;&#10;"/></div><p class="figure-caption">Figure 5.38: S3 Upload bucket Add files screen</p></li>
				<li>Click <strong class="source-inline">Add files</strong>:<div id="_idContainer384" class="IMG---Figure"><img src="image/B16061_05_39.jpg" alt="Figure 5.39: S3 Add files selection screen&#13;&#10;"/></div><p class="figure-caption">Figure 5.39: S3 Add files selection screen</p></li>
				<li>Navigate to the <strong class="source-inline">balance.txt</strong> file location. Select the file.<p class="callout-heading">Note</p><p class="callout">The <strong class="source-inline">balance.txt</strong> file is available from the following GitHub repository: <a href="https://packt.live/38CipvB">https://packt.live/38CipvB</a>.</p><p>As we mentioned in <em class="italic">Chapter 1</em>, <em class="italic">An Introduction to AWS</em>, you should have downloaded the GitHub files into a local subdirectory.</p><p>As an example, download the files into the <strong class="source-inline">Documents/aws-book/The-Applied-AI-and-Natural-Language-Processing-with-AWS</strong> directory. As you might have guessed, the files for this exercise are in the <strong class="source-inline">Chapter05</strong> subdirectory.</p></li>
				<li>Once the files have been selected, click the <strong class="source-inline">Open</strong> button to upload the files:<div id="_idContainer385" class="IMG---Figure"><img src="image/B16061_05_40.jpg" alt="Figure 5.40: File selection window in Explorer&#13;&#10;"/></div><p class="figure-caption">Figure 5.40: File selection window in Explorer</p></li>
				<li>Click <strong class="source-inline">Next</strong>:<div id="_idContainer386" class="IMG---Figure"><img src="image/B16061_05_41.jpg" alt="Figure 5.41: S3 Select files tab&#13;&#10;"/></div><p class="figure-caption">Figure 5.41: S3 Select files tab</p></li>
				<li>Set the permissions to those that are shown in the following screenshot:<div id="_idContainer387" class="IMG---Figure"><img src="image/B16061_05_42.jpg" alt="Figure 5.42: S3 Set permissions tab&#13;&#10;"/></div><p class="figure-caption">Figure 5.42: S3 Set permissions tab</p></li>
				<li>Keep the default <strong class="source-inline">Standard</strong> option under <strong class="source-inline">Storage class</strong> and click <strong class="source-inline">Next</strong>:<div id="_idContainer388" class="IMG---Figure"><img src="image/B16061_05_43.jpg" alt="Figure 5.43: S3 Set properties tab&#13;&#10;"/></div><p class="figure-caption">Figure 5.43: S3 Set properties tab</p></li>
				<li>Select <strong class="source-inline">Upload</strong> in the <strong class="source-inline">Review</strong> tab:<div id="_idContainer389" class="IMG---Figure"><img src="image/B16061_05_44.jpg" alt="Figure 5.44: S3 Review tab&#13;&#10;"/></div><p class="figure-caption">Figure 5.44: S3 Review tab</p></li>
				<li>You will see the file in the file list:<div id="_idContainer390" class="IMG---Figure"><img src="image/B16061_05_45.jpg" alt="Figure 5.45: S3 file list&#13;&#10;"/></div></li>
			</ol>
			<p class="figure-caption">Figure 5.45: S3 file list</p>
			<p><strong class="bold">Step 2: Creating a Lambda function to access the S3 Bucket and read the account balance</strong></p>
			<ol>
				<li value="1">Navigate to Amazon Lambda, then <strong class="source-inline">Services</strong>, and click <strong class="source-inline">Lambda</strong> under <strong class="source-inline">Compute</strong>:<div id="_idContainer391" class="IMG---Figure"><img src="image/B16061_05_46.jpg" alt="Figure 5.46: Services &gt; Compute &gt; Lambda&#13;&#10;"/></div><p class="figure-caption">Figure 5.46: Services &gt; Compute &gt; Lambda</p><p>You will see the <strong class="source-inline">Lambda</strong> console as follows:</p><div id="_idContainer392" class="IMG---Figure"><img src="image/B16061_05_47.jpg" alt="Figure 5.47: Lambda console&#13;&#10;"/></div><p class="figure-caption">Figure 5.47: Lambda console</p></li>
				<li>On the <strong class="source-inline">Lambda</strong> console, click <strong class="source-inline">Create function</strong>.</li>
				<li>Choose <strong class="source-inline">Author from scratch</strong> from the available options. For <strong class="source-inline">Function name</strong>, type in <strong class="source-inline">fetch_balance</strong>:<div id="_idContainer393" class="IMG---Figure"><img src="image/B16061_05_48.jpg" alt="Figure 5.48: AWS Lambda – creating a function with the Author from scratch selection&#13;&#10;"/></div><p class="figure-caption">Figure 5.48: AWS Lambda – creating a function with the Author from scratch selection</p></li>
				<li>For the <strong class="source-inline">Runtime</strong> option, choose <strong class="source-inline">Python 3.6</strong> from the list:<div id="_idContainer394" class="IMG---Figure"><img src="image/B16061_05_49.jpg" alt="Figure 5.49: AWS Lambda—Python 3.6 selection&#13;&#10;"/></div><p class="figure-caption">Figure 5.49: AWS Lambda—Python 3.6 selection</p></li>
				<li>Click on <strong class="source-inline">Choose or create an execution role</strong> and select <strong class="source-inline">Create a new role from AWS policy templates</strong>. Then, enter the name <strong class="source-inline">readBalanceRole</strong> in the <strong class="source-inline">Role name</strong> field.</li>
				<li>Click the drop-down menu under <strong class="source-inline">Policy templates</strong> and select <strong class="source-inline">Amazon S3 object read-only permissions</strong>. </li>
				<li>Then, click the <strong class="source-inline">Create function</strong> button to create the Lambda function in AWS:<div id="_idContainer395" class="IMG---Figure"><img src="image/B16061_05_50.jpg" alt="Figure 5.50: AWS Lambda—create function screen&#13;&#10;"/></div><p class="figure-caption">Figure 5.50: AWS Lambda—create function screen</p><p>You will see the Lambda function designer. There is a lot of information there. Let's focus on the essentials for this activity:</p><div id="_idContainer396" class="IMG---Figure"><img src="image/B16061_05_51.jpg" alt="Figure 5.51: AWS Lambda—function designer&#13;&#10;"/></div><p class="figure-caption">Figure 5.51: AWS Lambda—function designer</p></li>
				<li>Next, scroll down the screen to the <strong class="source-inline">Function code</strong> section. The default code will be the same as, or similar to, the following:<div id="_idContainer397" class="IMG---Figure"><img src="image/B16061_05_52.jpg" alt="Figure 5.52: AWS Lambda—the default lambda_function screen&#13;&#10;"/></div><p class="figure-caption">Figure 5.52: AWS Lambda—the default lambda_function screen</p></li>
				<li>Here, we can enter and edit our code entirely within the <strong class="source-inline">lambda_function</strong> tab (as long as <strong class="source-inline">Code entry type</strong> is set to <strong class="source-inline">Edit code inline</strong>, which is the default value in the drop-down menu):<p class="callout-heading">Note</p><p class="callout">For this step, you may either follow along and type in the code or you can obtain it from the source code folder in your local disk where you downloaded the files from GitHub or <a href="https://packt.live/2ZOSJbd">https://packt.live/2ZOSJbd</a>.</p><div id="_idContainer398" class="IMG---Figure"><img src="image/B16061_05_53.jpg" alt="Figure 5.53: Function code for fetch_balance&#13;&#10;"/></div><p class="figure-caption">Figure 5.53: Function code for fetch_balance</p></li>
				<li>First, we import the <strong class="bold">AWS SDK</strong> for Python (<strong class="source-inline">boto3</strong>) from <a href="http://boto3.readthedocs.io/en/latest/">http://boto3.readthedocs.io/en/latest/</a>:<p class="source-code">import boto3</p></li>
				<li>Next, create a function that takes two parameters—<strong class="source-inline">event</strong> and <strong class="source-inline">context</strong>:<p class="source-code">def Lambda_handler(event, context):</p></li>
				<li>Next, create the <strong class="source-inline">s3</strong> client object:<p class="source-code">s3 = boto3.client("s3")</p></li>
				<li>Next, replace <strong class="source-inline">&lt;input Bucket name&gt;</strong> with the bucket you created (<strong class="source-inline">account-balance-202001241911</strong>, in my example):<p class="source-code"># e.g." account-balance-202001241911"</p><p class="source-code">bucket = "&lt;input Bucket name&gt;"</p></li>
				<li>Next, assign the <strong class="source-inline">filename</strong> to a variable, and then print the filename:<p class="source-code">filename = 'balance.txt'</p><p class="source-code">print("filename: ", filename)</p></li>
				<li>Next, create the file object by getting the <strong class="source-inline">Bucket</strong> and <strong class="source-inline">Key</strong>:<p class="source-code">file_obj = s3.get_object(Bucket = Bucket, Key = filename)</p></li>
				<li>Extract the account balance from the file:<p class="source-code">account_balance =  (float(file_obj['Body'].read()))</p></li>
				<li>Then, return the balance as a message:<p class="source-code">return close('Your balance is ' + str(account_balance))</p></li>
				<li>We need the <strong class="source-inline">close</strong> function for our bot, which requires a well-formed JSON response:<p class="source-code">def close(message):</p><p class="source-code">    return {</p><p class="source-code">        'sessionAttributes': {},</p><p class="source-code">        'dialogAction': {</p><p class="source-code">            'type': 'Close',</p><p class="source-code">            'fulfillmentState': 'Fulfilled',</p><p class="source-code">            'message': {</p><p class="source-code">                'contentType': 'PlainText',</p><p class="source-code">                'content': message</p><p class="source-code">            }</p><p class="source-code">        }</p><p class="source-code">    }</p><p>Remember to <strong class="source-inline">Save</strong> the function frequently:</p><p class="callout-heading">Note</p><p class="callout">Use the <strong class="source-inline">Test</strong> button in the top-right corner to test and debug the code. You will see the results in <strong class="source-inline">Execution Results</strong> below the code pane.</p></li>
				<li>Click the <strong class="source-inline">Test</strong> button on the top-right corner:<div id="_idContainer399" class="IMG---Figure"><img src="image/B16061_05_54.jpg" alt="Figure 5.54: Test Button for testing Lambda function&#13;&#10;"/></div><p class="figure-caption">Figure 5.54: Test Button for testing Lambda function</p></li>
				<li>For every test, we need to create at least one <strong class="source-inline">Test Event</strong>. If this is the first time you are running a test, you will see the <strong class="source-inline">Configure test event</strong> screen:<div id="_idContainer400" class="IMG---Figure"><img src="image/B16061_05_55.jpg" alt="Figure 5.55: Configure Test Event to test a Lambda function&#13;&#10;"/></div><p class="figure-caption">Figure 5.55: Configure Test Event to test a Lambda function</p></li>
				<li>If the event expects values, for example a stock symbol or an account number, this is the place to create a valid JSON payload for the event. And, if you have multiple actions based on what the user asks for, you can have multiple events and then invoke the lambda with any of the events. In our case, to keep the interaction simple, we do not look for any information in the event payload. So just give the event a name – for example, type <strong class="source-inline">getBalance</strong> and then click the <strong class="source-inline">Create</strong> button.<div id="_idContainer401" class="IMG---Figure"><img src="image/B16061_05_56.jpg" alt="Figure 5.56: Configure Test Event with name getBalance&#13;&#10;"/></div><p class="figure-caption">Figure 5.56: Configure Test Event with name getBalance</p></li>
				<li>You will see the results under the <strong class="source-inline">Execution Results</strong> tab:<div id="_idContainer402" class="IMG---Figure"><img src="image/B16061_05_57.jpg" alt="Figure 5.57: Execution results of fetch_balance - Response&#13;&#10;"/></div><p class="figure-caption">Figure 5.57: Execution results of fetch_balance - Response</p></li>
				<li>If you scroll down in the Execution results window, you will see more details and the <strong class="source-inline">Function Logs</strong> where you will see the diagnostic prints that you have in your code. It is always good to print diagnostic messages while developing a lambda function:<div id="_idContainer403" class="IMG---Figure"><img src="image/B16061_05_58.jpg" alt="Figure 5.58: Execution results of fetch_balance – Function Logs&#13;&#10;"/></div></li>
			</ol>
			<p class="figure-caption">Figure 5.58: Execution results of fetch_balance – Function Logs</p>
			<p><strong class="bold">Step 3: Creating a Lex bot to get the balance using the Lambda function</strong></p>
			<ol>
				<li value="1">The first step is to navigate to the <strong class="source-inline">Amazon Lex</strong> service within the AWS Console. You can do so by clicking on <strong class="source-inline">Services</strong> | <strong class="source-inline">Machine Learning</strong> | <strong class="source-inline">Amazon Lex</strong> or navigating to <a href="https://console.aws.amazon.com/lex">https://console.aws.amazon.com/lex</a>.</li>
				<li>The next step is to click on the <strong class="source-inline">Create</strong> button in order to get to the <strong class="source-inline">Bots</strong> creation screen:<div id="_idContainer404" class="IMG---Figure"><img src="image/B16061_05_59.jpg" alt="Figure 5.59: The Amazon Lex console&#13;&#10;"/></div><p class="figure-caption">Figure 5.59: The Amazon Lex console</p></li>
				<li>At this point, you can create a custom bot by clicking on the <strong class="source-inline">Custom bot</strong> option. This reveals the bot's details, which can be filled out, as shown in the following screenshot:<div id="_idContainer405" class="IMG---Figure"><img src="image/B16061_05_60.jpg" alt="Figure 5.60: The Custom bot option&#13;&#10;"/></div><p class="figure-caption">Figure 5.60: The Custom bot option</p></li>
				<li>The <strong class="source-inline">Bot name</strong> field can be set to <strong class="source-inline">GetBalance</strong>. The <strong class="source-inline">Output voice</strong> field is set to any of the voices, for example, you can select <strong class="source-inline">Kendra</strong>. This is because we will be interacting with the bot using voice.</li>
				<li><strong class="source-inline">Session timeout</strong> can be set to the default of <strong class="source-inline">5</strong> <strong class="source-inline">min</strong>. The <strong class="source-inline">IAM role</strong> field displays the name of the IAM role, which is automatically created by Lex for use by bot applications. Let's say <strong class="source-inline">No</strong> to <strong class="source-inline">Sentiment analysis</strong>.</li>
				<li>Finally, the <strong class="source-inline">COPPA</strong> field pertains to the <strong class="source-inline">Children's Online Privacy Protection Act</strong>, which online applications must conform with. Choose <strong class="source-inline">Yes</strong> or <strong class="source-inline">No</strong> depending on whether you want to have someone under the age of 13 using your chatbot. <p class="callout-heading">Note</p><p class="callout">A law was passed in 1998 to protect the privacy of children under 13. It states that online sites may not collect personal information from users who are younger than 13 years old without parental consent, among other provisions. You can learn more about COPPA at <a href="https://www.ftc.gov/enforcement/rules/rulemaking-regulatory-reform-proceedings/childrens-online-privacy-protection-rule">https://www.ftc.gov/enforcement/rules/rulemaking-regulatory-reform-proceedings/childrens-online-privacy-protection-rule</a>.</p></li>
				<li>Finally, clicking on the <strong class="source-inline">Create</strong> button will create the chatbot and bring you to the bot's <strong class="source-inline">Editor</strong> screen. This screen will allow you to create and define an intent for the bot, as well as a slot with a custom slot type.</li>
				<li>Click on the <strong class="source-inline">Create Intent</strong> button to bring up the <strong class="source-inline">Add Intent</strong> pop-up dialog window:<div id="_idContainer406" class="IMG---Figure"><img src="image/B16061_05_61.jpg" alt="Figure 5.61: GetBalance bot’s Editor tab&#13;&#10;"/></div><p class="figure-caption">Figure 5.61: GetBalance bot's Editor tab</p></li>
				<li>Conversely, if you already have an intent defined, you can create a new one by clicking on the <strong class="source-inline">+</strong> sign next to the <strong class="source-inline">Intents</strong> heading in the left-hand side menu on the screen.</li>
				<li>The <strong class="source-inline">Create Intent</strong> window offers a few options to add an intent to the bot. The <strong class="source-inline">Import intent</strong> link allows you to import an intent from a <strong class="source-inline">ZIP</strong> file containing one or more <strong class="source-inline">JSON</strong> files with intents in the Lex format.</li>
				<li>The search for existing intents allows you to reuse the intents that you may have defined or imported previously, as well as the built-in intents defined by Amazon Lex.</li>
				<li>You should just click on the <strong class="source-inline">Create Intent</strong> link, however, to get to the following dialog box.</li>
				<li>In the <strong class="source-inline">Create intent</strong> dialog box, name your new intent <strong class="source-inline">Balance</strong>. The bot will recognize this intent when you let it know that you are interested in a market quote. Click on the <strong class="source-inline">Add</strong> button to complete this step:<div id="_idContainer407" class="IMG---Figure"><img src="image/B16061_05_62.jpg" alt="Figure 5.62: The Create intent dialog box&#13;&#10;"/></div><p class="figure-caption">Figure 5.62: The Create intent dialog box</p><p>You should be back at the <strong class="bold">Editor</strong> screen at this point, and you should see the <strong class="source-inline">Balance</strong> intent in the left toolbar portion of the screen. The <strong class="bold">Editor</strong> screen also contains many fields that are used to define and customize the new intent.</p></li>
				<li>The first thing to do is to fill in some <strong class="source-inline">Sample utterances</strong> to train the NLU system behind Lex to recognize the utterances you will provide to the bot as signals from the user for the <strong class="source-inline">Balance</strong> intent:<div id="_idContainer408" class="IMG---Figure"><img src="image/B16061_05_63.jpg" alt="Figure 5.63: Creation of the new intent&#13;&#10;"/></div><p class="figure-caption">Figure 5.63: Creation of the new intent</p></li>
				<li>After entering some sample utterances, you click on the <strong class="source-inline">Build</strong> button near the top of the page in order to kick off the training process for the bot:<div id="_idContainer409" class="IMG---Figure"><img src="image/B16061_05_64.jpg" alt="Figure 5.64: Building the bot&#13;&#10;"/></div><p class="figure-caption">Figure 5.64: Building the bot</p></li>
				<li>There will be a follow-up dialog box with another <strong class="source-inline">Build</strong> button, which you should also click on:<div id="_idContainer410" class="IMG---Figure"><img src="image/B16061_05_65.jpg" alt="Figure 5.65: Build confirmation&#13;&#10;"/></div><p class="figure-caption">Figure 5.65: Build confirmation</p></li>
				<li>After this, you should wait until you see the <strong class="source-inline">GetBalance build was successful</strong> message box. It might take between a few seconds and a couple of minutes:<div id="_idContainer411" class="IMG---Figure"><img src="image/B16061_05_66.jpg" alt="Figure 5.66: Bot build is successful&#13;&#10;&#13;&#10;"/></div><p class="figure-caption">Figure 5.66: Bot build is successful</p><p>You can test your new intent within the bot in the <strong class="source-inline">Test bot</strong> pane, in the top-right corner of the screen.</p><p class="callout-heading">Note</p><p class="callout">If the <strong class="source-inline">Test bot</strong> pane is not visible, you may have to click on the arrow button in order to expand it and make it visible.</p><p>Type utterances into the pane to verify that the bot is able to recognize the correct intent from the utterances:</p><div id="_idContainer412" class="IMG---Figure"><img src="image/B16061_05_67.jpg" alt="Figure 5.67: Test bot pane &#13;&#10;"/></div><p class="figure-caption">Figure 5.67: Test bot pane </p><p>You know that it has recognized the intent correctly when it returns the response: <strong class="source-inline">Intent Balance is</strong> <strong class="source-inline">ReadyForFulfillment</strong>. Feel free to experiment with different utterances, based on your sample utterances, in order to verify that the NLU engine is working correctly.</p><p>At this point, your bot does not do much, other than try to recognize the <strong class="source-inline">Balance</strong> intent and flag that it is ready for fulfillment.</p></li>
				<li>Let's now connect our Lambda function and see whether it works. Select <strong class="source-inline">AWS Lambda function</strong> in <strong class="source-inline">Fulfillment</strong> and then select the <strong class="source-inline">fetch_balance</strong> Lambda function:<div id="_idContainer413" class="IMG---Figure"><img src="image/B16061_05_68.jpg" alt="Figure 5.68: Lambda initiation&#13;&#10;"/></div><p class="figure-caption">Figure 5.68: Lambda initiation</p></li>
				<li>Click <strong class="source-inline">Build</strong> and then test again. Now it should show the balance:<div id="_idContainer414" class="IMG---Figure"><img src="image/B16061_05_69.jpg" alt="Figure 5.69: Testing the Lambda function&#13;&#10;"/></div></li>
			</ol>
			<p class="figure-caption">Figure 5.69: Testing the Lambda function</p>
			<p>We are making good progress.</p>
			<p><strong class="bold">Step 4: Connecting the Amazon Connect call center to the GetBalance bot</strong></p>
			<p>We will extend the call center created in <strong class="source-inline">Exercise 5.01</strong> to add this <strong class="source-inline">GetBalance</strong> feature.</p>
			<ol>
				<li value="1">From the <strong class="source-inline">My Account</strong> | <strong class="source-inline">AWS Management Console</strong>, go to <strong class="source-inline">Services </strong>|<strong class="source-inline"> Customer Engagement</strong> |<strong class="source-inline"> Amazon Connect</strong>. Select the instance you have created (<strong class="source-inline">jarvis42</strong>, in our case):<div id="_idContainer415" class="IMG---Figure"><img src="image/B16061_05_70.jpg" alt="Figure 5.70: Amazon Connect contact flow configuration&#13;&#10;"/></div><p class="figure-caption">Figure 5.70: Amazon Connect contact flow configuration</p><p>We have two ways to connect — via Amazon Lex or AWS Lambda. We will use Lex, but feel free to try out Lambda.</p></li>
				<li>Add the <strong class="source-inline">GetBalance</strong> bot:<div id="_idContainer416" class="IMG---Figure"><img src="image/B16061_05_71.jpg" alt="Figure 5.71: Amazon Connect contact flows&#13;&#10;"/></div><p class="figure-caption">Figure 5.71: Amazon Connect contact flows</p></li>
				<li>The next step is to create a contact flow. Go to the Dashboard, click <strong class="source-inline">View Contact Flows</strong> and <strong class="source-inline">Create Contact Flow</strong> in the upper-right corner:</li>
				<li>Name it <strong class="source-inline">GetBalance</strong> and wire it as follows:<div id="_idContainer417" class="IMG---Figure"><img src="image/B16061_05_72.jpg" alt="Figure 5.72: Contact flow editor—add entry point&#13;&#10;"/></div><p class="figure-caption">Figure 5.72: Contact flow editor—add entry point</p></li>
				<li>Add <strong class="source-inline">Get customer input</strong> and a friendly message:<div id="_idContainer418" class="IMG---Figure"><img src="image/B16061_05_73.jpg" alt="Figure 5.73: Get customer input details&#13;&#10;"/></div><p class="figure-caption">Figure 5.73: Get customer input details</p></li>
				<li>Connect it to our <strong class="source-inline">GetBalance</strong> Lex bot and the <strong class="source-inline">Balance</strong> intent:<div id="_idContainer419" class="IMG---Figure"><img src="image/B16061_05_74.jpg" alt="Figure 5.74: Get customer input configurations&#13;&#10;"/></div><p class="figure-caption">Figure 5.74: Get customer input configurations</p><p>Then, connect all of them to hang up for now. It is a simple sequence. You can experiment with various flows:</p><div id="_idContainer420" class="IMG---Figure"><img src="image/B16061_05_75.jpg" alt="Figure 5.75: Add a hang up flow&#13;&#10;"/></div><p class="figure-caption">Figure 5.75: Add a hang up flow</p><p>Now that we have created another contact flow, let's rewire our phone number to answer this.</p></li>
				<li>Go to <strong class="source-inline">Overview</strong> and click on <strong class="source-inline">Login URL</strong> and then enter your Amazon Connect credentials:<div id="_idContainer421" class="IMG---Figure"><img src="image/B16061_05_76.jpg" alt="Figure 5.76: Overview screen&#13;&#10;"/></div><p class="figure-caption">Figure 5.76: Overview screen</p></li>
				<li>Click on <strong class="source-inline">Routing</strong> and <strong class="source-inline">Phone numbers</strong>:<div id="_idContainer422" class="IMG---Figure"><img src="image/B16061_05_77.jpg" alt="Figure 5.77: Selecting the phone numbers&#13;&#10;"/></div><p class="figure-caption">Figure 5.77: Selecting the phone numbers</p></li>
				<li>Click on the phone number:<div id="_idContainer423" class="IMG---Figure"><img src="image/B16061_05_78.jpg" alt="Figure 5.78: Manage Phone numbers screen&#13;&#10;"/></div><p class="figure-caption">Figure 5.78: Manage Phone numbers screen</p></li>
				<li>Select <strong class="source-inline">GetBalance</strong> from the drop-down list for <strong class="source-inline">Contact flow/IVR</strong>:<div id="_idContainer424" class="IMG---Figure"><img src="image/B16061_05_79.jpg" alt="Figure 5.79: Add GetBalance to the phone number&#13;&#10;"/></div><p class="figure-caption">Figure 5.79: Add GetBalance to the phone number</p></li>
				<li>Click <strong class="source-inline">Save</strong>. Now you have wired your bot to a call center.</li>
				<li>Call the number. It will ask you <strong class="source-inline">How may I help you?</strong> You can say <strong class="source-inline">How much money do I have?</strong> and it will reply <strong class="source-inline">You have 42.0!</strong> Amazon has done a good job: when we activated the bot via the keyboard from the test console, it gave us a text message back. However, when we called it via Connect, it gave us a voice answer back.</li>
			</ol>
			<p>This is a good time to play around with different questions and even different people—your friends, your spouse, and others. With relatively very little work, the voice bot will understand what they are saying and answer this simple question. You can try different prompts, maybe even add a dollar sign and see whether it says it the right way.</p>
			<h1 id="_idParaDest-161"><a id="_idTextAnchor164"/>6. Computer Vision and Image Processing</h1>
			<h2 id="_idParaDest-162"><a id="_idTextAnchor165"/>Activity 6.01: Creating and Analyzing Different Faces in Rekognition</h2>
			<p><strong class="bold">Solution</strong>:</p>
			<ol>
				<li value="1">Navigate to the Amazon Rekognition service from the Amazon Management Console and choose <strong class="source-inline">Face comparison</strong> from the left toolbar.</li>
				<li>Upload the first set of images to Rekognition so that it can recognize and compare the faces, that is, <a href="https://packt.live/31X6IP6">https://packt.live/31X6IP6</a> and <a href="https://packt.live/2ZLseUd">https://packt.live/2ZLseUd</a>:<div id="_idContainer425" class="IMG---Figure"><img src="image/B16061_06_56.jpg" alt="Figure 6.56: The first images provided for face comparison&#13;&#10;"/></div><p class="figure-caption">Figure 6.56: The first images provided for face comparison</p><p>Rekognition can recognize that the faces are of the same person with a <strong class="source-inline">99.1</strong>% degree of confidence, even with different angles, lighting, and shades:</p><div id="_idContainer426" class="IMG---Figure"><img src="image/B16061_06_57.jpg" alt="Figure 6.57: Results for the first images provided for face comparison&#13;&#10;"/></div><p class="figure-caption">Figure 6.57: Results for the first images provided for face comparison</p><p><strong class="bold">Additional Challenge</strong></p></li>
				<li>The second set of images are <a href="https://images.unsplash.com/photo-1526510747491-58f928ec870f">https://images.unsplash.com/photo-1526510747491-58f928ec870f</a> and <a href="https://images.unsplash.com/photo-1529946179074-87642f6204d7">https://images.unsplash.com/photo-1529946179074-87642f6204d7</a>:</li>
			</ol>
			<div>
				<div id="_idContainer427" class="IMG---Figure">
					<img src="image/B16061_06_58.jpg" alt="Figure 6.58: The second images provided for face comparison&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 6.58: The second images provided for face comparison</p>
			<p>Once again, Rekognition recognizes the faces with a 99.4% degree of confidence, even at different angles:</p>
			<div>
				<div id="_idContainer428" class="IMG---Figure">
					<img src="image/B16061_06_59.jpg" alt="Figure 6.59: Results for the second images provided for face comparison&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 6.59: Results for the second images provided for face comparison</p>
			<p>With those impressive results, we conclude this activity. </p>
		</div>
		<div>
			<div id="_idContainer430" class="Content">
			</div>
		</div>
	</body></html>