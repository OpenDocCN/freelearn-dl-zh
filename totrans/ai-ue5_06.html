<html><head></head><body>
  <div><h1 class="chapter-number" id="_idParaDest-114">
    <a id="_idTextAnchor116">
    </a>
    
     6
    
   </h1>
   <h1 id="_idParaDest-115">
    <a id="_idTextAnchor117">
    </a>
    
     Optimizing the Navigation System
    
   </h1>
   <p>
    
     As a project grows in complexity, ensuring that the nav meshes are finely tuned for smooth and efficient AI agent movement becomes crucial.
    
    
     That’s why in this chapter, we will delve into the world of optimizing and debugging the
    
    
     
      Navigation System.
     
    
   </p>
   <p>
    
     Throughout this chapter, we will explore various techniques and strategies to optimize nav meshes, and we will discuss ways to streamline the pathfinding calculations, reduce computational overhead, and improve
    
    
     
      overall performance.
     
    
   </p>
   <p>
    
     You will also acquire the tools and knowledge necessary to effectively debug any issues that may arise within the Navigation System.
    
    
     From troubleshooting pathfinding errors to identifying nav mesh inconsistencies, we will cover a range of debugging techniques to help you conquer any obstacles standing in the way of your agents’
    
    
     
      smooth navigation.
     
    
   </p>
   <p>
    
     In this chapter, we will be covering the
    
    
     
      following topics:
     
    
   </p>
   <ul>
    <li>
     
      Understanding the nav mesh
     
     
      
       debugging tool
      
     
    </li>
    <li>
     
      Analyzing nav
     
     
      
       mesh resolution
      
     
    </li>
    <li>
     
      Refining nav
     
     
      
       mesh generation
      
     
    </li>
    <li>
     
      Making
     
     
      
       further improvements
      
     
    </li>
   </ul>
   <h1 id="_idParaDest-116">
    <a id="_idTextAnchor118">
    </a>
    
     Technical requirements
    
   </h1>
   <p>
    
     To follow the topics presented in this chapter, you should have completed the previous ones and understood
    
    
     
      their content.
     
    
   </p>
   <p>
    
     Additionally, if you would prefer to begin with code from the companion repository for this book, you can download the
    
    <strong class="source-inline">
     
      .zip
     
    </strong>
    
     project files provided in this book’s companion project repository
    
    
     
      at
     
    
    <a href="https://github.com/PacktPublishing/Artificial-Intelligence-in-Unreal-Engine-5">
     
      
       https://github.com/PacktPublishing/Artificial-Intelligence-in-Unreal-Engine-5
      
     
    </a>
    
     
      .
     
    
   </p>
   <p>
    
     To download the files from the end of the last chapter, click the
    
    <strong class="source-inline">
     
      Unreal Agility Arena –
     
    </strong>
    
     <strong class="source-inline">
      
       Chapter 05
      
     </strong>
    
    <strong class="source-inline">
     
      -
     
    </strong>
    
     <strong class="source-inline">
      
       End
      
     </strong>
    
    
     
      link.
     
    
   </p>
   <h1 id="_idParaDest-117">
    <a id="_idTextAnchor119">
    </a>
    
     Understanding the nav mesh debugging tool
    
   </h1>
   <p>
    <em class="italic">
     
      Driven by his relentless pursuit of perfection, Dr.
     
     
      Markus delved into the task of debugging and improving the artificial intelligence dummy puppets.
     
     
      Armed with a tireless spirit and a mind brimming with innovative ideas, he set out to fine-tune the puppets’ capabilities and address any glitches or shortcomings they encountered during
     
    </em>
    
     <em class="italic">
      
       their experiments.
      
     </em>
    
   </p>
   <p>
    <em class="italic">
     
      With his trusty assistant, Professor Viktoria, by his side, Dr.
     
     
      Markus meticulously analyzed the data collected from the puppets’ previous expeditions, scrutinizing every line of code, searching for any potential flaws, and seeking opportunities to enhance
     
    </em>
    
     <em class="italic">
      
       their performance.
      
     </em>
    
   </p>
   <p>
    
     As a
    
    <a id="_idIndexMarker228">
    </a>
    
     game programmer, you already know that optimizing code in your games and hunting down bugs is crucial for creating successful games.
    
    
     The AI system is no exception to this.
    
    
     Luckily, Unreal Engine provides a set of features – the
    
    <strong class="bold">
     
      debugging tools
     
    </strong>
    
     – that
    
    <a id="_idIndexMarker229">
    </a>
    
     grant you invaluable insights into the inner workings of the Navigation System, allowing you to visualize and analyze the nav mesh in real time.
    
    
     In this section, we will start exploring these tools in order to check how the system behaves and whether it is
    
    
     
      working well.
     
    
   </p>
   <p class="callout-heading">
    
     Note
    
   </p>
   <p class="callout">
    
     In this chapter, we are going to consider just the part of the debugging tools that will let you analyze the nav mesh system, but you should be aware that the AI debugging system covers all the AI features available in Unreal Engine.
    
    
     That’s why I will get back to the debugging tools later in this book, when I will be covering other
    
    
     
      AI topics.
     
    
   </p>
   <p>
    
     Let’s start by checking how the AI debugging tools can be enabled and how to get started with the nav mesh
    
    
     
      debugging features.
     
    
   </p>
   <h2 id="_idParaDest-118">
    <a id="_idTextAnchor120">
    </a>
    
     Enabling the AI debugging tools
    
   </h2>
   <p>
    
     To enable
    
    <a id="_idIndexMarker230">
    </a>
    
     the debugging tools, all you need to do is to hit the
    
    <a id="_idIndexMarker231">
    </a>
    
     apostrophe key (
    
    <em class="italic">
     
      ‘
     
    </em>
    
     ) on your keyboard.
    
    
     Be aware that on some keyboard layouts – such as mine – this key may not be available; you can add your own shortcut by doing
    
    
     
      the following:
     
    
   </p>
   <ol>
    <li>
     
      From the main menu, select
     
     <strong class="bold">
      
       Edit
      
     </strong>
     
      |
     
     
      <strong class="bold">
       
        Editor Preferences
       
      </strong>
     
     
      
       .
      
     
    </li>
    <li>
     
      Select the
     
     <strong class="bold">
      
       General – Keyboard Shortcuts
      
     </strong>
     
      category and, in the search bar, type
     
     <strong class="source-inline">
      
       show
      
     </strong>
     
      <strong class="source-inline">
       
        ai debug
       
      </strong>
     
     
      
       .
      
     
    </li>
    <li>
     
      In the
     
     <strong class="bold">
      
       Show AI Debug
      
     </strong>
     
      field, insert your favorite shortcut.
     
     
      In my case, I opted for the
     
     <strong class="source-inline">
      
       /
      
     </strong>
     
      character from
     
     
      
       the numpad.
      
     
    </li>
   </ol>
   <div><div><img alt="Figure 6.1 – AI debugger shortcut" src="img/B31016_06_1.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 6.1 – AI debugger shortcut
    
   </p>
   <ol>
    <li value="4">
     
      Once the AI debugging tools are enabled, you can toggle the AI information by using the following
     
     
      
       numpad keys:
      
     
     <ul>
      <li>
       <em class="italic">
        
         Numpad 0
        
       </em>
       
        : Displays or hides information about the currently available nav
       
       
        
         mesh data
        
       
      </li>
      <li>
       <em class="italic">
        
         Numpad 1
        
       </em>
       
        : Displays or hides general AI
       
       
        
         debug information
        
       
      </li>
      <li>
       <em class="italic">
        
         Numpad 2
        
       </em>
       
        : Displays or hides behavior trees
       
       
        
         debug information
        
       
      </li>
      <li>
       <em class="italic">
        
         Numpad 3
        
       </em>
       
        : Displays or hides EQS
       
       
        
         debug information
        
       
      </li>
      <li>
       <em class="italic">
        
         Numpad 4
        
       </em>
       
        : Displays or hides AI perception
       
       
        
         debug information
        
       
      </li>
      <li>
       <em class="italic">
        
         Numpad 5
        
       </em>
       
        : Displays or hides AI perception system
       
       
        
         debug information
        
       
      </li>
     </ul>
    </li>
   </ol>
   <p>
    
     Let’s start
    
    <a id="_idIndexMarker232">
    </a>
    
     checking
    
    <a id="_idIndexMarker233">
    </a>
    
     these tools with the gym levels we have created in the
    
    
     
      previous chapters.
     
    
   </p>
   <h2 id="_idParaDest-119">
    <a id="_idTextAnchor121">
    </a>
    
     Inspecting the AI debugging tool
    
   </h2>
   <p>
    
     To start
    
    <a id="_idIndexMarker234">
    </a>
    
     using the AI debugging tools, all you need is a level.
    
    
     So, start
    
    <a id="_idIndexMarker235">
    </a>
    
     by opening the
    
    <strong class="bold">
     
      Gym_NavMesh_01
     
    </strong>
    
     level and doing
    
    
     
      the following:
     
    
   </p>
   <ol>
    <li>
     
      Disable the nav mesh visualization tool – if enabled – by pressing the
     
     <em class="italic">
      
       P
      
     </em>
     
      key; this will avoid cluttering the AI
     
     
      
       information display.
      
     
    </li>
    <li>
     
      Start the level simulation and immediately
     
     
      
       pause it.
      
     
    </li>
    <li>
     
      Enable the AI debugging tools by pressing the apostrophe key; this will open a sidebar and you will get some display messages, as shown in
     
     
      <em class="italic">
       
        Figure 6
       
      </em>
     
     
      <em class="italic">
       
        .2
       
      </em>
     
     
      
       :
      
     
    </li>
   </ol>
   <div><div><img alt="Figure 6.2 – AI debugging tools in action" src="img/B31016_06_2.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 6.2 – AI debugging tools in action
    
   </p>
   <ol>
    <li value="4">
     
      Once the debugging tools are enabled, ensure that the
     
     <strong class="bold">
      
       Navmesh
      
     </strong>
     
      and
     
     <strong class="bold">
      
       AI
      
     </strong>
     
      categories are enabled and that all the other ones are disabled by using the corresponding numpad keys.
     
     
      Enabled categories are highlighted in green, as shown in
     
     
      <em class="italic">
       
        Figure 6
       
      </em>
     
     
      <em class="italic">
       
        .3
       
      </em>
     
     
      
       :
      
     
    </li>
   </ol>
   <div><div><img alt="Figure 6.3 – Enabled categories" src="img/B31016_06_3.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 6.3 – Enabled categories
    
   </p>
   <p class="list-inset">
    
     Still with the game paused, do
    
    
     
      the following:
     
    
   </p>
   <ol>
    <li value="5">
     
      Look
     
     <a id="_idIndexMarker236">
     </a>
     
      for
     
     <strong class="bold">
      
       BP_NavMeshAgent
      
     </strong>
     
      , and you will notice
     
     <a id="_idIndexMarker237">
     </a>
     
      that it now has a red
     
     
      
       icon associated.
      
     
    </li>
    <li>
     
      Click on the actor to select it; this will show some information on it.
     
     
      The most important one is the associated
     
     
      
       AI controller.
      
     
    </li>
   </ol>
   <p class="IMG---Figure">
   </p>
   <div><div><img alt="Figure 6.4 – AI agent" src="img/B31016_06_4.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 6.4 – AI agent
    
   </p>
   <p class="list-inset">
    
     Additionally, on the display, you will see additional information about the AI agent, as shown in
    
    
     <em class="italic">
      
       Figure 6
      
     </em>
    
    
     <em class="italic">
      
       .5
      
     </em>
    
    
     
      :
     
    
   </p>
   <div><div><img alt="Figure 6.5 – AI agent information" src="img/B31016_06_5.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 6.5 – AI agent information
    
   </p>
   <p class="list-inset">
    
     As you can see from the image, this display offers a plethora of information, including the controlling pawn, the controller, and the mesh the agent is
    
    
     
      walking on.
     
    
   </p>
   <p class="list-inset">
    
     Finally, you will get probably one of the most interesting pieces of information on the nav mesh and the pathfinding system; if you move around the level, you will see a highlight of the polygons that make up the path to the
    
    
     
      target point.
     
    
   </p>
   <div><div><img alt="Figure 6.6 – Pathfinding polygons" src="img/B31016_06_6.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 6.6 – Pathfinding polygons
    
   </p>
   <p>
    
     As an extra
    
    <a id="_idIndexMarker238">
    </a>
    
     exercise, you can open up all the other levels and see
    
    <a id="_idIndexMarker239">
    </a>
    
     which information you can get from the tool.
    
    
     For example, you may look at the
    
    <strong class="bold">
     
      Gym_NavMesh_04
     
    </strong>
    
     level and check what happens when the moving platform moves up
    
    
     
      and down.
     
    
   </p>
   <p>
    
     In this section, you have been introduced to the tools that will provide meaningful pieces of information on the AI system; in the next section, I’ll show you how to derive insights on nav mesh generation for your levels in order to
    
    
     
      optimize them.
     
    
   </p>
   <h1 id="_idParaDest-120">
    <a id="_idTextAnchor122">
    </a>
    
     Analyzing nav mesh resolution
    
   </h1>
   <p>
    
     Unreal Engine
    
    <a id="_idIndexMarker240">
    </a>
    
     provides a
    
    <strong class="bold">
     
      Navigation Mesh Resolution
     
    </strong>
    
     system
    
    <a id="_idIndexMarker241">
    </a>
    
     that lets developers create mesh tiles at three distinct levels of detail within a single nav mesh.
    
    
     This means that you have the flexibility to generate sets of tiles with high, medium – the default option – or low precision settings.
    
    
     By opting for different precision levels, users can achieve faster generation – in terms of computing time – of a dynamic nav mesh while the game
    
    
     
      is playing.
     
    
   </p>
   <p class="callout-heading">
    
     Note
    
   </p>
   <p class="callout">
    
     When we speak about
    
    <strong class="bold">
     
      resolution
     
    </strong>
    
     , we mean the precision and quantity of cells produced to map a specific
    
    
     
      navigation area.
     
    
   </p>
   <p>
    
     A high-resolution
    
    <a id="_idIndexMarker242">
    </a>
    
     tile may divide a given area into more polygons to closely approximate its shape.
    
    
     Conversely, a low-resolution tile will encompass the same area but with fewer polygons.
    
    
     This trade-off enables quicker tile generation but may sacrifice some accuracy in
    
    
     
      the process.
     
    
   </p>
   <p>
    
     As a first test, we can start analyzing one of
    
    
     
      our gyms:
     
    
   </p>
   <ol>
    <li>
     
      Open the
     
     
      <strong class="bold">
       
        Gym_NavMesh_01
       
      </strong>
     
     
      
       level.
      
     
    </li>
    <li>
     
      For a better view of the level, select the
     
     
      <strong class="bold">
       
        Top
       
      </strong>
     
     
      
       view.
      
     
    </li>
   </ol>
   <div><div><img alt="Figure 6.7 – Selecting the Top view" src="img/B31016_06_7.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 6.7 – Selecting the Top view
    
   </p>
   <ol>
    <li value="3">
     
      In
     
     <strong class="bold">
      
       Outliner
      
     </strong>
     
      , select the
     
     <strong class="bold">
      
       Recast Nav
      
     </strong>
     
      <strong class="bold">
       
        Mesh
       
      </strong>
     
     
      
       actor.
      
     
     <p class="list-inset">
      
       To get the overall information on the cost for your nav mesh, do
      
      
       
        the following:
       
      
     </p>
    </li>
    <li>
     
      With the
     
     <strong class="bold">
      
       Recast Nav Mesh
      
     </strong>
     
      actor still selected, check the
     
     <strong class="bold">
      
       Draw Tile Bounds
      
     </strong>
     
      property in the
     
     
      <strong class="bold">
       
        Details
       
      </strong>
     
     
      
       panel.
      
     
    </li>
    <li>
     
      Check the
     
     <strong class="bold">
      
       Draw Tile Bounds Times
      
     </strong>
     
      property.
     
     
      You should get a view like that shown in
     
     
      <em class="italic">
       
        Figure 6
       
      </em>
     
     
      <em class="italic">
       
        .8
       
      </em>
     
     
      
       :
      
     
    </li>
   </ol>
   <div><div><img alt="Figure 6.8 – Tiles and tile generation time" src="img/B31016_06_8.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 6.8 – Tiles and tile generation time
    
   </p>
   <p class="list-inset">
    
     The
    
    <strong class="bold">
     
      Draw Tile Bounds Time
     
    </strong>
    
     property shows the time cost of processing a specific tile; you
    
    <a id="_idIndexMarker243">
    </a>
    
     will notice that more complex areas will take more time to compute.
    
    
     If you want a more visual representation of the cost, you can check
    
    <strong class="bold">
     
      Draw Tile Build Times Heat Map
     
    </strong>
    
     , which will enable a heat map visualization of the cost, as shown in
    
    
     <em class="italic">
      
       Figure 6
      
     </em>
    
    
     <em class="italic">
      
       .9
      
     </em>
    
    
     
      :
     
    
   </p>
   <div><div><img alt="Figure 6.9 – Heat map visualization" src="img/B31016_06_9.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 6.9 – Heat map visualization
    
   </p>
   <p class="callout-heading">
    
     Note
    
   </p>
   <p class="callout">
    
     If you are not familiar with this feature, a heat map is a visual representation of data that employs color-coded systems to display the volume or intensity of a specific attribute across a defined area or dataset.
    
    
     Heat maps are adaptable and find application in diverse scenarios, including data analysis, user behavior analysis, and geographic representation.
    
    
     In our scenario, by associating colors with different levels of intensity – with blue being the less costly area and lighter colors being the higher costly ones – heat maps illuminate regions of increased or decreased traversal cost, enabling observers to discern patterns and
    
    
     
      crucial circumstances.
     
    
   </p>
   <p>
    
     This view
    
    <a id="_idIndexMarker244">
    </a>
    
     is particularly useful when dealing with large areas and wanting to obtain an overview of the more resource-intensive zones.
    
    
     In the preceding figure, the red zones are the ones that will cost more in
    
    
     
      navigation terms.
     
    
   </p>
   <p>
    
     In this section, you have grasped the process of analyzing a nav mesh to identify potential issues; in the next section, we will explore strategies for addressing and enhancing
    
    
     
      its generation.
     
    
   </p>
   <h1 id="_idParaDest-121">
    <a id="_idTextAnchor123">
    </a>
    
     Refining nav mesh generation
    
   </h1>
   <p>
    
     It should
    
    <a id="_idIndexMarker245">
    </a>
    
     come as no surprise that the complexity of an environment directly affects the time it takes for the system to generate a nav mesh.
    
    
     Conversely, if the generation time is shorter, the resulting nav mesh may be less precise.
    
    
     In most cases, your final system will involve a trade-off between computation speed and precision.
    
    
     This means it is mandatory, as a game developer, to understand how to properly set up your nav
    
    
     
      mesh generation.
     
    
   </p>
   <p>
    
     In this section, I will provide you with some advice on how to optimize the way a nav mesh
    
    
     
      is generated.
     
    
   </p>
   <h2 id="_idParaDest-122">
    <a id="_idTextAnchor124">
    </a>
    
     Influencing nav mesh resolution
    
   </h2>
   <p>
    
     The next test
    
    <a id="_idIndexMarker246">
    </a>
    
     we will perform involves modifying the resolution of a nav mesh.
    
    
     Start by following
    
    
     
      these steps:
     
    
   </p>
   <ol>
    <li>
     
      Open the
     
     
      <strong class="bold">
       
        Gym_NavMesh_02
       
      </strong>
     
     
      
       level.
      
     
    </li>
    <li>
     
      If it is not already enabled, select the
     
     
      <strong class="bold">
       
        Top
       
      </strong>
     
     
      
       view.
      
     
    </li>
    <li>
     
      In the
     
     <strong class="bold">
      
       Outliner
      
     </strong>
     
      panel, select the
     
     <strong class="bold">
      
       Recast Nav
      
     </strong>
     
      <strong class="bold">
       
        Mesh
       
      </strong>
     
     
      
       actor.
      
     
    </li>
    <li>
     
      In the
     
     <strong class="bold">
      
       Details
      
     </strong>
     
      panel, check the
     
     
      
       following properties:
      
     
     <ul>
      <li>
       <strong class="bold">
        
         Draw
        
       </strong>
       
        <strong class="bold">
         
          Tile Bounds
         
        </strong>
       
      </li>
      <li>
       <strong class="bold">
        
         Draw Tile
        
       </strong>
       
        <strong class="bold">
         
          Bounds Times
         
        </strong>
       
      </li>
      <li>
       <strong class="bold">
        
         Draw Tile Build Times
        
       </strong>
       
        <strong class="bold">
         
          Heat Map
         
        </strong>
       
      </li>
     </ul>
     <p class="list-inset">
      
       You should get a view similar to
      
      
       <em class="italic">
        
         Figure 6
        
       </em>
      
      
       <em class="italic">
        
         .10
        
       </em>
      
      
       
        :
       
      
     </p>
    </li>
   </ol>
   <div><div><img alt="Figure 6.10 – Heat map visualization" src="img/B31016_06_10.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 6.10 – Heat map visualization
    
   </p>
   <p class="list-inset">
    
     As you can see from the heat map, the central part has a higher cost.
    
    
     However, the overall geometry is quite simple; we have the muddy area and a bridge, which are basically rectangular, non-rotated areas.
    
    
     Let’s lower the cost for our mesh.
    
    
     Start doing the
    
    
     
      following steps:
     
    
   </p>
   <ol>
    <li value="5">
     
      In the
     
     <strong class="bold">
      
       Outliner
      
     </strong>
     
      panel, select the three
     
     <strong class="bold">
      
       Nav Modifier Volumes
      
     </strong>
     
      – the two muddy areas and the
     
     
      
       bridge area.
      
     
    </li>
    <li>
     
      In the
     
     <strong class="bold">
      
       Details
      
     </strong>
     
      panel, search for the
     
     <strong class="bold">
      
       Nav Mesh Resolution
      
     </strong>
     
      property and, in the dropdown menu,
     
     
      
       select
      
     
     
      <strong class="bold">
       
        Low
       
      </strong>
     
     
      
       .
      
     
     <p class="list-inset">
      
       You will
      
      <a id="_idIndexMarker247">
      </a>
      
       notice that the time cost for the central part of the map will immediately drop, as depicted in
      
      
       <em class="italic">
        
         Figure 6
        
       </em>
      
      
       <em class="italic">
        
         .11
        
       </em>
      
      
       
        :
       
      
     </p>
    </li>
   </ol>
   <div><div><img alt="Figure 6.11 – Improved nav mesh" src="img/B31016_06_11.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 6.11 – Improved nav mesh
    
   </p>
   <p>
    
     When you look at the heatmap visualization, you might see some tiles that have been left untouched by the previous modification – the ones on the sides – changing color and appearing more expensive.
    
    
     However, don’t let this trick you – the system will simply highlight areas that will be more costly in terms of the overall nav mesh.
    
    
     In fact, if you check those areas, you will see that the cost hasn’t changed at all; they have simply become more costly than their central map counterparts.
    
    
     This means that the cost for a particular area is relative to all other areas analyzed by
    
    
     
      the system.
     
    
   </p>
   <p>
    
     As another experiment, you can set the bridge
    
    <strong class="bold">
     
      Nav Mesh Modifier
     
    </strong>
    
     actor to a
    
    <strong class="bold">
     
      Nav Mesh Resolution
     
    </strong>
    
     value of
    
    <strong class="bold">
     
      High
     
    </strong>
    
     and see the results.
    
    
     Spoiler alert!
    
    
     The tiles, including the bridge, will become the most expensive parts of
    
    
     
      the level!
     
    
   </p>
   <h2 id="_idParaDest-123">
    <a id="_idTextAnchor125">
    </a>
    
     Changing nav mesh resolution
    
   </h2>
   <p>
    
     If, at this point, you
    
    <a id="_idIndexMarker248">
    </a>
    
     are wondering whether you can adjust the nav mesh resolution for your level, the answer is an
    
    
     
      unsurprising yes!
     
    
   </p>
   <p>
    
     By selecting the
    
    <strong class="bold">
     
      Recast Nav Mesh
     
    </strong>
    
     actor, in the
    
    <strong class="bold">
     
      Detail
     
    </strong>
    
     panel, you will find a
    
    <strong class="bold">
     
      Nav Mesh Resolution Params
     
    </strong>
    
     option with three fields –
    
    <strong class="bold">
     
      Low
     
    </strong>
    
     ,
    
    <strong class="bold">
     
      Default
     
    </strong>
    
     , and
    
    <strong class="bold">
     
      High
     
    </strong>
    
     – that will let you decide the cell size for
    
    
     
      your level.
     
    
   </p>
   <div><div><img alt="Figure 6.12 – Nav Mesh Resolution Params" src="img/B31016_06_12.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 6.12 – Nav Mesh Resolution Params
    
   </p>
   <p>
    
     As a rule of thumb, just remember that the higher the cell size, the less costly the zone
    
    
     
      will be.
     
    
   </p>
   <h2 id="_idParaDest-124">
    <a id="_idTextAnchor126">
    </a>
    
     Changing the tile size
    
   </h2>
   <p>
    
     You are
    
    <a id="_idIndexMarker249">
    </a>
    
     already aware that the nav mesh is partitioned into tiles, which are utilized to reconstruct specific sections of the nav mesh itself.
    
    
     As each tile consists of cells, rebuilding tiles entails recreating all its cells with the
    
    
     
      updated information.
     
    
   </p>
   <p>
    
     Larger tiles encompass more cells, resulting in a higher cost to rebuild than smaller tiles.
    
    
     However, when processing a tile, the system also handles the adjacent cells along the tile’s edges.
    
    
     It is important to consider this additional overhead cost when determining the size of your tiles.
    
    
     In certain scenarios, the cumulative overhead cost of processing numerous smaller tiles may exceed the cost of rebuilding a single large tile.
    
    
     Therefore, careful consideration should be given when choosing the appropriate tile size to
    
    
     
      optimize performance.
     
    
   </p>
   <p>
    
     To achieve optimal
    
    <a id="_idIndexMarker250">
    </a>
    
     performance during tile rebuilding at runtime, Epic Games’ recommendation is that you set each
    
    <strong class="bold">
     
      Cell Size
     
    </strong>
    
     property –
    
    <strong class="bold">
     
      Low
     
    </strong>
    
     ,
    
    <strong class="bold">
     
      Default
     
    </strong>
    
     , and
    
    <strong class="bold">
     
      High
     
    </strong>
    
     – as a multiple of each other and set the
    
    <strong class="bold">
     
      Tile size UU
     
    </strong>
    
     property to a value that is divisible by all
    
    <strong class="bold">
     
      Cell Size
     
    </strong>
    
     values.
    
    
     For instance, in
    
    
     <em class="italic">
      
       Figure 6
      
     </em>
    
    <em class="italic">
     
      .13
     
    </em>
    
     , I have set the values for the
    
    <strong class="bold">
     
      Gym_NavMesh_02
     
    </strong>
    
     level
    
    
     
      as follows:
     
    
   </p>
   <ul>
    <li>
     <strong class="bold">
      
       Tile Size UU
      
     </strong>
     
      
       as
      
     
     
      <strong class="source-inline">
       
        960.0
       
      </strong>
     
    </li>
    <li>
     <strong class="bold">
      
       Low Cell Size
      
     </strong>
     
      
       as
      
     
     
      <strong class="source-inline">
       
        60.0
       
      </strong>
     
    </li>
    <li>
     <strong class="bold">
      
       Default Cell Size
      
     </strong>
     
      
       as
      
     
     
      <strong class="source-inline">
       
        30.0
       
      </strong>
     
    </li>
    <li>
     <strong class="bold">
      
       High Cell Size
      
     </strong>
     
      
       as
      
     
     
      <strong class="source-inline">
       
        15.0
       
      </strong>
     
    </li>
   </ul>
   <div><div><img alt="Figure 6.13 – Cell size example" src="img/B31016_06_13.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 6.13 – Cell size example
    
   </p>
   <p>
    
     As you can see, the
    
    <strong class="bold">
     
      Low Cell Size
     
    </strong>
    
     value can be divided by
    
    <strong class="bold">
     
      Default Cell Size
     
    </strong>
    
     and
    
    <strong class="bold">
     
      High Cell Size
     
    </strong>
    
     , giving an integer value.
    
    
     The same can be said for
    
    <strong class="bold">
     
      Tile Size UU
     
    </strong>
    
     , which can be divided by
    
    <strong class="bold">
     
      Low Cell Size
     
    </strong>
    
     ,
    
    <strong class="bold">
     
      Default Cell Size
     
    </strong>
    
     , and
    
    <strong class="bold">
     
      High
     
    </strong>
    
     <strong class="bold">
      
       Cell Size
      
     </strong>
    
    
     
      .
     
    
   </p>
   <p>
    
     As an extra example,
    
    
     <em class="italic">
      
       Figure 6
      
     </em>
    
    <em class="italic">
     
      .14
     
    </em>
    
     shows the same level with
    
    
     
      these values:
     
    
   </p>
   <ul>
    <li>
     <strong class="bold">
      
       Tile Size UU
      
     </strong>
     
      
       as
      
     
     
      <strong class="source-inline">
       
        1280.0
       
      </strong>
     
    </li>
    <li>
     <strong class="bold">
      
       Low Cell Size
      
     </strong>
     
      
       as
      
     
     
      <strong class="source-inline">
       
        80.0
       
      </strong>
     
    </li>
    <li>
     <strong class="bold">
      
       Default Cell Size
      
     </strong>
     
      
       as
      
     
     
      <strong class="source-inline">
       
        40.0
       
      </strong>
     
    </li>
    <li>
     <strong class="bold">
      
       High Cell Size
      
     </strong>
     
      
       as
      
     
     
      <strong class="source-inline">
       
        20.0
       
      </strong>
     
    </li>
   </ul>
   <div><div><img alt="Figure 6.14 – Cell size alternative example" src="img/B31016_06_14.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 6.14 – Cell size alternative example
    
   </p>
   <p>
    
     In the second
    
    <a id="_idIndexMarker251">
    </a>
    
     example, a larger tile size is employed.
    
    
     However, it is evident that the optimization is not as effective, leading to inefficient utilization
    
    
     
      of space.
     
    
   </p>
   <p>
    
     In this section, I have presented you with some valuable tips on how to analyze your nav mesh generation and effectively optimize it by changing cell resolution and tile size.
    
    
     In the next section, I will give you some additional advice on how to make your navigation
    
    
     
      even better.
     
    
   </p>
   <h1 id="_idParaDest-125">
    <a id="_idTextAnchor127">
    </a>
    
     Making further improvements
    
   </h1>
   <p>
    
     Tweaking a
    
    <a id="_idIndexMarker252">
    </a>
    
     nav mesh may take a long time – depending on what you want to achieve –and sometimes, it’s a matter of trial and error and personal experience.
    
    
     In this section, I will give you additional advice on how to improve your maps to make them
    
    
     
      more functional.
     
    
   </p>
   <h2 id="_idParaDest-126">
    <a id="_idTextAnchor128">
    </a>
    
     Tweaking resolution
    
   </h2>
   <p>
    
     Choosing the
    
    <a id="_idIndexMarker253">
    </a>
    
     right nav mesh resolution is not just a matter of computational performance; sometimes it may even affect your
    
    
     
      agent navigation.
     
    
   </p>
   <p>
    
     As an example, take into consideration
    
    
     <em class="italic">
      
       Figure 6
      
     </em>
    
    <em class="italic">
     
      .15
     
    </em>
    
     showing a portion of the
    
    
     <strong class="bold">
      
       Gym_NavMesh_07
      
     </strong>
    
    
     
      level:
     
    
   </p>
   <div><div><img alt="Figure 6.15 – Nav mesh resolution" src="img/B31016_06_15.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 6.15 – Nav mesh resolution
    
   </p>
   <p>
    
     In this case, the
    
    <strong class="bold">
     
      Default Cell Size
     
    </strong>
    
     value has been set to
    
    <strong class="source-inline">
     
      20.0
     
    </strong>
    
     and, as you can see, there’s no walkable area between the obstacles.
    
    
     However, if you decrease the value to
    
    <strong class="source-inline">
     
      5.0
     
    </strong>
    
     , you will get a totally different scenario, as depicted in
    
    
     <em class="italic">
      
       Figure 6
      
     </em>
    
    
     <em class="italic">
      
       .16
      
     </em>
    
    
     
      :
     
    
   </p>
   <div><div><img alt="Figure 6.16 – Improved nav mesh resolution" src="img/B31016_06_16.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 6.16 – Improved nav mesh resolution
    
   </p>
   <p>
    
     As you can
    
    <a id="_idIndexMarker254">
    </a>
    
     clearly see, there are now open passages between the obstacles; the higher the coin, the finer
    
    
     
      the wine!
     
    
   </p>
   <h2 id="_idParaDest-127">
    <a id="_idTextAnchor129">
    </a>
    
     Disabling mesh influence
    
   </h2>
   <p>
    
     At times, your
    
    <a id="_idIndexMarker255">
    </a>
    
     nav mesh may become cluttered with meshes that could lead to unreachable pathways, yet they are included in the nav mesh generation process.
    
    
     In such instances, it is advisable to hide them to prevent them from affecting generation time.
    
    
     As an example, consider the situation depicted in
    
    
     <em class="italic">
      
       Figure 6
      
     </em>
    
    
     <em class="italic">
      
       .17
      
     </em>
    
    
     
      :
     
    
   </p>
   <div><div><img alt="Figure 6.17 – Unreachable path" src="img/B31016_06_17.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 6.17 – Unreachable path
    
   </p>
   <p>
    
     As you can
    
    <a id="_idIndexMarker256">
    </a>
    
     see, the area in the red rectangle is unreachable, yet the central cube will be counted during nav mesh generation.
    
    
     This means that, even though it won’t influence any pathfinding resolution, it will have to be computed anyway.
    
    
     In this case, you can exclude it by completing the
    
    
     
      following steps:
     
    
   </p>
   <ol>
    <li>
     
      Select
     
     
      
       the mesh.
      
     
    </li>
    <li>
     
      In the
     
     <strong class="bold">
      
       Details
      
     </strong>
     
      panel, look for the
     
     <strong class="bold">
      
       Can Ever Affect Navigation
      
     </strong>
     
      property and uncheck
     
     
      
       the checkbox.
      
     
     <p class="list-inset">
      
       The mesh
      
      <a id="_idIndexMarker257">
      </a>
      
       will now be excluded from the nav mesh generation, but the overall result will remain the same, as you can see from
      
      
       <em class="italic">
        
         Figure 6
        
       </em>
      
      
       <em class="italic">
        
         .18
        
       </em>
      
      
       
        :
       
      
     </p>
    </li>
   </ol>
   <div><div><img alt="Figure 6.18 – The improved area" src="img/B31016_06_18.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 6.18 – The improved area
    
   </p>
   <p class="list-inset">
    
     You can go even further by doing
    
    
     
      the following:
     
    
   </p>
   <ol>
    <li value="3">
     
      Select the other two boxes and uncheck the
     
     <strong class="bold">
      
       Can Ever Affect Navigation
      
     </strong>
     
      property
     
     
      
       for both.
      
     
    </li>
    <li>
     
      Add a Nav Modifier Volume actor and scale it so that it will encompass the
     
     
      
       whole area.
      
     
    </li>
    <li>
     
      Set the
     
     <a id="_idIndexMarker258">
     </a>
     
      volume
     
     <strong class="bold">
      
       Area Class
      
     </strong>
     
      property
     
     
      
       to
      
     
     
      <strong class="bold">
       
        NavArea_Null
       
      </strong>
     
     
      
       .
      
     
    </li>
   </ol>
   <p>
    
     <em class="italic">
      
       Figure 6
      
     </em>
    
    <em class="italic">
     
      .19
     
    </em>
    
     shows the
    
    
     
      final result:
     
    
   </p>
   <div><div><img alt="Figure 6.19 – The optimized area" src="img/B31016_06_19.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 6.19 – The optimized area
    
   </p>
   <p>
    
     As you can see, we are now using a single modifier to avoid the influence of three meshes on the final
    
    <a id="_idIndexMarker259">
    </a>
    
     nav mesh generation.
    
    
     Picture all the time you’ll have spared once your level is jam-packed with props and obstacles of
    
    
     
      every kind!
     
    
   </p>
   <h1 id="_idParaDest-128">
    <a id="_idTextAnchor130">
    </a>
    
     Summary
    
   </h1>
   <p>
    
     In this chapter, we went through some more advanced techniques to help improve your nav mesh generation.
    
    
     Starting with the debugging tool, we then learned how to analyze and tweak the mesh generation process.
    
    
     Finally, we learned a few tricks that will help us craft more
    
    
     
      effective levels.
     
    
   </p>
   <p>
    
     With this,
    
    <em class="italic">
     
      Part 2
     
    </em>
    
     of this book comes to an end; starting from the next chapter, get ready to face probably one of the most interesting topics when speaking about AI in game development:
    
    
     
      behavior trees.
     
    
   </p>
   <p>
    
     Be prepared.
    
    
     Your AI buddies are about to get a major overhaul and will never be
    
    
     
      the same!
     
    
   </p>
  </div>
 

  <div><h1 id="_idParaDest-129" lang="en-US" xml:lang="en-US">
    <a id="_idTextAnchor131">
    </a>
    
     Part 3: Working with Decision Making
    
   </h1>
   <p>
    
     In the third part of this book, you will get a comprehensive introduction to the powerful and versatile behavior tree system within the Unreal Engine framework.
    
    
     Additionally, you will be presented with advanced features so that you can implement your own complex game
    
    
     
      AI logic.
     
    
   </p>
   <p>
    
     This part includes the
    
    
     
      following chapters:
     
    
   </p>
   <ul>
    <li>
     <a href="B31016_07.xhtml#_idTextAnchor132">
      <em class="italic">
       
        Chapter 7
       
      </em>
     </a>
     <em class="italic">
      
       , Introducing Behavior Trees
      
     </em>
    </li>
    <li>
     <a href="B31016_08.xhtml#_idTextAnchor148">
      <em class="italic">
       
        Chapter 8
       
      </em>
     </a>
     <em class="italic">
      
       , Setting Up a Behavior Tree
      
     </em>
    </li>
    <li>
     <a href="B31016_09.xhtml#_idTextAnchor170">
      <em class="italic">
       
        Chapter 9
       
      </em>
     </a>
     <em class="italic">
      
       , Extending Behavior Trees
      
     </em>
    </li>
    <li>
     <a href="B31016_10.xhtml#_idTextAnchor198">
      <em class="italic">
       
        Chapter 10
       
      </em>
     </a>
     <em class="italic">
      
       , Improving Agents with the Perception System
      
     </em>
    </li>
    <li>
     <a href="B31016_11.xhtml#_idTextAnchor218">
      <em class="italic">
       
        Chapter 11
       
      </em>
     </a>
     <em class="italic">
      
       , Understanding the Environment Query System
      
     </em>
    </li>
   </ul>
  </div>
  <div><div></div>
  </div>
  <div><div></div>
  </div>
 </body></html>