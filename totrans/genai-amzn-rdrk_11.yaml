- en: '11'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '11'
- en: Evaluating and Monitoring Models with Amazon Bedrock
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 Amazon Bedrock 评估和监控模型
- en: To work with the best-performing model for your generative AI solution, you
    need to evaluate the models that are available to you. This chapter explores various
    techniques to assess the performance of different models.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使用最适合您生成式 AI 解决方案性能的模型，您需要评估您可用的模型。本章探讨了评估不同模型性能的各种技术。
- en: 'The chapter introduces two primary evaluation methods provided by Amazon Bedrock:
    automatic model evaluation and human evaluation. We will do a detailed walk-through
    of these two methods. In addition, we will look at open source tools such as **Foundation
    Models Evaluation** (**FMEval**) and **RAG Assessment** (**Ragas**) for model
    evaluation and evaluating RAG pipelines.'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 本章介绍了 Amazon Bedrock 提供的两种主要评估方法：自动模型评估和人工评估。我们将对这两种方法进行详细的讲解。此外，我们还将探讨用于模型评估和评估
    RAG 管道的开源工具，如 **基础模型评估**（**FMEval**）和 **RAG 评估**（**Ragas**）。
- en: The second part of the chapter goes into monitoring. We will explore how to
    leverage Amazon CloudWatch for real-time monitoring of model performance, latency,
    and token counts. We will further look at model invocation logging to capture
    requests, responses, and metadata for model invocations. Furthermore, we will
    highlight the integration of Amazon Bedrock with AWS CloudTrail for auditing API
    calls and with Amazon EventBridge for event-driven monitoring and automation of
    model customization jobs.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 本章的第二部分将探讨监控。我们将探讨如何利用 Amazon CloudWatch 对模型性能、延迟和令牌计数进行实时监控。我们还将进一步探讨模型调用日志，以捕获模型调用的请求、响应和元数据。此外，我们将强调
    Amazon Bedrock 与 AWS CloudTrail 的集成，用于审计 API 调用，以及与 Amazon EventBridge 的集成，用于事件驱动的监控和模型定制作业的自动化。
- en: By the end of this chapter, you will be able to understand how to evaluate FMs
    and monitor their performance.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 到本章结束时，您将能够理解如何评估 FMs 并监控其性能。
- en: 'Here are the key topics that will be covered in this chapter:'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将涵盖以下关键主题：
- en: Evaluating models
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 评估模型
- en: Monitoring Amazon Bedrock
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 监控 Amazon Bedrock
- en: Technical requirements
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 技术要求
- en: This chapter requires you to have access to an AWS account. If you don’t have
    it already, you can go to [https://aws.amazon.com/getting-started/](https://aws.amazon.com/getting-started/)
    and create an AWS account.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 本章要求您拥有 AWS 账户访问权限。如果您还没有，可以访问 [https://aws.amazon.com/getting-started/](https://aws.amazon.com/getting-started/)
    创建 AWS 账户。
- en: 'Secondly, you will need to set up AWS Python SDK (Boto3): [https://docs.aws.amazon.com/bedrock/latest/APIReference/welcome.html](https://docs.aws.amazon.com/bedrock/latest/APIReference/welcome.html)'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 其次，您需要设置 AWS Python SDK (Boto3)：[https://docs.aws.amazon.com/bedrock/latest/APIReference/welcome.html](https://docs.aws.amazon.com/bedrock/latest/APIReference/welcome.html)
- en: 'You can carry out the Python setup in any way: install it on your local machine,
    or use AWS Cloud9, or utilize AWS Lambda, or leverage Amazon SageMaker.'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以以任何方式执行 Python 设置：在本地机器上安装，使用 AWS Cloud9，利用 AWS Lambda，或利用 Amazon SageMaker。
- en: Note
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 注意
- en: There will be a charge associated with the invocation and customization of the
    FMs of Amazon Bedrock. Please refer to [https://aws.amazon.com/bedrock/pricing/](https://aws.amazon.com/bedrock/pricing/)
    to learn more.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 与 Amazon Bedrock 的 FMs（功能模型）的调用和定制相关联的费用。请参阅 [https://aws.amazon.com/bedrock/pricing/](https://aws.amazon.com/bedrock/pricing/)
    了解更多信息。
- en: Evaluating models
  id: totrans-15
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 评估模型
- en: By now, we have gained a comprehensive understanding of Amazon Bedrock’s capabilities,
    exploring techniques such as prompt engineering, RAG, and model customization.
    We have also examined various architectural design patterns and analyzed the responses
    generated by different models. With the vast selection of FMs available within
    Amazon Bedrock, identifying the most suitable option for your specific use case
    and business requirements can be challenging. To address this, we will now focus
    on the topic of model evaluation and how to compare the outputs of different models
    to choose the one that best meets the needs of your application and business.
    This is a critical initial phase in implementing any generative AI solution.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们已经全面了解了 Amazon Bedrock 的功能，探讨了提示工程、RAG（阅读-回答生成）和模型定制等技术。我们还检查了各种架构设计模式，并分析了不同模型生成的响应。由于
    Amazon Bedrock 内部提供了大量的 FMs，因此确定最适合您特定用例和业务需求的选项可能具有挑战性。为了解决这个问题，我们将现在专注于模型评估的主题，以及如何比较不同模型的输出，以选择最适合您应用程序和业务需求的模型。这是实施任何生成式
    AI 解决方案的关键初始阶段。
- en: '![Figure 11.1 – The generative AI life cycle](img/B22045_11_01.jpg)'
  id: totrans-17
  prefs: []
  type: TYPE_IMG
  zh: '![图 11.1 – 生成式 AI 生命周期](img/B22045_11_01.jpg)'
- en: Figure 11.1 – The generative AI life cycle
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: '**图 11**.1 – 生成式 AI 生命周期'
- en: As shown in *Figure 11**.1*, after defining the specific business use case that
    you’re aiming to solve with generative AI, the **choice** stage involves both
    selecting potential models from the available options and rigorously evaluating
    these candidate models. Following this, the **responsible AI** stage focuses on
    ensuring data privacy and security, as well as implementing guardrails for responsible
    model behavior, which we will cover in [*Chapter 12*](B22045_12.xhtml#_idTextAnchor226).
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 如**图 11**.1 所示，在定义了您希望通过生成式 AI 解决的具体业务用例之后，**选择**阶段涉及从可用选项中选择潜在模型并对这些候选模型进行严格评估。随后，**负责任的
    AI**阶段侧重于确保数据隐私和安全，以及实施负责任模型行为的护栏，这些内容我们将在[*第 12 章*](B22045_12.xhtml#_idTextAnchor226)中介绍。
- en: Before talking about model evaluation, one quick way to compare the responses
    from the models on Amazon Bedrock’s **Chat playground** screen is to use the **Compare**
    **mode** toggle.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 在讨论模型评估之前，一种快速比较 Amazon Bedrock 的**Chat playground**屏幕上模型响应的方法是使用**比较****模式**切换。
- en: '![Figure 11.2 – Compare mode in Bedrock’s Chat playground](img/B22045_11_02.jpg)'
  id: totrans-21
  prefs: []
  type: TYPE_IMG
  zh: '![**图 11**.2 – Bedrock 的 Chat playground 中的比较模式](img/B22045_11_02.jpg)'
- en: Figure 11.2 – Compare mode in Bedrock’s Chat playground
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: '**图 11**.2 – Bedrock 的 Chat playground 中的比较模式'
- en: '![Figure 11.3 – Model metrics in Compare mode](img/B22045_11_03.jpg)'
  id: totrans-23
  prefs: []
  type: TYPE_IMG
  zh: '![**图 11**.3 – 比较模式中的模型指标](img/B22045_11_03.jpg)'
- en: Figure 11.3 – Model metrics in Compare mode
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: '**图 11**.3 – 比较模式中的模型指标'
- en: As shown in *Figure 11**.2*, you can enable compare mode in **Chat playground**
    and add up to three models to view a side-by-side comparison of model responses
    to the same prompt. In addition, you can view the metrics of each of the selected
    models (as shown in *Figure 11**.3*) and compare latency, input token count, output
    token count, and the associated cost. We will cover the model metrics in depth
    in the *Monitoring Amazon* *Bedrock* section.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 如**图 11**.2 所示，您可以在**Chat playground**中启用比较模式并添加最多三个模型以查看模型对同一提示的响应的并排比较。此外，您还可以查看所选每个模型的指标（如**图
    11**.3 所示）并比较延迟、输入令牌计数、输出令牌计数和相关的成本。我们将在*监控 Amazon Bedrock*部分深入讨论模型指标。
- en: Using Amazon Bedrock
  id: totrans-26
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用 Amazon Bedrock
- en: Within Amazon Bedrock, you can create model evaluation jobs to compare the responses
    from the models for use cases such as text generation, summarization, Q&A, and
    so on.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Amazon Bedrock 中，您可以创建模型评估作业来比较用于文本生成、摘要、问答等用例的模型响应。
- en: 'Model evaluation within Amazon Bedrock primarily consists of two options:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 在 Amazon Bedrock 中对模型进行评估主要包含两种选项：
- en: Automatic model evaluation
  id: totrans-29
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**自动模型评估**'
- en: Human evaluation
  id: totrans-30
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**人工评估**'
- en: Let us dive deeper into both of these evaluation techniques.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们更深入地探讨这两种评估技术。
- en: Automatic model evaluation
  id: totrans-32
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '**自动模型评估**'
- en: 'With automatic model evaluation, an evaluation algorithm script is run behind
    the scenes on either Amazon Bedrock’s provided **built-in dataset** or on a **custom
    dataset** that you provide for the recommended metrics (accuracy, toxicity, and
    robustness). Let us go through the steps for creating an automatic model evaluation
    job:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 使用自动模型评估，后台会运行一个评估算法脚本，在 Amazon Bedrock 提供的**内置数据集**或您提供的**自定义数据集**上执行，用于推荐指标（准确度、毒性、鲁棒性）。让我们通过以下步骤来创建一个自动模型评估作业：
- en: '**Evaluation name**: This refers to choosing a descriptive name that accurately
    reflects the purpose of the job. This name should be unique within your AWS account
    in the specific AWS region.'
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**评估名称**：这指的是选择一个能够准确反映作业目的的描述性名称。此名称应在您特定的 AWS 区域的 AWS 账户中是唯一的。'
- en: '**Model selector**: Select the model that you would like to evaluate (as shown
    in *Figure 11**.4*). At the time of writing this book, automatic model evaluation
    is carried out on a single model.'
  id: totrans-35
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**模型选择器**：选择您想要评估的模型（如**图 11**.4 所示）。在撰写本书时，自动模型评估是在单个模型上进行的。'
- en: '![Figure 11.4 – Model selector](img/B22045_11_04.jpg)'
  id: totrans-36
  prefs: []
  type: TYPE_IMG
  zh: '![**图 11**.4 – 模型选择器](img/B22045_11_04.jpg)'
- en: Figure 11.4 – Model selector
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: '**图 11**.4 – 模型选择器'
- en: Within **Model selector**, you can optionally modify the inference parameters,
    such as **Temperature**, **Top P**, **Response length**, and so on (as shown in
    *Figure 11**.5*). You can get this screen by clicking on **Inference configuration:**
    **Default update**.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 在**模型选择器**中，您可以可选地修改推理参数，例如**温度**、**Top P**、**响应长度**等（如**图 11**.5 所示）。您可以通过点击**推理配置**：**默认更新**来获取此屏幕。
- en: Modifying the values of this inference configuration will alter the output of
    the model. To learn more about the inference configuration parameters, you can
    go back to [*Chapter 2*](B22045_02.xhtml#_idTextAnchor034) of this book.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 修改此推理配置的值将改变模型的输出。要了解更多关于推理配置参数的信息，您可以回到本书的[*第2章*](B22045_02.xhtml#_idTextAnchor034)。
- en: '![Figure 11.5 – Inference configuration](img/B22045_11_05.jpg)'
  id: totrans-40
  prefs: []
  type: TYPE_IMG
  zh: '![图11.5 – 推理配置](img/B22045_11_05.jpg)'
- en: Figure 11.5 – Inference configuration
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.5 – 推理配置
- en: '**Task type**: Currently, the following task types are supported while using
    Amazon Bedrock Model evaluation:'
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**任务类型**：在Amazon Bedrock模型评估中使用时，目前支持以下任务类型：'
- en: General text generation
  id: totrans-43
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通用文本生成
- en: Text summarization
  id: totrans-44
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 文本摘要
- en: Question and answer
  id: totrans-45
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 问答
- en: Text classification
  id: totrans-46
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 文本分类
- en: '**Metrics and datasets**: There are a total of three metrics provided by Amazon
    Bedrock that you can choose to use to measure the performance of the model:'
  id: totrans-47
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**指标和数据集**：Amazon Bedrock提供了总共三个指标，您可以选择使用这些指标来衡量模型的性能：'
- en: '**Accuracy**: The capability to encode factual knowledge about the real world
    is a critical aspect of generative AI models. This metric evaluates the model’s
    ability to generate outputs that align with established facts and data. It assesses
    the model’s understanding of the subject matter and its ability to synthesize
    information accurately. A high accuracy score indicates that the model’s outputs
    are reliable and can be trusted for tasks that require factual precision.'
  id: totrans-48
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**准确性**：将关于现实世界的实际知识编码的能力是生成式AI模型的一个关键方面。此指标评估模型生成与既定事实和数据一致输出的能力。它评估模型对主题内容的理解以及其准确综合信息的能力。高准确度分数表明模型的输出是可靠的，可以信赖用于需要事实精确性的任务。'
- en: '**Toxicity**: This refers to the propensity of the model to generate harmful,
    offensive, or inappropriate content. This metric gauges the model’s tendency to
    produce outputs that could be considered unethical, biased, or discriminatory.
    Evaluating toxicity is crucial for ensuring the responsible and ethical deployment
    of AI systems, particularly in applications that involve direct interaction with
    users or the dissemination of information to the public.'
  id: totrans-49
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**毒性**：这指的是模型生成有害、冒犯性或不适当内容的能力。此指标衡量模型产生可能被视为不道德、有偏见或歧视性的输出的倾向。评估毒性对于确保AI系统的负责任和道德部署至关重要，尤其是在涉及与用户直接互动或向公众传播信息的应用中。'
- en: '**Robustness**: Robustness is a measure of the model’s resilience to minor,
    semantic-preserving changes in the input data. It assesses the degree to which
    the model’s output remains consistent and reliable when faced with slight variations
    or perturbations in the input. This metric is particularly important for generative
    AI models that operate in dynamic or noisy environments, where the input data
    may be subject to minor fluctuations or disturbances. A robust model is less likely
    to produce erratic or inconsistent outputs in response to small input changes.'
  id: totrans-50
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**鲁棒性**：鲁棒性是衡量模型对输入数据中微小的、语义保持性变化的抵抗力的指标。它评估模型在面临输入数据中的轻微变化或扰动时，其输出保持一致和可靠的程度。此指标对于在动态或嘈杂环境中运行的生成式AI模型尤为重要，其中输入数据可能受到轻微波动或干扰。鲁棒性强的模型在输入变化较小的情况下，不太可能产生异常或不一致的输出。'
- en: The text classification task supports the accuracy and robustness metrics, while
    the other tasks support all three metrics.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 文本分类任务支持准确性和鲁棒性指标，而其他任务支持所有三个指标。
- en: 'For every task type and metric that you choose, Amazon Bedrock provides you
    with built-in datasets. For example, for the general text generation task type,
    you will get the following built-in datasets:'
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 对于您选择的每个任务类型和指标，Amazon Bedrock都为您提供了内置数据集。例如，对于通用文本生成任务类型，您将获得以下内置数据集：
- en: 'TREX: [https://hadyelsahar.github.io/t-rex/](https://hadyelsahar.github.io/t-rex/)'
  id: totrans-53
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'TREX: [https://hadyelsahar.github.io/t-rex/](https://hadyelsahar.github.io/t-rex/)'
- en: 'BOLD: [https://github.com/amazon-science/bold](https://github.com/amazon-science/bold)'
  id: totrans-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'BOLD: [https://github.com/amazon-science/bold](https://github.com/amazon-science/bold)'
- en: 'WikiText2: [https://huggingface.co/datasets/wikitext](https://huggingface.co/datasets/wikitext)'
  id: totrans-55
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'WikiText2: [https://huggingface.co/datasets/wikitext](https://huggingface.co/datasets/wikitext)'
- en: 'English Wikipedia: [https://en.wikipedia.org/wiki/Wikipedia:Database_download](https://en.wikipedia.org/wiki/Wikipedia:Database_download)'
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 英文维基百科：[https://en.wikipedia.org/wiki/Wikipedia:Database_download](https://en.wikipedia.org/wiki/Wikipedia:Database_download)
- en: 'RealToxicityPrompts: [https://github.com/allenai/real-toxicity-prompts](https://github.com/allenai/real-toxicity-prompts)'
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 'RealToxicityPrompts: [https://github.com/allenai/real-toxicity-prompts](https://github.com/allenai/real-toxicity-prompts)'
- en: For a complete list of built-in datasets based on different metrics and task
    types, you can go through [https://docs.aws.amazon.com/bedrock/latest/userguide/model-evaluation-prompt-datasets-builtin.html](https://docs.aws.amazon.com/bedrock/latest/userguide/model-evaluation-prompt-datasets-builtin.html).
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 要获取基于不同指标和任务类型的内置数据集的完整列表，您可以查阅[https://docs.aws.amazon.com/bedrock/latest/userguide/model-evaluation-prompt-datasets-builtin.html](https://docs.aws.amazon.com/bedrock/latest/userguide/model-evaluation-prompt-datasets-builtin.html)。
- en: If you would like to use your own custom dataset, it needs to be *JSON line*
    (*.jsonl*) format. Each line within the dataset must be a valid JSON object and
    you can include up to 1,000 prompts per evaluation job.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您想使用自己的自定义数据集，它需要是*JSON行* (*.jsonl*)格式。数据集中的每一行都必须是一个有效的JSON对象，并且每个评估作业可以包含最多1,000个提示。
- en: 'To construct your custom prompt dataset, you’ll need to incorporate the following
    keys:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 要构建您的自定义提示数据集，您需要包含以下键：
- en: '**prompt**: This key is mandatory and serves as the input for various tasks,
    such as general text generation, question answering, text summarization, and classification.
    Depending on the task, the value associated with this key will vary – it could
    be a prompt for the model to respond to, a question to answer, text to summarize,
    or content to classify.'
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**prompt**：此键是必需的，用作各种任务的输入，例如通用文本生成、问答、文本摘要和分类。根据任务的不同，与此键关联的值将有所不同——它可以是模型需要响应的提示、要回答的问题、要总结的文本或要分类的内容。'
- en: '`referenceResponse` is required to provide the ground truth response against
    which your model’s output will be evaluated. For tasks such as question answering,
    accuracy evaluation, and robustness testing, this key will hold the correct answer
    or expected response.'
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`referenceResponse`是必需的，用于提供与您的模型输出进行比较的基准响应。对于问答、准确性评估和鲁棒性测试等任务，此键将包含正确答案或预期响应。'
- en: '`category` key. This optional key allows you to group prompts and their corresponding
    reference responses, enabling a more granular analysis of your model’s performance
    across different domains or categories.'
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`category`键。此可选键允许您对提示及其相应的参考响应进行分组，从而实现对模型在不同领域或类别上的性能进行更细致的分析。'
- en: 'To illustrate the usage of these keys, consider the following example for a
    question answering task:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 为了说明这些键的用法，以下是一个问答任务的示例：
- en: '[PRE0]'
  id: totrans-65
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: In this JSON line, the `prompt` key contains the `What is the process that converts
    raw materials into finished goods?` question, while the `referenceResponse` key
    holds the correct answer, `Manufacturing`. Additionally, the category key is set
    to `Manufacturing`, allowing you to group this prompt and response with others
    related to manufacturing.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 在此JSON行中，`prompt`键包含`什么是将原材料转化为成品的过程？`这个问题，而`referenceResponse`键持有正确答案`Manufacturing`。此外，`category`键设置为`Manufacturing`，允许您将此提示和响应与其他与制造相关的提示和响应分组。
- en: Once you have created a custom prompt dataset, you will need to store the dataset
    file in an Amazon S3 bucket and specify the correct S3 path (such as **s3://test/data/**)
    when creating the model evaluation job (as shown in *Figure 11**.6*).
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦您创建了自定义提示数据集，您需要将数据集文件存储在Amazon S3桶中，并在创建模型评估作业时指定正确的S3路径（例如**s3://test/data/**）（如图*11.6*所示）。
- en: '![Figure 11.6 – Choosing a prompt dataset](img/B22045_11_06.jpg)'
  id: totrans-68
  prefs: []
  type: TYPE_IMG
  zh: '![图11.6 – 选择提示数据集](img/B22045_11_06.jpg)'
- en: Figure 11.6 – Choosing a prompt dataset
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.6 – 选择提示数据集
- en: 'Please note that the S3 bucket should have the following **Cross-Origin Resource
    Sharing** (**CORS**) policy attached:'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，S3桶应附加以下**跨源资源共享**（**CORS**）策略：
- en: '[PRE1]'
  id: totrans-71
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: The CORS policy is a set of rules that specify which origins (domains or websites)
    are allowed to access the S3 bucket. To learn more about CORS, you can check [https://docs.aws.amazon.com/AmazonS3/latest/userguide/cors.html](https://docs.aws.amazon.com/AmazonS3/latest/userguide/cors.html).
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: CORS策略是一组规则，指定哪些来源（域名或网站）允许访问S3桶。要了解更多关于CORS的信息，您可以查看[https://docs.aws.amazon.com/AmazonS3/latest/userguide/cors.html](https://docs.aws.amazon.com/AmazonS3/latest/userguide/cors.html)。
- en: By meticulously crafting your custom prompt dataset, you can ensure that your
    LLMs are thoroughly evaluated against a diverse range of scenarios, covering various
    tasks, domains, and complexity levels.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 通过精心制作您的自定义提示数据集，您可以确保您的LLMs在多种场景下得到全面评估，涵盖各种任务、领域和复杂度级别。
- en: '![Figure 11.7 – Metrics and datasets](img/B22045_11_07.jpg)'
  id: totrans-74
  prefs: []
  type: TYPE_IMG
  zh: '![图11.7 – 指标和数据集](img/B22045_11_07.jpg)'
- en: Figure 11.7 – Metrics and datasets
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.7 – 指标和数据集
- en: '*Figure 11**.7* depicts the **Metrics and Datasets** options for the general
    text generation task type.'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: '*图11.7*展示了通用文本生成任务类型的**指标和数据集**选项。'
- en: 'Let us look at the other parameters that you can specify while creating the
    model evaluation job:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看在创建模型评估作业时可以指定的其他参数：
- en: '**Evaluation results**: Here, you can specify the S3 path where the results
    of the evaluation job should be stored. We will cover the evaluation results in
    the next section.'
  id: totrans-78
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**评估结果**：在此，您可以指定评估作业结果应存储的S3路径。我们将在下一节中介绍评估结果。'
- en: '**IAM role and KMS key**: Certain permissions are required to perform actions
    such as accessing data from an S3 bucket or storing the evaluation results. Here
    is the policy that is needed, at minimum, for an automatic model evaluation job:'
  id: totrans-79
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**IAM角色和KMS密钥**：执行诸如从S3桶访问数据或存储评估结果等操作需要某些权限。以下是一个自动模型评估作业所需的最小策略：'
- en: '[PRE2]'
  id: totrans-80
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: '[PRE3]'
  id: totrans-81
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: '[PRE4]'
  id: totrans-82
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '[PRE5]'
  id: totrans-83
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '[PRE6]'
  id: totrans-84
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '[PRE7]'
  id: totrans-85
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '[PRE8]'
  id: totrans-86
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '[PRE9]'
  id: totrans-87
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '[PRE10]'
  id: totrans-88
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '[PRE11]'
  id: totrans-89
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '[PRE12]'
  id: totrans-90
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '[PRE13]'
  id: totrans-91
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE13]'
- en: '[PRE14]'
  id: totrans-92
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE14]'
- en: '[PRE15]'
  id: totrans-93
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE15]'
- en: '[PRE16]'
  id: totrans-94
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE16]'
- en: '[PRE17]'
  id: totrans-95
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE17]'
- en: '[PRE18]'
  id: totrans-96
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE18]'
- en: '[PRE19]'
  id: totrans-97
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE19]'
- en: '[PRE20]'
  id: totrans-98
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE20]'
- en: '[PRE21]'
  id: totrans-99
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE21]'
- en: '[PRE22]'
  id: totrans-100
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE22]'
- en: '[PRE23]'
  id: totrans-101
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE23]'
- en: '[PRE24]'
  id: totrans-102
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE24]'
- en: '[PRE25]'
  id: totrans-103
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE25]'
- en: '[PRE26]'
  id: totrans-104
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE26]'
- en: '[PRE27]'
  id: totrans-105
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE27]'
- en: '[PRE28]'
  id: totrans-106
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE28]'
- en: '[PRE29]'
  id: totrans-107
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE29]'
- en: '[PRE30]'
  id: totrans-108
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE30]'
- en: '[PRE31]'
  id: totrans-109
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE31]'
- en: '[PRE32]'
  id: totrans-110
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE32]'
- en: '[PRE33]'
  id: totrans-111
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE33]'
- en: '[PRE34]'
  id: totrans-112
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE34]'
- en: '[PRE35]'
  id: totrans-113
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE35]'
- en: '[PRE36]'
  id: totrans-114
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE36]'
- en: '[PRE37]'
  id: totrans-115
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE37]'
- en: '[PRE38]'
  id: totrans-116
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE38]'
- en: '[PRE39]'
  id: totrans-117
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE39]'
- en: '[PRE40]'
  id: totrans-118
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE40]'
- en: '[PRE41]'
  id: totrans-119
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE41]'
- en: '[PRE42]'
  id: totrans-120
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE42]'
- en: You can find details on the permissions needed for a model evaluation job at
    [https://docs.aws.amazon.com/bedrock/latest/userguide/model-evaluation-security.html?icmpid=docs_bedrock_help_panel_model_evaluation](https://docs.aws.amazon.com/bedrock/latest/userguide/model-evaluation-security.html?icmpid=docs_bedrock_help_panel_model_evaluation).
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在[https://docs.aws.amazon.com/bedrock/latest/userguide/model-evaluation-security.html?icmpid=docs_bedrock_help_panel_model_evaluation](https://docs.aws.amazon.com/bedrock/latest/userguide/model-evaluation-security.html?icmpid=docs_bedrock_help_panel_model_evaluation)找到有关模型评估作业所需权限的详细信息。
- en: Model evaluation results
  id: totrans-122
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 模型评估结果
- en: Once you start the model evaluation job, you can view the results for each of
    the metrics as shown in *Figure 11**.8*.
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦开始模型评估作业，您就可以查看每个指标的评估结果，如图*图11.8*所示。
- en: '![Figure 11.8 – An evaluation summary](img/B22045_11_08.jpg)'
  id: totrans-124
  prefs: []
  type: TYPE_IMG
  zh: '![图11.8 – 评估摘要](img/B22045_11_08.jpg)'
- en: Figure 11.8 – An evaluation summary
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.8 – 评估摘要
- en: In addition, the metrics results are stored in the S3 bucket that you have specified,
    as shown in *Figure 11**.9*.
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，指标结果存储在您指定的S3桶中，如图*图11.9*所示。
- en: '![Figure 11.9 – Metrics results in the S3 bucket](img/B22045_11_09.jpg)'
  id: totrans-127
  prefs: []
  type: TYPE_IMG
  zh: '![图11.9 – S3桶中的指标结果](img/B22045_11_09.jpg)'
- en: Figure 11.9 – Metrics results in the S3 bucket
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.9 – S3桶中的指标结果
- en: Let us understand how the evaluation is performed for each of the task types.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们了解每种任务类型是如何进行评估的。
- en: Text generation
  id: totrans-130
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 文本生成
- en: 'For text generation task type, here is how the evaluation is performed:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 对于文本生成任务类型，评估的执行方式如下：
- en: '**Accuracy**: This metric is evaluated using the **Real World Knowledge** (**RWK**)
    score, which assesses the model’s ability to understand the real world. The RWK
    score measures the extent to which a language model can produce output that is
    consistent with real-world facts and common sense. It assesses the model’s ability
    to reason about the physical world, understand social norms, and avoid generating
    nonsensical or contradictory statements. A high RWK score indicates that the model
    is performing accurately.'
  id: totrans-132
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**准确性**：此指标使用**现实世界知识**（**RWK**）分数进行评估，该分数评估模型理解现实世界的能力。RWK分数衡量语言模型产生与现实世界事实和常识一致输出的程度。它评估模型对物理世界的推理能力、理解社会规范以及避免生成无意义或矛盾的陈述的能力。高RWK分数表示模型表现准确。'
- en: '**Robustness**: Semantic robustness is the metric used to measure robustness
    in this task type. It is calculated using the word error rate, which quantifies
    how much the model’s output changes in response to minor, semantic-preserving
    perturbations in the input. A low semantic robustness score signifies that the
    model is performing well, as it is robust to such perturbations.'
  id: totrans-133
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**鲁棒性**：语义鲁棒性是衡量此任务类型鲁棒性的指标。它使用词错误率来计算，该词错误率量化了模型输出在输入发生轻微、语义保留的扰动时的变化程度。低语义鲁棒性分数表示模型表现良好，因为它对这些扰动具有鲁棒性。'
- en: '**Toxicity**: This metric is calculated using the detoxify algorithm ([https://github.com/unitaryai/detoxify](https://github.com/unitaryai/detoxify)),
    which measures the presence of toxic content in the model’s output. A low toxicity
    value indicates that the selected model is not generating a significant amount
    of harmful or offensive content.'
  id: totrans-134
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**毒性**：此指标使用detoxify算法([https://github.com/unitaryai/detoxify](https://github.com/unitaryai/detoxify))计算，该算法衡量模型输出中存在有毒内容的情况。低毒性值表示所选模型不会生成大量有害或冒犯性的内容。'
- en: Text summarization
  id: totrans-135
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 文本摘要
- en: 'For text summarization task type, here is how the evaluation is performed:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 对于文本摘要任务类型，评估方式如下：
- en: '**Accuracy**: The BERTScore is used to evaluate accuracy in this task type.
    It is calculated using pre-trained contextual embeddings from BERT models and
    matches words in candidate and reference sentences by cosine similarity.'
  id: totrans-137
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**准确性**：在此任务类型中，使用 BERTScore 来评估准确性。它是通过使用 BERT 模型的预训练上下文嵌入来计算的，并通过余弦相似度匹配候选句和参考句中的单词。'
- en: '**Robustness**: This metric is expressed as a percentage and is calculated
    by taking the difference between the BERTScores of a perturbed prompt and the
    original prompt, which is then divided by the BERTScore of the original prompt
    and multiplied by 100\. The lower the score, the more robust the selected model
    is.'
  id: totrans-138
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**鲁棒性**：此指标以百分比表示，通过计算扰动提示和原始提示的 BERTScore 之差，然后除以原始提示的 BERTScore 并乘以 100 来计算。分数越低，表示所选模型越鲁棒。'
- en: '**Toxicity**: As with the general text generation task type, the detoxify algorithm
    is used to calculate the toxicity of the model’s output, with a low value indicating
    minimal toxic content generation.'
  id: totrans-139
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**毒性**：与一般文本生成任务类型一样，使用 detoxify 算法来计算模型输出的毒性，低值表示生成的毒性内容最少。'
- en: Question and answer
  id: totrans-140
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 问答
- en: 'For question and answer task type, here is how the evaluation is performed:'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 对于问答任务类型，评估方式如下：
- en: '**Accuracy**: The F1 score is used to evaluate accuracy in this task type.
    It is calculated by dividing the precision score (the ratio of correct predictions
    to all predictions) by the recall score (the ratio of correct predictions to the
    total number of relevant predictions). Higher F1 scores indicate better performance.'
  id: totrans-142
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**准确性**：在此任务类型中，使用 F1 分数来评估准确性。它是通过将精确度分数（正确预测与所有预测的比率）除以召回率分数（正确预测与相关预测总数的比率）来计算的。F1
    分数越高，表示性能越好。'
- en: '**Robustness**: This metric is expressed as a percentage and is calculated
    by taking the difference between the F1 scores of a perturbed prompt and the original
    prompt, which is then divided by the F1 score of the original prompt and multiplied
    by 100\. A lower score indicates that the selected model is more robust.'
  id: totrans-143
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**鲁棒性**：此指标以百分比表示，通过计算扰动提示和原始提示的 F1 分数之差，然后除以原始提示的 F1 分数并乘以 100 来计算。分数越低，表示所选模型越鲁棒。'
- en: '**Toxicity**: As with the other task types, the detoxify algorithm is used
    to calculate the toxicity of the model’s output, with a low value indicating minimal
    toxic content generation.'
  id: totrans-144
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**毒性**：与其他任务类型一样，使用 detoxify 算法来计算模型输出的毒性，低值表示生成的毒性内容最少。'
- en: Text classification
  id: totrans-145
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 文本分类
- en: 'For text classification task type, here is how the evaluation is performed:'
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 对于文本分类任务类型，评估方式如下：
- en: '**Accuracy**: In this task type, accuracy is calculated by comparing the predicted
    class to its ground truth label. A higher accuracy score indicates that the model
    is correctly classifying text based on the provided ground truth labels.'
  id: totrans-147
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**准确性**：在此任务类型中，通过比较预测类别与其真实标签来计算准确性。准确性分数越高，表示模型根据提供的真实标签正确分类文本的能力越强。'
- en: '**Robustness**: This metric is expressed as a percentage and is calculated
    by taking the difference between the classification accuracy scores of a perturbed
    prompt and the original prompt, which is then divided by the classification accuracy
    score of the original prompt and multiplied by 100\. A lower score indicates that
    the selected model is more robust.'
  id: totrans-148
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**鲁棒性**：此指标以百分比表示，通过计算扰动提示和原始提示的分类准确性分数之差，然后除以原始提示的分类准确性分数并乘以 100 来计算。分数越低，表示所选模型越鲁棒。'
- en: 'Let us analyze the output of the accuracy and robustness metrics for the built-in
    dataset from T-Rex: ([https://hadyelsahar.github.io/t-rex/](https://hadyelsahar.github.io/t-rex/)):'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: '让我们分析来自 T-Rex 内置数据集的准确性和鲁棒性指标：([https://hadyelsahar.github.io/t-rex/](https://hadyelsahar.github.io/t-rex/)):'
- en: '[PRE43]'
  id: totrans-150
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: The output shows that a prompt (`al-Hira is the capital of`) is provided to
    the Anthropic Claude v2 model, and that the model’s response (`Al-Hira was an
    ancient city in Mesopotamia...`) is assessed against a reference response (`Lakhmid`).
    The evaluation computes scores for metrics such as accuracy and robustness, providing
    insights into the model’s performance on this specific input.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 输出显示，提供了一个提示（`al-Hira是首都`）给Anthropic Claude v2模型，并且该模型的响应（`Al-Hira是美索不达米亚的一个古老城市...`）被评估为参考响应（`Lakhmid`）。评估计算了诸如准确性和鲁棒性等指标的分数，为模型在此特定输入上的性能提供了见解。
- en: Using human evaluation
  id: totrans-152
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用人工评估
- en: 'Human evaluation allows you to incorporate human input into the evaluation
    process, so the models are not only accurate but also align with real-world expectations
    and requirements. There are two types of human evaluation:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 人工评估允许您将人工输入纳入评估过程，因此模型不仅准确，而且符合现实世界的期望和要求。有人工评估有两种类型：
- en: Bringing your own work team
  id: totrans-154
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 带自己的工作团队
- en: Using an AWS-managed work team
  id: totrans-155
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用AWS管理的团队
- en: Bringing your own work team
  id: totrans-156
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 带自己的工作团队
- en: 'Similar to automatic model evaluation, when you choose human evaluation with
    your own work team, Amazon Bedrock guides you through a straightforward setup
    process, allowing you to select the models you want to evaluate, the task type
    (for example, text summarization), and the evaluation metrics. It also shows you
    how to upload your custom prompt dataset. Let us consider the step-by-step process
    for setting up human evaluation by bringing your own team:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 与自动模型评估类似，当您选择使用您自己的工作团队进行人工评估时，Amazon Bedrock会引导您通过一个简单的设置过程，让您选择要评估的模型、任务类型（例如，文本摘要）和评估指标。它还会向您展示如何上传您定制的提示数据集。让我们考虑通过自己的团队设置人工评估的逐步过程：
- en: '**Evaluation name**: Choose a descriptive name that accurately represents the
    purpose of the job. This name should be unique within your AWS account in the
    specific AWS region. Along with the name, you can optionally provide the description
    and tags.'
  id: totrans-158
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**评估名称**：选择一个能够准确反映工作目的的描述性名称。此名称应在特定AWS区域内的AWS账户中是唯一的。除了名称外，您还可以选择性地提供描述和标签。'
- en: '**Model selector**: Select the model that you would like to evaluate (as shown
    in *Figure 11**.10*). At the time of writing this book, human model evaluation
    with bringing your own team can only performed on up to two models. Within the
    model selector, you can optionally modify the inference parameters such as temperature,
    Top P, response length, and so on.'
  id: totrans-159
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**模型选择器**：选择您想要评估的模型（如图*图11.10*所示）。在撰写本书时，使用您自己的团队进行人工模型评估只能针对最多两个模型进行。在模型选择器中，您可以选择性地修改推理参数，如温度、Top
    P、响应长度等。'
- en: '![Figure 11.10 – The model selector](img/B22045_11_10.jpg)'
  id: totrans-160
  prefs: []
  type: TYPE_IMG
  zh: '![图11.10 – 模型选择器](img/B22045_11_10.jpg)'
- en: Figure 11.10 – The model selector
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.10 – 模型选择器
- en: '**Task Type**: Currently, the following task types are supported in this mode:'
  id: totrans-162
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**任务类型**：目前，在此模式下支持以下任务类型：'
- en: General text generation
  id: totrans-163
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通用文本生成
- en: Text summarization
  id: totrans-164
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 文本摘要
- en: Question and answer
  id: totrans-165
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 问答
- en: Text classification
  id: totrans-166
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 文本分类
- en: Custom
  id: totrans-167
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 自定义
- en: The last task type of these, Custom, allows you to specify custom evaluation
    metrics that the human workers can use.
  id: totrans-168
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 这些任务类型中的最后一个，自定义，允许您指定人类工作者可以使用自定义评估指标。
- en: Based on the task type, you will see the list of evaluation metrics and rating
    methods that you would have to choose from, as shown in *Figures 11.11* and *11.12*.
  id: totrans-169
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 根据任务类型，您将看到您必须从其中选择的评估指标和评分方法的列表，如图*图11.11*和*11.12*所示。
- en: '![Figure 11.11 – Evaluation metrics](img/B22045_11_11.jpg)'
  id: totrans-170
  prefs: []
  type: TYPE_IMG
  zh: '![图11.11 – 评估指标](img/B22045_11_11.jpg)'
- en: Figure 11.11 – Evaluation metrics
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.11 – 评估指标
- en: '![Figure 11.12 – Rating method options](img/B22045_11_12.jpg)'
  id: totrans-172
  prefs: []
  type: TYPE_IMG
  zh: '![图11.12 – 评分方法选项](img/B22045_11_12.jpg)'
- en: Figure 11.12 – Rating method options
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.12 – 评分方法选项
- en: '**Specifying paths**: Next, you will need to specify the s3 path to your custom
    prompt dataset. As we have seen in the previous subsection, a custom prompt dataset
    needs to be in the *.jsonl* format. Here is an example of the custom prompt dataset:'
  id: totrans-174
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**指定路径**：接下来，您需要指定自定义提示数据集的s3路径。正如我们在前面的子节中看到的，自定义提示数据集需要是*.jsonl*格式。以下是一个自定义提示数据集的示例：'
- en: '[PRE44]'
  id: totrans-175
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE44]'
- en: '[PRE45]'
  id: totrans-176
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE45]'
- en: '[PRE46]'
  id: totrans-177
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE46]'
- en: Please note that the s3 path to your dataset requires you to have your **Cross
    Origin Resource Sharing (CORS)** settings configured as shown in *Figure 11**.13*.
  id: totrans-178
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 请注意，您的数据集的s3路径需要您将**跨源资源共享（CORS）**设置配置为如图*图11.13*所示。
- en: '![Figure 11.13 – The CORS policy window](img/B22045_11_13.jpg)'
  id: totrans-179
  prefs: []
  type: TYPE_IMG
  zh: '![图11.13 – CORS策略窗口](img/B22045_11_13.jpg)'
- en: Figure 11.13 – The CORS policy window
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.13 – CORS策略窗口
- en: To learn more, you can visit [https://docs.aws.amazon.com/bedrock/latest/userguide/model-evaluation-security-cors.html](https://docs.aws.amazon.com/bedrock/latest/userguide/model-evaluation-security-cors.html).
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 要了解更多信息，您可以访问[https://docs.aws.amazon.com/bedrock/latest/userguide/model-evaluation-security-cors.html](https://docs.aws.amazon.com/bedrock/latest/userguide/model-evaluation-security-cors.html)。
- en: '**IAM role and KMS key**: Certain permissions are required to perform actions
    such as accessing data from an S3 bucket or storing the evaluation results. You
    can find more details on the IAM permissions needed for the model evaluation job
    at [https://docs.aws.amazon.com/bedrock/latest/userguide/model-evaluation-security.html?icmpid=docs_bedrock_help_panel_model_evaluation](https://docs.aws.amazon.com/bedrock/latest/userguide/model-evaluation-security.html?icmpid=docs_bedrock_help_panel_model_evaluation).'
  id: totrans-182
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**IAM角色和KMS密钥**：执行诸如从S3存储桶访问数据或存储评估结果等操作需要特定的权限。您可以在[https://docs.aws.amazon.com/bedrock/latest/userguide/model-evaluation-security.html?icmpid=docs_bedrock_help_panel_model_evaluation](https://docs.aws.amazon.com/bedrock/latest/userguide/model-evaluation-security.html?icmpid=docs_bedrock_help_panel_model_evaluation)找到有关模型评估作业所需的IAM权限的更多详细信息。'
- en: '**Setting up a work team**: Next, you will need to set up a work team (as shown
    in *Figure 11**.14*). This involves inviting the appropriate team members. The
    console provides you with sample email templates for inviting new workers and
    existing workers, which you can use as a reference when sending out the invitations.
    The worker receives the link to the private worker portal where they complete
    the labeling task.'
  id: totrans-183
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**设置工作团队**：接下来，您需要设置一个工作团队（如图11.14所示）。这包括邀请适当的团队成员。控制台为您提供了邀请新工作者和现有工作者的示例电子邮件模板，您可以在发送邀请时作为参考。工作者会收到一个链接，链接到私人工作者门户，在那里他们完成标记任务。'
- en: '![Figure 11.14 – Setting up a custom work team](img/B22045_11_14.jpg)'
  id: totrans-184
  prefs: []
  type: TYPE_IMG
  zh: '![图11.14 – 设置自定义工作团队](img/B22045_11_14.jpg)'
- en: Figure 11.14 – Setting up a custom work team
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.14 – 设置自定义工作团队
- en: Next, you would need to specify the instructions (as shown in *Figure 11**.15*)
    of the task to the workers. These instructions will be visible to the human workers
    in the private worker portal where they will perform the labeling task.
  id: totrans-186
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 接下来，您需要将任务的说明（如图11.15所示）告知工作者。这些说明将在工作者执行标记任务的私人工作者门户中可见。
- en: '![Figure 11.15 – Providing instructions to human workers](img/B22045_11_15.jpg)'
  id: totrans-187
  prefs: []
  type: TYPE_IMG
  zh: '![图11.15 – 向人工工作者提供说明](img/B22045_11_15.jpg)'
- en: Figure 11.15 – Providing instructions to human workers
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.15 – 向人工工作者提供说明
- en: 'After you have reviewed and created the job, the human worker team will receive
    an email along with the link to the portal to perform the task. Once the task
    has been completed by the workers, Amazon Bedrock will provide an evaluation report
    card. Let us understand the report card in detail:'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 在您审查并创建作业后，人工工作者团队将收到一封电子邮件，以及执行任务的门户链接。一旦工作者完成任务，Amazon Bedrock将提供评估报告卡。让我们详细了解报告卡：
- en: '`1` to `5`. When using this method, it is essential to provide clear instructions
    that define the meaning of each rating point. For instance, a rating of `1` could
    indicate a poor or irrelevant response, while a rating of `5` could signify an
    excellent and highly relevant output. The results are then presented as a histogram
    showcasing the distribution of ratings across the dataset:'
  id: totrans-190
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`1`到`5`。在使用此方法时，提供明确的说明以定义每个评分点的含义至关重要。例如，评分`1`可能表示较差或不相关的响应，而评分`5`可能表示优秀且高度相关的输出。结果将以直方图的形式展示，展示评分在数据集中的分布情况：'
- en: Define the scale points explicitly (for example, 1 = poor, 2 = fair, 3 = good,
    4 = very good, 5 = excellent)
  id: totrans-191
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 明确定义刻度点（例如，1 = 差，2 = 一般，3 = 好，4 = 非常好，5 = 优秀）
- en: Provide clear guidelines for evaluators on how to interpret and apply the scale
  id: totrans-192
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为评估者提供明确的指南，说明如何解释和应用刻度
- en: Present the results as a histogram, allowing for easy visual interpretation
    of the rating distribution
  id: totrans-193
  prefs:
  - PREF_IND
  - PREF_UL
  type: TYPE_NORMAL
  zh: 以直方图的形式展示结果，便于轻松视觉解释评分分布
- en: '**Choice buttons**: When you choose the choice buttons method, evaluators are
    presented with two model responses and asked to select their preferred option.
    This approach is particularly useful when comparing the performance of multiple
    models on the same task. The results are typically reported as a percentage, indicating
    the proportion of responses that evaluators preferred for each model.'
  id: totrans-194
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**选择按钮**：当您选择选择按钮方法时，评估者会看到两个模型响应并要求选择他们偏好的选项。这种方法在比较多个模型在相同任务上的性能时特别有用。结果通常以百分比的形式报告，表示评估者对每个模型偏好的响应比例。'
- en: '`1` (most preferred). This method provides a more nuanced understanding of
    the relative performance of different models. The results are presented as a histogram
    showing the distribution of rankings across the dataset.'
  id: totrans-195
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`1`（最优先）。这种方法提供了对不同模型相对性能的更细致的理解。结果以直方图的形式展示，显示了数据集中排名的分布。'
- en: '**Thumbs up/down**: Evaluators rate each response as acceptable or unacceptable.
    The final report showcases the percentage of responses that received a **thumbs-up**
    rating for each model, enabling a straightforward assessment of acceptability.'
  id: totrans-196
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**点赞/踩**：评估者对每个响应进行接受或不接受的评分。最终报告展示了每个模型获得**点赞**评分的响应百分比，从而可以简单地评估其接受度。'
- en: Another form of human evaluation method is through an AWS-managed work team.
  id: totrans-197
  prefs: []
  type: TYPE_NORMAL
  zh: 另一种人类评估方法是通过 AWS 管理的工作团队。
- en: Using an AWS-managed work team
  id: totrans-198
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用 AWS 管理的工作团队
- en: If you opt for an AWS-managed team, you can simply describe your model evaluation
    needs, including the task type, expertise level required, and approximate number
    of prompts. Based on these details, an AWS expert will then reach out to discuss
    your project requirements in detail, providing a custom quote and project timeline
    tailored to your specific needs.
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您选择 AWS 管理的团队，您可以简单描述您的模型评估需求，包括任务类型、所需的专家级别和大约的提示数量。基于这些详细信息，AWS 专家将随后联系，详细讨论您的项目需求，提供符合您特定需求的定制报价和项目时间表。
- en: '*Figure 11**.16* shows how you can create a managed workforce with all the
    details such as task type and expertise required.'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 11.16* 展示了如何创建一个包含任务类型和所需专家级别等所有详细信息的管理工作团队。'
- en: '![Figure 11.16 – AWS-managed team for model evaluation](img/B22045_11_16.jpg)'
  id: totrans-201
  prefs: []
  type: TYPE_IMG
  zh: '![图 11.16 – AWS 管理的模型评估团队](img/B22045_11_16.jpg)'
- en: Figure 11.16 – AWS-managed team for model evaluation
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 图 11.16 – AWS 管理的模型评估团队
- en: An AWS-managed workforce is useful when you do not want to manage or assign
    tasks to your own workforce and when you require an AWS team to perform evaluations
    on your behalf.
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 当您不想管理或分配任务给您的员工，并且需要 AWS 团队代表您进行评估时，AWS 管理的工作团队非常有用。
- en: Aside from using Bedrock’s model evaluation job, there are other open source
    techniques that you can utilize for model evaluation, such as `fmeval` and Ragas.
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 除了使用 Bedrock 的模型评估作业外，还有其他开源技术可用于模型评估，例如 `fmeval` 和 Ragas。
- en: FMEval
  id: totrans-205
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: FMEval
- en: FMEval is the open source library made available by AWS, which you can access
    at [https://github.com/aws/fmeval](https://github.com/aws/fmeval).
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: FMEval 是 AWS 提供的开源库，您可以在 [https://github.com/aws/fmeval](https://github.com/aws/fmeval)
    访问。
- en: This library enables comprehensive evaluation of LLMs across various aspects
    such as accuracy, toxicity, semantic robustness, and prompt stereotyping. It offers
    a range of algorithms tailored for assessing LLMs’ performance on different tasks,
    ensuring a thorough understanding of their capabilities and limitations.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: 此库能够全面评估 LLM 在准确性、毒性、语义鲁棒性和提示刻板印象等各个方面。它提供了一系列针对评估 LLM 在不同任务上性能的算法，确保对其能力和局限性的全面理解。
- en: 'If you plan to use your own dataset for evaluation, you’ll need to configure
    a `DataConfig` object, like in the following code block. This object specifies
    the dataset name, URI, and MIME type, as well as the locations of the input prompts,
    target outputs, and other relevant columns. By customizing the `DataConfig` object,
    you can tailor the evaluation process to your specific dataset and task requirements:'
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您计划使用自己的数据集进行评估，您需要配置一个 `DataConfig` 对象，如下面的代码块所示。此对象指定数据集名称、URI 和 MIME 类型，以及输入提示、目标输出和其他相关列的位置。通过自定义
    `DataConfig` 对象，您可以调整评估过程以适应您特定的数据集和任务需求：
- en: '[PRE47]'
  id: totrans-209
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: 'The library provides a flexible `ModelRunner` interface, allowing for seamless
    integration with Amazon Bedrock, and is used to perform invocations on the model.
    The following code block shows how an invocation can be carried out:'
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 该库提供了一个灵活的`ModelRunner`接口，允许与Amazon Bedrock无缝集成，并用于对模型进行调用。以下代码块展示了如何执行调用：
- en: '[PRE48]'
  id: totrans-211
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: If you want to learn more about `fmeval`, you can visit [https://github.com/aws/fmeval/tree/main](https://github.com/aws/fmeval/tree/main).
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您想了解更多关于`fmeval`的信息，您可以访问[https://github.com/aws/fmeval/tree/main](https://github.com/aws/fmeval/tree/main)。
- en: 'In addition, you can try out `fmeval` with Amazon Bedrock. Here are some sample
    examples that you can test with Anthropic Claude v2:'
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，您还可以尝试使用Amazon Bedrock进行`fmeval`。以下是一些您可以测试的Anthropic Claude v2的示例：
- en: '[https://github.com/aws/fmeval/blob/main/examples/bedrock-claude-factual-knowledge.ipynb](https://github.com/aws/fmeval/blob/main/examples/bedrock-claude-factual-knowledge.ipynb)'
  id: totrans-214
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://github.com/aws/fmeval/blob/main/examples/bedrock-claude-factual-knowledge.ipynb](https://github.com/aws/fmeval/blob/main/examples/bedrock-claude-factual-knowledge.ipynb)'
- en: '[https://github.com/aws/fmeval/blob/main/examples/bedrock-claude-summarization-accuracy.ipynb](https://github.com/aws/fmeval/blob/main/examples/bedrock-claude-summarization-accuracy.ipynb)'
  id: totrans-215
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '[https://github.com/aws/fmeval/blob/main/examples/bedrock-claude-summarization-accuracy.ipynb](https://github.com/aws/fmeval/blob/main/examples/bedrock-claude-summarization-accuracy.ipynb)'
- en: Ragas
  id: totrans-216
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: Ragas
- en: Ragas is a framework designed to assess the performance of your RAG pipelines,
    which combine language models with external data sources to enhance their output.
    It offers practical tools grounded in the latest research to analyze the text
    generated by your language model, giving you valuable insights into the effectiveness
    of your RAG pipeline.
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: Ragas是一个框架，旨在评估您的RAG管道的性能，这些管道结合了语言模型和外部数据源以增强其输出。它提供了基于最新研究的实用工具，用于分析您语言模型生成的文本，为您提供有关RAG管道有效性的宝贵见解。
- en: 'Here are some key features and benefits of using Ragas:'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 下面是使用Ragas的一些关键功能和好处：
- en: '**Automated evaluation metrics**: Ragas offers a suite of automated metrics
    tailored specifically for assessing the quality of RAG-generated text. These metrics
    go beyond traditional measures such as perplexity and BLEU, providing a more nuanced
    understanding of the generated output’s coherence, relevance, and factual accuracy.'
  id: totrans-219
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**自动评估指标**：Ragas提供了一套针对评估RAG生成文本质量的自动化指标。这些指标超越了传统的度量，如困惑度和BLEU，提供了对生成输出连贯性、相关性和事实准确性的更深入理解。'
- en: '**Customizable evaluation strategies**: Recognizing that every RAG pipeline
    is unique, Ragas allows for flexible and customizable evaluation strategies. You
    can tailor the evaluation process to align with your specific use case, data domain,
    and performance requirements.'
  id: totrans-220
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**可定制的评估策略**：认识到每个RAG管道都是独特的，Ragas允许灵活和可定制的评估策略。您可以调整评估过程以适应您的特定用例、数据领域和性能要求。'
- en: '**Integration with CI/CD pipelines**: Ragas is designed to integrate with **CI/CD**
    (**Continuous Integration and Continuous Deployment**) pipelines. This integration
    enables continuous monitoring and evaluation of your RAG pipeline’s performance,
    ensuring that any deviations or regressions are promptly detected and addressed.'
  id: totrans-221
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**与CI/CD管道的集成**：Ragas旨在与**CI/CD**（**持续集成和持续部署**）管道集成。这种集成使您可以持续监控和评估RAG管道的性能，确保任何偏差或回归都能得到及时检测和处理。'
- en: '**Interpretable insights**: Ragas generates interpretable and actionable insights,
    highlighting areas where your RAG pipeline excels and identifying potential weaknesses
    or bottlenecks. These insights can guide your optimization efforts, helping you
    refine and enhance your pipeline’s performance iteratively.'
  id: totrans-222
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**可解释的见解**：Ragas生成可解释和可操作的见解，突出您RAG管道表现优异的领域，并识别潜在的弱点或瓶颈。这些见解可以指导您的优化工作，帮助您迭代地改进和增强管道的性能。'
- en: 'Ragas provides a list of metrics that you can import. Here is how:'
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: Ragas提供了一系列您可以导入的指标。以下是操作方法：
- en: '[PRE49]'
  id: totrans-224
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: 'These metrics can then be passed to the `evaluate` function in Ragas, along
    with the Bedrock model and embeddings. Here is how:'
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 这些指标可以传递给Ragas中的`evaluate`函数，以及Bedrock模型和嵌入。以下是操作方法：
- en: '[PRE50]'
  id: totrans-226
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: In the preceding code snippet, `df` is assumed to be a pandas DataFrame containing
    the data you want to evaluate. Note that `llm=bedrock_model` and `embeddings=bedrock_embeddings`
    are the instances of the Bedrock and embeddings models, respectively, that we
    have created beforehand.
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的代码片段中，`df`假设是一个包含您想要评估的数据的pandas DataFrame。请注意，`llm=bedrock_model`和`embeddings=bedrock_embeddings`是我们先前创建的Bedrock和嵌入模型实例。
- en: For the complete tutorial on how to use Amazon Bedrock with Ragas, you can go
    to [https://docs.ragas.io/en/stable/howtos/customisations/aws-bedrock.html](https://docs.ragas.io/en/stable/howtos/customisations/aws-bedrock.html).
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 对于如何使用 Ragas 与 Amazon Bedrock 的完整教程，您可以访问 [https://docs.ragas.io/en/stable/howtos/customisations/aws-bedrock.html](https://docs.ragas.io/en/stable/howtos/customisations/aws-bedrock.html)。
- en: Now that we have seen various techniques to perform Amazon Bedrock model evaluation,
    let us look at monitoring and logging solutions integrated with Amazon Bedrock.
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经看到了执行 Amazon Bedrock 模型评估的各种技术，让我们看看与 Amazon Bedrock 集成的监控和日志记录解决方案。
- en: Monitoring Amazon Bedrock
  id: totrans-230
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 监控 Amazon Bedrock
- en: Monitoring the performance and usage of your generative AI applications is crucial
    for ensuring optimal functionality, maintaining security and privacy standards,
    and gaining insights for future enhancements. Amazon Bedrock seamlessly integrates
    with Amazon CloudWatch, CloudTrail, and EventBridge, which provides a comprehensive
    monitoring and logging solution.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 监控您的生成式 AI 应用程序的性能和用法对于确保最佳功能、维护安全和隐私标准以及获取未来改进的见解至关重要。Amazon Bedrock 与 Amazon
    CloudWatch、CloudTrail 和 EventBridge 无缝集成，提供全面的监控和日志记录解决方案。
- en: Amazon CloudWatch
  id: totrans-232
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Amazon CloudWatch
- en: Amazon CloudWatch is a monitoring and observability service that collects and
    visualizes data from various AWS resources, including Amazon Bedrock. By leveraging
    CloudWatch, you can gain valuable insights into your Bedrock models’ performance
    so you can identify and address potential issues proactively. Through CloudWatch,
    you can track usage metrics and construct tailored dashboards for auditing purposes,
    ensuring transparency and accountability throughout the AI model development process.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: Amazon CloudWatch 是一种监控和可观察性服务，它收集并可视化来自各种 AWS 资源的数据，包括 Amazon Bedrock。通过利用
    CloudWatch，您可以获得有关 Bedrock 模型性能的宝贵见解，以便您可以主动识别和解决问题。通过 CloudWatch，您可以跟踪使用指标并构建定制的仪表板以进行审计，确保在整个
    AI 模型开发过程中保持透明度和问责制。
- en: One of the key features of using CloudWatch with Amazon Bedrock is that you
    can gain insights into model usage across multiple accounts and FMs within a single
    account. You can monitor critical aspects such as model invocations and token
    counts, so you can make informed decisions and optimize resource allocation effectively.
    If you would like to configure monitoring across multiple accounts in one or more
    regions, you can check the Amazon CloudWatch documentation at [https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch-Cross-Account-Methods.html](https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch-Cross-Account-Methods.html).
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 Amazon Bedrock 的一个关键特性是，您可以深入了解单个账户内多个账户和 FM 的模型使用情况。您可以监控关键方面，如模型调用和令牌计数，以便您可以做出明智的决定并有效地优化资源分配。如果您想在一个或多个区域中配置跨多个账户的监控，您可以在
    [https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch-Cross-Account-Methods.html](https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch-Cross-Account-Methods.html)
    查看Amazon CloudWatch 文档。
- en: This provides all the steps that you will need to take to enable this feature.
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 这提供了您需要采取的所有步骤来启用此功能。
- en: Furthermore, Bedrock offers a feature called model *invocation logging*. This
    functionality allows users to collect metadata, requests, and responses for all
    model invocations within the account. While this feature is disabled by default,
    you can easily enable it by going to **Settings** in the Bedrock console and toggling
    **Model invocation logging**. By enabling this, you allow Bedrock to publish invocation
    logs for enhanced visibility and analysis.
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，Bedrock 提供了一个名为模型 *调用日志* 的功能。此功能允许用户收集账户内所有模型调用的元数据、请求和响应。虽然此功能默认禁用，但您可以通过访问
    Bedrock 控制台中的 **设置** 并切换 **模型调用日志** 来轻松启用它。通过启用此功能，您允许 Bedrock 发布调用日志，以增强可见性和分析。
- en: Let us look at how CloudWatch can be leveraged to monitor Bedrock in near real-time,
    utilizing metrics and logs to trigger alarms and initiate actions when predefined
    thresholds are exceeded.
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看如何利用 CloudWatch 在接近实时的情况下监控 Bedrock，利用指标和日志在预定义阈值超过时触发警报并启动操作。
- en: Bedrock metrics
  id: totrans-238
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Bedrock 指标
- en: Amazon Bedrock’s CloudWatch metrics cover a wide range of performance indicators,
    including the number of invocations, invocation latency, invocation client and
    server errors, invocation throttling instances, input and output tokens, and much
    more. You can see the full list of supported metrics at [https://docs.aws.amazon.com/bedrock/latest/userguide/monitoring-cw.html#runtime-cloudwatch-metrics](https://docs.aws.amazon.com/bedrock/latest/userguide/monitoring-cw.html#runtime-cloudwatch-metrics).
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: Amazon Bedrock的CloudWatch度量涵盖了广泛的性能指标，包括调用次数、调用延迟、调用客户端和服务器错误、调用节流实例、输入和输出令牌等。您可以在[https://docs.aws.amazon.com/bedrock/latest/userguide/monitoring-cw.html#runtime-cloudwatch-metrics](https://docs.aws.amazon.com/bedrock/latest/userguide/monitoring-cw.html#runtime-cloudwatch-metrics)查看支持的度量标准的完整列表。
- en: With these metrics, you can compare latency between different models and measure
    token counts to assist in purchasing provisioned throughput, as well as detect
    and alert for throttling events.
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 使用这些度量标准，您可以比较不同模型的延迟，并测量令牌计数，以帮助购买预配吞吐量，以及检测和警报节流事件。
- en: When you are using a chat playground, you can view these metrics after running
    the prompt, as shown in *Figure 11**.17*.
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
  zh: 当您使用聊天游乐场时，您可以在运行提示后查看这些度量标准，如图**11.17**所示。
- en: '![Figure 11.17 – Model metrics](img/B22045_11_17.jpg)'
  id: totrans-242
  prefs: []
  type: TYPE_IMG
  zh: '![图11.17 – 模型度量](img/B22045_11_17.jpg)'
- en: Figure 11.17 – Model metrics
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.17 – 模型度量
- en: In addition, you can define metric criteria, which allow you to provide specific
    conditions or thresholds for the model metrics. You can set criteria such as **latency
    less than 100ms** or **output token count greater than 500** based on your requirements.
    These criteria can be used to evaluate and compare the performance of different
    models against your desired metrics. When comparing multiple models, setting metric
    criteria helps identify which models meet or fail to meet your specified conditions,
    which helps in the selection of the most suitable model for your use case.
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，您还可以定义度量标准，这允许您为模型度量提供特定的条件或阈值。根据您的需求，您可以设置如**延迟小于100ms**或**输出令牌计数大于500**等标准。这些标准可以用来评估和比较不同模型与您期望的度量标准之间的性能。在比较多个模型时，设置度量标准有助于确定哪些模型满足或未满足您指定的条件，这有助于选择最适合您用例的最合适的模型。
- en: Let us also look at these metrics in the CloudWatch metrics dashboard.
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们也在CloudWatch度量仪表板中查看这些度量标准。
- en: '![Figure 11.18 – The CloudWatch metrics dashboard](img/B22045_11_18.jpg)'
  id: totrans-246
  prefs: []
  type: TYPE_IMG
  zh: '![图11.18 – CloudWatch度量仪表板](img/B22045_11_18.jpg)'
- en: Figure 11.18 – The CloudWatch metrics dashboard
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.18 – CloudWatch度量仪表板
- en: 'In *Figure 11**.18*, you can see the CloudWatch metrics for the Anthropic Claude
    3 Sonnet model: **Invocations** (sample count), **InvocationLatency** (in milliseconds),
    **OutputTokenCount** (sample count), and **InputTokenCount** (sample count). Let
    us understand what these terminologies (metrics and statistics) mean:'
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 在**图11.18**中，您可以查看Anthropic Claude 3 Sonnet模型的CloudWatch度量：**调用次数**（样本计数）、**调用延迟**（以毫秒为单位）、**输出令牌计数**（样本计数）和**输入令牌计数**（样本计数）。让我们了解这些术语（指标和统计数据）的含义：
- en: '**Sample count**: This statistic represents total data points or observations
    recorded within a specified timeframe.'
  id: totrans-249
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**样本计数**：这个统计数据表示在指定时间段内记录的总数据点或观察值。'
- en: '`Converse`, `ConverseStream`, `InvokeModel`, and `InvokeModelWithResponseStream`
    APIs within a given time frame.'
  id: totrans-250
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在给定时间段内，`Converse`、`ConverseStream`、`InvokeModel`和`InvokeModelWithResponseStream`
    API。
- en: '**InvocationLatency**: This metric refers to the delay or amount of time that
    has elapsed between when the invocation request is made and when the response
    is received.'
  id: totrans-251
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**调用延迟**：此度量标准指的是从调用请求发出到收到响应之间的延迟或时间量。'
- en: '**OutputTokenCount** and **InputTokenCount** are useful metrics when you are
    analyzing and calculating the cost of model invocations. A token is essentially
    a small group of characters from an input prompt and the response. **OutputTokenCount**
    signifies the total count of tokens in the response provided by the model, whereas
    **InputTokenCount** signifies the total count of tokens in the input and prompt
    provided to the model.'
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: '**输出令牌计数**和**输入令牌计数**是分析并计算模型调用成本时的有用度量标准。令牌本质上是从输入提示和响应中提取的一小组字符。**输出令牌计数**表示模型提供的响应中令牌的总数，而**输入令牌计数**表示提供给模型的输入和提示中令牌的总数。'
- en: To streamline monitoring and analysis, Bedrock’s logs and metrics can be presented
    in a single view using CloudWatch dashboards. These dashboards provide a comprehensive
    overview of the same KPIs, including the number of invocations over time by model,
    invocation latency by model, and token counts for input and output. The following
    figure shows the dashboard view of the metrics in a one-week time frame for the
    two models, Anthropic Claude v2 and Anthropic Claude v3 Sonnet.
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 为了简化监控和分析，Bedrock的日志和指标可以通过CloudWatch仪表板以单一视图呈现。这些仪表板提供了对相同KPIs的全面概述，包括按模型随时间变化的调用次数、按模型的调用延迟以及输入和输出的令牌计数。以下图显示了两个模型，Anthropic
    Claude v2和Anthropic Claude v3 Sonnet，在一周时间框架内的仪表板视图。
- en: '![Figure 11.19 – The CloudWatch dashboard](img/B22045_11_19.jpg)'
  id: totrans-254
  prefs: []
  type: TYPE_IMG
  zh: '![图11.19 – CloudWatch仪表板](img/B22045_11_19.jpg)'
- en: Figure 11.19 – The CloudWatch dashboard
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.19 – CloudWatch仪表板
- en: For organizations with multiple AWS accounts, Bedrock supports CloudWatch cross-account
    observability, enabling the creation of rich cross-account dashboards in monitoring
    accounts. This feature ensures a centralized view of performance metrics across
    various accounts, facilitating better oversight and decision-making.
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 对于拥有多个AWS账户的组织，Bedrock支持CloudWatch跨账户可观察性，允许在监控账户中创建丰富的跨账户仪表板。此功能确保了跨各种账户的性能指标集中视图，便于更好的监督和决策。
- en: Model invocation logging
  id: totrans-257
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 模型调用日志
- en: Model invocation logging allows you to capture and analyze the requests and
    responses generated by the models, along with the metadata of all the invocation
    calls that are made. It provides a comprehensive view of how your models are utilized,
    enabling you to monitor their performance, identify potential issues, and optimize
    their usage.
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: 模型调用日志允许您捕获和分析模型生成的请求和响应，以及所有调用调用的元数据。它提供了对您的模型如何被使用的全面视图，使您能够监控其性能，识别潜在问题，并优化其使用。
- en: Enabling model invocation logging is a straightforward process. You can configure
    it through the Amazon Bedrock console or via the API.
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 启用模型调用日志是一个简单的过程。您可以通过Amazon Bedrock控制台或通过API进行配置。
- en: '![Figure 11.20 – Enabling model invocation logging](img/B22045_11_20.jpg)'
  id: totrans-260
  prefs: []
  type: TYPE_IMG
  zh: '![图11.20 – 启用模型调用日志](img/B22045_11_20.jpg)'
- en: Figure 11.20 – Enabling model invocation logging
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.20 – 启用模型调用日志
- en: '*Figure 11**.20* shows the console view of **Model invocation logging** in
    the Amazon Bedrock console. You will need to enable the feature. The first step
    is to choose the type of data you want to log, such as text, images, or embeddings.
    Next, you’ll need to select the destination for your logs, which can be Amazon
    S3, Amazon CloudWatch Logs, or both, and provide the path.'
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: '*图11.20*显示了Amazon Bedrock控制台中**模型调用日志**的控制台视图。您需要启用此功能。第一步是选择您想要记录的数据类型，例如文本、图像或嵌入。接下来，您需要选择日志的目的地，可以是Amazon
    S3、Amazon CloudWatch Logs或两者，并提供路径。'
- en: If you opt for Amazon S3, your logs will be stored as compressed JSON files,
    each containing a batch of invocation records. These files can be queried using
    Amazon Athena or sent to various AWS services such as Amazon EventBridge. On the
    other hand, if you choose Amazon CloudWatch Logs, your invocation logs will be
    delivered to a specified log group as JSON events. This allows you to leverage
    CloudWatch log insights for querying and analyzing your logs in real time.
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您选择Amazon S3，您的日志将以压缩的JSON文件形式存储，每个文件包含一批调用记录。这些文件可以使用Amazon Athena进行查询，或发送到各种AWS服务，如Amazon
    EventBridge。另一方面，如果您选择Amazon CloudWatch Logs，您的调用日志将以JSON事件的形式发送到指定的日志组。这允许您利用CloudWatch日志洞察功能，实时查询和分析您的日志。
- en: One of the key advantages of model invocation logging is its ability to capture
    large input and output data. For data exceeding 100 KB , or data in binary formats
    (for example, images, audio, and so on), Amazon Bedrock automatically uploads
    it to your designated Amazon S3 bucket. This ensures that no valuable information
    is lost, even for large or non-text data.
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 模型调用日志的一个关键优势在于其能够捕获大量输入和输出数据。对于超过100 KB的数据，或者二进制格式（例如，图像、音频等）的数据，Amazon Bedrock会自动将其上传到您指定的Amazon
    S3存储桶。这确保了即使对于大量或非文本数据，也不会丢失任何有价值的信息。
- en: By leveraging this feature, you can optimize your models, identify potential
    issues, and ensure that your systems are operating efficiently and effectively.
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 通过利用此功能，您可以优化您的模型，识别潜在问题，并确保您的系统高效且有效地运行。
- en: 'Here is a sample model invocation logs in the CloudWatch logs console:'
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 下面是CloudWatch日志控制台中模型调用日志的一个示例：
- en: '[PRE51]'
  id: totrans-267
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: The preceding log snippet provides the `ConverseStream` conversational request
    made to the `anthropic.claude-v2` model. It captures various data points such
    as the input prompt, output response, performance metrics, and usage statistics.
    With this comprehensive logging, you can perform effective analysis and evaluation
    of the model’s capabilities and behavior.
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的日志片段提供了对`anthropic.claude-v2`模型的`ConverseStream`对话请求。它捕获了各种数据点，如输入提示、输出响应、性能指标和用量统计。通过这种全面的日志记录，您可以有效地分析和评估模型的能力和行为。
- en: AWS CloudTrail
  id: totrans-269
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: AWS CloudTrail
- en: AWS CloudTrail is a compliance and auditing service that allows you to capture
    and analyze all API calls made within your AWS environment. Here’s how you can
    leverage CloudTrail to gain invaluable insights.
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: AWS CloudTrail是一种合规性和审计服务，允许您捕获和分析您AWS环境中所有API调用。以下是您如何利用CloudTrail获得宝贵见解的方法。
- en: Amazon Bedrock seamlessly integrates with AWS CloudTrail, capturing every API
    call as an event. These events encompass actions initiated from the Amazon Bedrock
    console, as well as programmatic calls made through the Amazon Bedrock API operations.
    In CloudTrail, you gain a comprehensive record of who initiated the request, the
    source IP address, the timestamp, and additional details surrounding the request.
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: Amazon Bedrock与AWS CloudTrail无缝集成，将每个API调用作为一个事件捕获。这些事件包括从Amazon Bedrock控制台发起的操作，以及通过Amazon
    Bedrock API操作进行的程序调用。在CloudTrail中，您可以获得关于谁发起请求、源IP地址、时间戳以及与请求相关的其他详细信息的全面记录。
- en: 'Amazon Bedrock logs two distinct categories of events with CloudTrail: data
    events and management events. When it comes to data events, CloudTrail doesn’t
    log Amazon Bedrock Runtime API operations (`InvokeModel` and `InvokeModelWithResponseStream`)
    as data events by default. However, it does log all actions related to agents
    for Amazon Bedrock Runtime API operations, categorized as data events:'
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: Amazon Bedrock使用CloudTrail记录两类不同的事件：数据事件和管理事件。当涉及到数据事件时，CloudTrail默认不将Amazon
    Bedrock Runtime API操作（`InvokeModel`和`InvokeModelWithResponseStream`）记录为数据事件。然而，它确实记录了与Amazon
    Bedrock Runtime API操作相关的所有代理操作，这些操作被归类为数据事件：
- en: To log `InvokeAgent` calls, you would need to configure advanced event selectors
    on the CloudTrail trail to record data events for the `AWS::Bedrock::AgentAlias`
    resource type.
  id: totrans-273
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要记录`InvokeAgent`调用，您需要在CloudTrail跟踪上配置高级事件选择器以记录`AWS::Bedrock::AgentAlias`资源类型的数据事件。
- en: To log `Retrieve` and `RetrieveAndGenerate` calls, configure advanced event
    selectors to record data events for the `AWS::Bedrock::KnowledgeBase` resource
    type.
  id: totrans-274
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要记录`Retrieve`和`RetrieveAndGenerate`调用，请配置高级事件选择器以记录`AWS::Bedrock::KnowledgeBase`资源类型的数据事件。
- en: Advanced Event Selector enables the creation of precision and granular filters
    for monitoring and managing CloudTrail activities related to both management and
    data events.
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 高级事件选择器允许创建针对监控和管理与管理和数据事件相关的CloudTrail活动的精确和细粒度过滤器。
- en: '**Data events** provide insights into resource operations such as reading or
    writing to resources such as Amazon Bedrock Knowledge Bases or agent aliases.
    These events are not logged by default due to their high volume but logging can
    be enabled through advanced event selectors.'
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: '**数据事件**提供了对资源操作（如读取或写入Amazon Bedrock知识库或代理别名等资源）的洞察。由于数据量较大，这些事件默认不记录，但可以通过高级事件选择器启用记录。'
- en: On the other hand, **management events** capture control plane operations such
    as API calls for creating, updating, or deleting Amazon Bedrock resources. CloudTrail
    automatically logs these management events, providing a comprehensive audit trail
    of administrative activities within your Amazon Bedrock environment.
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 另一方面，**管理事件**捕获控制平面操作，例如创建、更新或删除Amazon Bedrock资源的API调用。CloudTrail自动记录这些管理事件，为您的Amazon
    Bedrock环境中的管理活动提供全面的审计跟踪。
- en: 'If you would like to learn more about CloudTrail, please check the AWS documentation:
    [https://docs.aws.amazon.com/awscloudtrail/latest/userguide/how-cloudtrail-works.html](https://docs.aws.amazon.com/awscloudtrail/latest/userguide/how-cloudtrail-works.html).'
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 如果您想了解更多关于CloudTrail的信息，请查看AWS文档：[https://docs.aws.amazon.com/awscloudtrail/latest/userguide/how-cloudtrail-works.html](https://docs.aws.amazon.com/awscloudtrail/latest/userguide/how-cloudtrail-works.html)。
- en: Leveraging AWS CloudTrail in conjunction with Amazon Bedrock provides you with
    a powerful auditing and monitoring solution. By capturing and analyzing API calls,
    you can maintain visibility in your Amazon Bedrock environment, ensure adherence
    to best practices, and promptly address any potential security or operational
    concerns.
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 结合 AWS CloudTrail 和 Amazon Bedrock 可为您提供强大的审计和监控解决方案。通过捕获和分析 API 调用，您可以在 Amazon
    Bedrock 环境中保持可见性，确保遵守最佳实践，并迅速解决任何潜在的安全或运营问题。
- en: EventBridge
  id: totrans-280
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: EventBridge
- en: Amazon EventBridge provides a solution for tracking and responding to events
    in near-real time. It acts as a centralized event bus, ingesting and processing
    state change data from various sources including Amazon Bedrock. Whenever there’s
    a shift in the status of a model customization job you’ve initiated, Bedrock publishes
    a new event to EventBridge. This event contains detailed information about the
    job, such as its current state, output model ARN, and any failure messages.
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: Amazon EventBridge 提供了一种在近乎实时的情况下跟踪和响应事件的解决方案。它充当一个中央事件总线，从包括 Amazon Bedrock
    在内的各种来源摄取和处理状态变化数据。每当您启动的模型定制作业的状态发生变化时，Bedrock 会向 EventBridge 发布一个新事件。此事件包含有关作业的详细信息，例如其当前状态、输出模型
    ARN 以及任何失败消息。
- en: 'Here’s how you can harness the power of Amazon EventBridge to monitor Amazon
    Bedrock events effectively:'
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: 这是您如何利用 Amazon EventBridge 的力量有效地监控 Amazon Bedrock 事件的方法：
- en: '**Event streaming and delivery**: Amazon Bedrock emits events on a best-effort
    basis whenever there’s a state change in a model customization job you’ve initiated.
    These events are streamed to Amazon EventBridge, which acts as a centralized event
    bus, ingesting and processing event data from various AWS services and external
    sources.'
  id: totrans-283
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**事件流和交付**：每当您启动的模型定制作业中发生状态变化时，Amazon Bedrock 会尽力发出事件。这些事件被流式传输到 Amazon EventBridge，它充当一个中央事件总线，从各种
    AWS 服务和外部来源摄取和处理事件数据。'
- en: '**Event pattern matching**: Within Amazon EventBridge, you can create rules
    that define event patterns based on specific criteria such as the source service,
    event type, or job status. By crafting rules tailored to your needs, you can filter
    and capture only the events that are relevant to your Amazon Bedrock workflows.'
  id: totrans-284
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**事件模式匹配**：在 Amazon EventBridge 中，您可以根据特定的标准（如源服务、事件类型或作业状态）创建定义事件模式的规则。通过制定满足您需求的规则，您可以过滤和捕获仅与您的
    Amazon Bedrock 工作流相关的事件。'
- en: '**Automated responses and integrations**: Once an event matches a rule you’ve
    defined, Amazon EventBridge routes it to one or more targets you’ve specified.
    These targets can be various AWS services such as AWS Lambda functions, Amazon
    **Simple Queue Service** (**SQS**) queues, or Amazon **Simple Notification Service**
    (**SNS**) topics. With this flexibility, you can trigger automated actions, invoke
    downstream workflows, or receive notifications based on event data.'
  id: totrans-285
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**自动响应和集成**：一旦事件与您定义的规则匹配，Amazon EventBridge 就会将它路由到您指定的一个或多个目标。这些目标可以是各种 AWS
    服务，例如 AWS Lambda 函数、Amazon **简单队列服务**（**SQS**）队列或 Amazon **简单通知服务**（**SNS**）主题。凭借这种灵活性，您可以根据事件数据触发自动化操作、调用下游工作流或接收通知。'
- en: '**Monitoring and alerting**: One common use case for Amazon EventBridge is
    setting up alerting mechanisms for critical events. For instance, you can configure
    a rule to send an email notification to a designated address whenever a model
    customization job fails, enabling you to promptly investigate and address the
    issue.'
  id: totrans-286
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**监控和警报**：Amazon EventBridge 的一个常见用例是为关键事件设置警报机制。例如，您可以配置一个规则，在模型定制作业失败时向指定的地址发送电子邮件通知，使您能够及时调查并解决问题。'
- en: '**Event data enrichment**: The event data emitted by Amazon Bedrock contains
    valuable information about the model customization job, such as the job ARN, output
    model ARN, job status, and failure messages (if applicable). By leveraging this
    data, you can build robust monitoring and alerting systems tailored to your specific
    requirements.'
  id: totrans-287
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**事件数据丰富**：Amazon Bedrock 发出的事件数据包含有关模型定制作业的宝贵信息，例如作业 ARN、输出模型 ARN、作业状态以及（如果适用）失败消息。通过利用这些数据，您可以构建针对特定需求的强大监控和警报系统。'
- en: 'To receive and process Amazon Bedrock events through Amazon EventBridge, you
    will need to create *rules* and *targets*. Rules define the event patterns to
    match, while targets specify the actions to be taken when an event matches a rule.
    Let’s learn more about how to do this:'
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: 要通过 Amazon EventBridge 接收和处理 Amazon Bedrock 事件，您需要创建 *规则* 和 *目标*。规则定义要匹配的事件模式，而目标指定当事件匹配规则时要采取的操作。让我们更深入地了解如何做到这一点：
- en: 'To create a rule, follow the ensuing steps:'
  id: totrans-289
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要创建一个规则，请遵循以下步骤：
- en: Open the Amazon EventBridge console.
  id: totrans-290
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打开Amazon EventBridge控制台。
- en: Choose **Create rule**.
  id: totrans-291
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**创建规则**。
- en: Provide a name for your rule.
  id: totrans-292
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 为您的规则提供一个名称。
- en: Select **Event pattern**, as shown in *Figure 11**.21*
  id: totrans-293
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择**事件模式**，如图*图11**.21*所示。
- en: Define the event pattern to match Amazon Bedrock events (for instance, set **source**
    to **aws.bedrock** and **detail-type** to **Model Customization Job** **State
    Change**).
  id: totrans-294
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义事件模式以匹配Amazon Bedrock事件（例如，将**source**设置为**aws.bedrock**，将**detail-type**设置为**模型定制作业**
    **状态变更**）。
- en: '![Figure 11.21 – The Event pattern window](img/B22045_11_21.jpg)'
  id: totrans-295
  prefs: []
  type: TYPE_IMG
  zh: '![图11.21 – 事件模式窗口](img/B22045_11_21.jpg)'
- en: Figure 11.21 – The Event pattern window
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 图11.21 – 事件模式窗口
- en: 'Follow the ensuing steps for configuring targets:'
  id: totrans-297
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 按照以下步骤配置目标：
- en: Choose the target type (for example, AWS Lambda, Amazon SNS, Amazon SQS).
  id: totrans-298
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 选择目标类型（例如，AWS Lambda、Amazon SNS、Amazon SQS）。
- en: Specify the target resource (for example, a Lambda function ARN or an SNS topic
    ARN).
  id: totrans-299
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 指定目标资源（例如，Lambda函数ARN或SNS主题ARN）。
- en: Optionally, add additional configurations or transformations for the target.
  id: totrans-300
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 可选地，为目标添加额外的配置或转换。
- en: 'One practical use case is to receive email notifications whenever there is
    a change in the status of your model customization jobs. Here’s how you can set
    it up:'
  id: totrans-301
  prefs: []
  type: TYPE_NORMAL
  zh: 一个实际用例是在您的模型定制作业状态发生变化时接收电子邮件通知。以下是您如何设置它的方法：
- en: Create an Amazon SNS topic.
  id: totrans-302
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个Amazon SNS主题。
- en: Subscribe your email address to the SNS topic.
  id: totrans-303
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将您的电子邮件地址订阅到SNS主题。
- en: 'Create an Amazon EventBridge rule with the following event pattern:'
  id: totrans-304
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个具有以下事件模式的Amazon EventBridge规则：
- en: '[PRE52]'
  id: totrans-305
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE52]'
- en: '[PRE53]'
  id: totrans-306
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE53]'
- en: '{'
  id: totrans-307
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '{'
- en: '[PRE54]'
  id: totrans-308
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE54]'
- en: '"source": ["aws.bedrock"],'
  id: totrans-309
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '"source": ["aws.bedrock"],'
- en: '[PRE55]'
  id: totrans-310
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE55]'
- en: '"detail-type": ["Model Customization Job State Change"]'
  id: totrans-311
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '"detail-type": ["模型定制作业状态变更"]'
- en: '[PRE56]'
  id: totrans-312
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE56]'
- en: '}'
  id: totrans-313
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: '}'
- en: '[PRE57]'
  id: totrans-314
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE57]'
- en: '[PRE58]'
  id: totrans-315
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE58]'
- en: Set the SNS topic as the target for the rule.
  id: totrans-316
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将SNS主题设置为规则的目标。
- en: With this set up, you’ll receive email notifications whenever there is a state
    change in your Amazon Bedrock model customization jobs, keeping you informed about
    job progress and potential failures.
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: 使用此设置，每当您的Amazon Bedrock模型定制作业状态发生变化时，您都会收到电子邮件通知，让您了解作业进度和潜在故障。
- en: 'Additionally, the Amazon EventBridge integration with Amazon Bedrock opens
    up various advanced use cases, such as the following:'
  id: totrans-318
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，Amazon EventBridge与Amazon Bedrock的集成还打开了各种高级用例，例如以下内容：
- en: Triggering Lambda functions to perform custom actions based on job events (for
    example, sending notifications to a Slack channel, updating a dashboard, or triggering
    downstream workflows)
  id: totrans-319
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 根据作业事件触发Lambda函数执行自定义操作（例如，向Slack频道发送通知、更新仪表板或触发下游工作流程）
- en: Integrating with Amazon Step Functions to orchestrate complex workflows based
    on job events
  id: totrans-320
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将Amazon Step Functions与Amazon Bedrock集成，根据作业事件编排复杂的工作流程
- en: Sending job events to Amazon Kinesis data streams for real-time processing and
    analysis
  id: totrans-321
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将作业事件发送到Amazon Kinesis数据流进行实时处理和分析
- en: Archiving job events in Amazon S3 or Amazon CloudWatch logs for auditing and
    compliance purposes
  id: totrans-322
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 将作业事件存档到Amazon S3或Amazon CloudWatch日志中，用于审计和合规性目的
- en: By leveraging Amazon EventBridge to monitor and respond to Amazon Bedrock events,
    you can enhance the security, automation, and visibility of your machine learning
    operations. With the ability to define custom rules and integrate with various
    AWS services, you can create a robust and secure environment tailored to your
    specific needs.
  id: totrans-323
  prefs: []
  type: TYPE_NORMAL
  zh: 通过利用Amazon EventBridge来监控和响应Amazon Bedrock事件，您可以增强机器学习操作的安全性、自动化和可见性。凭借定义自定义规则和集成各种AWS服务的能力，您可以创建一个符合您特定需求的强大且安全的环境。
- en: Summary
  id: totrans-324
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we learned about various methods for evaluating and monitoring
    the Amazon Bedrock models.
  id: totrans-325
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们学习了各种评估和监控Amazon Bedrock模型的方法。
- en: 'We began by exploring the two primary model evaluation methods offered by Amazon
    Bedrock: automatic model evaluation and human evaluation. The automatic model
    evaluation process involves running an evaluation algorithm script on either a
    built-in or custom dataset, assessing metrics such as accuracy, toxicity, and
    robustness. Human evaluation, on the other hand, incorporates human input into
    the evaluation process, ensuring that the models not only deliver accurate results
    but also that those results align with real-world expectations and requirements.'
  id: totrans-326
  prefs: []
  type: TYPE_NORMAL
  zh: 我们首先探讨了Amazon Bedrock提供的两种主要模型评估方法：自动模型评估和人工评估。自动模型评估过程涉及在内置或自定义数据集上运行评估算法脚本，评估准确度、毒性、鲁棒性等指标。另一方面，人工评估将人类输入纳入评估过程，确保模型不仅提供准确的结果，而且这些结果与实际世界的期望和要求相一致。
- en: Furthermore, we discussed open source tools such as `fmeval` and Ragas, which
    provide additional evaluation capabilities that are specifically tailored for
    LLMs and RAG pipelines.
  id: totrans-327
  prefs: []
  type: TYPE_NORMAL
  zh: 此外，我们还讨论了诸如`fmeval`和Ragas等开源工具，这些工具提供了针对LLMs和RAG管道的特定评估能力。
- en: Moving on to the section on monitoring, we discussed how Amazon CloudWatch can
    be leveraged to gain valuable insights into model performance, latency, and token
    counts. We explored the various metrics provided by Amazon Bedrock and considered
    how they can be visualized and monitored through CloudWatch dashboards. Additionally,
    we covered model invocation logging, a powerful feature that allows you to capture
    and analyze requests, responses, and metadata for all model invocations. Next,
    we looked at the integration of Amazon Bedrock with AWS CloudTrail and EventBridge.
    CloudTrail provides a comprehensive audit trail of API calls made within your
    AWS environment, enabling you to monitor and ensure adherence to best practices.
    EventBridge, on the other hand, allows you to track and respond to events in near-real
    time, enabling automated responses and integrations based on the state changes
    of your model customization jobs.
  id: totrans-328
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们讨论了监控部分，我们讨论了如何利用Amazon CloudWatch来获取有关模型性能、延迟和令牌计数的宝贵见解。我们探讨了Amazon Bedrock提供的各种指标，并考虑了如何通过CloudWatch仪表板进行可视化和监控。此外，我们还介绍了模型调用日志，这是一个强大的功能，允许您捕获和分析所有模型调用的请求、响应和元数据。接下来，我们探讨了Amazon
    Bedrock与AWS CloudTrail和EventBridge的集成。CloudTrail提供了您AWS环境中API调用的全面审计跟踪，使您能够监控并确保遵守最佳实践。另一方面，EventBridge允许您在近乎实时的情况下跟踪和响应事件，使基于模型定制作业状态变化的自动化响应和集成成为可能。
- en: Ensuring security and privacy is the top priority at Amazon and also in today’s
    digital landscape. In the next chapter, we are going to look at how security and
    privacy can be ensured in Amazon Bedrock.
  id: totrans-329
  prefs: []
  type: TYPE_NORMAL
  zh: 在亚马逊，确保安全和隐私是首要任务，在今天的数字景观中也是如此。在下一章中，我们将探讨如何在Amazon Bedrock中确保安全和隐私。
