<html><head></head><body>
		<div id="_idContainer069">
			<h1 id="_idParaDest-72"><em class="italic"><a id="_idTextAnchor079"/>Chapter <a id="_idTextAnchor080"/>5</em>: <a id="_idTextAnchor081"/>Building Your First API Endpoints</h1>
			<p>Communication is at the core of all relationships. Good or bad relationships are often defined by how well two individuals can convey their thoughts, feelings, and ideas. Communication needs to be clear, accurate, and trusted.</p>
			<p>Sharing information appropriately is also critical for computer applications. Having a standard way of sending and receiving data between two different applications is critical for many programs.</p>
			<p>One of these standards is referred to as an <strong class="bold">API</strong>, which stands for <strong class="bold">application programming interface</strong>. We are working specifically with the REST API architecture style. It was designed to quickly provide information and perform actions based on standard HTTP methods.</p>
			<p>Because of this well-known and understood standard, in this chapter, we will show you how to plan and build an API using n8n. We will help you plan your API by understanding the core concepts of APIs and thinking about what you want the final product to perform. You will also understand how to use n8n to build, secure, and test the API that you designed.</p>
			<p>In this chapter, we are going to cover the following topics:</p>
			<ul>
				<li>Planning your project's API</li>
				<li>Configuring the Webhook node to handle requests</li>
				<li>Building the API in n8n</li>
				<li>Securing your API endpoints</li>
				<li>Testing your API</li>
			</ul>
			<p>By the end of the chapter, you will be able to do the following:</p>
			<ul>
				<li>Create blueprints for an API endpoint so that there's minimal friction when building the API.</li>
				<li>Configure the Webhook node so that it can handle requests that are sent to our API and reply to them.</li>
				<li>Build an API endpoint in n8n based on the blueprints that we created.</li>
				<li>Secure your API endpoints by using the different authentication methods available in the Webhook node.</li>
				<li>Test your API to make sure that all the functionalities that we have implemented work as expected.</li>
			</ul>
			<h1 id="_idParaDest-73"><a id="_idTextAnchor082"/>Technical requirements</h1>
			<p>The following are the technical requirements for this chapter:</p>
			<ul>
				<li>A working version of n8n.</li>
				<li>A web browser.</li>
				<li>Access to this book's GitHub repository: <a href="https://github.com/PacktPublishing/Rapid-Product-Development-with-n8n">https://github.com/PacktPublishing/Rapid-Product-Development-with-n8n</a>. Another useful tool is the Insomnia API tool, which can be found at <a href="https://insomnia.rest/">https://insomnia.rest/</a>.</li>
			</ul>
			<h1 id="_idParaDest-74"><a id="_idTextAnchor083"/>Planning your project's API</h1>
			<p>Before you start <a id="_idIndexMarker223"/>building out your API, you must have a solid roadmap. This plan allows you to create the API quicker and ensure the design is consistent and accurate.</p>
			<p>There are several different dimensions to consider when you are planning out your API. For an example of good API design, see the OpenAPI Specification at <a href="https://swagger.io/specification/">https://swagger.io/specification/</a>.</p>
			<h2 id="_idParaDest-75"><a id="_idTextAnchor084"/>Easy to understand</h2>
			<p>How an API works should be almost obvious to a developer using it. The API should have terms that are consistent with similar APIs and adequately describe the information it is using and the<a id="_idIndexMarker224"/> action it is performing.</p>
			<h2 id="_idParaDest-76"><a id="_idTextAnchor085"/>Output data in JSON</h2>
			<p>While <a id="_idIndexMarker225"/>several <a id="_idIndexMarker226"/>different data formats are available to use, such as XML, YAML, and SOAP, REST APIs most often output their data in JSON format. To maintain consistency, it is recommended that all of your APIs, at the very least, be able to output their data in JSON.</p>
			<h2 id="_idParaDest-77"><a id="_idTextAnchor086"/>Using the GET, HEAD, and POST HTTP methods</h2>
			<p>n8n <a id="_idIndexMarker227"/>supports<a id="_idIndexMarker228"/> three <a id="_idIndexMarker229"/>different<a id="_idIndexMarker230"/> HTTP<a id="_idIndexMarker231"/> methods (you<a id="_idIndexMarker232"/> can think of HTTP methods like action verbs that tell the system what to do with the request it has received):</p>
			<ol>
				<li><strong class="source-inline">GET</strong></li>
				<li><strong class="source-inline">HEAD</strong></li>
				<li><strong class="source-inline">POST</strong></li>
				<li><strong class="source-inline">DELETE</strong></li>
				<li><strong class="source-inline">PATCH</strong></li>
				<li><strong class="source-inline">PUT</strong></li>
			</ol>
			<p>While several other HTTP methods are available, such as <strong class="source-inline">UPDATE</strong>, at the time of writing this book, n8n does not support them.</p>
			<p>The two most commonly used HTTP methods are <strong class="source-inline">GET</strong> and <strong class="source-inline">POST</strong>, each of which provides a specific action.</p>
			<p>The <strong class="source-inline">GET</strong> method is generally used when we're attempting to retrieve (or get) information from the API. It should not be used to pass sensitive information to the API. It is common for the query parameters to be passed along in a URL format that is human readable and often stored in web browser history.</p>
			<p>However, the flip side of this method is that it is straightforward to create a website URL that specifies all the information being requested by the user in a simple link. </p>
			<p class="callout-heading">Note</p>
			<p class="callout">This assumes that no security has been applied to the API that needs to be passed in the headers.</p>
			<p>The <strong class="source-inline">POST</strong> HTTP method is usually used to create or add a new record to the system providing the API. In n8n, it is also often used to change a record since there is no <strong class="source-inline">UPDATE</strong> HTTP method support.</p>
			<p>One of the advantages of using the <strong class="source-inline">POST</strong> HTTP method is that it does not show up in the URL when it is submitted to the server.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">For<a id="_idIndexMarker233"/> more <a id="_idIndexMarker234"/>information about<a id="_idIndexMarker235"/> response <a id="_idIndexMarker236"/>codes, check<a id="_idIndexMarker237"/> out <a id="_idIndexMarker238"/>the <em class="italic">HTTP methods</em> subsection of the <em class="italic">HTTP Request node – talk to any API</em> section of <a href="B17493_03_Final_PD_ePub.xhtml#_idTextAnchor039"><em class="italic">Chapter 3</em></a><em class="italic">, Diving into Core Nodes and Data in n8n</em>.</p>
			<h2 id="_idParaDest-78"><a id="_idTextAnchor087"/>Knowing what your API will do</h2>
			<p>It is critical to<a id="_idIndexMarker239"/> know precisely what your API is meant to do, not only in terms of the capabilities of the API but also inside the system. A simple API call can efficiently perform many different actions behind the scenes.</p>
			<p>Plan out what each API call does in detail once the system receives the API request. This should be very detailed and documented exceptionally well.</p>
			<h2 id="_idParaDest-79"><a id="_idTextAnchor088"/>Having meaningful and consistent response codes</h2>
			<p>Several <a id="_idIndexMarker240"/>different response codes can be used in response to an API call. Still, it is generally recommended that you limit yourself to the <strong class="source-inline">2xx</strong> and <strong class="source-inline">4xx</strong> codes since most other codes are handled by other systems, such as the web server (although we have an exception for this).</p>
			<p>In general, it is recommended that you use the following code for each stated purpose:</p>
			<ul>
				<li><strong class="source-inline">200 (OK)</strong>: All the data has been received, processed, and returned correctly. No further actions are required.</li>
				<li><strong class="source-inline">201 (Created)</strong>: Often used with <strong class="source-inline">POST</strong> requests, this indicates that the request has resulted in creating a new resource and that the information for the resource has been returned in the results.</li>
				<li><strong class="source-inline">202 (Accepted)</strong>: When information is processed asynchronously, the system may have been received but is not yet active in the system, so the API could return a <strong class="source-inline">202</strong> code. This lets the requester know that the information made it to its destination, but that it cannot be accessed yet.</li>
				<li><strong class="source-inline">203 (Non-Authoritative Information)</strong>: If you are caching local data to reduce the number of calls to a remote data source, your API can respond with <a id="_idIndexMarker241"/>a <strong class="source-inline">203</strong> response code to let the user know that the information they received was accurate the last time it pulled a copy of the information, though this could have changed in the interim.</li>
				<li><strong class="source-inline">204 (No Content)</strong>: Sometimes, a request for information is made to an API, but there is nothing to return to the user. For example, if an API references a list of animals (for example, cat, dog, and horse) and the user has requested a list of all reptiles, there would be no animals in the results. This is when the API would respond with a <strong class="source-inline">204</strong> response code so that the user knows that the API meant to send back no information and that there wasn't some error returning no results from the API.</li>
				<li><strong class="source-inline">206 (Partial Content)</strong>: It is not uncommon for an API <strong class="source-inline">GET</strong> request to generate several thousands of records. Returning all of these records can be very taxing on both the server hosting the API and the client receiving the data. There can also be a considerable amount of bandwidth used when transmitting large amounts of data.</li>
				<li>The API only sends out a portion of the records (often referred to as pagination) to the requestor to alleviate this issue. It includes a <strong class="source-inline">206</strong> response code to let us know that there is more information to be received.</li>
				<li><strong class="source-inline">400 (Bad Request)</strong>: It is straightforward to miswrite an API request, and it is important to let the requester know that they made a mistake. For example, if a requester was searching for a user by email address but asked the system to look for the information in the first name field, then a <strong class="source-inline">400</strong> response would be warranted.</li>
				<li><strong class="source-inline">401 (Unauthorized)</strong>: You should secure your API with some sort of authentication scheme. When someone provides the wrong authentication information, a <strong class="source-inline">401</strong> response code should be generated and returned to the user.</li>
				<li><strong class="source-inline">403 (Forbidden)</strong>: Sometimes, people attempt to access information that they shouldn't, regardless of whether or not they are properly authenticated to the system. In this instance, a <strong class="source-inline">403</strong> response code would be returned to the user. I often <a id="_idIndexMarker242"/>use this response code when I have my API set up to only be accessed from a specific IP address and the IP addresses do not match.</li>
				<li><strong class="source-inline">404</strong> (<strong class="source-inline">Not Found</strong>): It is not uncommon for users to accidentally enter the wrong information for a URL or for a resource to move. When that happens, the user making the request will automatically get a 404 error.<p class="callout-heading">Note</p><p class="callout">For more information about response codes, see the <em class="italic">Response codes</em> section of <a href="B17493_03_Final_PD_ePub.xhtml#_idTextAnchor039"><em class="italic">Chapter 3</em></a>, <em class="italic">Diving into Core Nodes and Data in n8n</em>.</p></li>
			</ul>
			<h2 id="_idParaDest-80"><a id="_idTextAnchor089"/>Consistent noun/verb design</h2>
			<p>One very <a id="_idIndexMarker243"/>common way of laying out an API is by using a <strong class="bold">noun/verb</strong> architecture. The idea behind this design is that the requestor starts with an object or item that is directly followed by an action to be performed in that object.</p>
			<p>For example, if we were to create an API that would change the name of a device in its database, the request path may look something like this:</p>
			<p class="source-code"><strong class="bold">/device/rename</strong></p>
			<p>Similarly, if we were to remove that device from the database, the API call path might look something like this:</p>
			<p class="source-code"><strong class="bold">/device/remove</strong></p>
			<h2 id="_idParaDest-81"><a id="_idTextAnchor090"/>Submitting data</h2>
			<p>There are<a id="_idIndexMarker244"/> several different ways to submit data to an API. It is entirely up to you how you want your users to send information to your API:</p>
			<ul>
				<li><strong class="bold">Body</strong>: The body of the API request is a common place to place information. This is most often used in POST HTTP requests.</li>
				<li><strong class="bold">API Path</strong>: The API path is a different way of sending information. It is often used when you're referencing a specific record item and then performing an action on that item. For example, if you needed to delete record ID 237 from the system, you may have the user send a request to <strong class="source-inline">/record/237/delete</strong> to accomplish this task.</li>
				<li><strong class="bold">Query</strong>: A query is often used with the <strong class="source-inline">GET</strong> HTTP method as it is used to ask for specific information. A query is often represented by a URL and is even displayed that way. For example, if you were to request record 237 from the system using a query, the URL path may look something like <a href="https://api.example.com/record/display?recordID=237"><strong class="source-inline">https://api.example.com/record/display?recordID=237</strong></a>. The <strong class="source-inline">?</strong> character separates the API path and the query. <strong class="source-inline">recordID</strong> is the data key to be searched for, while <strong class="source-inline">237</strong> is the value of the key the system is looking for. You can also have multiple key/value pairs in a query by concatenating the queries together with a <strong class="source-inline">&amp;</strong> character; for example, <strong class="source-inline">recordID=237&amp;fname=Tim</strong>.</li>
				<li><strong class="bold">Header</strong>: You can also send information as a part of the headers in the request. This is often done when you're sending authentication information such as an API token to the API.</li>
			</ul>
			<h2 id="_idParaDest-82"><a id="_idTextAnchor091"/>Versioning your API</h2>
			<p>It is not uncommon <a id="_idIndexMarker245"/>that, as your system changes and matures, you may want to make changes to your API. The problem with modifying how your API works is that the changes can suddenly make a large number of user programs and scripts fail. This quickly leads to several upset and disgruntled customers.</p>
			<p>One easy way around this is to create multiple versions of your API. This way, people can continue to use their scripts with previous versions of the API while new users can automatically move to the new version.</p>
			<p>However, there is an issue with creating multiple versions of your API. As the number of versions grows, so does the effort required to maintain the system and all of its versions. </p>
			<p>To avoid this ever-growing effort, it is recommended that you maintain no more than two versions of an API at any given time. When a new version of the API is released, clearly communicate to the users that the previous version has been replaced and that the old version will be decommissioned in a reasonable amount of time ("<strong class="bold">reasonable</strong>" depends on the<a id="_idIndexMarker246"/> audience, where it could be a couple of weeks, or several years).</p>
			<h2 id="_idParaDest-83"><a id="_idTextAnchor092"/>Documenting your API</h2>
			<p>One of the <a id="_idIndexMarker247"/>most important parts of the design process is documenting the API so that others can use it properly. This can also help you figure out what you did when you come to troubleshoot it 2 years later.</p>
			<h3>The OpenAPI Specification</h3>
			<p>One of the<a id="_idIndexMarker248"/> more <a id="_idIndexMarker249"/>common forms of<a id="_idIndexMarker250"/> documentation is the OpenAPI Specification (<a href="https://github.com/OAI/OpenAPI-Specification">https://github.com/OAI/OpenAPI-Specification</a>). This specification only takes a couple of hours to learn and can be used in conjunction with other tools to automatically create an API testing platform and all user documentation.</p>
			<p>The specification uses either a JSON or YAML file to outline how your API behaves and how to create the documentation for the specification.</p>
			<p>The following is a simple JSON OpenAPI Specification file's contents:</p>
			<p class="source-code">{"openapi": "3.0.0",</p>
			<p class="source-code">  "servers": [</p>
			<p class="source-code">    {"description": "User Example",</p>
			<p class="source-code">      "url": "https://virtserver.swaggerhub.com/</p>
			<p class="source-code">        tephlon/user-example/1.0.0"}</p>
			<p class="source-code">  ],</p>
			<p class="source-code">  "info": {"version": "1.0.0",</p>
			<p class="source-code">    "title": "User Example",</p>
			<p class="source-code">    "description": "Add a user with the API"},</p>
			<p class="source-code">  "paths": {</p>
			<p class="source-code">    "/api/v1/user/add": {</p>
			<p class="source-code">      "post": {</p>
			<p class="source-code">        "tags": ["Users"],</p>
			<p class="source-code">        "operationId": "addUser",</p>
			<p class="source-code">        "parameters": [</p>
			<p class="source-code">          {"name": "email",</p>
			<p class="source-code">            "in": "query",</p>
			<p class="source-code">            "description": "User's Email Address",</p>
			<p class="source-code">            "schema": {"type": "string"}</p>
			<p class="source-code">          },</p>
			<p class="source-code">          {"name": "password",</p>
			<p class="source-code">            "in": "query",</p>
			<p class="source-code">            "description": "User's Password",</p>
			<p class="source-code">            "schema": {"type": "string"}</p>
			<p class="source-code">          }</p>
			<p class="source-code">        ],</p>
			<p class="source-code">        "responses": {</p>
			<p class="source-code">          "200": {</p>
			<p class="source-code">            "description": "User Added Successfully",</p>
			<p class="source-code">            "content": {</p>
			<p class="source-code">              "application/json": {</p>
			<p class="source-code">                "schema": {</p>
			<p class="source-code">                  "properties": {</p>
			<p class="source-code">                    "userID": {"type" : "integer"}</p>
			<p class="source-code">                  }</p>
			<p class="source-code">                }</p>
			<p class="source-code">              }</p>
			<p class="source-code">            }</p>
			<p class="source-code">          }</p>
			<p class="source-code">        }</p>
			<p class="source-code">      }</p>
			<p class="source-code">    }</p>
			<p class="source-code">  }</p>
			<p class="source-code">}</p>
			<p>This is only a <a id="_idIndexMarker251"/>small piece<a id="_idIndexMarker252"/> of the API that we are going to be building in the next few sections of this chapter.</p>
			<p>The following screenshot shows the documentation that is generated from this specification file:</p>
			<div>
				<div id="_idContainer063" class="IMG---Figure">
					<img src="image/Figure_5.01_B17493.jpg" alt="Figure 5.1 – Generated documentation from the OpenAPI Specification file&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.1 – Generated documentation from the OpenAPI Specification file</p>
			<p>We have <a id="_idIndexMarker253"/>created <a id="_idIndexMarker254"/>a full API definition for this, which you can find here:</p>
			<p><a href="https://github.com/PacktPublishing/Rapid-Product-Development-with-n8n/tree/main/Chapter%205">https://github.com/PacktPublishing/Rapid-Product-Development-with-n8n/tree/main/Chapter%205</a></p>
			<p>Now that we know how to design APIs, it is time to dive into n8n and start the basic setup for creating our API.</p>
			<h1 id="_idParaDest-84"><a id="_idTextAnchor093"/>Configuring the Webhook node to handle requests</h1>
			<p>The core <a id="_idIndexMarker255"/>node<a id="_idIndexMarker256"/> for building an API in n8n is the Webhook node. While this may seem a bit strange on the surface, it makes a lot of sense when you start to think of it in the correct frame of mind.</p>
			<p>Webhooks are web services that are sitting on a system, waiting to be called upon to perform some action. Meanwhile, an API is a service that a client uses to perform actions on a remote server:</p>
			<div>
				<div id="_idContainer064" class="IMG---Figure">
					<img src="image/Figure_5.02_B17493.jpg" alt="Figure 5.2 – The Webhook node&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.2 – The Webhook node</p>
			<p>So, what is seen as an API from the client's perspective is the same as a Webhook from the server's perspective! And this is why we use a Webhook to create an API.</p>
			<p>The Webhook node is a trigger node that executes a workflow when it receives a remote connection. It collects the information that it receives and performs actions based on that information.</p>
			<h2 id="_idParaDest-85"><a id="_idTextAnchor094"/>Parameters</h2>
			<p>The Webhook<a id="_idIndexMarker257"/> node is configured by setting the parameters in the node itself. Each of these parameters modifies the behavior of the Webhook and some parameters, such as the <strong class="bold">Authentication</strong> and <strong class="bold">HTTP Method</strong> parameters, enable<a id="_idIndexMarker258"/> even more options for the user.</p>
			<h3>Webhook URLs</h3>
			<p>If you click <a id="_idIndexMarker259"/>on the text in the Webhook <a id="_idIndexMarker260"/>node that reads <strong class="bold">Webhook URLs</strong>, it will open up a small panel below it. You will see two buttons, one reading <strong class="bold">Production</strong> and the other reading <strong class="bold">Test</strong>. These are the two different types of Webhook URLs that are available to use.</p>
			<p>These URLs in n8n cloud are built by combining the n8n protocol (<strong class="source-inline">https://</strong>), the hostname (<strong class="source-inline">tephlon.app.n8n.cloud/</strong>), the Webhook root (<strong class="source-inline">webhook</strong> for production and <strong class="source-inline">webhook-test</strong> for test), and the Webhook path (<strong class="source-inline">f929fdc9-b62a-4661-913e-b5648c407edd</strong>). This creates the two Webhook paths of <strong class="source-inline">https://tephlon.app.n8n.cloud/webhook/f929fdc9-b62a-4661-913e-b5648c407edd</strong> for <strong class="bold">Production</strong> and <a href="https://tephlon.app.n8n.cloud/webhook-test/f929fdc9-b62a-4661-913e-b5648c407edd">https://tephlon.app.n8n.cloud/webhook-test/f929fdc9-b62a-4661-913e-b5648c407edd</a> for <strong class="bold">Test</strong>:</p>
			<div>
				<div id="_idContainer065" class="IMG---Figure">
					<img src="image/Figure_5.03_B17493.jpg" alt="Figure 5.3 – Initial Webhook properties&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.3 – Initial Webhook properties</p>
			<p>You can modify <a id="_idIndexMarker261"/>the<a id="_idIndexMarker262"/> Webhook's endpoint locations by changing the <strong class="bold">Path</strong> parameter. If we were to change the path from <strong class="source-inline">f929fdc9-b62a-4661-913e-b5648c407edd</strong> to <strong class="source-inline">api/v1/user/add</strong>, then the Webhook paths would change to <a href="https://tephlon.app.n8n.cloud/webhook/api/v1/user"><strong class="source-inline">https://tephlon.app.n8n.cloud/webhook/api/v1/user</strong></a> for <strong class="bold">Production</strong> and <a href="https://tephlon.app.n8n.cloud/webhook-test/api/v1/user/add"><strong class="source-inline">https://tephlon.app.n8n.cloud/webhook-test/api/v1/user/add</strong></a> for <strong class="bold">Test</strong>:</p>
			<div>
				<div id="_idContainer066" class="IMG---Figure">
					<img src="image/Figure_5.04_B17493.jpg" alt="Figure 5.4 – Changing the Webhook paths&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.4 – Changing the Webhook paths</p>
			<p>The <a id="_idIndexMarker263"/>two <a id="_idIndexMarker264"/>different types of Webhook URLs – <strong class="bold">Production</strong> and <strong class="bold">Test</strong> – serve two different purposes. The <strong class="bold">Production</strong> URL is used when your workflow has been saved and set to <strong class="bold">Active</strong>. The Webhook will then respond even when the Editor UI is not open. It is designed to be available and work completely on its own.</p>
			<p>The <strong class="bold">Test</strong> URL is designed to be used when you are building and troubleshooting your API. It still requires that your workflow be saved to register the Webhook URL but it will only be active when one of the following conditions has been met:</p>
			<ul>
				<li>You press the <strong class="bold">Execute Workflow</strong> button in the Editor UI.</li>
				<li>You press the <strong class="bold">Execute Node</strong> button in an open node that is either the Webhook node or a child node to the Webhook node with no cached information available to be processed.</li>
			</ul>
			<p>The <strong class="bold">Test</strong> URL is available until one of the following actions occurs:</p>
			<ul>
				<li>A connection attempt is made.</li>
				<li>The <strong class="bold">Stop</strong> button is pressed in the Editor UI.</li>
				<li>120 seconds have passed since the Webhook was initiated.</li>
			</ul>
			<p>Once this happens, the Webhook URL will unregister and the workflow will stop.</p>
			<p>The purpose of the <strong class="bold">Test</strong> URL is to provide an easy way to see what is happening in each node when <a id="_idIndexMarker265"/>a request is made and troubleshoot the <a id="_idIndexMarker266"/>workflow for development.</p>
			<h3>Authentication</h3>
			<p>Since APIs are <a id="_idIndexMarker267"/>a very common way<a id="_idIndexMarker268"/> for people to programmatically access pure data from a system, there is a good chance that you may want to secure that data. Even if your API is going to be publicly available to everyone, it can be a good idea to set up registration and authentication for your API so that you can track who is using (or abusing) your API.</p>
			<p>While there are many different aspects of securing your API (many of which will be covered a bit later in this chapter), we want to take a quick look at authentication for your API. This can be accomplished using the <strong class="bold">Authentication</strong> parameter.</p>
			<p>The Authentication <a id="_idIndexMarker269"/>parameter has three different options:</p>
			<ul>
				<li>None</li>
				<li>Basic Auth</li>
				<li>Header Auth</li>
			</ul>
			<p>Selecting <strong class="bold">None</strong> for the <strong class="bold">Authentication</strong> parameter is self-explanatory: the Webhook will not look for any form of authentication before executing the workflow or returning information. While there are valid use cases for not using any authentication for your API (for example, you want to use the Webhook like a web server and display web content), it is generally frowned upon as a practice.</p>
			<p><strong class="bold">Basic Auth</strong> is the simplest form of authentication that n8n can use. It essentially sends a Base64 calculated version of a username and a password to n8n and compares it to the password information that it has on record.</p>
			<p>For example, if we were to use Basic Auth for our API and the username and password required are <strong class="source-inline">jim.nasium</strong> and <strong class="source-inline">123456</strong>, the API client would calculate the Base64 version of <strong class="source-inline">jim.nasium:123456</strong> (which is <strong class="source-inline">amltLm5hc2l1bToxMjM0NTY=</strong>) and send it in the header request.</p>
			<p class="callout-heading">Calculating the Base64 Value</p>
			<p class="callout">If you ever find yourself in need of generating the Base64 value for a <strong class="source-inline">Function</strong> node, you can use the following code to do this for you. Simply replace the values of the username and password:</p>
			<p class="callout"><strong class="source-inline">var username = "jim.nasium";</strong></p>
			<p class="callout"><strong class="source-inline">var password = "123456";</strong></p>
			<p class="callout"><strong class="source-inline">var encoded = Buffer.from(username + ":" + password).toString('base64');</strong></p>
			<p>While this is better than no authentication at all, it isn't all that great. Since Base64-encoded text is really easy to reverse engineer, it is recommended that the API is secured properly by complimentary means such as SSL/TLS certificates.</p>
			<p><strong class="bold">Header Auth</strong> is similar to <strong class="bold">Basic Auth</strong> in that it sends a value in the header of the API request. However, the difference is that it is just a random string of characters that is very difficult to memorize.</p>
			<p>In <a id="_idIndexMarker270"/>both<a id="_idIndexMarker271"/> the <strong class="bold">Basic</strong> and <strong class="bold">Header Auth</strong> scenarios, you are required to create credentials that hold the information that's required for users to access the API. Without these credentials, you users will not be able to use the API.</p>
			<h3>HTTP methods</h3>
			<p>As we <a id="_idIndexMarker272"/>mentioned <a id="_idIndexMarker273"/>earlier in this chapter, the n8n Webhook node supports three different HTTP methods:</p>
			<ul>
				<li><strong class="source-inline">GET</strong></li>
				<li><strong class="source-inline">HEAD</strong></li>
				<li><strong class="source-inline">POST</strong></li>
			</ul>
			<p>Depending on the HTTP method that you select, different options become available to you.</p>
			<h4>General options</h4>
			<p>Four <a id="_idIndexMarker274"/>options are available for all the methods:</p>
			<ul>
				<li>Response Content-Type</li>
				<li>Response Headers</li>
				<li>Property Name</li>
				<li>Raw Body</li>
			</ul>
			<p><strong class="bold">Response Content-Type</strong> indicates <a id="_idIndexMarker275"/>the media type that will be returned to the user. This is typically a two-part designation, with the first part representing the type and the second part representing the subtype, separated by a slash ("<strong class="source-inline">/</strong>") character. </p>
			<p>For example, if your API is returning JSON data, you would set <strong class="bold">Response Content-Type</strong> to <strong class="source-inline">text/json</strong>.</p>
			<p>For an official <a id="_idIndexMarker276"/>list of all the media types that are available, visit the <strong class="bold">Internet Assigned Numbers Authority</strong> (<strong class="bold">IANA</strong>) <em class="italic">Media Types</em> web page at <a href="https://www.iana.org/assignments/media-types/media-types.xhtml">https://www.iana.org/assignments/media-types/media-types.xhtml</a>.</p>
			<p>The <strong class="bold">Response Headers</strong> option allows you to add additional key/value pairs to the headers to provide extra metadata to the response. This is information about the data that the user is receiving from the API.</p>
			<p>It is often used to confirm that the data is accurate and has not been tampered with between the sender and the receiver. It could contain a hash algorithm that the receiver could calculate to determine that the information is accurate or a timestamp to indicate when the information was received.</p>
			<p>The <strong class="bold">Property Name</strong> option allows you to return just the value of a specific value/key pair.</p>
			<p>For example, let's assume that you have a Webhook set up that outputs the following JSON object:</p>
			<p class="source-code">{</p>
			<p class="source-code">  "response": "Hello!",</p>
			<p class="source-code">  "status": "Successful"</p>
			<p class="source-code">}</p>
			<p>Now, if we were to modify that Webhook and add the <strong class="bold">Property Name</strong> option with a value of <strong class="bold">status</strong>, our output would be as follows:</p>
			<p class="source-code">Successful</p>
			<p>This is useful if you have HTML in a key-value pair and you just want to output the HTML to display a web page.</p>
			<p>The final <a id="_idIndexMarker277"/>option is <strong class="bold">Raw Body</strong>. The <strong class="bold">Raw Body</strong> option is a binary (off or on) value that indicates the <a id="_idIndexMarker278"/>information coming into the Webhook is in a raw format, such as XML or JSON.</p>
			<h4>Additional POST option</h4>
			<p>When you<a id="_idIndexMarker279"/> select <strong class="bold">Post</strong> for the HTTP method, there is one extra option available. This is the <strong class="bold">Binary Data</strong> option. This option is used to indicate that the API is expecting that there will be binary data attached to the request. This is handy when you are uploading files to the system.</p>
			<h2 id="_idParaDest-86"><a id="_idTextAnchor095"/>Response Code</h2>
			<p>The <strong class="bold">Response Code</strong> parameter <a id="_idIndexMarker280"/>is used to reply to the sender with a quick response, letting the requester know the results of their request.</p>
			<p>We went through response codes in detail earlier in this chapter, so I'm not going to go over them again, but make sure that you reference the code and reply with the appropriate response.</p>
			<p class="callout-heading">Note</p>
			<p class="callout">The response code that you are selecting is going to be sent when everything goes well. Other failure response codes (for example, <strong class="source-inline">404</strong>) will be sent by the system and do not need to be programmed here.</p>
			<h2 id="_idParaDest-87"><a id="_idTextAnchor096"/>Response Mode</h2>
			<p>The <strong class="bold">Response Mode</strong> option <a id="_idIndexMarker281"/>controls how the Webhook responds to the request. Two options can be set for the Response Mode option:</p>
			<ul>
				<li>On Received</li>
				<li>Last Node</li>
			</ul>
			<p>In general, if you are not passing data back to the requester, you will want to use the <strong class="bold">On Received</strong> option. Otherwise, if you are sending information back via the API, you should use the <strong class="bold">Last Node</strong> option.</p>
			<p>The <strong class="bold">On Received</strong> option will immediately send the value of the <strong class="bold">Response Code</strong> option back to the sender. It does not wait for the workflow to complete before returning this code.</p>
			<p>Things get a little bit more interesting with the <strong class="bold">Last Node</strong> option. When you want to return information to the requester, this option will initiate a workflow and then the results (or part of the results) of the last executed node will be returned to the requester as JSON.</p>
			<h3>Response Data options</h3>
			<p>When you <a id="_idIndexMarker282"/>select the <strong class="bold">Last Node</strong> option for <strong class="bold">Response Mode</strong>, this enables a new parameter called <strong class="bold">Response Data</strong>. The three options for <strong class="bold">Response Data</strong> are as follows:</p>
			<ul>
				<li>All Entries</li>
				<li>First Entry JSON</li>
				<li>First Entry Binary</li>
			</ul>
			<p>To understand how this option works, we will look at an example. Let's assume that we have a workflow with the final node outputting the following JSON array:</p>
			<p class="source-code">[</p>
			<p class="source-code">  {</p>
			<p class="source-code">   "name": "Jim Nasium",</p>
			<p class="source-code">    "city": "Berlin"</p>
			<p class="source-code">  },</p>
			<p class="source-code">  {</p>
			<p class="source-code">    "name": "Kris P. Bayken",</p>
			<p class="source-code">    "city": "Edmonton"</p>
			<p class="source-code">  }</p>
			<p class="source-code">]</p>
			<p>Also, for each JSON object in the array, there is a binary file attached to the object; <strong class="source-inline">CV - Jim Nasium.pdf</strong> for the first one and <strong class="source-inline">Resume - Kris P. Bayken.pdf</strong> for the second one.</p>
			<p>If we set the <strong class="bold">Response Data</strong> parameter to <strong class="bold">All Entries</strong>, the requester will receive the entire array contents but none of the files.</p>
			<p>When we change <strong class="bold">Response Data</strong> to <strong class="bold">First Entry JSON</strong>, the receiver will receive the following JSON object:</p>
			<p class="source-code">{</p>
			<p class="source-code">  "name": "Jim Nasium",</p>
			<p class="source-code">  "city": "Berlin"</p>
			<p class="source-code">}</p>
			<p>Finally, if we <a id="_idIndexMarker283"/>use the <strong class="bold">First Entry Binary</strong> option, the requester will be sent the <strong class="source-inline">CV - Jim Nasium.pdf</strong> file.</p>
			<p>Now that we have gone through the Webhook node in great detail, it is time to start building out our API in n8n.</p>
			<h1 id="_idParaDest-88"><a id="_idTextAnchor097"/>Building the API in n8n</h1>
			<p>We<a id="_idIndexMarker284"/> are finally<a id="_idIndexMarker285"/> ready to start building in n8n! Let's start by outlining our project.</p>
			<h2 id="_idParaDest-89"><a id="_idTextAnchor098"/>API project specifications</h2>
			<p>For our<a id="_idIndexMarker286"/> project, we are going to build a simple user management API that will modify the user information in an Airtable database. Most of the workflow that we will be building isn't important to the API itself. All we have to be aware of is the result of each API.</p>
			<p>Our API is going to have five endpoints:</p>
			<ul>
				<li><strong class="source-inline">POST /api/v1/user/add</strong></li>
				<li><strong class="source-inline">GET /api/v1/user/list</strong></li>
				<li><strong class="source-inline">GET /api/v1/user/search</strong></li>
				<li><strong class="source-inline">POST /api/v1/user/delete</strong></li>
				<li><strong class="source-inline">POST /api/v1/user/changepw</strong></li>
			</ul>
			<p>The base URL for our API will be <a href="https://tephlon.app.n8n.cloud/webhook">https://tephlon.app.n8n.cloud/webhook</a> since that is the Webhook URL for my n8n cloud instance.</p>
			<p>Our API will also use header authentication with a bearer token value of <strong class="source-inline">675tryfhgui89765tyrfghjui89765uyr4thfgjuio</strong>.</p>
			<p>The Airtable database will store the following information:</p>
			<ul>
				<li><strong class="bold">First Name</strong>: The user's first name</li>
				<li><strong class="bold">Last Name</strong>: The user's last name </li>
				<li><strong class="bold">Email</strong>: The user's email address</li>
				<li><strong class="bold">Password Hash</strong>: A calculated value representing the user's password<p class="callout-heading">Note</p><p class="callout">The reason that we do not store the user's password is for security. If the data table were to become compromised, the user's password would be out in the wild. By storing a calculated value based on the user's password, the same calculation can be performed each time the password is supplied to n8n, and the calculated value is compared to the stored value.</p></li>
			</ul>
			<h2 id="_idParaDest-90"><a id="_idTextAnchor099"/>Creating credentials</h2>
			<p>The first step<a id="_idIndexMarker287"/> will be to create the header authentication:</p>
			<ol>
				<li value="1">In the n8n Editor UI, click on the "^" icon and click on <strong class="bold">New</strong>.</li>
				<li>When prompted, select <strong class="bold">Header Auth</strong> for <strong class="bold">Credential type</strong>.</li>
				<li>In the <strong class="bold">Create New Credentials</strong> form, enter the following information:<ul><li><strong class="bold">Credentials Name</strong>: <strong class="source-inline">Header Authentication</strong></li><li><strong class="bold">Name</strong>: <strong class="source-inline">Auth</strong></li><li><strong class="bold">Value</strong>: <strong class="source-inline">Bearer 675tryfhgui89765tyrfghjui89765uyr4thfgjuio</strong></li><li><strong class="bold">Nodes with Access</strong>: <strong class="source-inline">Webhook</strong></li></ul></li>
			</ol>
			<p>The final credentials form should look like this:</p>
			<div>
				<div id="_idContainer067" class="IMG---Figure">
					<img src="image/Figure_5.05_B17493.jpg" alt="Figure 5.5 – Header Auth credentials&#13;&#10;"/>
				</div>
			</div>
			<p class="figure-caption">Figure 5.5 – Header Auth credentials</p>
			<ol>
				<li value="4">Click<a id="_idIndexMarker288"/> the <strong class="bold">Create</strong> button to complete this process.</li>
			</ol>
			<h2 id="_idParaDest-91"><a id="_idTextAnchor100"/>Creating Webhooks</h2>
			<p>Next, let's <a id="_idIndexMarker289"/>create <a id="_idIndexMarker290"/>the Webhooks in n8n:</p>
			<ol>
				<li value="1">Create five new Webhook nodes and name them like so:<ul><li><strong class="source-inline">Add</strong></li><li><strong class="source-inline">List</strong></li><li><strong class="source-inline">Search</strong></li><li><strong class="source-inline">Delete</strong></li><li><strong class="source-inline">ChangePW</strong></li></ul></li>
				<li>Configure each of the Webhooks based on the following table:</li>
			</ol>
			<div>
				<div id="_idContainer068" class="IMG---Figure">
					<img src="image/Table_5.1_B17493.jpg" alt=""/>
				</div>
			</div>
			<p>That should <a id="_idIndexMarker291"/>complete the initial Webhook <a id="_idIndexMarker292"/>creation. Make sure to save and activate the workflow.</p>
			<h2 id="_idParaDest-92"><a id="_idTextAnchor101"/>The rest of the workflow</h2>
			<p>While the rest<a id="_idIndexMarker293"/> of the workflow is important for generating the proper outcomes for the API, it has very little to do with the API itself. </p>
			<p>You can download the whole workflow here: <a href="https://github.com/PacktPublishing/Rapid-Product-Development-with-n8n/blob/main/Chapter%205/User_Management_API.json">https://github.com/PacktPublishing/Rapid-Product-Development-with-n8n/blob/main/Chapter%205/User_Management_API.json</a>.</p>
			<p>Now that we<a id="_idIndexMarker294"/> have built the API in n8n, let's look at how to add further security to your API endpoints.</p>
			<h1 id="_idParaDest-93"><a id="_idTextAnchor102"/>Securing your API endpoints</h1>
			<p>Earlier in this<a id="_idIndexMarker295"/> chapter, we talked about using Webhook authorization to help secure your API. This is an important first step but that does not mean that your API is secure. There are several extra actions that you can take to secure your API.</p>
			<h2 id="_idParaDest-94"><a id="_idTextAnchor103"/>Using SSL/TLS security</h2>
			<p>SSL and its<a id="_idIndexMarker296"/> younger brother, TLS, are common security standards on the internet. Any time you see <strong class="source-inline">https</strong> in front of a website address, this means that one of these systems is at work.</p>
			<p>The purpose of SSL/TLS is to encrypt the communication between the client software (for example, the web browser, n8n, and API client) and the web server that is hosting the API. This way, if someone were to set themselves up between you and the API server, all they would get is jibberish instead of the API tokens and passwords that are used to access that information.</p>
			<h2 id="_idParaDest-95"><a id="_idTextAnchor104"/>Limiting where users come from</h2>
			<p>One way of <a id="_idIndexMarker297"/>reducing the probability of being taken down by a malicious actor is to limit who can access your API based on where they are coming from. For example, if all your clients who use your API are from Germany, then there is no point in allowing people from Canada to access the API.</p>
			<p>While this is not a perfect solution, since it is relatively easy to get around by using a VPN, this means that people who are out to cause trouble need to jump through yet another hoop.</p>
			<p>If you want to take this option to the next level, you can even limit access to a single IP address so that only people from a specific office can use your API.</p>
			<h2 id="_idParaDest-96"><a id="_idTextAnchor105"/>Proxying your API</h2>
			<p>Putting your <a id="_idIndexMarker298"/>API behind a proxy is one of the smartest things that you can do. Here <a id="_idIndexMarker299"/>are some of the benefits of doing this:</p>
			<ul>
				<li>It prevents people from directly accessing your API server. </li>
				<li>It hides other potentially dangerous open ports. </li>
				<li>It can reduce calls to your API and other tools by caching requests and returning results without having to talk to the API server.</li>
				<li>It can distribute requests across several servers.</li>
			</ul>
			<p>With all of these advantages from the proxy, it is well worth looking into setting up a proxy.</p>
			<h2 id="_idParaDest-97"><a id="_idTextAnchor106"/>Rotating security tokens</h2>
			<p>With security <a id="_idIndexMarker300"/>breaches happening daily, it is well worth changing the API tokens regularly as well. There are several different ways to do this but you need to find a way that works for you.</p>
			<p>One of the best ways to do this is to have a token expire after a certain period. At that point, the user would be required to get a new token. This can be automated so that as soon as the token times out, the system knows to reach out and request a new one.</p>
			<p>This way, even if your token were to get out and someone on the internet were to start using it, they would only have access for a short period before the token would expire and then require a new token to be generated.</p>
			<h2 id="_idParaDest-98"><a id="_idTextAnchor107"/>Tracking and limiting the number of requests</h2>
			<p>It is<a id="_idIndexMarker301"/> important<a id="_idIndexMarker302"/> to record every single connection attempt that occurs on your API server. This provides you with two advantages:</p>
			<ul>
				<li>You can identify if there is any strange behavior occurring on your API server.</li>
				<li>You can prevent one person or organization from abusing the API server.</li>
			</ul>
			<p>Users (as identified by their token) and organizations (as identified by their IP address) should have the number of calls they make throttled to a reasonable speed.</p>
			<h2 id="_idParaDest-99"><a id="_idTextAnchor108"/>Providing metadata in your API responses</h2>
			<p>Embedding <a id="_idIndexMarker303"/>useful metadata in the information that you provide to your users is a great way to allow the end user to verify the information that they are receiving is accurate. Some examples of good metadata are as follows:</p>
			<ul>
				<li>Providing an <strong class="bold">MD5</strong> sum value when downloading a file for the user</li>
				<li>Indicating the record count being returned from a query</li>
				<li>Performing a GeoIP lookup of the city the user is coming from so that they can confirm the request is legitimate</li>
				<li>Returning the length of the results in a certain number of characters</li>
			</ul>
			<p>Once your API<a id="_idIndexMarker304"/> is secure, it is time to start testing its robustness.</p>
			<h1 id="_idParaDest-100"><a id="_idTextAnchor109"/>Testing your API</h1>
			<p>Creating a <a id="_idIndexMarker305"/>testing plan for your API is an important part of the design and rollout process. If you do not test your API properly, there is no telling what results your clients will get.</p>
			<p>Because of its importance, let's look at some recommendations for API testing.</p>
			<h2 id="_idParaDest-101"><a id="_idTextAnchor110"/>Use a testing platform</h2>
			<p>While you may be able to manually test some small or simple APIs, the bigger they become, the harder they are to test. Not only does this allow you to do more for testing, but it also allows you to easily retest after you make changes, knowing that the test is the same as it was the previous time.</p>
			<p>If you don't have a testing platform, you can easily create several testing scripts using the cURL command-line tool or use something such as the documentation and testing tool built<a id="_idIndexMarker306"/> into Insomnia (<strong class="source-inline">https://insomnia.rest</strong>).</p>
			<h2 id="_idParaDest-102"><a id="_idTextAnchor111"/>Follow the documentation</h2>
			<p>The documentation that you have created or been provided with is very important. Make sure you can do everything that the documentation says that it can do and none of the things that it doesn't say you can do.</p>
			<p>You should be able to do absolutely everything that is in the documentation without fail.</p>
			<h2 id="_idParaDest-103"><a id="_idTextAnchor112"/>Try to break it</h2>
			<p>This is the part of the testing process that you can have a lot of fun with. Here are some ideas I've had success with in the past:</p>
			<ul>
				<li>Send information in different character sets. </li>
				<li>Enter SQL commands as usernames or passwords and see if the commands execute on the server.</li>
				<li>Overload the server by making thousands of calls per second.</li>
				<li>Try to get access to the information you shouldn't be able to on the server.</li>
			</ul>
			<h2 id="_idParaDest-104"><a id="_idTextAnchor113"/>Confirm the data</h2>
			<p>When you are testing the API, make sure that the data you are expecting to receive is the data you are receiving. It is really easy to look at one or two samples and then extrapolate over the entire dataset that the information being returned is accurate.</p>
			<h2 id="_idParaDest-105"><a id="_idTextAnchor114"/>Ongoing testing</h2>
			<p>Just like data <a id="_idIndexMarker307"/>backups should be tested regularly to ensure that the data is recoverable, it is also important to continue testing your API regularly.</p>
			<p>As the environment that the API is running in changes, so can the performance of your API. Some environmental changes that could cause your API to begin behaving poorly include the following:</p>
			<ul>
				<li>A sudden increase in the number of users</li>
				<li>Increased database size</li>
				<li>Larger and more frequent data requests</li>
				<li>A poorly designed proxy</li>
				<li>Changes to the work schedules</li>
			</ul>
			<p>By continually testing and upgrading the API, you can continue to ensure that the API performs as expected and continues to keep your clients happy.</p>
			<h1 id="_idParaDest-106"><a id="_idTextAnchor115"/>Summary</h1>
			<p>In this chapter, we showed you how to plan out your API and build it in n8n using Webhooks. We also covered how to test and secure your API so that it functions properly when it is in production.</p>
			<p>While it may feel as though we have covered a lot about APIs, there are still considerable amounts for us to go through. </p>
			<p>One of the aspects of APIs that I did not go into very much detail about was manipulating the data that's sent and received by APIs in the workflows. If APIs are a language that computer systems use to communicate with each other, then the data manipulation that occurs inside an n8n workflow is the translation of that API language so that two or more different systems can communicate, even when they don't know each other's language.</p>
			<p>We are going to be talking about this data manipulation in more depth in the next chapter as it is not just an important topic – it is a critical one.</p>
		</div>
	</body></html>