<html><head></head><body><div id="sbo-rt-content"><div id="_idContainer061">
			<h1 id="_idParaDest-66"><em class="italic"><a id="_idTextAnchor063"/>Chapter 4</em>: Preparing a Headless Raspberry Pi for a Robot</h1>
			<p>In this chapter, you will learn why the Raspberry Pi controller on a robot should be wireless and headless, what headless means, and why it's useful in robotics. You will see how to set up a Raspberry Pi directly as a headless device, and how to connect to this Raspberry Pi once on the network, and then send your first instructions to it. By the end of the chapter, you will have your own ready-to-use Raspberry Pi without needing to connect a screen, keyboard, or wired network to it, so it can be mobile in a robot.</p>
			<p>We'll cover the following topics in this chapter:</p>
			<ul>
				<li>What is a headless system and why is it useful in a robot?</li>
				<li>Setting up Wi-Fi on the Raspberry Pi and enabling SSH</li>
				<li>Finding your Raspberry Pi on the network</li>
				<li>Using PuTTY or SSH to connect to your Raspberry Pi</li>
				<li>Configuring Raspberry Pi OS</li>
			</ul>
			<h1 id="_idParaDest-67"><a id="_idTextAnchor064"/>Technical requirements</h1>
			<p>To complete the exercises in this chapter, you will require the following:</p>
			<ul>
				<li>A Raspberry Pi, preferably a 3A+ (but a Pi 3 or 4 will do)</li>
				<li>A USB power supply capable of 2.1 amps with a Micro-USB cable</li>
				<li>The MicroSD card you prepared in the previous chapter</li>
				<li>A Windows, Linux, or macOS computer connected to the internet and able to read/write to SD cards</li>
				<li>A text editor on your computer – VS Code is a suitable multiplatform option</li>
				<li>PuTTY software on Windows (SSH software is already available on Mac and Linux desktops)</li>
			</ul>
			<p>The GitHub link for the code is as follows:</p>
			<p><a href="https://github.com/PacktPublishing/Learn-Robotics-Programming-Second-Edition/tree/master/chapter4">https://github.com/PacktPublishing/Learn-Robotics-Programming-Second-Edition/tree/master/chapter4</a></p>
			<p>Check out the following video to see the Code in Action: <a href="https://bit.ly/3bErI1I">https://bit.ly/3bErI1I</a></p>
			<h1 id="_idParaDest-68"><a id="_idTextAnchor065"/>What is a headless system, and why is it useful in a robot?</h1>
			<p>A <strong class="bold">headless system</strong> is a computer designed to be <a id="_idIndexMarker151"/>operated from another computer via a network, at times or in places where keyboard, screen, and mouse access to a <a id="_idIndexMarker152"/>device is inconvenient. Headless access is used for server systems, for building robots and making gadgets:</p>
			<div>
				<div id="_idContainer048" class="IMG---Figure">
					<img src="Images/B15660_04_01.jpg" alt="" width="950" height="444"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.1 – A Raspberry Pi tethered to a screen, keyboard, and mouse</p>
			<p><em class="italic">Figure 4.1</em> shows a system with a head where a user can sit in front of the device. You need to attach a screen, keyboard, and mouse to your robot, and hence it is not very mobile. You may be able to attach/detach them as required, but this is also inconvenient. There are <a id="_idIndexMarker153"/>portable systems designed to dock with Raspberry Pis like this, but when a robot moves, you'll need to disconnect it or move with the robot.</p>
			<p>At some events, I have seen<a id="_idIndexMarker154"/> robots with tiny onboard screens, controlled by a wireless keyboard and mouse. However, in this book, we use a robot as a headless device:</p>
			<div>
				<div id="_idContainer049" class="IMG---Figure">
					<img src="Images/B15660_04_02.jpg" alt="" width="1273" height="441"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.2 – A Raspberry Pi on a robot in a headless configuration</p>
			<p>The Raspberry Pi in <em class="italic">Figure 4.2</em> is mounted on a robot as a headless device. This Raspberry Pi is not weighed down by a screen and keyboard; those are handled by another computer. Code, instructions, and information is sent to and from the Raspberry Pi via a wireless network from a laptop. Many code examples run autonomously, and the computer can start/stop these. We add indicator LEDs in <a href="B15660_09_Final_ASB_ePub.xhtml#_idTextAnchor171"><em class="italic">Chapter 9</em></a>, <em class="italic">Programming RGB Strips in Python</em>. We also show you how to use a mobile phone to drive the robot in <a href="B15660_17_Final_ASB_ePub.xhtml#_idTextAnchor396"><em class="italic">Chapter 17</em></a>, <em class="italic">Controlling the Robot with a Phone and Python</em>. The phone can start and stop autonomous behaviors, view the robot's status, or just drive it without needing to hook up the laptop at all. This Raspberry Pi is free from the screen and keyboard.</p>
			<p class="callout-heading">Tip</p>
			<p class="callout">Although you won't usually need a screen and keyboard, it is worth having these around in case you lose contact with the Raspberry Pi, and it refuses to respond via the network. You can then use a screen and keyboard to connect to it and see what is going on.</p>
			<p>For our headless <a id="_idIndexMarker155"/>access to the Raspberry Pi, we will be using a <strong class="bold">Secure Shell</strong> (<strong class="bold">SSH</strong>). SSH gives you a<a id="_idIndexMarker156"/> command line to send instructions to the Pi and a file transfer system to put files onto it.</p>
			<p>Making a Pi headless <a id="_idIndexMarker157"/>makes it free to roam around. It keeps a robot light by not needing to carry or power a screen and keyboard. Being headless makes a robot smaller since a monitor and keyboard are bulky. It also encourages you, the maker, to think about autonomous behavior since you can't always type commands to the robot.</p>
			<h1 id="_idParaDest-69"><a id="_idTextAnchor066"/>Setting up Wi-Fi on the Raspberry Pi and enabling SSH</h1>
			<p>Now you've seen what you<a id="_idIndexMarker158"/> get with a headless system, let's modify the<a id="_idIndexMarker159"/> SD card so the Raspberry Pi starts up ready to use as a headless device. We need to set up Wi-Fi first:</p>
			<ol>
				<li>Remove and reinsert the MicroSD card we made earlier into your computer so that the computer can recognize the new state of the drive. </li>
				<li>Now you will see the card shows up as two disk drives. One of the drives is called <strong class="source-inline">boot</strong>; Windows will ask whether you want to format the other drive. Click <strong class="bold">Cancel</strong> when Windows asks you. This part of the SD card holds a Linux-specific filesystem that Windows cannot read. </li>
				<li>Now, in <strong class="source-inline">boot</strong>, create two files as follows. I suggest using an editor such as VSCode for plain text files, seeing file extensions, and making empty files:<ul><li><strong class="source-inline">ssh</strong>: An empty file with no extension.</li><li><strong class="source-inline">wpa_supplicant.conf</strong>: This file contains your Wi-Fi network configuration as shown here:<p class="source-code"><strong class="bold">country=GB</strong></p><p class="source-code"><strong class="bold">update_config=1</strong></p><p class="source-code"><strong class="bold">ctrl_interface=/var/run/wpa_supplicant</strong></p><p class="source-code"><strong class="bold">network={</strong></p><p class="source-code"><strong class="bold">  ssid="&lt;your network ssid&gt;"</strong></p><p class="source-code"><strong class="bold">  psk="&lt;your network password&gt;"</strong></p><p class="source-code"><strong class="bold">}</strong></p><p>Let's go over this file line by line:</p><p>The first line<a id="_idIndexMarker160"/> must specify an ISO/IEC alpha2 country code. You can find the appropriate country code for your location at <a href="https://datahub.io/core/country-list">https://datahub.io/core/country-list</a>. The Wi-Fi adapter will be disabled by Raspberry <a id="_idIndexMarker161"/>Pi OS if this is not present. In my case, I am in Great Britain, so my country code is GB.</p><p>The next two lines allow other tools to update the configuration.</p><p>The last 4 lines of the file define the Wi-Fi network your robot and Raspberry Pi will connect to. Use your own network details instead of the placeholders here. The <strong class="bold">Pre-Shared Key</strong> (<strong class="bold">PSK</strong>) is also known <a id="_idIndexMarker162"/>as the Wi-Fi password. These should be the same details you use to connect your laptop or phone to your Wi-Fi network. I recommend keeping a copy of the <strong class="source-inline">wpa_supplicant.conf</strong> file on your computer to use on other Raspberry Pi SD cards.</p><p class="callout-heading">Important note</p><p class="callout">The <strong class="source-inline">ssh</strong> file must have no extension. It must not be <strong class="source-inline">ssh.txt</strong> or some other variation.</p></li></ul></li>
				<li>Eject the MicroSD card. Remember to use the menus to do so. This ensures that the files are entirely written before removing it.</li>
				<li>Now, with these two files in place, you can use the MicroSD card to boot the Raspberry Pi. Plug the MicroSD card into the slot on the underside of the Raspberry Pi. It only fits into the slot in the correct orientation. </li>
				<li>Finally, plug a<a id="_idIndexMarker163"/> Micro-USB cable into the side of the Raspberry Pi and<a id="_idIndexMarker164"/> connect it to a power supply. You should see lights blinking to show it is starting.<p class="callout-heading">Important note</p><p class="callout">For a Raspberry Pi, you need a power supply providing at least 2.1 amps. </p></li>
			</ol>
			<p>Your Raspberry Pi headless system has now been set up. With this, we have taken a major step toward being mobile. Now we'll need to go find it on our network so we can connect to it.</p>
			<h1 id="_idParaDest-70"><a id="_idTextAnchor067"/>Finding your Pi on the network</h1>
			<p>Assuming your SSID and PSK are<a id="_idIndexMarker165"/> correct, your Raspberry Pi is now registered on your Wi-Fi network. However, now you need to find it. The Raspberry Pi uses dynamic addresses (DHCP). Every time you connect it to your network, it may get a different address. Visiting the admin page on your Wi-Fi router and writing down the IP address works in the short term. Doing that every time the address changes is frustrating, and may not be available in some situations.</p>
			<p>Luckily, the Raspberry Pi<a id="_idIndexMarker166"/> uses a technology known as <strong class="bold">mDNS</strong> (<strong class="bold">Multicast Domain Name System</strong>), so nearby computers can find it. A client computer will broadcast a local message to ask for devices with the name <strong class="source-inline">raspberrypi.local</strong>, and the Raspberry Pi will respond with the address to find it. This is also known by the names Zeroconf and Bonjour. So, the first thing you'll need to do is ensure your computer can do this. </p>
			<p>If you are using macOS, your computer will already be running the Bonjour software, which is already mDNS capable. Also, Ubuntu and Fedora desktop versions have had mDNS compatibility for a long time. On other Linux desktops, you will need to find their instructions for Zeroconf or Avahi. Many recent ones have this enabled by default.</p>
			<p>But if you are using Windows, you will need the Bonjour software. So let's see how to set it up.</p>
			<h2 id="_idParaDest-71"><a id="_idTextAnchor068"/>Setting up Bonjour for Microsoft Windows</h2>
			<p>If you have installed a<a id="_idIndexMarker167"/> recent version of Skype or iTunes, you <a id="_idIndexMarker168"/>will have this software. You can use this guide to check that it is already present and enable it: <a href="https://smallbusiness.chron.com/enable-bonjour-65245.html">https://smallbusiness.chron.com/enable-bonjour-65245.html</a>.</p>
			<p>You can check whether it is already working with the following command in Command Prompt:</p>
			<p class="source-code">C:\Users\danny&gt;ping raspberrypi.local</p>
			<p>If you see this, you have Bonjour installed already:</p>
			<p class="source-code">PING raspberrypi.local (192.168.0.53) 56(84) bytes of data.</p>
			<p class="source-code">64 bytes from 192.168.0.53 (192.168.0.53): icmp_seq=1 ttl=64 time=0.113 ms</p>
			<p class="source-code">64 bytes from 192.168.0.53 (192.168.0.53): icmp_seq=2 ttl=64 time=0.079 ms</p>
			<p>If you see this, you'll need to install it:</p>
			<p class="source-code">Ping request could not find host raspberrypi.local. Please check the name and try again.</p>
			<p>To do<a id="_idIndexMarker169"/> so, browse to the Apple Bonjour For Windows site at <a href="https://support.apple.com/downloads/bonjour_for_windows">https://support.apple.com/downloads/bonjour_for_windows</a> and download it, then install <strong class="bold">Download Bonjour Print Services for Windows</strong>. Once this has run, Windows will be able to ask for mDNS devices by name.</p>
			<h2 id="_idParaDest-72"><a id="_idTextAnchor069"/>Testing the setup</h2>
			<p>The Raspberry Pi's green light should have stopped blinking, and only a red power light should be visible. This indicates that the Pi has<a id="_idIndexMarker170"/> finished booting and has connected to the network.</p>
			<p>In Windows, summon a command line by pressing the Windows key and type <strong class="source-inline">CMD</strong> in the windows search bar. In Linux or macOS, open Terminal. From Terminal, we will try to <strong class="source-inline">ping</strong> the Raspberry Pi, that is, find the Pi on the network and send a short message to get a response:</p>
			<p class="source-code">ping raspberrypi.local</p>
			<p>If everything has gone right, the computer will show that it has connected to the Pi:</p>
			<p class="source-code">$ ping raspberrypi.local</p>
			<p class="source-code">PING raspberrypi.local (192.168.0.53) 56(84) bytes of data.</p>
			<p class="source-code">64 bytes from 192.168.0.53 (192.168.0.53): icmp_seq=1 ttl=64 time=0.113 ms</p>
			<p class="source-code">64 bytes from 192.168.0.53 (192.168.0.53): icmp_seq=2 ttl=64 time=0.079 ms</p>
			<p class="source-code">64 bytes from 192.168.0.53 (192.168.0.53): icmp_seq=3 ttl=64 time=0.060 ms</p>
			<p class="source-code">64 bytes from 192.168.0.53 (192.168.0.53): icmp_seq=4 ttl=64 time=0.047 ms</p>
			<p>What if you cannot<a id="_idIndexMarker171"/> reach the Raspberry Pi? In the next section, we'll try some troubleshooting steps.</p>
			<h2 id="_idParaDest-73"><a id="_idTextAnchor070"/>Troubleshooting</h2>
			<p>If the Raspberry Pi does not <a id="_idIndexMarker172"/>appear to be responding to the ping operation, these are some steps you can take to try to diagnose and remedy the situation. Try the following:</p>
			<ol>
				<li value="1">Double-check your connections. You should have seen a few blinks of the green light and a persistent red light. If not, unplug the power, ensure that the SD card is seated firmly and that the power supply can give 2.1 amps, then try again.</li>
				<li>Use your Wi-Fi access point settings with the Raspberry Pi booted and see if it has taken an IP address there.</li>
				<li>If you find the Raspberry Pi on your Wi-Fi router, this may mean that mDNS is not running on your computer correctly. If you have not installed it, please go back and do so. On Windows, the different versions of Bonjour print services, Bonjour from Skype, and Bonjour from iTunes can conflict if installed together. Use the Windows add/remove functions to see whether there is more than one and remove all Bonjour instances, then install the official one again.</li>
				<li>Next, turn the power off, take out the SD card, place this back into your computer, and double-check that the <strong class="source-inline">wpa_supplicant.conf</strong> file is present and has the correct <a id="_idIndexMarker173"/>Wi-Fi details and country code. The most common errors in this file are the following: <p>a) Incorrect Wi-Fi details</p><p>b) Missing quotes or missing/incorrect punctuation</p><p>c) An incorrect or missing country code</p><p>d) Keywords being in the wrong case (keywords should be lowercase, country code in uppercase)</p></li>
				<li>The SSH file is removed when the Raspberry Pi starts. If you are sure it was there and has been removed, this means the Pi actually booted.</li>
				<li>Finally, you may need to boot the Pi with a screen and keyboard connected, and attempt to diagnose the issue. The display will tell you whether there are other issues with <strong class="source-inline">wpa_supplicant.conf</strong> or other problems. Use the screen text and search the web for answers. I cannot reproduce all those here, as there are many kinds of problems that<a id="_idIndexMarker174"/> could occur here. I also recommend asking on Twitter using the tag <strong class="source-inline">#raspberrypi</strong>, on Stack Overflow, or in the Raspberry Pi Forums at <a href="https://www.raspberrypi.org/forums/">https://www.raspberrypi.org/forums/</a>.</li>
			</ol>
			<p>We have now verified that our Pi is connected to the network, troubleshooting issues along the way. We've been able to find it with <strong class="source-inline">ping</strong>. Now we know it is there, let's connect to it.</p>
			<h1 id="_idParaDest-74"><a id="_idTextAnchor071"/>Using PuTTY or SSH to connect to your Raspberry Pi</h1>
			<p>Earlier, we added a file to<a id="_idIndexMarker175"/> our Raspberry Pi boot named <strong class="source-inline">ssh</strong>. This activates<a id="_idIndexMarker176"/> the SSH service on the Pi. As <a id="_idIndexMarker177"/>mentioned before, SSH is an abbreviation for secure shell, intended for secure network access. In this case, we are not specifically targeting the secure encryption capabilities, but are using the remote networking capability to send instructions and files to and from the Raspberry<a id="_idIndexMarker178"/> Pi without having <a id="_idIndexMarker179"/>physical access to it.</p>
			<p class="callout-heading">Important note</p>
			<p class="callout">If you already use an SSH client, note that not all of the Windows command-line SSH clients support mDNS.</p>
			<p>PuTTY is a handy tool<a id="_idIndexMarker180"/> for accessing SSH and is available for Windows, Linux, and Mac. Its installation information for these operating systems can be found at <a href="https://www.ssh.com/ssh/putty/">https://www.ssh.com/ssh/putty/</a>. </p>
			<p>Once you have PuTTY installed from the preceding link, let's get it connected to your Raspberry Pi. Follow along:</p>
			<ol>
				<li value="1">Start PuTTY. You will see a screen like in <em class="italic">Figure 4.3</em>. In the <strong class="bold">Host Name (or IP address)</strong> box, type <strong class="source-inline">raspberrypi.local</strong> and click <strong class="bold">Open</strong> to log in to your Pi:<div id="_idContainer050" class="IMG---Figure"><img src="Images/B15660_04_03.jpg" alt="" width="1173" height="866"/></div><p class="figure-caption">Figure 4.3 – Connecting to the Pi</p></li>
				<li>The first time <a id="_idIndexMarker181"/>you do this, PuTTY displays a <a id="_idIndexMarker182"/>security warning asking you to add the Pi's <a id="_idIndexMarker183"/>key if you trust it. Click <strong class="bold">Yes</strong>; it only asks you this again if another device with the same hostname (for example, a fresh Raspberry Pi) shows up with a different key.</li>
				<li>When you see the <strong class="bold">Login as</strong> prompt, type <strong class="source-inline">pi</strong>, press <em class="italic">Enter</em>, and use the password <strong class="source-inline">raspberry</strong>. You'll now see something like <em class="italic">Figure 4.4</em>, showing that you have connected to the Pi:</li>
			</ol>
			<div>
				<div id="_idContainer051" class="IMG---Figure">
					<img src="Images/B15660_04_04.jpg" alt="" width="1559" height="648"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.4 – Successfully connected</p>
			<p>In this section, you've<a id="_idIndexMarker184"/> used PuTTY or your<a id="_idIndexMarker185"/> preferred SSH client to connect to the Raspberry Pi, setting<a id="_idIndexMarker186"/> you up to configure it, send commands to it, and interact with it. Next, we'll see how to configure it.</p>
			<h1 id="_idParaDest-75"><a id="_idTextAnchor072"/>Configuring Raspberry Pi OS</h1>
			<p>Now we are <a id="_idIndexMarker187"/>connected, let's do a few things to prepare the Raspberry Pi for use, such as changing the user password and changing the hostname to make the Pi more secure.</p>
			<p>We can perform many of these tasks with the <strong class="source-inline">raspi-config</strong> tool, a menu system to perform configuration tasks on Raspberry Pi OS. We start it with another tool, <strong class="source-inline">sudo</strong>, which runs <strong class="source-inline">raspi-config</strong> as root, a master user. Refer to the following command:</p>
			<p class="source-code">sudo raspi-config</p>
			<p>The <strong class="source-inline">raspi-config</strong> interface will appear, as shown in <em class="italic">Figure 4.5</em>:</p>
			<div>
				<div id="_idContainer052" class="IMG---Figure">
					<img src="Images/B15660_04_05.jpg" alt="" width="1479" height="799"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.5 – The raspi-config tool</p>
			<p>Now we've accessed <strong class="source-inline">raspi-config</strong>, we can use it to<a id="_idIndexMarker188"/> change some of the settings on the Raspberry Pi.</p>
			<h2 id="_idParaDest-76"><a id="_idTextAnchor073"/>Renaming your Pi</h2>
			<p>Every fresh Raspberry Pi image<a id="_idIndexMarker189"/> is called <strong class="bold">raspberrypi</strong>. If there is<a id="_idIndexMarker190"/> more than one of those in a room, your computer will not be able to find yours. It's time to think of a name. For now, we'll use <strong class="source-inline">myrobot</strong>, but I am sure you can think of something better. You can change this later too. It can be letters, numbers, and dash characters only. Use the following steps:</p>
			<ol>
				<li value="1">In <strong class="source-inline">raspi-config</strong>, select <strong class="bold">Network Options</strong>, shown in <em class="italic">Figure 4.6</em>. Use the arrow keys on your keyboard to highlight and press <em class="italic">Enter</em> to select the entry:<div id="_idContainer053" class="IMG---Figure"><img src="Images/B15660_04_06.jpg" alt="" width="1480" height="791"/></div><p class="figure-caption">Figure 4.6 – Network options</p></li>
				<li>Now select <strong class="bold">Hostname</strong> as shown in <em class="italic">Figure 4.7</em>:<div id="_idContainer054" class="IMG---Figure"><img src="Images/B15660_04_07.jpg" alt="" width="1478" height="651"/></div><p class="figure-caption">Figure 4.7 – Change the hostname</p></li>
				<li>You should be on a screen waiting for hostname input. Type in a name for your robot (I called mine <strong class="source-inline">myrobot</strong>), then press <em class="italic">Enter</em> to set it. Please be more inventive than my name.</li>
			</ol>
			<p>You have now<a id="_idIndexMarker191"/> named your robot, which will be more important if you have other Raspberry Pis but also gives the robot a little character. Let's also change the password to something a bit less generic.</p>
			<h2 id="_idParaDest-77"><a id="_idTextAnchor074"/>Securing your Pi (a little bit)</h2>
			<p>Right now, your Raspberry Pi <a id="_idIndexMarker192"/>has the same password as every other Raspberry Pi fresh from an image. It's recommended you change it. Perform the following steps:</p>
			<ol>
				<li value="1">In the top menu of <strong class="source-inline">raspi-config</strong>, select <strong class="bold">Change User Password</strong> (<em class="italic">Figure 4.8</em>):<div id="_idContainer055" class="IMG---Figure"><img src="Images/B15660_04_08.jpg" alt="" width="1479" height="852"/></div><p class="figure-caption">Figure 4.8 – Changing the password</p></li>
				<li>Type a new password for <a id="_idIndexMarker193"/>your robot – something you will remember, more unique than <strong class="source-inline">raspberry</strong>. It should not be anything you've used for something sensitive such as email or banking.</li>
			</ol>
			<p>Changing the password personalizes the Raspberry Pi on your robot, and also drastically reduces the likelihood of someone else connecting to your robot and ruining your hard work. Now we've made configuration changes, we need to restart the Raspberry Pi for them to take effect.</p>
			<h2 id="_idParaDest-78"><a id="_idTextAnchor075"/>Rebooting and reconnecting</h2>
			<p>It's time<a id="_idIndexMarker194"/> to finish the configuration<a id="_idIndexMarker195"/> and restart the Pi:</p>
			<ol>
				<li value="1">Use the <em class="italic">Tab</em> button to get to the <strong class="bold">Finish</strong> item (<em class="italic">Figure 4.9</em>) and press <em class="italic">Enter</em>:<div id="_idContainer056" class="IMG---Figure"><img src="Images/B15660_04_09.jpg" alt="" width="1477" height="853"/></div><p class="figure-caption">Figure 4.9 – Select Finish</p></li>
				<li>The next screen <a id="_idIndexMarker196"/>asks whether you want to reboot the Pi. Select <strong class="bold">Yes</strong> and <a id="_idIndexMarker197"/>press <em class="italic">Enter</em> (<em class="italic">Figure 4.10</em>):<div id="_idContainer057" class="IMG---Figure"><img src="Images/B15660_04_10.jpg" alt="" width="1650" height="401"/></div><p class="figure-caption">Figure 4.10 – Say Yes to rebooting</p><p>The Raspberry Pi will <a id="_idIndexMarker198"/>start to reset, and the PuTTY session will be disconnected as it <a id="_idIndexMarker199"/>does so (<em class="italic">Figure 4.11</em>). Wait for a few minutes; the green activity light on the Pi should blink a bit and then settle down. PuTTY will tell you it has lost connection to it. The Pi is now shut down. The red light will stay on until you remove the power:</p><div id="_idContainer058" class="IMG---Figure"><img src="Images/B15660_04_11.jpg" alt="" width="1297" height="249"/></div><p class="figure-caption">Figure 4.11 – PuTTY telling you the Pi connection has gone</p><p>PuTTY only sends <a id="_idIndexMarker200"/>commands to and from the robot; it does not understand that <a id="_idIndexMarker201"/>this command has shut down the Pi. It does not expect the connection to close. You and I know better, as we told the Pi to reboot. Click <strong class="bold">OK</strong> to dismiss the error.</p></li>
				<li>Connect to it again with PuTTY using the new hostname you gave your robot (in my case, <strong class="source-inline">myrobot</strong>), with the <strong class="source-inline">.local</strong> ending and the fresh password, as shown in <em class="italic">Figure 4.12</em>:<div id="_idContainer059" class="IMG---Figure"><img src="Images/B15660_04_12.jpg" alt="" width="1174" height="216"/></div><p class="figure-caption">Figure 4.12 – Reconnect to the Raspberry Pi</p></li>
				<li>Now, you should be able to log in and see your prompt as <strong class="bold">pi@myrobot</strong>, or whatever your robot's name is, as shown in <em class="italic">Figure 4.13</em>:</li>
			</ol>
			<div>
				<div id="_idContainer060" class="IMG---Figure">
					<img src="Images/B15660_04_13.jpg" alt="" width="1376" height="806"/>
				</div>
			</div>
			<p class="figure-caption">Figure 4.13 – Reconnected to the Raspberry Pi</p>
			<p>We are now<a id="_idIndexMarker202"/> reconnected to the Raspberry Pi. We can try a simple Linux command to see<a id="_idIndexMarker203"/> how much of the SD card we are using. Linux commands are often abbreviations of things you want to ask the computer to do.</p>
			<p>The <strong class="source-inline">df</strong> command in <em class="italic">Figure 4.13</em> shows the space used in the various storage locations connected to your Raspberry Pi. The additional <strong class="source-inline">-h</strong> makes <strong class="source-inline">df</strong> display this in human-readable numbers. It uses <strong class="source-inline">G</strong>, <strong class="source-inline">M</strong>, and <strong class="source-inline">K</strong> suffixes for gigabytes, megabytes, and kilobytes. Type the <strong class="source-inline">df -h</strong> command, as shown in the preceding screenshot, and it will show that <strong class="source-inline">/dev/root</strong> is close to the full size of the SD card, with some other devices taking up the rest of the space.</p>
			<h2 id="_idParaDest-79"><a id="_idTextAnchor076"/>Updating the software on your Raspberry Pi</h2>
			<p>One last thing to do here is to<a id="_idIndexMarker204"/> ensure your Raspberry Pi has up-to-date software on it. This is the kind of process you start off and leave going while getting a meal, as it will take a while. Type the <strong class="source-inline">sudo apt update -y &amp;&amp; sudo apt upgrade -y</strong> command, and you should see something similar to the following: </p>
			<p class="source-code">pi@myrobot:~ $ sudo apt update – y &amp;&amp; sudo apt upgrade -y</p>
			<p class="source-code">Hit:1 http://raspbian.raspberrypi.org/raspbian buster InRelease</p>
			<p class="source-code">Hit:2 http://archive.raspberrypi.org/debian buster InRelease</p>
			<p class="source-code">. </p>
			<p class="source-code">.</p>
			<p class="source-code">Reading package lists... Done</p>
			<p class="source-code">Building dependency tree</p>
			<p class="source-code">Reading state information... Done</p>
			<p class="source-code">Calculating upgrade... Done</p>
			<p class="source-code">The following packages will be upgraded:</p>
			<p class="source-code">  bluez-firmware curl libcurl3 libcurl3-gnutls libprocps6 pi-bluetooth procps</p>
			<p class="source-code">  raspi-config wget</p>
			<p class="source-code">9 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.</p>
			<p class="source-code">Need to get 1,944 kB of archives.</p>
			<p class="source-code">After this operation, 16.4 kB of additional disk space will be used. Get:1 http://archive.raspberrypi.org/debian buster/main armhf bluez-firmware all 1.2-3+rpt6 [126 kB]</p>
			<p class="source-code">.</p>
			<p class="source-code">.</p>
			<p class="source-code">.</p>
			<p>Please let the Pi <a id="_idIndexMarker205"/>continue until it is complete here, and do not interrupt or turn the power off until the <strong class="source-inline">pi@myrobot:~ $</strong> prompt has reappeared.</p>
			<p class="callout-heading">Tip</p>
			<p class="callout">You've probably seen a pattern with <strong class="source-inline">sudo</strong> in a few of the commands. This command tells the Raspberry Pi to run the following command (such as <strong class="source-inline">raspbi-config</strong> or <strong class="source-inline">apt</strong>) as a <em class="italic">root</em> user, the Linux administrator/superuser. You can read it as <em class="italic">superuser do</em>. This is needed for software that will make changes to the system or perform updates. It's usually not required for user programs, though.</p>
			<p>It's worth doing this update/upgrade step monthly while actively working on a project. With the Raspberry Pi up to <a id="_idIndexMarker206"/>date, you will be able to install additional software for the robot code. When the software gets stale, <strong class="source-inline">apt-get</strong> installations may not work. An update will usually solve that.</p>
			<h2 id="_idParaDest-80"><a id="_idTextAnchor077"/>Shutting down your Raspberry Pi</h2>
			<p>When you are<a id="_idIndexMarker207"/> done with the Pi for the session, shut it down as shown: </p>
			<p class="source-code">pi@myrobot:~ $ sudo poweroff </p>
			<p>Wait for the green light activity to stop; PuTTY will detect that it has disconnected. You can now safely disconnect the power.</p>
			<p class="callout-heading">Important note</p>
			<p class="callout">Pulling power from the Raspberry Pi when it is not expected can cause the loss of files and SD card corruption. You may lose your work and damage the SD card. Always use the correct shutdown procedure.</p>
			<h1 id="_idParaDest-81"><a id="_idTextAnchor078"/>Summary</h1>
			<p>In this chapter, you've seen how to free a Raspberry Pi from a screen and keyboard by making it headless. You set up an SD card to connect to your Wi-Fi and to enable SSH so you could connect to it. You've used <strong class="source-inline">raspi-config</strong> to personalize your Pi and secure it with your own password. You then made the first small steps in looking around the Linux system it has running on it. You also ensured the Raspberry Pi is up to date and running the most current software. Finally, we saw how to safely put the Pi into shutdown mode, so that filesystem damage does not occur when you unplug it.</p>
			<p>You have now learned how to make a Raspberry Pi headless. You have seen how to keep it upgraded and connected to your network and the Pi is ready to start building with. You can use this to build Raspberry Pi-powered gadgets, including robots.</p>
			<p>In the next chapter, we look at ensuring you don't lose valuable code or configuration when things go wrong. We will learn about what can go wrong and how to use Git, SFTP, and SD card backups to protect our hard work.</p>
			<h1 id="_idParaDest-82"><a id="_idTextAnchor079"/>Assessment</h1>
			<ol>
				<li value="1">What other gadgets or projects could you build with a headless Raspberry Pi?</li>
				<li>Try giving your Raspberry Pi a different hostname and connecting to this locally with PuTTY and mDNS.</li>
				<li>Try other Linux commands on the Raspberry Pi, such as <strong class="source-inline">cd</strong>, <strong class="source-inline">ls</strong>, <strong class="source-inline">cat</strong>, and <strong class="source-inline">man</strong>.</li>
				<li>Shut down the Raspberry Pi correctly after trying these.</li>
			</ol>
			<h1 id="_idParaDest-83"><a id="_idTextAnchor080"/>Further reading</h1>
			<p>Please refer to the following to get more information:</p>
			<ul>
				<li><em class="italic">Internet of Things with Raspberry Pi 3</em>, <em class="italic">Maneesh Rao</em>, <em class="italic">Packt Publishing</em>: This book uses a wired headless Raspberry Pi for the demonstrations and experiments in it.</li>
			</ul>
		</div>
	</div></body></html>