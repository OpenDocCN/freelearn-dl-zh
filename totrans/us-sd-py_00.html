<html><head></head><body>
		<div><h1 id="_idParaDest-6"><a id="_idTextAnchor005"/>Preface</h1>
			<p>When Stable Diffusion was released on August 22, 2022, this Diffusion-based image generation model quickly caught the attention of the whole world. Both its model and source code are completely open source and hosted on GitHub. With millions of community participants and users, numerous new and mixed models have been released. Tools such as Stable Diffusion WebUI and InvokeAI have been created.</p>
			<p>While the Stable Diffusion WebUI tool can generate fantastic images driven by the diffusion model, its usability is limited. The open source Diffusers package from Hugging Face allows users to have full control over Stable Diffusion using Python. However, it lacks many key features, such as loading custom LoRA models and Textual Inversion, utilizing community-shared models/checkpoints, scheduling and weighted prompts, unlimited prompt tokens, fixing the resolution of the images, and upscaling. This book will assist you in overcoming the limitations of Diffusers and implementing the advanced features to create a fully customized and industrial-level Stable Diffusion application.</p>
			<p>By the end of this book, you will be able to not only use Python to generate and edit images but also leverage the solutions provided in the book to build Stable Diffusion applications for your business and users.</p>
			<h1 id="_idParaDest-7"><a id="_idTextAnchor006"/>Who this book is for</h1>
			<p>This book is for AI image and art generation enthusiasts who want to gain a comprehensive understanding of how image generation and diffusion models work.</p>
			<p>It is also for artists who are interested in fully understanding AI image generation and gaining precise control over the Diffusion model.</p>
			<p>Python application developers who aim to create AI image generation applications based on Stable Diffusion will also find this book helpful.</p>
			<p>Finally, this book is aimed at data scientists, machine learning engineers, and researchers who want to programmatically control the Stable Diffusion process, automate pipelines, build custom pipelines, and conduct testing and validation using Python.</p>
			<h1 id="_idParaDest-8"><a id="_idTextAnchor007"/>What this book covers</h1>
			<p><a href="B21263_01.xhtml#_idTextAnchor015"><em class="italic">Chapter 1</em></a>, <em class="italic">Introducing Stable Diffusion</em>, provides an introduction to the AI image generation technology Stable Diffusion.</p>
			<p><a href="B21263_02.xhtml#_idTextAnchor037"><em class="italic">Chapter 2</em></a>, <em class="italic">Setting Up an Environment for Stable Diffusion</em>, covers how to set up the CUDA and Python environments to run Stable Diffusion models.</p>
			<p><a href="B21263_03.xhtml#_idTextAnchor064"><em class="italic">Chapter 3</em></a>, <em class="italic">Generate Images Using Stable Diffusion</em>, is a whirlwind chapter that helps you start using Python to generate images with Stable Diffusion.</p>
			<p><a href="B21263_04.xhtml#_idTextAnchor081"><em class="italic">Chapter 4</em></a>, <em class="italic">Understand the Theory behind the Diffusion Models</em>, digs into the internals of the Diffusion model.</p>
			<p><a href="B21263_05.xhtml#_idTextAnchor097"><em class="italic">Chapter 5</em></a>, <em class="italic">Understanding How Stable Diffusion Works</em>, covers the theory behind Stable Diffusion.</p>
			<p><a href="B21263_06.xhtml#_idTextAnchor117"><em class="italic">Chapter 6</em></a>, <em class="italic">Using the Stable Diffusion Model</em>, covers model data handling and converting and loading model files.</p>
			<p><a href="B21263_07.xhtml#_idTextAnchor136"><em class="italic">Chapter 7</em></a>, <em class="italic">Optimizing Performance and VRAM Usage</em>, teaches you how to improve performance and reduce VRAM usage.</p>
			<p><a href="B21263_08.xhtml#_idTextAnchor153"><em class="italic">Chapter 8</em></a>, <em class="italic">Using Community-Shared LoRAs</em>, shows you how to use the community-shared LoRAs with Stable Diffusion checkpoint models.</p>
			<p><a href="B21263_09.xhtml#_idTextAnchor178"><em class="italic">Chapter 9</em></a>, <em class="italic">Using Textual Inversion</em>, uses the community-shared Textual Inversion with Stable Diffusion checkpoint models.</p>
			<p><a href="B21263_10.xhtml#_idTextAnchor197"><em class="italic">Chapter 10</em></a>, <em class="italic">Unlocking 77 Token Limitations and Enabling Prompt Weighting</em>, covers how to build custom prompt-handling code to use unlimited-size prompts with weighted importance scores. Specifically, we'll explore how to assign different weights to individual prompts or tokens, allowing us to fine-tune the model's attention and generate more accurate results.</p>
			<p><a href="B21263_11.xhtml#_idTextAnchor214"><em class="italic">Chapter 11</em></a>, <em class="italic">Image Restore and Super-Resolution</em>, shows you how to fix and upscale images using Stable Diffusion.</p>
			<p><a href="B21263_12.xhtml#_idTextAnchor240"><em class="italic">Chapter 12</em></a>, <em class="italic">Scheduled Prompt Parsing</em>, shows you how to build a custom pipeline to support scheduled prompts.</p>
			<p><a href="B21263_13.xhtml#_idTextAnchor257"><em class="italic">Chapter 13</em></a>, <em class="italic">Generating Images with ControlNet</em>, covers how to use ControlNet with Stable Diffusion checkpoint models.</p>
			<p><a href="B21263_14.xhtml#_idTextAnchor277"><em class="italic">Chapter 14</em></a>, <em class="italic">Generating Video Using Stable Diffusion</em>, shows you how to use AnimateDiff together with Stable Diffusion to generate a short video clip and understand the theory behind the video generation.</p>
			<p><a href="B21263_15.xhtml#_idTextAnchor289"><em class="italic">Chapter 15</em></a>, <em class="italic">Generating Image Descriptions Using BLIP-2 and LLaVA</em>, covers how to use large language models (LLMs) to extract descriptions from images.</p>
			<p><a href="B21263_16.xhtml#_idTextAnchor309"><em class="italic">Chapter 16</em></a>, <em class="italic">Exploring Stable Diffusion XL</em>, shows you how to start using Stable Diffusion XL, a newer and better Stable Diffusion model.</p>
			<p><a href="B21263_17.xhtml#_idTextAnchor335"><em class="italic">Chapter 17</em></a>, <em class="italic">Building Optimized Prompts for Stable Diffusion</em>, discusses techniques to write up Stable Diffusion prompts to generate better images, as well as leveraging LLMs to help generate prompts automatically.</p>
			<p><a href="B21263_18.xhtml#_idTextAnchor357"><em class="italic">Chapter 18</em></a>, <em class="italic">Applications: Object Editing and Style Transferring</em>, covers how to use Stable Diffusion and related machine learning models to edit images and transfer styles from one image to another.</p>
			<p><a href="B21263_19.xhtml#_idTextAnchor375"><em class="italic">Chapter 19</em></a>, <em class="italic">Generation Data Persistence</em>, shows you how to save image generation prompts and parameters into the generated PNG image.</p>
			<p><a href="B21263_20.xhtml#_idTextAnchor387"><em class="italic">Chapter 20</em></a>, <em class="italic">Creating Interactive User Interfaces</em>, shows you how to build a Stable Diffusion WebUI using the open source framework Gradio.</p>
			<p><a href="B21263_21.xhtml#_idTextAnchor405"><em class="italic">Chapter 21</em></a>, <em class="italic">Diffusion Model Transfer Learning</em>, covers how to train a Stable Diffusion LoRA from scratch.</p>
			<p><a href="B21263_22.xhtml#_idTextAnchor443"><em class="italic">Chapter 22</em></a>, <em class="italic">Exploring Beyond Stable Diffusion</em>, provides additional information about Stable Diffusion, AI, and how to learn more about the latest developments.</p>
			<h1 id="_idParaDest-9"><a id="_idTextAnchor008"/>To get the most out of this book</h1>
			<p>You will need to have some experience with the Python programming language. Familiarity with neural networks and PyTorch will be helpful for reading and running up the code in this book.</p>
			<p class="callout-heading">Disclaimer:</p>
			<p class="callout">This book has been written keeping in mind ethical practices and regulations. Please avoid utilizing the knowledge that you will get here for any unethical purposes. Please refer to <a href="B21263_22.xhtml#_idTextAnchor443"><em class="italic">Chapter 22</em></a> for an in-depth review of the ethics of using AI.</p>
			<table id="table001" class="No-Table-Style">
				<colgroup>
					<col/>
					<col/>
				</colgroup>
				<tbody>
					<tr class="No-Table-Style">
						<td class="No-Table-Style">
							<p><strong class="bold">Software/hardware covered in </strong><strong class="bold">the book</strong></p>
						</td>
						<td class="No-Table-Style">
							<p><strong class="bold">Operating </strong><strong class="bold">system requirements</strong></p>
						</td>
					</tr>
					<tr class="No-Table-Style">
						<td class="No-Table-Style">
							<p>Python 3.10+</p>
						</td>
						<td class="No-Table-Style">
							<p>Linux, Windows, or macOS</p>
						</td>
					</tr>
					<tr class="No-Table-Style">
						<td class="No-Table-Style">
							<p>Nvidia GPU (Apple M chips may work, but Nvidia GPU is highly recommended)</p>
						</td>
						<td class="No-Table-Style"/>
					</tr>
					<tr class="No-Table-Style">
						<td class="No-Table-Style">
							<p>Hugging Face Diffusers</p>
						</td>
						<td class="No-Table-Style"/>
					</tr>
				</tbody>
			</table>
			<p>Please turn to <a href="B21263_02.xhtml#_idTextAnchor037"><em class="italic">Chapter 2</em></a> for detailed steps to set up the environment.</p>
			<p><strong class="bold">If you are using the digital version of this book, we advise you to type the code yourself or access the code from the book’s GitHub repository (a link is available in the next section). Doing so will help you avoid any potential errors related to the copying and pasting </strong><strong class="bold">of code.</strong></p>
			<h1 id="_idParaDest-10"><a id="_idTextAnchor009"/>Download the example code files</h1>
			<p>You can download the example code files for this book from GitHub at <a href="https://github.com/PacktPublishing/Using-Stable-Diffusion-with-Python">https://github.com/PacktPublishing/Using-Stable-Diffusion-with-Python</a>. If there’s an update to the code, it will be updated in the GitHub repository.</p>
			<p>We also have other code bundles from our rich catalog of books and videos available at <a href="https://github.com/PacktPublishing/">https://github.com/PacktPublishing/</a>. Check them out!</p>
			<h1 id="_idParaDest-11"><a id="_idTextAnchor010"/>Conventions used</h1>
			<p>There are a number of text conventions used throughout this book.</p>
			<p><code>Code in text</code>: Indicates code words in text, database table names, folder names, filenames, file extensions, pathnames, dummy URLs, user input, and Twitter handles. Here is an example: “Here, let’s use the <code>controlnet-openpose-sdxl-1.0</code> open pose ControlNet for SDXL.”</p>
			<p>A block of code is set as follows:</p>
			<pre class="source-code">
import torch
from diffusers import StableDiffusionPipeline
# load model
text2img_pipe = StableDiffusionPipeline.from_pretrained(
    "stablediffusionapi/deliberate-v2",
    torch_dtype = torch.float16
).to("cuda:0")</pre>
			<p>Any command-line input or output is written as follows:</p>
			<pre class="console">
$ pip install pandas</pre>
			<p><strong class="bold">Bold</strong>: Indicates a new term, an important word, or words that you see onscreen. For instance, words in menus or dialog boxes appear in <strong class="bold">bold</strong>. Here is an example: “After clicking the <strong class="bold">Run</strong> button, the progress bar will appear in the position of the output textbox.”</p>
			<p class="callout-heading">Tips or important notes</p>
			<p class="callout">Appear like this.</p>
			<h1 id="_idParaDest-12"><a id="_idTextAnchor011"/>Get in touch</h1>
			<p>Feedback from our readers is always welcome.</p>
			<p><code>customercare@packtpub.com</code> and mention the book title in the subject of your message.</p>
			<p><strong class="bold">Errata</strong>: Although we have taken every care to ensure the accuracy of our content, mistakes do happen. If you have found a mistake in this book, we would be grateful if you would report this to us. Please visit <a href="http://www.packtpub.com/support/errata">www.packtpub.com/support/errata</a> and fill in the form.</p>
			<p><code>copyright@packt.com</code> with a link to the material.</p>
			<p><strong class="bold">If you are interested in becoming an author</strong>: If there is a topic that you have expertise in and you are interested in either writing or contributing to a book, please visit <a href="http://authors.packtpub.com">authors.packtpub.com</a>.</p>
			<h1 id="_idParaDest-13"><a id="_idTextAnchor012"/>Share Your Thoughts</h1>
			<p>Once you’ve read <em class="italic">Using Stable Diffusion with Python</em>, we’d love to hear your thoughts! Please <a href="https://packt.link/r/1-835-08637-3">click here to go straight to the Amazon review page</a> for this book and share your feedback.</p>
			<p>Your review is important to us and the tech community and will help us make sure we’re delivering excellent quality content.</p>
			<h1 id="_idParaDest-14"><a id="_idTextAnchor013"/>Download a free PDF copy of this book</h1>
			<p>Thanks for purchasing this book!</p>
			<p>Do you like to read on the go but are unable to carry your print books everywhere?</p>
			<p>Is your eBook purchase not compatible with the device of your choice?</p>
			<p>Don’t worry, now with every Packt book you get a DRM-free PDF version of that book at no cost.</p>
			<p>Read anywhere, any place, on any device. Search, copy, and paste code from your favorite technical books directly into your application. </p>
			<p>The perks don’t stop there, you can get exclusive access to discounts, newsletters, and great free content in your inbox daily</p>
			<p>Follow these simple steps to get the benefits:</p>
			<ol>
				<li>Scan the QR code or visit the link below</li>
			</ol>
			<div><div><img src="img/B21263_QR_Free_PDF.jpg" alt="" role="presentation"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><a href="https://packt.link/free-ebook/9781835086377">https://packt.link/free-ebook/9781835086377</a></p>
			<ol>
				<li value="2">Submit your proof of purchase</li>
				<li>That’s it! We’ll send your free PDF and other benefits to your email directly</li>
			</ol>
		</div>
	

		<div><h1 id="_idParaDest-15" lang="en-US" xml:lang="en-US"><a id="_idTextAnchor014"/>Part 1 – A Whirlwind of Stable Diffusion</h1>
			<p>Welcome to the fascinating world of Stable Diffusion, a rapidly evolving field that has revolutionized the way we approach image generation and manipulation. In the first part of our journey, we’ll embark on a comprehensive exploration of the fundamentals, laying the groundwork for a deep understanding of this powerful technology.</p>
			<p>Over the next six chapters, we’ll delve into the core concepts, principles, and applications of Stable Diffusion, providing a solid foundation for further experimentation and innovation. We’ll begin by introducing the basics of Stable Diffusion, followed by a hands-on guide to setting up your environment for success. You’ll then learn how to generate stunning images using Stable Diffusion, before diving deeper into the theoretical underpinnings of diffusion models and the intricacies of how Stable Diffusion works its magic.</p>
			<p>By the end of this part, you’ll possess a broad understanding of Stable Diffusion, from its underlying mechanics to practical applications, empowering you to harness its potential and create remarkable visual content. So, let’s dive in and discover the wonders of Stable Diffusion!</p>
			<p>This part contains the following chapters:</p>
			<ul>
				<li><a href="B21263_01.xhtml#_idTextAnchor015"><em class="italic">Chapter 1</em></a>, <em class="italic">Introducing Stable Diffusion</em></li>
				<li><a href="B21263_02.xhtml#_idTextAnchor037"><em class="italic">Chapter 2</em></a>, <em class="italic">Setup Environment for Stable Diffusion</em></li>
				<li><a href="B21263_03.xhtml#_idTextAnchor064"><em class="italic">Chapter 3</em></a>, <em class="italic">Generate Images Using Stable Diffusion</em></li>
				<li><a href="B21263_04.xhtml#_idTextAnchor081"><em class="italic">Chapter 4</em></a>, <em class="italic">Understand the Theory behind the Diffusion Models</em></li>
				<li><a href="B21263_05.xhtml#_idTextAnchor097"><em class="italic">Chapter 5</em></a>, <em class="italic">Understanding How Stable Diffusion Works</em></li>
				<li><a href="B21263_06.xhtml#_idTextAnchor117"><em class="italic">Chapter 6</em></a>, <em class="italic">Using the Stable Diffusion Model</em></li>
			</ul>
		</div>
		<div><div></div>
		</div>
		<div><div></div>
		</div>
		<div><div></div>
		</div>
		<div><div></div>
		</div>
		<div><div></div>
		</div>
	</body></html>