<html><head></head><body>
		<div id="_idContainer004">
			<h1 id="_idParaDest-6"><a id="_idTextAnchor005"/>Preface</h1>
			<p>When Stable Diffusion was released on August 22, 2022, this Diffusion-based image generation model quickly caught the attention of the whole world. Both its model and source code are completely open source and hosted on GitHub. With millions of community participants and users, numerous new and mixed models have been released. Tools such as Stable Diffusion WebUI and InvokeAI have <span class="No-Break">been created.</span></p>
			<p>While the Stable Diffusion WebUI tool can generate fantastic images driven by the diffusion model, its usability is limited. The open source Diffusers package from Hugging Face allows users to have full control over Stable Diffusion using Python. However, it lacks many key features, such as loading custom LoRA models and Textual Inversion, utilizing community-shared models/checkpoints, scheduling and weighted prompts, unlimited prompt tokens, fixing the resolution of the images, and upscaling. This book will assist you in overcoming the limitations of Diffusers and implementing the advanced features to create a fully customized and industrial-level Stable <span class="No-Break">Diffusion application.</span></p>
			<p>By the end of this book, you will be able to not only use Python to generate and edit images but also leverage the solutions provided in the book to build Stable Diffusion applications for your business <span class="No-Break">and users.</span></p>
			<h1 id="_idParaDest-7"><a id="_idTextAnchor006"/>Who this book is for</h1>
			<p>This book is for AI image and art generation enthusiasts who want to gain a comprehensive understanding of how image generation and diffusion <span class="No-Break">models work.</span></p>
			<p>It is also for artists who are interested in fully understanding AI image generation and gaining precise control over the <span class="No-Break">Diffusion model.</span></p>
			<p>Python application developers who aim to create AI image generation applications based on Stable Diffusion will also find this <span class="No-Break">book helpful.</span></p>
			<p>Finally, this book is aimed at data scientists, machine learning engineers, and researchers who want to programmatically control the Stable Diffusion process, automate pipelines, build custom pipelines, and conduct testing and validation <span class="No-Break">using Python.</span></p>
			<h1 id="_idParaDest-8"><a id="_idTextAnchor007"/>What this book covers</h1>
			<p><a href="B21263_01.xhtml#_idTextAnchor015"><span class="No-Break"><em class="italic">Chapter 1</em></span></a>, <em class="italic">Introducing Stable Diffusion</em>, provides an introduction to the AI image generation technology <span class="No-Break">Stable Diffusion.</span></p>
			<p><a href="B21263_02.xhtml#_idTextAnchor037"><span class="No-Break"><em class="italic">Chapter 2</em></span></a>, <em class="italic">Setting Up an Environment for Stable Diffusion</em>, covers how to set up the CUDA and Python environments to run Stable <span class="No-Break">Diffusion models.</span></p>
			<p><a href="B21263_03.xhtml#_idTextAnchor064"><span class="No-Break"><em class="italic">Chapter 3</em></span></a>, <em class="italic">Generate Images Using Stable Diffusion</em>, is a whirlwind chapter that helps you start using Python to generate images with <span class="No-Break">Stable Diffusion.</span></p>
			<p><a href="B21263_04.xhtml#_idTextAnchor081"><span class="No-Break"><em class="italic">Chapter 4</em></span></a>, <em class="italic">Understand the Theory behind the Diffusion Models</em>, digs into the internals of the <span class="No-Break">Diffusion model.</span></p>
			<p><a href="B21263_05.xhtml#_idTextAnchor097"><span class="No-Break"><em class="italic">Chapter 5</em></span></a>, <em class="italic">Understanding How Stable Diffusion Works</em>, covers the theory behind <span class="No-Break">Stable Diffusion.</span></p>
			<p><a href="B21263_06.xhtml#_idTextAnchor117"><span class="No-Break"><em class="italic">Chapter 6</em></span></a>, <em class="italic">Using the Stable Diffusion Model</em>, covers model data handling and converting and loading <span class="No-Break">model files.</span></p>
			<p><a href="B21263_07.xhtml#_idTextAnchor136"><span class="No-Break"><em class="italic">Chapter 7</em></span></a>, <em class="italic">Optimizing Performance and VRAM Usage</em>, teaches you how to improve performance and reduce <span class="No-Break">VRAM usage.</span></p>
			<p><a href="B21263_08.xhtml#_idTextAnchor153"><span class="No-Break"><em class="italic">Chapter 8</em></span></a>, <em class="italic">Using Community-Shared LoRAs</em>, shows you how to use the community-shared LoRAs with Stable Diffusion <span class="No-Break">checkpoint models.</span></p>
			<p><a href="B21263_09.xhtml#_idTextAnchor178"><span class="No-Break"><em class="italic">Chapter 9</em></span></a>, <em class="italic">Using Textual Inversion</em>, uses the community-shared Textual Inversion with Stable Diffusion <span class="No-Break">checkpoint models.</span></p>
			<p><a href="B21263_10.xhtml#_idTextAnchor197"><span class="No-Break"><em class="italic">Chapter 10</em></span></a>, <em class="italic">Unlocking 77 Token Limitations and Enabling Prompt Weighting</em>, covers how to build custom prompt-handling code to use unlimited-size prompts with weighted importance scores. Specifically, we'll explore how to assign different weights to individual prompts or tokens, allowing us to fine-tune the model's attention and generate more <span class="No-Break">accurate results.</span></p>
			<p><a href="B21263_11.xhtml#_idTextAnchor214"><span class="No-Break"><em class="italic">Chapter 11</em></span></a>, <em class="italic">Image Restore and Super-Resolution</em>, shows you how to fix and upscale images using <span class="No-Break">Stable Diffusion.</span></p>
			<p><a href="B21263_12.xhtml#_idTextAnchor240"><span class="No-Break"><em class="italic">Chapter 12</em></span></a>, <em class="italic">Scheduled Prompt Parsing</em>, shows you how to build a custom pipeline to support <span class="No-Break">scheduled prompts.</span></p>
			<p><a href="B21263_13.xhtml#_idTextAnchor257"><span class="No-Break"><em class="italic">Chapter 13</em></span></a>, <em class="italic">Generating Images with ControlNet</em>, covers how to use ControlNet with Stable Diffusion <span class="No-Break">checkpoint models.</span></p>
			<p><a href="B21263_14.xhtml#_idTextAnchor277"><span class="No-Break"><em class="italic">Chapter 14</em></span></a>, <em class="italic">Generating Video Using Stable Diffusion</em>, shows you how to use AnimateDiff together with Stable Diffusion to generate a short video clip and understand the theory behind the <span class="No-Break">video generation.</span></p>
			<p><a href="B21263_15.xhtml#_idTextAnchor289"><span class="No-Break"><em class="italic">Chapter 15</em></span></a>, <em class="italic">Generating Image Descriptions Using BLIP-2 and LLaVA</em>, covers how to use large language models (LLMs) to extract descriptions <span class="No-Break">from images.</span></p>
			<p><a href="B21263_16.xhtml#_idTextAnchor309"><span class="No-Break"><em class="italic">Chapter 16</em></span></a>, <em class="italic">Exploring Stable Diffusion XL</em>, shows you how to start using Stable Diffusion XL, a newer and better Stable <span class="No-Break">Diffusion model.</span></p>
			<p><a href="B21263_17.xhtml#_idTextAnchor335"><span class="No-Break"><em class="italic">Chapter 17</em></span></a>, <em class="italic">Building Optimized Prompts for Stable Diffusion</em>, discusses techniques to write up Stable Diffusion prompts to generate better images, as well as leveraging LLMs to help generate <span class="No-Break">prompts automatically.</span></p>
			<p><a href="B21263_18.xhtml#_idTextAnchor357"><span class="No-Break"><em class="italic">Chapter 18</em></span></a>, <em class="italic">Applications: Object Editing and Style Transferring</em>, covers how to use Stable Diffusion and related machine learning models to edit images and transfer styles from one image <span class="No-Break">to another.</span></p>
			<p><a href="B21263_19.xhtml#_idTextAnchor375"><span class="No-Break"><em class="italic">Chapter 19</em></span></a>, <em class="italic">Generation Data Persistence</em>, shows you how to save image generation prompts and parameters into the generated <span class="No-Break">PNG image.</span></p>
			<p><a href="B21263_20.xhtml#_idTextAnchor387"><span class="No-Break"><em class="italic">Chapter 20</em></span></a>, <em class="italic">Creating Interactive User Interfaces</em>, shows you how to build a Stable Diffusion WebUI using the open source <span class="No-Break">framework Gradio.</span></p>
			<p><a href="B21263_21.xhtml#_idTextAnchor405"><span class="No-Break"><em class="italic">Chapter 21</em></span></a>, <em class="italic">Diffusion Model Transfer Learning</em>, covers how to train a Stable Diffusion LoRA <span class="No-Break">from scratch.</span></p>
			<p><a href="B21263_22.xhtml#_idTextAnchor443"><span class="No-Break"><em class="italic">Chapter 22</em></span></a>, <em class="italic">Exploring Beyond Stable Diffusion</em>, provides additional information about Stable Diffusion, AI, and how to learn more about the <span class="No-Break">latest developments.</span></p>
			<h1 id="_idParaDest-9"><a id="_idTextAnchor008"/>To get the most out of this book</h1>
			<p>You will need to have some experience with the Python programming language. Familiarity with neural networks and PyTorch will be helpful for reading and running up the code in <span class="No-Break">this book.</span></p>
			<p class="callout-heading">Disclaimer:</p>
			<p class="callout">This book has been written keeping in mind ethical practices and regulations. Please avoid utilizing the knowledge that you will get here for any unethical purposes. Please refer to <a href="B21263_22.xhtml#_idTextAnchor443"><em class="italic">Chapter 22</em></a> for an in-depth review of the ethics of using AI.</p>
			<table id="table001" class="No-Table-Style">
				<colgroup>
					<col/>
					<col/>
				</colgroup>
				<tbody>
					<tr class="No-Table-Style">
						<td class="No-Table-Style">
							<p><strong class="bold">Software/hardware covered in </strong><span class="No-Break"><strong class="bold">the book</strong></span></p>
						</td>
						<td class="No-Table-Style">
							<p><strong class="bold">Operating </strong><span class="No-Break"><strong class="bold">system requirements</strong></span></p>
						</td>
					</tr>
					<tr class="No-Table-Style">
						<td class="No-Table-Style">
							<p><span class="No-Break">Python 3.10+</span></p>
						</td>
						<td class="No-Table-Style">
							<p>Linux, Windows, <span class="No-Break">or macOS</span></p>
						</td>
					</tr>
					<tr class="No-Table-Style">
						<td class="No-Table-Style">
							<p>Nvidia GPU (Apple M chips may work, but Nvidia GPU is <span class="No-Break">highly recommended)</span></p>
						</td>
						<td class="No-Table-Style"/>
					</tr>
					<tr class="No-Table-Style">
						<td class="No-Table-Style">
							<p>Hugging <span class="No-Break">Face Diffusers</span></p>
						</td>
						<td class="No-Table-Style"/>
					</tr>
				</tbody>
			</table>
			<p>Please turn to <a href="B21263_02.xhtml#_idTextAnchor037"><span class="No-Break"><em class="italic">Chapter 2</em></span></a> for detailed steps to set up <span class="No-Break">the environment.</span></p>
			<p><strong class="bold">If you are using the digital version of this book, we advise you to type the code yourself or access the code from the book’s GitHub repository (a link is available in the next section). Doing so will help you avoid any potential errors related to the copying and pasting </strong><span class="No-Break"><strong class="bold">of code.</strong></span></p>
			<h1 id="_idParaDest-10"><a id="_idTextAnchor009"/>Download the example code files</h1>
			<p>You can download the example code files for this book from GitHub at <a href="https://github.com/PacktPublishing/Using-Stable-Diffusion-with-Python">https://github.com/PacktPublishing/Using-Stable-Diffusion-with-Python</a>. If there’s an update to the code, it will be updated in the <span class="No-Break">GitHub repository.</span></p>
			<p>We also have other code bundles from our rich catalog of books and videos available at <a href="https://github.com/PacktPublishing/">https://github.com/PacktPublishing/</a>. Check <span class="No-Break">them out!</span></p>
			<h1 id="_idParaDest-11"><a id="_idTextAnchor010"/>Conventions used</h1>
			<p>There are a number of text conventions used throughout <span class="No-Break">this book.</span></p>
			<p><strong class="source-inline">Code in text</strong>: Indicates code words in text, database table names, folder names, filenames, file extensions, pathnames, dummy URLs, user input, and Twitter handles. Here is an example: “Here, let’s use the <strong class="source-inline">controlnet-openpose-sdxl-1.0</strong> open pose ControlNet <span class="No-Break">for SDXL.”</span></p>
			<p>A block of code is set <span class="No-Break">as follows:</span></p>
			<pre class="source-code">
import torch
from diffusers import StableDiffusionPipeline
# load model
text2img_pipe = StableDiffusionPipeline.from_pretrained(
    "stablediffusionapi/deliberate-v2",
    torch_dtype = torch.float16
).to("cuda:0")</pre>
			<p>Any command-line input or output is written <span class="No-Break">as follows:</span></p>
			<pre class="console">
$ pip install pandas</pre>
			<p><strong class="bold">Bold</strong>: Indicates a new term, an important word, or words that you see onscreen. For instance, words in menus or dialog boxes appear in <strong class="bold">bold</strong>. Here is an example: “After clicking the <strong class="bold">Run</strong> button, the progress bar will appear in the position of the <span class="No-Break">output textbox.”</span></p>
			<p class="callout-heading">Tips or important notes</p>
			<p class="callout">Appear like this.</p>
			<h1 id="_idParaDest-12"><a id="_idTextAnchor011"/>Get in touch</h1>
			<p>Feedback from our readers is <span class="No-Break">always welcome.</span></p>
			<p><strong class="bold">General feedback</strong>: If you have questions about any aspect of this book, email us at <strong class="source-inline">customercare@packtpub.com</strong> and mention the book title in the subject of <span class="No-Break">your message.</span></p>
			<p><strong class="bold">Errata</strong>: Although we have taken every care to ensure the accuracy of our content, mistakes do happen. If you have found a mistake in this book, we would be grateful if you would report this to us. Please visit <a href="http://www.packtpub.com/support/errata">www.packtpub.com/support/errata</a> and fill in <span class="No-Break">the form.</span></p>
			<p><strong class="bold">Piracy</strong>: If you come across any illegal copies of our works in any form on the internet, we would be grateful if you would provide us with the location address or website name. Please contact us at <strong class="source-inline">copyright@packt.com</strong> with a link to <span class="No-Break">the material.</span></p>
			<p><strong class="bold">If you are interested in becoming an author</strong>: If there is a topic that you have expertise in and you are interested in either writing or contributing to a book, please <span class="No-Break">visit </span><a href="http://authors.packtpub.com"><span class="No-Break">authors.packtpub.com</span></a><span class="No-Break">.</span></p>
			<h1 id="_idParaDest-13"><a id="_idTextAnchor012"/>Share Your Thoughts</h1>
			<p>Once you’ve read <em class="italic">Using Stable Diffusion with Python</em>, we’d love to hear your thoughts! Please <a href="https://packt.link/r/1-835-08637-3">click here to go straight to the Amazon review page</a> for this book and share <span class="No-Break">your feedback.</span></p>
			<p>Your review is important to us and the tech community and will help us make sure we’re delivering excellent <span class="No-Break">quality content.</span></p>
			<h1 id="_idParaDest-14"><a id="_idTextAnchor013"/>Download a free PDF copy of this book</h1>
			<p>Thanks for purchasing <span class="No-Break">this book!</span></p>
			<p>Do you like to read on the go but are unable to carry your print <span class="No-Break">books everywhere?</span></p>
			<p>Is your eBook purchase not compatible with the device of <span class="No-Break">your choice?</span></p>
			<p>Don’t worry, now with every Packt book you get a DRM-free PDF version of that book at <span class="No-Break">no cost.</span></p>
			<p>Read anywhere, any place, on any device. Search, copy, and paste code from your favorite technical books directly into your application. </p>
			<p>The perks don’t stop there, you can get exclusive access to discounts, newsletters, and great free content in your <span class="No-Break">inbox daily</span></p>
			<p>Follow these simple steps to get <span class="No-Break">the benefits:</span></p>
			<ol>
				<li>Scan the QR code or visit the <span class="No-Break">link below</span></li>
			</ol>
			<div>
				<div id="_idContainer003" class="IMG---Figure">
					<img src="image/B21263_QR_Free_PDF.jpg" alt="" role="presentation"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><a href="https://packt.link/free-ebook/9781835086377">https://packt.link/free-ebook/9781835086377</a></p>
			<ol>
				<li value="2">Submit your proof <span class="No-Break">of purchase</span></li>
				<li>That’s it! We’ll send your free PDF and other benefits to your <span class="No-Break">email directly</span></li>
			</ol>
		</div>
	

		<div id="_idContainer005" class="Content">
			<h1 id="_idParaDest-15" lang="en-US" xml:lang="en-US"><a id="_idTextAnchor014"/>Part 1 – A Whirlwind of Stable Diffusion</h1>
			<p>Welcome to the fascinating world of Stable Diffusion, a rapidly evolving field that has revolutionized the way we approach image generation and manipulation. In the first part of our journey, we’ll embark on a comprehensive exploration of the fundamentals, laying the groundwork for a deep understanding of this <span class="No-Break">powerful technology.</span></p>
			<p>Over the next six chapters, we’ll delve into the core concepts, principles, and applications of Stable Diffusion, providing a solid foundation for further experimentation and innovation. We’ll begin by introducing the basics of Stable Diffusion, followed by a hands-on guide to setting up your environment for success. You’ll then learn how to generate stunning images using Stable Diffusion, before diving deeper into the theoretical underpinnings of diffusion models and the intricacies of how Stable Diffusion works <span class="No-Break">its magic.</span></p>
			<p>By the end of this part, you’ll possess a broad understanding of Stable Diffusion, from its underlying mechanics to practical applications, empowering you to harness its potential and create remarkable visual content. So, let’s dive in and discover the wonders of <span class="No-Break">Stable Diffusion!</span></p>
			<p>This part contains the <span class="No-Break">following chapters:</span></p>
			<ul>
				<li><a href="B21263_01.xhtml#_idTextAnchor015"><em class="italic">Chapter 1</em></a>, <em class="italic">Introducing Stable Diffusion</em></li>
				<li><a href="B21263_02.xhtml#_idTextAnchor037"><em class="italic">Chapter 2</em></a>, <em class="italic">Setup Environment for Stable Diffusion</em></li>
				<li><a href="B21263_03.xhtml#_idTextAnchor064"><em class="italic">Chapter 3</em></a>, <em class="italic">Generate Images Using Stable Diffusion</em></li>
				<li><a href="B21263_04.xhtml#_idTextAnchor081"><em class="italic">Chapter 4</em></a>, <em class="italic">Understand the Theory behind the Diffusion Models</em></li>
				<li><a href="B21263_05.xhtml#_idTextAnchor097"><em class="italic">Chapter 5</em></a>, <em class="italic">Understanding How Stable Diffusion Works</em></li>
				<li><a href="B21263_06.xhtml#_idTextAnchor117"><em class="italic">Chapter 6</em></a>, <em class="italic">Using the Stable Diffusion Model</em></li>
			</ul>
		</div>
		<div>
			<div id="_idContainer006">
			</div>
		</div>
		<div>
			<div id="_idContainer007" class="Basic-Graphics-Frame">
			</div>
		</div>
		<div>
			<div id="_idContainer008" class="Basic-Graphics-Frame">
			</div>
		</div>
		<div>
			<div id="_idContainer009">
			</div>
		</div>
		<div>
			<div id="_idContainer010" class="Basic-Graphics-Frame">
			</div>
		</div>
	</body></html>