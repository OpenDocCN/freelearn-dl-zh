<html><head></head><body>
  <div id="_idContainer142">
   <h1 class="chapter-number" id="_idParaDest-146">
    <a id="_idTextAnchor148">
    </a>
    <span class="koboSpan" id="kobo.1.1">
     8
    </span>
   </h1>
   <h1 id="_idParaDest-147">
    <a id="_idTextAnchor149">
    </a>
    <span class="koboSpan" id="kobo.2.1">
     Setting Up a Behavior Tree
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.3.1">
     Understanding how to properly set up a behavior tree is crucial for developing effective AI systems in your games.
    </span>
    <span class="koboSpan" id="kobo.3.2">
     As you have seen from the previous chapter, behavior trees serve as a powerful tool to define the logic and decision-making processes of AI characters, allowing developers to create complex behaviors in a structured and manageable manner.
    </span>
    <span class="koboSpan" id="kobo.3.3">
     This chapter will provide valuable insights into the fundamentals of behavior trees’ implementation and their inner workings in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.4.1">
      Unreal Engine.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.5.1">
     In this chapter, we will be covering the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.6.1">
      following topics:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.7.1">
      Extending the Unreal
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.8.1">
       Agility Arena
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.9.1">
      Creating a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.10.1">
       behavior tree
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.11.1">
      Implementing behavior tree tasks
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.12.1">
       and services
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.13.1">
      Setting up a behavior tree on
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.14.1">
       an agent
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-148">
    <a id="_idTextAnchor150">
    </a>
    <span class="koboSpan" id="kobo.15.1">
     Technical requirements
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.16.1">
     To follow along with this chapter, you’ll need to use the starter content available in this book’s companion repository, located at
    </span>
    <a href="https://github.com/PacktPublishing/Artificial-Intelligence-in-Unreal-Engine-5">
     <span class="koboSpan" id="kobo.17.1">
      https://github.com/PacktPublishing/Artificial-Intelligence-in-Unreal-Engine-5
     </span>
    </a>
    <span class="koboSpan" id="kobo.18.1">
     .
    </span>
    <span class="koboSpan" id="kobo.18.2">
     Through this link, locate the section for this chapter and download the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.19.1">
      Unreal Agility Arena – Starter Content
     </span>
    </strong>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.20.1">
      ZIP file.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.21.1">
     If you somehow get lost during the progress of this chapter, in the repository, you will also find the up-to-date project files at
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.22.1">
      Unreal Agility Arena –
     </span>
    </strong>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.23.1">
       Chapter
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.24.1">
       08
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.25.1">
       End
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.26.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.27.1">
     Also, to fully understand this chapter, it is necessary to have some basic knowledge about Blueprint visual scripting and C++; as an extra piece of advice, you may want to take a peek at
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.28.1">
      Appendix A
     </span>
    </em>
    <span class="koboSpan" id="kobo.29.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.30.1">
      Understanding C++ in Unreal Engine
     </span>
    </em>
    <span class="koboSpan" id="kobo.31.1">
     , for a gentle introduction (or a refresher) on the C++ syntax in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.32.1">
      Unreal Engine.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-149">
    <a id="_idTextAnchor151">
    </a>
    <span class="koboSpan" id="kobo.33.1">
     Extending the Unreal Agility Arena
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.34.1">
     To get started, let’s continue exploring the short novel we introduced in
    </span>
    <a href="B31016_04.xhtml#_idTextAnchor073">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.35.1">
        Chapter 4
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.36.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.37.1">
      Setting Up a
     </span>
    </em>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.38.1">
       Navigation Mesh
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.39.1">
      :
     </span>
    </span>
   </p>
   <p>
    <em class="italic">
     <span class="koboSpan" id="kobo.40.1">
      As Dr.
     </span>
     <span class="koboSpan" id="kobo.40.2">
      Markus and his trusty assistant Professor Viktoria continued to refine their AI dummy puppets, they stumbled upon an intriguing challenge: the limited power supply of the puppets’ batteries.
     </span>
     <span class="koboSpan" id="kobo.40.3">
      It seemed that the advanced AI technology consumed energy at an alarming rate, causing the puppets to shut
     </span>
    </em>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.41.1">
       down unexpectedly.
      </span>
     </em>
    </span>
   </p>
   <p>
    <em class="italic">
     <span class="koboSpan" id="kobo.42.1">
      Undeterred by this setback, Dr.
     </span>
     <span class="koboSpan" id="kobo.42.2">
      Markus saw an opportunity to turn this limitation into a unique aspect of the puppets’ behavior.
     </span>
     <span class="koboSpan" id="kobo.42.3">
      He theorized that the puppets’ interactions, when powered by dwindling battery life, would mimic human fatigue and exhaustion.
     </span>
     <span class="koboSpan" id="kobo.42.4">
      With great excitement, Dr.
     </span>
     <span class="koboSpan" id="kobo.42.5">
      Markus and Professor Viktoria devised a plan to create a new series of experiments centered around the puppets’ limited
     </span>
    </em>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.43.1">
       power supply.
      </span>
     </em>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.44.1">
     After learning all that information in the last chapter, it’s time to dive in and begin crafting your own AI agents, equipped with fully functional behavior trees.
    </span>
    <span class="koboSpan" id="kobo.44.2">
     To keep things simple and clean, I will start with a brand-new project, but you are free to continue developing the work you started in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.45.1">
      previous chapters.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.46.1">
     To start, I will give you some short information on what will
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.47.1">
      be created.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-150">
    <a id="_idTextAnchor152">
    </a>
    <span class="koboSpan" id="kobo.48.1">
     Updating the project brief
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.49.1">
     As a starting point, you will need to create a new dummy character (the one from previous chapters is too limited) that will need to implement some base logic.
    </span>
    <span class="koboSpan" id="kobo.49.2">
     This will let you extend its basic functionality once we start creating more
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.50.1">
      advanced characters.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.51.1">
     The main requisites are listed
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.52.1">
      as follows:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.53.1">
      The AI agent will be implemented
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.54.1">
       in C++
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.55.1">
      It will have the ability to move at two different speeds – walking
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.56.1">
       and running
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.57.1">
      It will be provided with a battery system that will consume energy when walking and recharge when
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.58.1">
       standing still
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.59.1">
      It will need to be controlled by a custom
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.60.1">
       AIController
      </span>
     </strong>
     <span class="koboSpan" id="kobo.61.1">
      class that will use
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.62.1">
       behavior trees
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.63.1">
     Once the character has been created, we will be able to start creating new gym levels to create and test new AI agent behaviors.
    </span>
    <span class="koboSpan" id="kobo.63.2">
     So, let’s start by creating
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.64.1">
      the project.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-151">
    <a id="_idTextAnchor153">
    </a>
    <span class="koboSpan" id="kobo.65.1">
     Creating the project
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.66.1">
     The project creation process is basically the same as the one we covered in
    </span>
    <a href="B31016_04.xhtml#_idTextAnchor073">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.67.1">
        Chapter 4
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.68.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.69.1">
      Setting Up a Navigation Mesh
     </span>
    </em>
    <span class="koboSpan" id="kobo.70.1">
     , so I won’t go much into detail about it; the distinction we will make (which is certainly not trivial) is the inclusion of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.71.1">
      C++ classes.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.72.1">
     Luckily, this is going to be a seamless transition, as when you create a new C++ class for the first time, Unreal Engine sets up the whole system for you.
    </span>
    <span class="koboSpan" id="kobo.72.2">
     Once the C++ project files have been generated, you should see the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.73.1">
      C++ Classes
     </span>
    </strong>
    <span class="koboSpan" id="kobo.74.1">
     folder in your
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.75.1">
      Content Browser
     </span>
    </strong>
    <span class="koboSpan" id="kobo.76.1">
     window, along with the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.77.1">
       Content
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.78.1">
      folder.
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer121">
     <span class="koboSpan" id="kobo.79.1">
      <img alt="Figure 8.1 – The C++ folder" src="image/B31016_figure_08.01.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.80.1">
     Figure 8.1 – The C++ folder
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.81.1">
     Note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.82.1">
     If the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.83.1">
      C++ Classes
     </span>
    </strong>
    <span class="koboSpan" id="kobo.84.1">
     folder does not appear in your
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.85.1">
      Content Browser
     </span>
    </strong>
    <span class="koboSpan" id="kobo.86.1">
     window, you will probably need to open the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.87.1">
      Settings
     </span>
    </strong>
    <span class="koboSpan" id="kobo.88.1">
     window and tick the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.89.1">
      Show C++ Classes
     </span>
    </strong>
    <span class="koboSpan" id="kobo.90.1">
     option, as shown in
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.91.1">
       Figure 8
      </span>
     </em>
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.92.1">
       .2
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.93.1">
      .
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer122">
     <span class="koboSpan" id="kobo.94.1">
      <img alt="img" role="presentation" src="image/B31016_figure_08.02.jpg"/>
     </span>
    </div>
   </div>
   <p class="callout">
    <span class="No-Break">
     <span class="koboSpan" id="kobo.95.1">
      Figure 8
     </span>
    </span>
    <span class="koboSpan" id="kobo.96.1">
     .2 – Enabling the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.97.1">
      C++ folder
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.98.1">
     Let’s start creating the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.99.1">
      character class.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-152">
    <a id="_idTextAnchor154">
    </a>
    <span class="koboSpan" id="kobo.100.1">
     Creating the character
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.101.1">
     The first thing we are going to
    </span>
    <a id="_idIndexMarker318">
    </a>
    <span class="koboSpan" id="kobo.102.1">
     do is to create the base character class for our prospective AI dummies.
    </span>
    <span class="koboSpan" id="kobo.102.2">
     To do so, follow
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.103.1">
      these steps:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.104.1">
      From the main menu of the Unreal Engine Editor, select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.105.1">
       Tools
      </span>
     </strong>
     <span class="koboSpan" id="kobo.106.1">
      |
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.107.1">
       New
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.108.1">
        C++ Class
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.109.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer123">
     <span class="koboSpan" id="kobo.110.1">
      <img alt="Figure 8.3 – Creating a C++ class" src="image/B31016_figure_08.03.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.111.1">
     Figure 8.3 – Creating a C++ class
    </span>
   </p>
   <ol>
    <li value="2">
     <span class="koboSpan" id="kobo.112.1">
      From the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.113.1">
       Add C++ Class
      </span>
     </strong>
     <span class="koboSpan" id="kobo.114.1">
      pop-up window, select the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.115.1">
       Character
      </span>
     </strong>
     <span class="koboSpan" id="kobo.116.1">
      option and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.117.1">
       click
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.118.1">
        Next
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.119.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer124">
     <span class="koboSpan" id="kobo.120.1">
      <img alt="Figure 8.4 – Class selection" src="image/B31016_figure_08.04.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.121.1">
     Figure 8.4 – Class selection
    </span>
   </p>
   <ol>
    <li value="3">
     <span class="koboSpan" id="kobo.122.1">
      In the following window, insert
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.123.1">
       BaseDummyCharacter
      </span>
     </strong>
     <span class="koboSpan" id="kobo.124.1">
      into the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.125.1">
       Name
      </span>
     </strong>
     <span class="koboSpan" id="kobo.126.1">
      field and leave the rest as
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.127.1">
       it is.
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer125">
     <span class="koboSpan" id="kobo.128.1">
      <img alt="Figure 8.5 – Class creation" src="image/B31016_figure_08.05.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.129.1">
     Figure 8.5 – Class creation
    </span>
   </p>
   <ol>
    <li value="4">
     <span class="koboSpan" id="kobo.130.1">
      Click the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.131.1">
       Create Class
      </span>
     </strong>
     <span class="koboSpan" id="kobo.132.1">
      button to
     </span>
     <a id="_idIndexMarker319">
     </a>
     <span class="koboSpan" id="kobo.133.1">
      start the class
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.134.1">
       creation process.
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.135.1">
     As this is the very first class you have created, Unreal will start generating the C++ project; after that, your IDE – most probably Visual Studio or Rider – will open, and you will be able to start developing
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.136.1">
      your class.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-153">
    <a id="_idTextAnchor155">
    </a>
    <span class="koboSpan" id="kobo.137.1">
     Handling the battery status
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.138.1">
     Before
    </span>
    <a id="_idIndexMarker320">
    </a>
    <span class="koboSpan" id="kobo.139.1">
     implementing the character, we need to define how its battery status will be tracked; that’s why we are going to create a simple enumeration class that will list how much the battery is charged.
    </span>
    <span class="koboSpan" id="kobo.139.2">
     To do this, follow
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.140.1">
      these steps:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.141.1">
      Inside your IDE, locate the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.142.1">
        UnrealAgilityArena/Source/UnrealAgilityArena
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.143.1">
       folder.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.144.1">
      Inside this folder, create a new text file and call
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.145.1">
       it
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.146.1">
        BatteryStatus.h
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.147.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.148.1">
      Open the file to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.149.1">
       edit it.
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.150.1">
     Inside the file, add this piece
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.151.1">
      of code:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.152.1">
#pragma once
UENUM(BlueprintType)
enum class EBatteryStatus : uint8
{
    EBS_Empty = 0 UMETA(DisplayName = "Empty"),
    EBS_Low = 1 UMETA(DisplayName = "Low"),
    EBS_Medium = 2 UMETA(DisplayName = "Medium"),
    EBS_Full = 3 UMETA(DisplayName = "Full")
};</span></pre>
   <p>
    <span class="koboSpan" id="kobo.153.1">
     I guess you are already familiar with what an enumeration does, but a short explanation here is mandatory; we are defining an
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.154.1">
      enum
     </span>
    </strong>
    <span class="koboSpan" id="kobo.155.1">
     class, which in Unreal Engine needs to be of type
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.156.1">
      uint8
     </span>
    </strong>
    <span class="koboSpan" id="kobo.157.1">
     , and we are listing four levels of battery charging –
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.158.1">
      Empty
     </span>
    </strong>
    <span class="koboSpan" id="kobo.159.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.160.1">
      Low
     </span>
    </strong>
    <span class="koboSpan" id="kobo.161.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.162.1">
      Medium
     </span>
    </strong>
    <span class="koboSpan" id="kobo.163.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.164.1">
      Full
     </span>
    </strong>
    <span class="koboSpan" id="kobo.165.1">
     .
    </span>
    <span class="koboSpan" id="kobo.165.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.166.1">
      UENUM()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.167.1">
     macro defines an
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.168.1">
      enum
     </span>
    </strong>
    <span class="koboSpan" id="kobo.169.1">
     class for the Unreal Engine framework, and the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.170.1">
      BlueprintType
     </span>
    </strong>
    <span class="koboSpan" id="kobo.171.1">
     specifier will expose it to the Blueprint system, making it usable for variables.
    </span>
    <span class="koboSpan" id="kobo.171.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.172.1">
      DisplayName
     </span>
    </strong>
    <span class="koboSpan" id="kobo.173.1">
     metadata defines how the value will be shown in the Blueprint system; you can use your own convention here if you
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.174.1">
      so desire.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.175.1">
     Finally, pay
    </span>
    <a id="_idIndexMarker321">
    </a>
    <span class="koboSpan" id="kobo.176.1">
     attention to the
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.177.1">
      E
     </span>
    </em>
    <span class="koboSpan" id="kobo.178.1">
     prefix in the name definition; this is the Unreal Engine naming convention for
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.179.1">
      enum
     </span>
    </strong>
    <span class="koboSpan" id="kobo.180.1">
     types, and it
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.181.1">
      is mandatory.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.182.1">
     With the battery status defined, we are ready to start implementing the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.183.1">
      dummy character.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-154">
    <a id="_idTextAnchor156">
    </a>
    <span class="koboSpan" id="kobo.184.1">
     Implementing the character
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.185.1">
     To start implementing the
    </span>
    <a id="_idIndexMarker322">
    </a>
    <span class="koboSpan" id="kobo.186.1">
     AI agent, open the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.187.1">
      BaseDummyCharacter.h
     </span>
    </strong>
    <span class="koboSpan" id="kobo.188.1">
     file – that is, the header for the agent class – and start adding the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.189.1">
      class definitions.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.190.1">
     As a first step, add the battery status definition at the top of the file, where all the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.191.1">
      #include
     </span>
    </strong>
    <span class="koboSpan" id="kobo.192.1">
     definitions
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.193.1">
      are set:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.194.1">
#include "BatteryStatus.h"</span></pre>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.195.1">
     Note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.196.1">
     All the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.197.1">
      #include
     </span>
    </strong>
    <span class="koboSpan" id="kobo.198.1">
     declarations you’ll be adding always need to be put before the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.199.1">
      .generated.h
     </span>
    </strong>
    <span class="koboSpan" id="kobo.200.1">
     definition – in this case,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.201.1">
      BaseDummyCharacter.generated.h
     </span>
    </strong>
    <span class="koboSpan" id="kobo.202.1">
     .
    </span>
    <span class="koboSpan" id="kobo.202.2">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.203.1">
      .generated.h
     </span>
    </strong>
    <span class="koboSpan" id="kobo.204.1">
     definition always needs to be the last in the declaration list; this convention ensures that all the necessary dependencies are properly set at
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.205.1">
      compilation time.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.206.1">
     Declaring properties
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.207.1">
     The second step is to add all the
    </span>
    <a id="_idIndexMarker323">
    </a>
    <span class="koboSpan" id="kobo.208.1">
     properties that will be exposed in the extending Blueprint classes.
    </span>
    <span class="koboSpan" id="kobo.208.2">
     To do so, under the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.209.1">
      public
     </span>
    </strong>
    <span class="koboSpan" id="kobo.210.1">
     section of the file, add the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.211.1">
      following declarations:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.212.1">
UPROPERTY(EditAnywhere, BlueprintReadWrite, Category = "Dummy Character")
float MaxBatteryLevel = 100.f;
UPROPERTY(EditAnywhere, BlueprintReadWrite, Category = "Dummy Character")
float BatteryCostPerTick = 5.f;
UPROPERTY(EditAnywhere, BlueprintReadWrite, Category = "Dummy Character")
float BatteryRechargePerTick = 1.f;
UPROPERTY(EditAnywhere, BlueprintReadWrite, Category = "Dummy Character")
float RunSpeed = 650.f;
UPROPERTY(EditAnywhere, BlueprintReadWrite, Category = "Dummy Character")
float WalkSpeed = 500.f;
UPROPERTY(EditAnywhere, BlueprintReadWrite, Category = "Dummy Character")
float MovementRandomDeviation = 5.f;</span></pre>
   <p>
    <span class="koboSpan" id="kobo.213.1">
     Here, we have declared a list of variables to handle
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.214.1">
      the agent:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.215.1">
       MaxBatteryLevel
      </span>
     </strong>
     <span class="koboSpan" id="kobo.216.1">
      : Represents the maximum value reachable by the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.217.1">
       agent battery
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.218.1">
       BatteryCostPerTick
      </span>
     </strong>
     <span class="koboSpan" id="kobo.219.1">
      : Represents how much battery power is spent by the agent while it
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.220.1">
       is moving
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.221.1">
       BatteryRechargePerTick
      </span>
     </strong>
     <span class="koboSpan" id="kobo.222.1">
      : Represents how much battery power is recovered when the agent
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.223.1">
       is resting
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.224.1">
       RunSpeed
      </span>
     </strong>
     <span class="koboSpan" id="kobo.225.1">
      : Represents the maximum speed reachable
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.226.1">
       when running
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.227.1">
       WalkSpeed
      </span>
     </strong>
     <span class="koboSpan" id="kobo.228.1">
      : Represents the maximum speed reachable
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.229.1">
       when walking
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.230.1">
       MovementRandomDeviation
      </span>
     </strong>
     <span class="koboSpan" id="kobo.231.1">
      : A value that will be randomly added or subtracted to the
     </span>
     <a id="_idIndexMarker324">
     </a>
     <span class="koboSpan" id="kobo.232.1">
      agent speed in order to make the movement pace
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.233.1">
       less predictable
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.234.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.235.1">
      UPROPERTY()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.236.1">
     macro is used to declare class properties with additional functionality and metadata.
    </span>
    <span class="koboSpan" id="kobo.236.2">
     It allows for easy integration with the Unreal Engine Editor, providing a visual interface to modify and configure these properties.
    </span>
    <span class="koboSpan" id="kobo.236.3">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.237.1">
      EditAnywhere
     </span>
    </strong>
    <span class="koboSpan" id="kobo.238.1">
     property specifier indicates that the property can be edited in property windows from the Unreal Engine Editor, while
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.239.1">
      BlueprintReadWrite
     </span>
    </strong>
    <span class="koboSpan" id="kobo.240.1">
     specifies that the property will be accessible from the extending Blueprint classes in read and write mode.
    </span>
    <span class="koboSpan" id="kobo.240.2">
     Finally, we want all the properties to be in the same category – that is,
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.241.1">
      Dummy Character
     </span>
    </strong>
    <span class="koboSpan" id="kobo.242.1">
     – and that’s why we have set the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.243.1">
      Category
     </span>
    </strong>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.244.1">
      property specifier.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.245.1">
     We need just one more variable, but this need not be public because it will be used for the actor’s inner logic.
    </span>
    <span class="koboSpan" id="kobo.245.2">
     In the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.246.1">
      protected
     </span>
    </strong>
    <span class="koboSpan" id="kobo.247.1">
     section, let’s add the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.248.1">
      following declaration:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.249.1">
UPROPERTY()
float BatteryLevel;</span></pre>
   <p>
    <span class="koboSpan" id="kobo.250.1">
     This self-explanatory
    </span>
    <a id="_idIndexMarker325">
    </a>
    <span class="koboSpan" id="kobo.251.1">
     attribute will be used to keep track of the actual battery level of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.252.1">
      the agent.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.253.1">
     Adding delegates
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.254.1">
     We now need to create an
    </span>
    <a id="_idIndexMarker326">
    </a>
    <span class="koboSpan" id="kobo.255.1">
     event dispatcher for battery status change
    </span>
    <a id="_idIndexMarker327">
    </a>
    <span class="koboSpan" id="kobo.256.1">
     notification; the best method in C++ is to use
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.257.1">
      a
     </span>
    </span>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.258.1">
       delegate
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.259.1">
      .
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.260.1">
     Note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.261.1">
     If you are unfamiliar with delegates, my advice is to take a peek at
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.262.1">
      Appendix A
     </span>
    </em>
    <span class="koboSpan" id="kobo.263.1">
     ,
    </span>
    <strong class="source-inline">
    </strong>
    <em class="italic">
     <span class="koboSpan" id="kobo.264.1">
      Understanding C++ in Unreal Engine
     </span>
    </em>
    <span class="koboSpan" id="kobo.265.1">
     , at the end of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.266.1">
      this book.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.267.1">
     Locate the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.268.1">
      public
     </span>
    </strong>
    <span class="koboSpan" id="kobo.269.1">
     section and add the following piece
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.270.1">
      of code:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.271.1">
DECLARE_DYNAMIC_MULTICAST_DELEGATE_OneParam(FOnBatteryStatusChanged, EBatteryStatus, NewBatteryStatus);
UPROPERTY(BlueprintAssignable, Category = "Dummy Character")
FOnBatteryStatusChanged OnBatteryStatusChanged;</span></pre>
   <p>
    <span class="koboSpan" id="kobo.272.1">
     We have declared a dynamic multicast delegate with a single parameter – the battery new status – that will be dispatched every time the battery changes its
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.273.1">
      charge level.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.274.1">
     Declaring functions
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.275.1">
     The last thing we need to
    </span>
    <a id="_idIndexMarker328">
    </a>
    <span class="koboSpan" id="kobo.276.1">
     add to the header is the function declarations.
    </span>
    <span class="koboSpan" id="kobo.276.2">
     As a first step, delete the following line of code that is found at the end of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.277.1">
      the file:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.278.1">
virtual void SetupPlayerInputComponent(class UInputComponent* PlayerInputComponent) override;</span></pre>
   <p>
    <span class="koboSpan" id="kobo.279.1">
     This character will be controlled by AI, so we don’t need to set up the player input.
    </span>
    <span class="koboSpan" id="kobo.279.2">
     Next, just after the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.280.1">
      Tick()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.281.1">
     declaration, add the following lines
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.282.1">
      of code:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.283.1">
UFUNCTION(BlueprintCallable, Category="Dummy Character")
void SetWalkSpeed();
UFUNCTION(BlueprintCallable, Category="Dummy Character")
void SetRunSpeed();
UFUNCTION(BlueprintCallable, BlueprintGetter, Category="Dummy Character")
EBatteryStatus GetBatteryStatus() const;</span></pre>
   <p>
    <span class="koboSpan" id="kobo.284.1">
     We have just declared two functions –
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.285.1">
      SetWalkSpeed()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.286.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.287.1">
      SetRunSpeed()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.288.1">
     – that will let us change the character speed at runtime.
    </span>
    <span class="koboSpan" id="kobo.288.2">
     Additionally, we have added a getter function for the agent
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.289.1">
      battery status.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.290.1">
     In Unreal Engine, the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.291.1">
      UFUNCTION()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.292.1">
     macro is used to declare functions that are recognized by the Unreal Engine reflection system; this means the function becomes accessible and usable within the Unreal Engine framework.
    </span>
    <span class="koboSpan" id="kobo.292.2">
     All three functions have the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.293.1">
      BlueprintCallable
     </span>
    </strong>
    <span class="koboSpan" id="kobo.294.1">
     specifier added, meaning that these functions will be accessible in a Blueprint graph.
    </span>
    <span class="koboSpan" id="kobo.294.2">
     Additionally, the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.295.1">
      GetBatteryStatus()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.296.1">
     function has the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.297.1">
      const
     </span>
    </strong>
    <span class="koboSpan" id="kobo.298.1">
     keyword added; this will remove the execution pin in the corresponding Blueprint node, as we
    </span>
    <a id="_idIndexMarker329">
    </a>
    <span class="koboSpan" id="kobo.299.1">
     need this function to just be a getter and not change any data
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.300.1">
      during execution.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.301.1">
     Implementing functions
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.302.1">
     Now that all the class declarations
    </span>
    <a id="_idIndexMarker330">
    </a>
    <span class="koboSpan" id="kobo.303.1">
     have been done, we can start implementing the functions.
    </span>
    <span class="koboSpan" id="kobo.303.2">
     To do so, the first thing you need to do is to open the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.304.1">
       BaseDummyCharacter.cpp
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.305.1">
      file.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.306.1">
     The first thing you’ll need to do is to remove the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.307.1">
      SetPlayerInputComponent()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.308.1">
     function, as the corresponding declaration in the header file was
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.309.1">
      previously removed.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.310.1">
     Next, we need to add the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.311.1">
      #include
     </span>
    </strong>
    <span class="koboSpan" id="kobo.312.1">
     declarations at the very beginning of the file.
    </span>
    <span class="koboSpan" id="kobo.312.2">
     Simply add these three lines
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.313.1">
      of code:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.314.1">
#include "Components/CapsuleComponent.h"
#include "Components/SkeletalMeshComponent.h"
#include "GameFramework/CharacterMovementComponent.h"
#include "BatteryStatus.h"</span></pre>
   <p>
    <span class="koboSpan" id="kobo.315.1">
     As always, remember to add these
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.316.1">
      #include
     </span>
    </strong>
    <span class="koboSpan" id="kobo.317.1">
     declarations before the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.318.1">
      .
     </span>
    </strong>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.319.1">
       generated.h
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.320.1">
      declaration.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.321.1">
     Next, locate the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.322.1">
      ABaseDummyCharacter()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.323.1">
     constructor function, as we will need to set up some character attributes and components.
    </span>
    <span class="koboSpan" id="kobo.323.2">
     This function should have already a line of code that sets the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.324.1">
      bCanEverTick
     </span>
    </strong>
    <span class="koboSpan" id="kobo.325.1">
     property to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.326.1">
      true
     </span>
    </strong>
    <span class="koboSpan" id="kobo.327.1">
     .
    </span>
    <span class="koboSpan" id="kobo.327.2">
     Add the following line of code just
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.328.1">
      after it:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.329.1">
PrimaryActorTick.TickInterval = .25f;</span></pre>
   <p>
    <span class="koboSpan" id="kobo.330.1">
     As we will use the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.331.1">
      Tick()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.332.1">
     event just for updating the battery status, we don’t need it to be executed every frame; we have set a time interval of a quarter of a second – this will be more than enough to suit our
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.333.1">
      own needs.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.334.1">
     Next, add the following lines of code that set up the yaw, pitch, and roll behavior of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.335.1">
      the character:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.336.1">
bUseControllerRotationPitch = false;
bUseControllerRotationYaw = false;
bUseControllerRotationRoll = false;</span></pre>
   <p>
    <span class="koboSpan" id="kobo.337.1">
     Next, we need to
    </span>
    <a id="_idIndexMarker331">
    </a>
    <span class="koboSpan" id="kobo.338.1">
     initialize the skeletal mesh component in order to show the dummy puppet model.
    </span>
    <span class="koboSpan" id="kobo.338.2">
     Add these lines
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.339.1">
      of code:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.340.1">
GetMesh()-&gt;SetRelativeLocation(FVector(0.f, 0.f, -120.f));
GetMesh()-&gt;SetRelativeRotation(FRotator(0.f, -90.f, 0.f));
static ConstructorHelpers::FObjectFinder&lt;USkeletalMesh&gt;
SkeletalMeshAsset(TEXT("/Game/KayKit/PrototypeBits/Character/Dummy.Dummy"));
if (SkeletalMeshAsset.Succeeded())
{
    GetMesh()-&gt;SetSkeletalMesh(SkeletalMeshAsset.Object);
}
GetMesh()-&gt;SetAnimationMode(EAnimationMode::AnimationBlueprint);
static ConstructorHelpers::FObjectFinder&lt;UAnimBlueprint&gt;
AnimBlueprintAsset(TEXT("/Game/KayKit/PrototypeBits/Character/ABP_Dummy.ABP_Dummy"));
if (AnimBlueprintAsset.Succeeded())
{
    GetMesh()-&gt;SetAnimClass(AnimBlueprintAsset.Object-&gt;GeneratedClass);
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.341.1">
     Here, we set the
    </span>
    <a id="_idIndexMarker332">
    </a>
    <span class="koboSpan" id="kobo.342.1">
     mesh location and rotation in order to suit the dummy puppet model.
    </span>
    <span class="koboSpan" id="kobo.342.2">
     After that, we assign the dummy puppet skeletal mesh asset by hardcoding the asset path; we will use just this asset, so there is no need to assign it from the extending Blueprint classes.
    </span>
    <span class="koboSpan" id="kobo.342.3">
     We will do the same with the animation Blueprint asset; I have provided one such asset for you in the project files in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.343.1">
      declared path.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.344.1">
     Now, we are going to set the capsule component size in order to match the dummy puppet model.
    </span>
    <span class="koboSpan" id="kobo.344.2">
     To do this, add this line
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.345.1">
      of code:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.346.1">
GetCapsuleComponent()-&gt;InitCapsuleSize(50.f, 120.0f);</span></pre>
   <p>
    <span class="koboSpan" id="kobo.347.1">
     Finally, set up the movement component by adding the following lines
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.348.1">
      of code:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.349.1">
GetCharacterMovement()-&gt;bOrientRotationToMovement = true;
GetCharacterMovement()-&gt;MaxWalkSpeed = 500.f;
GetCharacterMovement()-&gt;RotationRate = FRotator(0.f, 640.f, 0.f);
GetCharacterMovement()-&gt;bConstrainToPlane = true;
GetCharacterMovement()-&gt;bSnapToPlaneAtStart = true;
GetCharacterMovement()-&gt;AvoidanceConsiderationRadius = 2000.f;
GetCharacterMovement()-&gt;bUseRVOAvoidance = true;</span></pre>
   <p>
    <span class="koboSpan" id="kobo.350.1">
     Note the use of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.351.1">
      bUseRVOAvoidance
     </span>
    </strong>
    <span class="koboSpan" id="kobo.352.1">
     , set to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.353.1">
      true
     </span>
    </strong>
    <span class="koboSpan" id="kobo.354.1">
     ; we will use several agents at the same time, so a basic avoidance system is almost mandatory to make things
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.355.1">
      work properly.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.356.1">
     The constructor method is complete, so we can now start implementing all the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.357.1">
      other functions.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.358.1">
     Locate the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.359.1">
      BeginPlay()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.360.1">
     method, and just after the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.361.1">
      Super::BeginPlay()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.362.1">
     declaration, add the following lines
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.363.1">
      of code:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.364.1">
BatteryLevel = MaxBatteryLevel * FMath::RandRange(0.f, 1.f);
OnBatteryStatusChanged.Broadcast(GetBatteryStatus());</span></pre>
   <p>
    <span class="koboSpan" id="kobo.365.1">
     When the
    </span>
    <a id="_idIndexMarker333">
    </a>
    <span class="koboSpan" id="kobo.366.1">
     game starts, we set the AI agent to have a random battery level to make things a bit more interesting, and next, we broadcast this status to all
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.367.1">
      registered listeners.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.368.1">
     After that, just after the closing bracket of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.369.1">
      BeginPlay()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.370.1">
     function, add the following piece
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.371.1">
      of code:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.372.1">
void ABaseDummyCharacter::SetWalkSpeed()
{
    const auto Deviation = FMath::RandRange(-1.f * MovementRandomDeviation, MovementRandomDeviation);
   GetCharacterMovement()-&gt;MaxWalkSpeed = WalkSpeed + Deviation;
}
void ABaseDummyCharacter::SetRunSpeed()
{
    const auto Deviation = FMath::RandRange(-1.f * MovementRandomDeviation, MovementRandomDeviation);
    GetCharacterMovement()-&gt;MaxWalkSpeed = RunSpeed + MovementRandomDeviation;
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.373.1">
     There’s nothing fancy here; we just implement the two functions to change the movement speed of the agent, making it walk
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.374.1">
      or run.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.375.1">
     We now need to
    </span>
    <a id="_idIndexMarker334">
    </a>
    <span class="koboSpan" id="kobo.376.1">
     implement the battery status getter function, so add the following lines
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.377.1">
      of code:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.378.1">
EBatteryStatus ABaseDummyCharacter::GetBatteryStatus() const
{
    const auto Value = BatteryLevel / MaxBatteryLevel;
    if (Value &lt; 0.05f)
    {
       return EBatteryStatus::EBS_Empty;
    }
    if (Value &lt; 0.35f)
    {
       return EBatteryStatus::EBS_Low;
    }
    if (Value &lt; 0.95f)
    {
       return EBatteryStatus::EBS_Medium;
    }
    return EBatteryStatus::EBS_Full;
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.379.1">
     As you can see, we simply check the battery level and return the corresponding
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.380.1">
      status enumeration.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.381.1">
     The last thing
    </span>
    <a id="_idIndexMarker335">
    </a>
    <span class="koboSpan" id="kobo.382.1">
     we need to implement is the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.383.1">
      Tick()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.384.1">
     function, where we will constantly check how much battery power is consumed, depending on the character movement speed.
    </span>
    <span class="koboSpan" id="kobo.384.2">
     Locate the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.385.1">
      Tick()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.386.1">
     function, and just after
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.387.1">
      Super::Tick(DeltaTime);
     </span>
    </strong>
    <span class="koboSpan" id="kobo.388.1">
     , add the following lines
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.389.1">
      of code:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.390.1">
const auto CurrentStatus = GetBatteryStatus();
if(GetMovementComponent()-&gt;Velocity.Size() &gt; .1f)
{
    BatteryLevel -= BatteryCostPerTick;
}
else
{
    BatteryLevel += BatteryRechargePerTick;
}
BatteryLevel = FMath::Clamp&lt;float&gt;(BatteryLevel, 0.f, MaxBatteryLevel);
if (const auto NewStatus = GetBatteryStatus();
  CurrentStatus != NewStatus)0
  {
    OnBatteryStatusChanged.Broadcast(NewStatus);
  }</span></pre>
   <p>
    <span class="koboSpan" id="kobo.391.1">
     In this piece of code, we compute the current battery status using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.392.1">
      GetBatteryStatus()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.393.1">
     function.
    </span>
    <span class="koboSpan" id="kobo.393.2">
     Then, if the velocity of the character’s movement is greater than a tiny number – that is,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.394.1">
      0.1
     </span>
    </strong>
    <span class="koboSpan" id="kobo.395.1">
     – it means the agent is moving, so we decrease the battery level by the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.396.1">
      BatteryCostPerTick
     </span>
    </strong>
    <span class="koboSpan" id="kobo.397.1">
     value.
    </span>
    <span class="koboSpan" id="kobo.397.2">
     Otherwise, the agent is standing still – therefore, recharging – so we increase the battery level by
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.398.1">
      BatteryRechargePerTick
     </span>
    </strong>
    <span class="koboSpan" id="kobo.399.1">
     .
    </span>
    <span class="koboSpan" id="kobo.399.2">
     After that, we clamp the battery level between a value of zero and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.400.1">
      MaxBatteryLevel
     </span>
    </strong>
    <span class="koboSpan" id="kobo.401.1">
     .
    </span>
    <span class="koboSpan" id="kobo.401.2">
     Finally, we check whether the starting battery status is different from the new battery status, and we eventually broadcast the new battery status using the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.402.1">
       OnBatteryStatusChanged
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.403.1">
      delegate.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.404.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.405.1">
      BaseDummyCharacter
     </span>
    </strong>
    <span class="koboSpan" id="kobo.406.1">
     class has
    </span>
    <a id="_idIndexMarker336">
    </a>
    <span class="koboSpan" id="kobo.407.1">
     been completed.
    </span>
    <span class="koboSpan" id="kobo.407.2">
     It is evident that we have not yet incorporated any AI agent behavior; this is intentional, as we plan to manage everything through an
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.408.1">
      AIController
     </span>
    </strong>
    <span class="koboSpan" id="kobo.409.1">
     class, a task we will undertake in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.410.1">
      following section.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-155">
    <a id="_idTextAnchor157">
    </a>
    <span class="koboSpan" id="kobo.411.1">
     Creating a behavior tree
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.412.1">
     In this section, we will create a fully functional behavior tree for the agent we previously created.
    </span>
    <span class="koboSpan" id="kobo.412.2">
     The steps we will follow are
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.413.1">
      as follows:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.414.1">
      Creating the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.415.1">
       AI controller
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.416.1">
      Creating
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.417.1">
       the Blackboard
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.418.1">
      Creating the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.419.1">
       behavior tree
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.420.1">
     Let’s start by creating a subclass of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.421.1">
      AIController
     </span>
    </strong>
    <span class="koboSpan" id="kobo.422.1">
     class to control our
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.423.1">
      dummy puppet.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-156">
    <a id="_idTextAnchor158">
    </a>
    <span class="koboSpan" id="kobo.424.1">
     Creating the AI controller
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.425.1">
     We will be now creating
    </span>
    <a id="_idIndexMarker337">
    </a>
    <span class="koboSpan" id="kobo.426.1">
     a class extending
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.427.1">
      AIController
     </span>
    </strong>
    <span class="koboSpan" id="kobo.428.1">
     that will be used as a starting point for the behavior tree.
    </span>
    <span class="koboSpan" id="kobo.428.2">
     To get started, open the Unreal Engine Editor and do the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.429.1">
      following steps:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.430.1">
      From the main menu, select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.431.1">
       Tools
      </span>
     </strong>
     <span class="koboSpan" id="kobo.432.1">
      |
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.433.1">
       New
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.434.1">
        C++ Class
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.435.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.436.1">
      Click on the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.437.1">
       All Classes
      </span>
     </strong>
     <span class="koboSpan" id="kobo.438.1">
      tab section and look
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.439.1">
       for
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.440.1">
        AIController
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.441.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer126">
     <span class="koboSpan" id="kobo.442.1">
      <img alt="Figure 8.6 – AI controller class creation" src="image/B31016_figure_08.06.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.443.1">
     Figure 8.6 – AI controller class creation
    </span>
   </p>
   <ol>
    <li value="3">
     <span class="koboSpan" id="kobo.444.1">
      Click the
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.445.1">
        Next
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.446.1">
       button.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.447.1">
      Name the
     </span>
     <a id="_idIndexMarker338">
     </a>
     <span class="koboSpan" id="kobo.448.1">
      class
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.449.1">
       BaseDummyAIController
      </span>
     </strong>
     <span class="koboSpan" id="kobo.450.1">
      and click the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.451.1">
       Create
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.452.1">
        Class
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.453.1">
       button.
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.454.1">
     Once the class files have been created and your IDE has been opened, look for the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.455.1">
      BaseDummyAIController.h
     </span>
    </strong>
    <span class="koboSpan" id="kobo.456.1">
     header file and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.457.1">
      open it.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.458.1">
     Editing the header file
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.459.1">
     As a first step, add a
    </span>
    <a id="_idIndexMarker339">
    </a>
    <span class="koboSpan" id="kobo.460.1">
     forward declaration for the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.461.1">
      BehaviorTree
     </span>
    </strong>
    <span class="koboSpan" id="kobo.462.1">
     class, just after the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.463.1">
      #
     </span>
    </strong>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.464.1">
       include
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.465.1">
      declarations:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.466.1">
class UBehaviorTree;</span></pre>
   <p>
    <span class="koboSpan" id="kobo.467.1">
     Then, in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.468.1">
      protected
     </span>
    </strong>
    <span class="koboSpan" id="kobo.469.1">
     section of the header file, add these lines
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.470.1">
      of code:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.471.1">
UPROPERTY(EditAnywhere, BlueprintReadOnly,
  Category = "Dummy AI Controller")
TObjectPtr&lt;UBehaviorTree&gt; BehaviorTree;</span></pre>
   <p>
    <span class="koboSpan" id="kobo.472.1">
     This property declares a pointer to the behavior tree, so that it will be assignable from the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.473.1">
      Class Defaults
     </span>
    </strong>
    <span class="koboSpan" id="kobo.474.1">
     Blueprints panel – using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.475.1">
      EditAnywhere
     </span>
    </strong>
    <span class="koboSpan" id="kobo.476.1">
     specifier – and it will be readable from any
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.477.1">
      extending Blueprints.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.478.1">
     Now, just after these lines of code,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.479.1">
      add this:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.480.1">
virtual void OnPossess(APawn* InPawn) override;</span></pre>
   <p>
    <span class="koboSpan" id="kobo.481.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.482.1">
      OnPossess()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.483.1">
     function is called when the controller possesses a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.484.1">
      Pawn
     </span>
    </strong>
    <span class="koboSpan" id="kobo.485.1">
     instance – and our dummy character extends it – and it is a good place to run
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.486.1">
      behavior trees.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.487.1">
     Implementing the controller
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.488.1">
     The controller is quite
    </span>
    <a id="_idIndexMarker340">
    </a>
    <span class="koboSpan" id="kobo.489.1">
     easy to implement; we just need to run the behavior tree when the AI agent is possessed.
    </span>
    <span class="koboSpan" id="kobo.489.2">
     To do so, open the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.490.1">
      BaseDummyAIController.cpp
     </span>
    </strong>
    <span class="koboSpan" id="kobo.491.1">
     file and add these lines
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.492.1">
      of code:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.493.1">
void ABaseDummyAIController::OnPossess(APawn* InPawn)
{
    Super::OnPossess(InPawn);
    if (ensureMsgf(BehaviorTree, TEXT("Behavior Tree is nullptr! </span><span class="koboSpan" id="kobo.493.2">Please assign BehaviorTree in your AI Controller.")))
    {
       RunBehaviorTree(BehaviorTree);
    }
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.494.1">
     In this function, the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.495.1">
      Super::OnPossess()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.496.1">
     base class is called first.
    </span>
    <span class="koboSpan" id="kobo.496.2">
     Then, we use the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.497.1">
      ensureMsgf()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.498.1">
     macro to ensure that the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.499.1">
      BehaviorTree
     </span>
    </strong>
    <span class="koboSpan" id="kobo.500.1">
     variable is not a null pointer.
    </span>
    <span class="koboSpan" id="kobo.500.2">
     If a behavior tree has been set, we run it using the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.501.1">
       RunBehaviorTree()
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.502.1">
      function.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.503.1">
     With the AI controller set, we can start implementing the actual AI behaviors, starting from
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.504.1">
      the Blackboard.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-157">
    <a id="_idTextAnchor159">
    </a>
    <span class="koboSpan" id="kobo.505.1">
     Creating the Blackboard
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.506.1">
     Creating a
    </span>
    <a id="_idIndexMarker341">
    </a>
    <span class="koboSpan" id="kobo.507.1">
     Blackboard asset is a straightforward task once you know what keys you will be tracking.
    </span>
    <span class="koboSpan" id="kobo.507.2">
     In our case, we want to make the following values available to the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.508.1">
      behavior tree:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.509.1">
      A target location vector that will be used by the agent to walk around
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.510.1">
       the level
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.511.1">
      A Boolean flag that will warn the agent once the battery charge is
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.512.1">
       dangerously low
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.513.1">
      A Boolean flag that will indicate that the battery has
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.514.1">
       been depleted
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.515.1">
     To get started, we need to create a
    </span>
    <a id="_idIndexMarker342">
    </a>
    <span class="koboSpan" id="kobo.516.1">
     Blackboard asset.
    </span>
    <span class="koboSpan" id="kobo.516.2">
     To do so, follow
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.517.1">
      these steps:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.518.1">
      Open
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.519.1">
       Content Drawer
      </span>
     </strong>
     <span class="koboSpan" id="kobo.520.1">
      and create a new folder, naming
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.521.1">
       it
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.522.1">
        AI
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.523.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.524.1">
      Open the folder and right-click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.525.1">
       Content Drawer
      </span>
     </strong>
     <span class="koboSpan" id="kobo.526.1">
      , selecting
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.527.1">
       Artificial Intelligence
      </span>
     </strong>
     <span class="koboSpan" id="kobo.528.1">
      |
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.529.1">
       Blackboard
      </span>
     </strong>
     <span class="koboSpan" id="kobo.530.1">
      to create a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.531.1">
       Blackboard asset.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.532.1">
      Name the asset
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.533.1">
       BB_Dummy
      </span>
     </strong>
     <span class="koboSpan" id="kobo.534.1">
      and double-click on it to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.535.1">
       open it.
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer127">
     <span class="koboSpan" id="kobo.536.1">
      <img alt="Figure 8.7 – The Blackboard panel" src="image/B31016_figure_08.07.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.537.1">
     Figure 8.7 – The Blackboard panel
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.538.1">
     Once the Blackboard is opened, you will see that there’s already a key named
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.539.1">
      SelfActor
     </span>
    </strong>
    <span class="koboSpan" id="kobo.540.1">
     ; we won’t be using it during this chapter, but we will leave it as it is, since it is usually used to store a reference to the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.541.1">
      owning actor.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.542.1">
     We need to create three keys, as stated at the beginning of this subsection, so we’ll start by following
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.543.1">
      these steps:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.544.1">
      Click the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.545.1">
       New Key
      </span>
     </strong>
     <span class="koboSpan" id="kobo.546.1">
      button, and from the dropdown list, select the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.547.1">
       Vector
      </span>
     </strong>
     <span class="koboSpan" id="kobo.548.1">
      type, as shown in
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.549.1">
        Figure 8
       </span>
      </em>
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.550.1">
        .8
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.551.1">
       :
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer128">
     <span class="koboSpan" id="kobo.552.1">
      <img alt="Figure 8.8 – Key creation" src="image/B31016_figure_08.08.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.553.1">
     Figure 8.8 – Key creation
    </span>
   </p>
   <ol>
    <li value="2">
     <span class="koboSpan" id="kobo.554.1">
      Name the new
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.555.1">
       key
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.556.1">
        TargetLocation
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.557.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.558.1">
      Click the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.559.1">
       New Key
      </span>
     </strong>
     <span class="koboSpan" id="kobo.560.1">
      button again, select the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.561.1">
       Bool
      </span>
     </strong>
     <span class="koboSpan" id="kobo.562.1">
      type, and name the new
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.563.1">
       key
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.564.1">
        IsLowOnBattery
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.565.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.566.1">
      Click the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.567.1">
       New Key
      </span>
     </strong>
     <span class="koboSpan" id="kobo.568.1">
      button once more, select the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.569.1">
       Bool
      </span>
     </strong>
     <span class="koboSpan" id="kobo.570.1">
      type, and name the new
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.571.1">
       key
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.572.1">
        IsBatteryDepleted
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.573.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.574.1">
     Once these steps are finished, your
    </span>
    <a id="_idIndexMarker343">
    </a>
    <span class="koboSpan" id="kobo.575.1">
     Blackboard should be pretty similar to the one depicted in
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.576.1">
       Figure 8
      </span>
     </em>
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.577.1">
       .9
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.578.1">
      :
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer129">
     <span class="koboSpan" id="kobo.579.1">
      <img alt="Figure 8.9 – The finished Blackboard" src="image/B31016_figure_08.09.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.580.1">
     Figure 8.9 – The finished Blackboard
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.581.1">
     The Blackboard is finished, and we can now start working on the behavior tree for our
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.582.1">
      AI agent.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-158">
    <a id="_idTextAnchor160">
    </a>
    <span class="koboSpan" id="kobo.583.1">
     Creating the behavior tree
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.584.1">
     Like the Blackboard, a
    </span>
    <a id="_idIndexMarker344">
    </a>
    <span class="koboSpan" id="kobo.585.1">
     behavior tree is created as a project asset.
    </span>
    <span class="koboSpan" id="kobo.585.2">
     Let’s start by performing the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.586.1">
      following steps:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.587.1">
      In
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.588.1">
       Content Drawer
      </span>
     </strong>
     <span class="koboSpan" id="kobo.589.1">
      , open the
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.590.1">
        AI
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.591.1">
       folder.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.592.1">
      Right-click on
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.593.1">
       Content Drawer
      </span>
     </strong>
     <span class="koboSpan" id="kobo.594.1">
      and select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.595.1">
       Artificial Intelligence
      </span>
     </strong>
     <span class="koboSpan" id="kobo.596.1">
      |
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.597.1">
        Behavior Tree
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.598.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.599.1">
      Name the newly created asset
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.600.1">
       BT_RoamerDummy
      </span>
     </strong>
     <span class="koboSpan" id="kobo.601.1">
      and double-click on it to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.602.1">
       open it.
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.603.1">
     Once opened, you
    </span>
    <a id="_idIndexMarker345">
    </a>
    <span class="koboSpan" id="kobo.604.1">
     should see a graph pretty similar to the one shown in
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.605.1">
       Figure 8
      </span>
     </em>
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.606.1">
       .10
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.607.1">
      :
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer130">
     <span class="koboSpan" id="kobo.608.1">
      <img alt="Figure 8.10 – Behavior tree creation" src="image/B31016_figure_08.10.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.609.1">
     Figure 8.10 – Behavior tree creation
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.610.1">
     Note that the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.611.1">
      Root
     </span>
    </strong>
    <span class="koboSpan" id="kobo.612.1">
     node is already included in the graph.
    </span>
    <span class="koboSpan" id="kobo.612.2">
     As mentioned in the previous chapter, there can only be one such node in the graph.
    </span>
    <span class="koboSpan" id="kobo.612.3">
     Furthermore, in the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.613.1">
      Details
     </span>
    </strong>
    <span class="koboSpan" id="kobo.614.1">
     panel, you should see that the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.615.1">
      BB_Dummy
     </span>
    </strong>
    <span class="koboSpan" id="kobo.616.1">
     Blackboard asset has already been assigned to the Blackboard asset.
    </span>
    <span class="koboSpan" id="kobo.616.2">
     If you don’t see it assigned, simply click the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.617.1">
      Blackboard
     </span>
    </strong>
    <span class="koboSpan" id="kobo.618.1">
     property dropdown and select the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.619.1">
      BB_Dummy
     </span>
    </strong>
    <span class="koboSpan" id="kobo.620.1">
     asset; it should be the only asset of that type present in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.621.1">
      your project.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.622.1">
     In this section, we went through a step-by-step guide on creating a character that will utilize a behavior tree to implement AI logic.
    </span>
    <span class="koboSpan" id="kobo.622.2">
     We have also successfully created a Blackboard asset and a behavior tree asset, which serve as the foundation to implement our character’s AI behaviors.
    </span>
    <span class="koboSpan" id="kobo.622.3">
     As the process of implementing all the AI logic for our character is quite extensive, we will tackle it in the upcoming section.
    </span>
    <span class="koboSpan" id="kobo.622.4">
     Stay tuned for a detailed walk-through on how to effectively implement AI behaviors for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.623.1">
      our character.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-159">
    <a id="_idTextAnchor161">
    </a>
    <span class="koboSpan" id="kobo.624.1">
     Implementing behavior tree tasks and services
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.625.1">
     Before creating the
    </span>
    <a id="_idIndexMarker346">
    </a>
    <span class="koboSpan" id="kobo.626.1">
     behavior tree, it is crucial to have a clear understanding of the intended implementation.
    </span>
    <span class="koboSpan" id="kobo.626.2">
     The AI agent will need to manage the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.627.1">
      following behaviors:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.628.1">
      Wander around the level looking for
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.629.1">
       target locations
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.630.1">
      The default movement speed is running, but if the battery level is low, the movement speed should switch
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.631.1">
       to walking
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.632.1">
      Once the battery is depleted, it should
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.633.1">
       stop moving
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.634.1">
      Once the battery is fully charged, it should return to the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.635.1">
       movement pattern
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.636.1">
     It is worth noting that the battery depletion and recharging logic has already been implemented in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.637.1">
      BaseDummyCharacter
     </span>
    </strong>
    <span class="koboSpan" id="kobo.638.1">
     class, so we won’t need to worry about it – we will just need to listen to the events dispatched by the character and
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.639.1">
      behave accordingly.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.640.1">
     As I mentioned in the previous chapter, the Unreal Engine AI system provides a comprehensive collection of tasks, services, and decorators for our AIs.
    </span>
    <span class="koboSpan" id="kobo.640.2">
     However, it’s worth noting that these built-in components may not cover all the specific requirements of your game.
    </span>
    <span class="koboSpan" id="kobo.640.3">
     After all, as developers, we enjoy the creative process of building new things that suit our unique needs and add to the overall fun of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.641.1">
      game development!
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.642.1">
     That’s why, before adding nodes to our graph, we will need to implement a set of tasks and services that will make our dummy puppet life easier.
    </span>
    <span class="koboSpan" id="kobo.642.2">
     In particular, we will create
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.643.1">
      the following:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.644.1">
      A task that will find a random
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.645.1">
       reachable location
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.646.1">
      A service that will control the agent speed, depending on the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.647.1">
       battery level
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.648.1">
      A service that will listen for battery
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.649.1">
       status changes
      </span>
     </span>
    </li>
   </ul>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.650.1">
     Note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.651.1">
     Behavior tree nodes can be implemented both in C++ and in Blueprint; for the purpose of this book, I will be sticking to the C++ option, but in
    </span>
    <a href="B31016_09.xhtml#_idTextAnchor170">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.652.1">
        Chapter 9
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.653.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.654.1">
      Extending Behavior Trees
     </span>
    </em>
    <span class="koboSpan" id="kobo.655.1">
     , I will give you some useful hints on how to work also with
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.656.1">
      Blueprint classes.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.657.1">
     So, let’s start implementing new features for our
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.658.1">
      dummy puppets!
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-160">
    <a id="_idTextAnchor162">
    </a>
    <span class="koboSpan" id="kobo.659.1">
     Implementing the FindRandomLocation task
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.660.1">
     We will begin by
    </span>
    <a id="_idIndexMarker347">
    </a>
    <span class="koboSpan" id="kobo.661.1">
     implementing the first node, which will enable the AI agent to search for a random actor in the level that has a specific tag.
    </span>
    <span class="koboSpan" id="kobo.661.2">
     This functionality
    </span>
    <a id="_idIndexMarker348">
    </a>
    <span class="koboSpan" id="kobo.662.1">
     will allow the agent to have a specific point to navigate toward, enhancing its precision in reaching
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.663.1">
      its destination.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.664.1">
     To start implementing this node, from the Unreal Engine Editor, create a new C++ class that extends
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.665.1">
      BTTaskNode
     </span>
    </strong>
    <span class="koboSpan" id="kobo.666.1">
     , and name
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.667.1">
      it
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.668.1">
       BTTask_FindRandomLocation
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.669.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.670.1">
     Open the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.671.1">
      BTTask_FindRandomLocation.h
     </span>
    </strong>
    <span class="koboSpan" id="kobo.672.1">
     header file and add the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.673.1">
      following declarations:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.674.1">
public:
UPROPERTY(EditAnywhere, Category="Blackboard")
FBlackboardKeySelector BlackboardKey;
UPROPERTY(EditAnywhere, Category="Dummy Task")
FName TargetTag;
virtual EBTNodeResult::Type ExecuteTask(UBehaviorTreeComponent&amp;   OwnerComp, uint8* NodeMemory) override;</span></pre>
   <p>
    <span class="koboSpan" id="kobo.675.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.676.1">
      BlackboardKey
     </span>
    </strong>
    <span class="koboSpan" id="kobo.677.1">
     property will be used to declare which key should be used to store the random location once it has been found, while the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.678.1">
      TargetTag
     </span>
    </strong>
    <span class="koboSpan" id="kobo.679.1">
     property will be used to find all available actors in the level in order to randomize a selection.
    </span>
    <span class="koboSpan" id="kobo.679.2">
     Finally, the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.680.1">
      ExecuteTask()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.681.1">
     function will be called when the task node needs to be executed and will contain all the logic to randomize a target location.
    </span>
    <span class="koboSpan" id="kobo.681.2">
     This function will need to return whether the task was successful
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.682.1">
      or failed.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.683.1">
     Now, open
    </span>
    <a id="_idIndexMarker349">
    </a>
    <span class="koboSpan" id="kobo.684.1">
     the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.685.1">
      BTTask_FindRandomLocation.cpp
     </span>
    </strong>
    <span class="koboSpan" id="kobo.686.1">
     file, and as a first step, add the needed
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.687.1">
      #include
     </span>
    </strong>
    <span class="koboSpan" id="kobo.688.1">
     declarations at the top of the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.689.1">
      file itself:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.690.1">
#include "BehaviorTree/BlackboardComponent.h"
#include "Kismet/GameplayStatics.h"</span></pre>
   <p>
    <span class="koboSpan" id="kobo.691.1">
     Next, add
    </span>
    <a id="_idIndexMarker350">
    </a>
    <span class="koboSpan" id="kobo.692.1">
     the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.693.1">
      ExecuteTask()
     </span>
    </strong>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.694.1">
      function implementation:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.695.1">
EBTNodeResult::Type UBTTask_FindRandomLocation::ExecuteTask(UBehaviorTreeComponent&amp; OwnerComp,   uint8* NodeMemory)
{
    const auto BlackboardComp = OwnerComp.GetBlackboardComponent();
    if (BlackboardComp == nullptr) { return EBTNodeResult::Failed; }
    TArray&lt;AActor*&gt; TargetList;
    UGameplayStatics::GetAllActorsWithTag(GetWorld(), TargetTag,       TargetList);
    if(TargetList.Num() == 0) { return EBTNodeResult::Failed; }
    const auto RandomTarget = TargetList[FMath::RandRange       (0, TargetList.Num() - 1)];
    BlackboardComp-&gt;SetValueAsVector(BlackboardKey.SelectedKeyName,       RandomTarget-&gt;GetActorLocation());
    return EBTNodeResult::Succeeded;
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.696.1">
     The
    </span>
    <a id="_idIndexMarker351">
    </a>
    <span class="koboSpan" id="kobo.697.1">
     code gets the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.698.1">
      Blackboard
     </span>
    </strong>
    <span class="koboSpan" id="kobo.699.1">
     component from
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.700.1">
      OwnerComp
     </span>
    </strong>
    <span class="koboSpan" id="kobo.701.1">
     and checks its validity.
    </span>
    <span class="koboSpan" id="kobo.701.2">
     Then, it retrieves a list of actors with a specific tag, selecting a random element from that list.
    </span>
    <span class="koboSpan" id="kobo.701.3">
     Then, it updates the Blackboard with the selected target’s location by using the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.702.1">
      SetValueAsVector()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.703.1">
     method.
    </span>
    <span class="koboSpan" id="kobo.703.2">
     Note the use of
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.704.1">
      EBTNodeResult::Succeeded
     </span>
    </strong>
    <span class="koboSpan" id="kobo.705.1">
     and
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.706.1">
      EBTNodeResult::Failed
     </span>
    </strong>
    <span class="koboSpan" id="kobo.707.1">
     to return the result of all these operations; this is a requirement in
    </span>
    <a id="_idIndexMarker352">
    </a>
    <span class="koboSpan" id="kobo.708.1">
     order to indicate to the behavior tree whether a task was successful
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.709.1">
      or not.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.710.1">
     Now that we have completed this task node, we can move on to the next step, which involves creating
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.711.1">
      a service.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-161">
    <a id="_idTextAnchor163">
    </a>
    <span class="koboSpan" id="kobo.712.1">
     Implementing the SpeedControl service
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.713.1">
     We
    </span>
    <a id="_idIndexMarker353">
    </a>
    <span class="koboSpan" id="kobo.714.1">
     are now prepared to create our first custom service, which will monitor the character’s speed based on the battery charge.
    </span>
    <span class="koboSpan" id="kobo.714.2">
     As you may remember from the previous chapter, a service is usually run at fixed intervals, and that’s exactly what we will do for the speed control service class – we will check the battery status and change
    </span>
    <a id="_idIndexMarker354">
    </a>
    <span class="koboSpan" id="kobo.715.1">
     the character
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.716.1">
      speed accordingly.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.717.1">
     To start implementing this class, from the Unreal Engine Editor, create a new C++ class that extends
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.718.1">
      BTService
     </span>
    </strong>
    <span class="koboSpan" id="kobo.719.1">
     , and name
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.720.1">
      it
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.721.1">
       BTService_SpeedControl
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.722.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.723.1">
     Open the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.724.1">
      BTTask_SpeedControl.h
     </span>
    </strong>
    <span class="koboSpan" id="kobo.725.1">
     header file, and in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.726.1">
      public
     </span>
    </strong>
    <span class="koboSpan" id="kobo.727.1">
     section, add the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.728.1">
      following declarations:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.729.1">
protected:
  virtual void TickNode(UBehaviorTreeComponent&amp; OwnerComp, uint8*     NodeMemory, float DeltaSeconds) override;</span></pre>
   <p>
    <span class="koboSpan" id="kobo.730.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.731.1">
      TickNode()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.732.1">
     function that we are overriding will be executed on every node tick interval that this service is attached to.
    </span>
    <span class="koboSpan" id="kobo.732.2">
     In order to call this function, the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.733.1">
      bNotifyTick
     </span>
    </strong>
    <span class="koboSpan" id="kobo.734.1">
     needs to be set to
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.735.1">
      true
     </span>
    </strong>
    <span class="koboSpan" id="kobo.736.1">
     ; this value is already set by default, but it’s good to know if you need to disable it – something we’ll implement in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.737.1">
      next service.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.738.1">
     We are ready to implement the service, so open the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.739.1">
      BT_Service_SpeedControl.cpp
     </span>
    </strong>
    <span class="koboSpan" id="kobo.740.1">
     file and add the following
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.741.1">
      #include
     </span>
    </strong>
    <span class="koboSpan" id="kobo.742.1">
     declarations at
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.743.1">
      the top:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.744.1">
#include "BaseDummyAIController.h"
#include "BaseDummyCharacter.h"</span></pre>
   <p>
    <span class="koboSpan" id="kobo.745.1">
     After
    </span>
    <a id="_idIndexMarker355">
    </a>
    <span class="koboSpan" id="kobo.746.1">
     that, add
    </span>
    <a id="_idIndexMarker356">
    </a>
    <span class="koboSpan" id="kobo.747.1">
     the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.748.1">
       TickNode()
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.749.1">
      implementation:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.750.1">
void UBTService_SpeedControl::TickNode(UBehaviorTreeComponent&amp;   OwnerComp, uint8* NodeMemory, float DeltaSeconds)
{
    Super::TickNode(OwnerComp, NodeMemory, DeltaSeconds);
    const auto AIController = Cast&lt;ABaseDummyAIController&gt;(OwnerComp.      GetAIOwner());
    if (!AIController) return;
    const auto ControlledCharacter = Cast&lt;ABaseDummyCharacter&gt;      (AIController-&gt;GetPawn());
    if (!ControlledCharacter) return;
    switch (ControlledCharacter-&gt;GetBatteryStatus())
    {
      case EBatteryStatus::EBS_Empty:
          break;
      case EBatteryStatus::EBS_Low:
          ControlledCharacter-&gt;SetWalkSpeed();
          break;
      case EBatteryStatus::EBS_Medium:
      case EBatteryStatus::EBS_Full:
          ControlledCharacter-&gt;SetRunSpeed();
          break;
    }
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.751.1">
     This function is quite straightforward; all it does is update the speed of the controlled character based on the character’s
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.752.1">
      battery status.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.753.1">
     At this stage, you might be wondering why we retrieve the AI controller and character reference at every tick instead of storing them.
    </span>
    <span class="koboSpan" id="kobo.753.2">
     It may seem inefficient in terms of computational power, but it’s important to remember that the behavior tree is a shared asset.
    </span>
    <span class="koboSpan" id="kobo.753.3">
     This means that a single instance of the behavior tree – and its nodes – will be executed for all AI agents that use it.
    </span>
    <span class="koboSpan" id="kobo.753.4">
     Hence, storing a class reference would not yield any
    </span>
    <a id="_idIndexMarker357">
    </a>
    <span class="koboSpan" id="kobo.754.1">
     advantages and
    </span>
    <a id="_idIndexMarker358">
    </a>
    <span class="koboSpan" id="kobo.755.1">
     could result in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.756.1">
      unpredictable behaviors.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.757.1">
     If there is a genuine need to store a reference, you would need to create a node instance, which is precisely what we will do with the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.758.1">
      upcoming service.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-162">
    <a id="_idTextAnchor164">
    </a>
    <span class="koboSpan" id="kobo.759.1">
     Implementing the BatteryCheck service
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.760.1">
     The second service we
    </span>
    <a id="_idIndexMarker359">
    </a>
    <span class="koboSpan" id="kobo.761.1">
     are about to create is going to be a bit more challenging than the previous one.
    </span>
    <span class="koboSpan" id="kobo.761.2">
     We need to continuously monitor any changes in the battery
    </span>
    <a id="_idIndexMarker360">
    </a>
    <span class="koboSpan" id="kobo.762.1">
     status; the most straightforward approach would be to use the node tick to constantly check the character’s battery status, similar to how the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.763.1">
      UBTService_SpeedControl
     </span>
    </strong>
    <span class="koboSpan" id="kobo.764.1">
     class operates.
    </span>
    <span class="koboSpan" id="kobo.764.2">
     However, as we learned earlier in this chapter, the dummy character dispatches battery status events.
    </span>
    <span class="koboSpan" id="kobo.764.3">
     So, why not leverage this feature and make use
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.765.1">
      of it?
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.766.1">
     Let’s start implementing this service; from the Unreal Engine Editor, create a new C++ class that extends
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.767.1">
      BTService
     </span>
    </strong>
    <span class="koboSpan" id="kobo.768.1">
     and name
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.769.1">
      it
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.770.1">
       BTService_BetteryCheck
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.771.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.772.1">
     Once the files have been created, open the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.773.1">
      BTService_BatteryCheck.h
     </span>
    </strong>
    <span class="koboSpan" id="kobo.774.1">
     file, and just after the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.775.1">
      #include
     </span>
    </strong>
    <span class="koboSpan" id="kobo.776.1">
     section, add the following
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.777.1">
      forward declarations:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.778.1">
class ABaseDummyCharacter;
enum class EBatteryStatus : uint8;</span></pre>
   <p>
    <span class="koboSpan" id="kobo.779.1">
     Then, add the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.780.1">
      public
     </span>
    </strong>
    <span class="koboSpan" id="kobo.781.1">
     section and the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.782.1">
      constructor declaration:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.783.1">
public:
UBTService_BatteryCheck();</span></pre>
   <p>
    <span class="koboSpan" id="kobo.784.1">
     Just after that, declare the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.785.1">
      protected
     </span>
    </strong>
    <span class="koboSpan" id="kobo.786.1">
     section, along with all the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.787.1">
      necessary properties:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.788.1">
protected:
UPROPERTY()
UBlackboardComponent* BlackboardComponent = nullptr;
UPROPERTY()
ABaseDummyCharacter* ControlledCharacter = nullptr;
UPROPERTY(BlueprintReadOnly, EditAnywhere, Category="Blackboard")
FBlackboardKeySelector IsLowOnBatteryKey;
UPROPERTY(BlueprintReadOnly, EditAnywhere, Category="Blackboard")
FBlackboardKeySelector IsBatteryDepletedKey;</span></pre>
   <p>
    <span class="koboSpan" id="kobo.789.1">
     As you can see, we are
    </span>
    <a id="_idIndexMarker361">
    </a>
    <span class="koboSpan" id="kobo.790.1">
     doing something
    </span>
    <a id="_idIndexMarker362">
    </a>
    <span class="koboSpan" id="kobo.791.1">
     slightly different from the previous service; we are declaring a reference to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.792.1">
      Blackboard
     </span>
    </strong>
    <span class="koboSpan" id="kobo.793.1">
     component and the character.
    </span>
    <span class="koboSpan" id="kobo.793.2">
     In this case, we will work with node instances, so each AI agent will have its own separate instance of the node decorated by this service.
    </span>
    <span class="koboSpan" id="kobo.793.3">
     We also declare two Blackboard keys to assign the proper values to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.794.1">
      the Blackboard.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.795.1">
     Just after that, add the
    </span>
    <a id="_idIndexMarker363">
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.796.1">
      following functions:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.797.1">
virtual void OnBecomeRelevant(UBehaviorTreeComponent&amp; OwnerComp, uint8* NodeMemory) override;
virtual void OnCeaseRelevant(UBehaviorTreeComponent&amp; OwnerComp, uint8* NodeMemory) override;
UFUNCTION()
void OnBatteryStatusChange(EBatteryStatus NewBatteryStatus);</span></pre>
   <p>
    <span class="koboSpan" id="kobo.798.1">
     The
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.799.1">
      OnBecomeRelevant()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.800.1">
     function will be called when the decorated node becomes active, while the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.801.1">
      OnCeaseRelevant()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.802.1">
     function is no longer active.
    </span>
    <span class="koboSpan" id="kobo.802.2">
     We will use these two functions to register the battery status events and react accordingly by using the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.803.1">
       OnBatteryStatusChange()
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.804.1">
      function.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.805.1">
     You can now open
    </span>
    <a id="_idIndexMarker364">
    </a>
    <span class="koboSpan" id="kobo.806.1">
     the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.807.1">
      BTService_BatteryCheck.cpp
     </span>
    </strong>
    <span class="koboSpan" id="kobo.808.1">
     file to start implementing the functions.
    </span>
    <span class="koboSpan" id="kobo.808.2">
     As
    </span>
    <a id="_idIndexMarker365">
    </a>
    <span class="koboSpan" id="kobo.809.1">
     a first step, add the needed
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.810.1">
      #include
     </span>
    </strong>
    <span class="koboSpan" id="kobo.811.1">
     declarations at the top of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.812.1">
      the file:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.813.1">
#include "BaseDummyAIController.h"
#include "BaseDummyCharacter.h"
#include "BatteryStatus.h"
#include "BehaviorTree/BlackboardComponent.h"</span></pre>
   <p>
    <span class="koboSpan" id="kobo.814.1">
     Immediately after that, add the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.815.1">
      constructor implementation:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.816.1">
UBTService_BatteryCheck::UBTService_BatteryCheck()
{
    bCreateNodeInstance = true;
    bNotifyBecomeRelevant = true;
    bNotifyCeaseRelevant = true;
    bNotifyTick = false;
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.817.1">
     Although it may appear that we are simply setting some flags, we are actually making a significant change to the behavior of this service.
    </span>
    <span class="koboSpan" id="kobo.817.2">
     First, we create a node instance; each AI agent will have its own instance of this service.
    </span>
    <span class="koboSpan" id="kobo.817.3">
     Next, we disable the service tick, as we won’t be needing it, and we activate the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.818.1">
      relevancy behavior.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.819.1">
     Next, let’s
    </span>
    <a id="_idIndexMarker366">
    </a>
    <span class="koboSpan" id="kobo.820.1">
     implement
    </span>
    <a id="_idIndexMarker367">
    </a>
    <span class="koboSpan" id="kobo.821.1">
     the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.822.1">
       OnBatteryStatusChange()
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.823.1">
      method:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.824.1">
void UBTService_BatteryCheck::OnBatteryStatusChange(const EBatteryStatus NewBatteryStatus)
{
    switch (NewBatteryStatus)
    {
    case EBatteryStatus::EBS_Empty:
       BlackboardComponent-&gt;SetValueAsBool(IsBatteryDepletedKey.         SelectedKeyName, true);
       break;
    case EBatteryStatus::EBS_Low:
       BlackboardComponent-&gt;SetValueAsBool(IsLowOnBatteryKey.         SelectedKeyName, true);
       BlackboardComponent-&gt;SetValueAsBool(IsBatteryDepletedKey.         SelectedKeyName, false);
       break;
    case EBatteryStatus::EBS_Medium:
       break;
    case EBatteryStatus::EBS_Full:
       BlackboardComponent-&gt;SetValueAsBool(IsLowOnBatteryKey.         SelectedKeyName, false);
       break;
    }
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.825.1">
     There is nothing
    </span>
    <a id="_idIndexMarker368">
    </a>
    <span class="koboSpan" id="kobo.826.1">
     fancy here; we just set the Blackboard keys based on the new battery status.
    </span>
    <span class="koboSpan" id="kobo.826.2">
     After that, we implement the two
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.827.1">
      remaining
     </span>
    </span>
    <span class="No-Break">
     <a id="_idIndexMarker369">
     </a>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.828.1">
      functions:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.829.1">
void UBTService_BatteryCheck::OnBecomeRelevant(UBehaviorTreeComponent&amp; OwnerComp, uint8* NodeMemory)
{
    Super::OnBecomeRelevant(OwnerComp, NodeMemory);
    BlackboardComponent = OwnerComp.GetBlackboardComponent();
   const ABaseDummyAIController* AIController =      Cast&lt;ABaseDummyAIController&gt;(OwnerComp.GetAIOwner());
    if (!AIController) return;
    APawn* ControlledPawn = AIController-&gt;GetPawn();
    if (!ControlledPawn) return;
    ControlledCharacter = Cast&lt;ABaseDummyCharacter&gt;(ControlledPawn);
    if (!ControlledCharacter) return;
    ControlledCharacter-&gt;OnBatteryStatusChanged.AddDynamic       (this, &amp;UBTService_BatteryCheck::OnBatteryStatusChange);
}
void UBTService_BatteryCheck::OnCeaseRelevant(UBehaviorTreeComponent&amp;   OwnerComp, uint8* NodeMemory)
{
    Super::OnCeaseRelevant(OwnerComp, NodeMemory);
    ControlledCharacter-&gt;OnBatteryStatusChanged.RemoveDynamic       (this, &amp;UBTService_BatteryCheck::OnBatteryStatusChange);
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.830.1">
     These two
    </span>
    <a id="_idIndexMarker370">
    </a>
    <span class="koboSpan" id="kobo.831.1">
     functions register and unregister the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.832.1">
      OnBatteryStatusChanged
     </span>
    </strong>
    <span class="koboSpan" id="kobo.833.1">
     delegate; additionally,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.834.1">
      OnBecomeRelevantFunction()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.835.1">
     saves a reference to the Blackboard component and the AI controller – something
    </span>
    <a id="_idIndexMarker371">
    </a>
    <span class="koboSpan" id="kobo.836.1">
     we can do because we use an instanced node for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.837.1">
      this service.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.838.1">
     In this extensive section, you acquired the knowledge to create custom tasks and services in C++.
    </span>
    <span class="koboSpan" id="kobo.838.2">
     Often, the pre-built classes provided by Unreal Engine may not suffice to create engaging AI behaviors.
    </span>
    <span class="koboSpan" id="kobo.838.3">
     Hence, it becomes essential to develop your own distinctive nodes.
    </span>
    <span class="koboSpan" id="kobo.838.4">
     In the forthcoming section, we will create such new classes to construct a fully operational
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.839.1">
      AI agent.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-163">
    <a id="_idTextAnchor165">
    </a>
    <span class="koboSpan" id="kobo.840.1">
     Setting up a behavior tree on an agent
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.841.1">
     To begin delving into the AI agent behavior tree, the first step is to compile the entire project.
    </span>
    <span class="koboSpan" id="kobo.841.2">
     Once the process is finished, your custom tasks and services will be available as an option in the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.842.1">
      behavior tree.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.843.1">
     Note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.844.1">
     If you are unfamiliar with the Unreal Engine compilation process, my advice is to take a peek at
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.845.1">
      Appendix A
     </span>
    </em>
    <span class="koboSpan" id="kobo.846.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.847.1">
      Understanding C++ in Unreal Engine
     </span>
    </em>
    <span class="koboSpan" id="kobo.848.1">
     , and then return to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.849.1">
      this chapter.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.850.1">
     Once the compilation phase is finished, we can start editing the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.851.1">
      behavior tree.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-164">
    <a id="_idTextAnchor166">
    </a>
    <span class="koboSpan" id="kobo.852.1">
     Editing the behavior tree
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.853.1">
     Open the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.854.1">
      BT_RoamerDummy
     </span>
    </strong>
    <span class="koboSpan" id="kobo.855.1">
     asset we
    </span>
    <a id="_idIndexMarker372">
    </a>
    <span class="koboSpan" id="kobo.856.1">
     previously created and locate the only element – the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.857.1">
      ROOT
     </span>
    </strong>
    <span class="koboSpan" id="kobo.858.1">
     node – present in the graph; you will see that it has a darker area at
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.859.1">
      the bottom.
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer131">
     <span class="koboSpan" id="kobo.860.1">
      <img alt="Figure 8.11 – The ROOT node" src="image/B31016_figure_08.11.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.861.1">
     Figure 8.11 – The ROOT node
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.862.1">
     Clicking and dragging from this area will make all the nodes that can be connected to the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.863.1">
      ROOT
     </span>
    </strong>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.864.1">
      node available.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.865.1">
     Note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.866.1">
     Moving forward, whenever I mention the task of adding a node, I will be requesting that you perform the aforementioned action.
    </span>
    <span class="koboSpan" id="kobo.866.2">
     One such case is depicted in
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.867.1">
       Figure 8
      </span>
     </em>
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.868.1">
       .12
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.869.1">
      .
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer132">
     <span class="koboSpan" id="kobo.870.1">
      <img alt="img" role="presentation" src="image/B31016_figure_08.12.jpg"/>
     </span>
    </div>
   </div>
   <p class="callout">
    <span class="No-Break" lang="en-US" xml:lang="en-US">
     <span class="koboSpan" id="kobo.871.1">
      Figure 8
     </span>
    </span>
    <span lang="en-US" xml:lang="en-US">
     <span class="koboSpan" id="kobo.872.1">
      .12 – Adding
     </span>
    </span>
    <span class="No-Break" lang="en-US" xml:lang="en-US">
     <span class="koboSpan" id="kobo.873.1">
      a node
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.874.1">
     To get started, do the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.875.1">
      following steps:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.876.1">
      Add a
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.877.1">
       Composites
      </span>
     </strong>
     <span class="koboSpan" id="kobo.878.1">
      |
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.879.1">
       Sequence
      </span>
     </strong>
     <span class="koboSpan" id="kobo.880.1">
      node to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.881.1">
       Root
      </span>
     </strong>
     <span class="koboSpan" id="kobo.882.1">
      node, and in the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.883.1">
       Details
      </span>
     </strong>
     <span class="koboSpan" id="kobo.884.1">
      panel, rename it
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.885.1">
        Root Sequence
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.886.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.887.1">
      From the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.888.1">
       Root Sequence
      </span>
     </strong>
     <span class="koboSpan" id="kobo.889.1">
      node, add a
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.890.1">
       Tasks
      </span>
     </strong>
     <span class="koboSpan" id="kobo.891.1">
      |
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.892.1">
        FindRandomLocation
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.893.1">
       node.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.894.1">
      With the newly created node selected, in the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.895.1">
       Details
      </span>
     </strong>
     <span class="koboSpan" id="kobo.896.1">
      panel, set the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.897.1">
       Blackboard Key
      </span>
     </strong>
     <span class="koboSpan" id="kobo.898.1">
      dropdown value
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.899.1">
       to
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.900.1">
        TargetLocation
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.901.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.902.1">
      From the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.903.1">
       Root Sequence
      </span>
     </strong>
     <span class="koboSpan" id="kobo.904.1">
      node, add a
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.905.1">
       Composites
      </span>
     </strong>
     <span class="koboSpan" id="kobo.906.1">
      |
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.907.1">
       Selector
      </span>
     </strong>
     <span class="koboSpan" id="kobo.908.1">
      node at the right of the
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.909.1">
        FindRandomLocation
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.910.1">
       node.
      </span>
     </span>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.911.1">
       Your graph
      </span>
      <a id="_idIndexMarker373">
      </a>
      <span class="koboSpan" id="kobo.912.1">
       should now be similar to the one depicted in
      </span>
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.913.1">
         Figure 8
        </span>
       </em>
      </span>
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.914.1">
         .13
        </span>
       </em>
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.915.1">
        :
       </span>
      </span>
     </p>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer133">
     <span class="koboSpan" id="kobo.916.1">
      <img alt="Figure 8.13 – The initial behavior tree" src="image/B31016_figure_08.13.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.917.1">
     Figure 8.13 – The initial behavior tree
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.918.1">
     We now need to decorate the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.919.1">
      Selector
     </span>
    </strong>
    <span class="koboSpan" id="kobo.920.1">
     node to give it extra abilities.
    </span>
    <span class="koboSpan" id="kobo.920.2">
     To do so, follow
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.921.1">
      these steps:
     </span>
    </span>
   </p>
   <ol>
    <li value="5">
     <span class="koboSpan" id="kobo.922.1">
      Right-click on the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.923.1">
       Selector
      </span>
     </strong>
     <span class="koboSpan" id="kobo.924.1">
      node and select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.925.1">
       Add Decorator
      </span>
     </strong>
     <span class="koboSpan" id="kobo.926.1">
      |
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.927.1">
        Conditional Loop
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.928.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.929.1">
      Right-click one more time and select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.930.1">
       Add Service
      </span>
     </strong>
     <span class="koboSpan" id="kobo.931.1">
      |
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.932.1">
        Battery Check
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.933.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.934.1">
      Click on the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.935.1">
       Conditional Loop
      </span>
     </strong>
     <span class="koboSpan" id="kobo.936.1">
      decorator, and in the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.937.1">
       Details
      </span>
     </strong>
     <span class="koboSpan" id="kobo.938.1">
      panel, set the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.939.1">
       Blackboard Key
      </span>
     </strong>
     <span class="koboSpan" id="kobo.940.1">
      attribute dropdown to
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.941.1">
       TargetLocation
      </span>
     </strong>
     <span class="koboSpan" id="kobo.942.1">
      .
     </span>
     <span class="koboSpan" id="kobo.942.2">
      The
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.943.1">
       Key Query
      </span>
     </strong>
     <span class="koboSpan" id="kobo.944.1">
      attribute should be left to
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.945.1">
        Is Set
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.946.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.947.1">
      Click on the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.948.1">
       BatteryCheck
      </span>
     </strong>
     <span class="koboSpan" id="kobo.949.1">
      service, and in the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.950.1">
       Details
      </span>
     </strong>
     <span class="koboSpan" id="kobo.951.1">
      panel, do
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.952.1">
       the following:
      </span>
     </span>
     <ul>
      <li>
       <span class="koboSpan" id="kobo.953.1">
        Set the
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.954.1">
         Is Low on Battery Key
        </span>
       </strong>
       <span class="koboSpan" id="kobo.955.1">
        dropdown value
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.956.1">
         to
        </span>
       </span>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.957.1">
          IsLowOnBattery
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.958.1">
         .
        </span>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.959.1">
        Set the
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.960.1">
         Is Battery Depleted Key
        </span>
       </strong>
       <span class="koboSpan" id="kobo.961.1">
        dropdown value
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.962.1">
         to
        </span>
       </span>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.963.1">
          IsBatteryDepleted
         </span>
        </strong>
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.964.1">
         .
        </span>
       </span>
      </li>
     </ul>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.965.1">
       The
      </span>
      <strong class="bold">
       <span class="koboSpan" id="kobo.966.1">
        Selector
       </span>
      </strong>
      <span class="koboSpan" id="kobo.967.1">
       node should now look similar to
      </span>
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.968.1">
         Figure 8
        </span>
       </em>
      </span>
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.969.1">
         .14
        </span>
       </em>
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.970.1">
        :
       </span>
      </span>
     </p>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer134">
     <span class="koboSpan" id="kobo.971.1">
      <img alt="Figure 8.14 – The decorated Selector node" src="image/B31016_figure_08.14.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.972.1">
     Figure 8.14 – The decorated Selector node
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.973.1">
     Note that the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.974.1">
      BatteryCheck
     </span>
    </strong>
    <span class="koboSpan" id="kobo.975.1">
     service should show a
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.976.1">
      never ticks
     </span>
    </strong>
    <span class="koboSpan" id="kobo.977.1">
     comment; this is what we set when we implemented the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.978.1">
      C++ class.
     </span>
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.979.1">
     What we
    </span>
    <a id="_idIndexMarker374">
    </a>
    <span class="koboSpan" id="kobo.980.1">
     have done so far is basically the main loop of the AI agent behavior; we start by finding a target location for the AI agent, and then we execute a
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.981.1">
      Selector
     </span>
    </strong>
    <span class="koboSpan" id="kobo.982.1">
     node that will be waiting for battery status notifications.
    </span>
    <span class="koboSpan" id="kobo.982.2">
     The
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.983.1">
      Conditional Loop
     </span>
    </strong>
    <span class="koboSpan" id="kobo.984.1">
     decorator will keep on repeating the child nodes (still to be added) while the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.985.1">
      TargetLocation
     </span>
    </strong>
    <span class="koboSpan" id="kobo.986.1">
     key
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.987.1">
      is set.
     </span>
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.988.1">
     Now, we will focus on the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.989.1">
      Selector
     </span>
    </strong>
    <span class="koboSpan" id="kobo.990.1">
     node and do
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.991.1">
      the following:
     </span>
    </span>
   </p>
   <ol>
    <li value="9">
     <span class="koboSpan" id="kobo.992.1">
      Add a
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.993.1">
       Composite
      </span>
     </strong>
     <span class="koboSpan" id="kobo.994.1">
      |
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.995.1">
       Sequence
      </span>
     </strong>
     <span class="koboSpan" id="kobo.996.1">
      child node and rename it
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.997.1">
        Roam Sequence
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.998.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.999.1">
      Add a
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1000.1">
       Task
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1001.1">
      |
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1002.1">
       Wait
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1003.1">
      child node, and in its
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1004.1">
       Details
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1005.1">
      panel, do
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1006.1">
       the following:
      </span>
     </span>
     <ul>
      <li>
       <span class="koboSpan" id="kobo.1007.1">
        Set the
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1008.1">
         Wait Time
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1009.1">
        value
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1010.1">
         to
        </span>
       </span>
       <span class="No-Break">
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.1011.1">
          8.0
         </span>
        </strong>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.1012.1">
        Set the
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1013.1">
         Random Deviation
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1014.1">
        value
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1015.1">
         to
        </span>
       </span>
       <span class="No-Break">
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.1016.1">
          2.0
         </span>
        </strong>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.1017.1">
        Set the
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1018.1">
         Node Name
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1019.1">
        as
       </span>
       <span class="No-Break">
        <strong class="source-inline">
         <span class="koboSpan" id="kobo.1020.1">
          Recharge Battery
         </span>
        </strong>
       </span>
      </li>
     </ul>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.1021.1">
       We need to decorate the
      </span>
      <strong class="bold">
       <span class="koboSpan" id="kobo.1022.1">
        Roam Sequence
       </span>
      </strong>
      <span class="koboSpan" id="kobo.1023.1">
       node with extra capabilities, so we do
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1024.1">
        the following:
       </span>
      </span>
     </p>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1025.1">
      Right-click on the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1026.1">
       Roam Sequence
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1027.1">
      node and select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1028.1">
       Add Decorator
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1029.1">
      |
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1030.1">
        Blackboard
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1031.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1032.1">
      With the decorator selected, do the following in the
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1033.1">
        Details
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1034.1">
       panel:
      </span>
     </span>
     <ul>
      <li>
       <span class="koboSpan" id="kobo.1035.1">
        Set the
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1036.1">
         Notify Observers
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1037.1">
        dropdown value to
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1038.1">
         On
        </span>
       </strong>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.1039.1">
          Value Change
         </span>
        </strong>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.1040.1">
        Set the
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1041.1">
         Observer aborts
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1042.1">
        dropdown value
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1043.1">
         to
        </span>
       </span>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.1044.1">
          Self
         </span>
        </strong>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.1045.1">
        Set the
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1046.1">
         Key Query
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1047.1">
        dropdown value to
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1048.1">
         Is
        </span>
       </strong>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.1049.1">
          Not Set
         </span>
        </strong>
       </span>
      </li>
      <li>
       <span class="koboSpan" id="kobo.1050.1">
        Set the
       </span>
       <strong class="bold">
        <span class="koboSpan" id="kobo.1051.1">
         Blackboard Key
        </span>
       </strong>
       <span class="koboSpan" id="kobo.1052.1">
        dropdown value
       </span>
       <span class="No-Break">
        <span class="koboSpan" id="kobo.1053.1">
         to
        </span>
       </span>
       <span class="No-Break">
        <strong class="bold">
         <span class="koboSpan" id="kobo.1054.1">
          IsBatteryDepleted
         </span>
        </strong>
       </span>
      </li>
     </ul>
     <p class="list-inset">
      <span class="koboSpan" id="kobo.1055.1">
       This portion of the graph should now look like
      </span>
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.1056.1">
         Figure 8
        </span>
       </em>
      </span>
      <span class="No-Break">
       <em class="italic">
        <span class="koboSpan" id="kobo.1057.1">
         .15
        </span>
       </em>
      </span>
      <span class="No-Break">
       <span class="koboSpan" id="kobo.1058.1">
        :
       </span>
      </span>
     </p>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer135">
     <span class="koboSpan" id="kobo.1059.1">
      <img alt="Figure 8.15 – The roam loop" src="image/B31016_figure_08.15.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1060.1">
     Figure 8.15 – The roam loop
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.1061.1">
     This portion of the graph will constantly loop between two phases – a roam sequence and a
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1062.1">
      Wait
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1063.1">
     node.
    </span>
    <span class="koboSpan" id="kobo.1063.2">
     The AI agent will stay in the roam sequence until the battery has been depleted.
    </span>
    <span class="koboSpan" id="kobo.1063.3">
     After that, it will stay still for between 6 and 10 seconds (so that the battery will recharge) and then revert
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1064.1">
      to roaming.
     </span>
    </span>
   </p>
   <p class="list-inset">
    <span class="koboSpan" id="kobo.1065.1">
     The last step we need to
    </span>
    <a id="_idIndexMarker375">
    </a>
    <span class="koboSpan" id="kobo.1066.1">
     take is to implement the roaming nodes.
    </span>
    <span class="koboSpan" id="kobo.1066.2">
     To do this, from the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1067.1">
      Roam Sequence
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1068.1">
     node, do
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1069.1">
      the following:
     </span>
    </span>
   </p>
   <ol>
    <li value="13">
     <span class="koboSpan" id="kobo.1070.1">
      Add a
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1071.1">
       Tasks
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1072.1">
      |
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1073.1">
       Move To
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1074.1">
      node, and in the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1075.1">
       Details
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1076.1">
      panel, set the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1077.1">
       Blackboard Key
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1078.1">
      dropdown value
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1079.1">
       to
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1080.1">
        TargetLocation
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1081.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1082.1">
      Add a
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1083.1">
       Tasks
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1084.1">
      |
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1085.1">
       FindRandomLocation
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1086.1">
      node and, in the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1087.1">
       Details
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1088.1">
      panel, set the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1089.1">
       Target Tag
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1090.1">
      value
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1091.1">
       to
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1092.1">
        TargetPoint
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1093.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1094.1">
      Add a
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1095.1">
       Tasks
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1096.1">
      |
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1097.1">
       Wait
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1098.1">
      node, leaving its properties to their
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1099.1">
       default values.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1100.1">
      We need to add extra functionality to the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1101.1">
       Move To
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1102.1">
      node, so right-click on it and select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1103.1">
       Add Service
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1104.1">
      |
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1105.1">
       Speed Control
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1106.1">
      .
     </span>
     <span class="koboSpan" id="kobo.1106.2">
      This portion of the graph should look like
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1107.1">
        Figure 8
       </span>
      </em>
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1108.1">
        .16
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1109.1">
       :
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer136">
     <span class="koboSpan" id="kobo.1110.1">
      <img alt="Figure 8.16 – The roam sequence" src="image/B31016_figure_08.16.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1111.1">
     Figure 8.16 – The roam sequence
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1112.1">
     What we are doing
    </span>
    <a id="_idIndexMarker376">
    </a>
    <span class="koboSpan" id="kobo.1113.1">
     here is pretty straightforward; we try to reach the target point and, once reached, search for another one, and then get some well-deserved rest by waiting a random time interval.
    </span>
    <span class="koboSpan" id="kobo.1113.2">
     While moving, we constantly check the battery status, changing the speed of the AI
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1114.1">
      agent accordingly.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1115.1">
     Great news!
    </span>
    <span class="koboSpan" id="kobo.1115.2">
     The behavior tree graph has been completed.
    </span>
    <span class="koboSpan" id="kobo.1115.3">
     Now, we can attach it to our dummy puppet and witness its behavior.
    </span>
    <span class="koboSpan" id="kobo.1115.4">
     However, before we proceed, we need to create some suitable Blueprints to ensure that everything
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1116.1">
      functions smoothly.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-165">
    <a id="_idTextAnchor167">
    </a>
    <span class="koboSpan" id="kobo.1117.1">
     Creating the AI agent Blueprints
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1118.1">
     When working with Unreal
    </span>
    <a id="_idIndexMarker377">
    </a>
    <span class="koboSpan" id="kobo.1119.1">
     Engine, it is considered good practice to create a Blueprint from a C++ class.
    </span>
    <span class="koboSpan" id="kobo.1119.2">
     This approach offers several advantages, such as flexibility and extensibility, that contribute to a more efficient development process.
    </span>
    <span class="koboSpan" id="kobo.1119.3">
     That’s why we are going to create some Blueprints from our previously
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1120.1">
      created classes.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.1121.1">
     Creating the controller Blueprint
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.1122.1">
     Let’s start by
    </span>
    <a id="_idIndexMarker378">
    </a>
    <span class="koboSpan" id="kobo.1123.1">
     extending the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1124.1">
      BaseDummyAIController
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1125.1">
     class into a Blueprint.
    </span>
    <span class="koboSpan" id="kobo.1125.2">
     To do so, in your
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1126.1">
      Content Browser
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1127.1">
     , create a new folder, name it
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1128.1">
      Blueprints
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1129.1">
     , and then follow
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1130.1">
      these steps:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1131.1">
      Create a new Blueprint class deriving from
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1132.1">
       BaseDummyAIController
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1133.1">
      , and name
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1134.1">
       it
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1135.1">
        AIRoamerDummyController
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1136.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1137.1">
      Open it, and in the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1138.1">
       Class Defaults
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1139.1">
      panel, look for the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1140.1">
       Dummy AI Controller
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1141.1">
      category and set the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1142.1">
       Behavior Tree
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1143.1">
      attribute
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1144.1">
       to
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1145.1">
        BT_RoamerDummy
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1146.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer137">
     <span class="koboSpan" id="kobo.1147.1">
      <img alt="Figure 8.17 – Assigning the behavior tree" src="image/B31016_figure_08.17.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1148.1">
     Figure 8.17 – Assigning the behavior tree
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1149.1">
     This is all you
    </span>
    <a id="_idIndexMarker379">
    </a>
    <span class="koboSpan" id="kobo.1150.1">
     need to do to set up the AI controller for the roamer dummy character; we will now create the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1151.1">
      dedicated character.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.1152.1">
     Creating the character Blueprint
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.1153.1">
     To create a
    </span>
    <a id="_idIndexMarker380">
    </a>
    <span class="koboSpan" id="kobo.1154.1">
     character Blueprint, follow
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1155.1">
      these steps:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1156.1">
      In the
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1157.1">
       Blueprints
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1158.1">
      folder of your
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1159.1">
       Content Browser
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1160.1">
      create a new Blueprint class deriving from
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1161.1">
       BaseDummyCharacter
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1162.1">
      , and name
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1163.1">
       it
      </span>
     </span>
     <span class="No-Break">
      <strong class="source-inline">
       <span class="koboSpan" id="kobo.1164.1">
        BP_RoamerDummyCharacter
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1165.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1166.1">
      Open it, and in the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1167.1">
       Class Defaults
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1168.1">
      panel, look for the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1169.1">
       AI Controller Class
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1170.1">
      attribute located in the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1171.1">
       Pawn
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1172.1">
      category.
     </span>
     <span class="koboSpan" id="kobo.1172.2">
      From the dropdown menu,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1173.1">
       select
      </span>
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1174.1">
        AIRoamerDummyController
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1175.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.1176.1">
     Congratulations on creating your very own roamer agent!
    </span>
    <span class="koboSpan" id="kobo.1176.2">
     Now, we just need to add one final touch to make it even better – a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1177.1">
      battery indicator.
     </span>
    </span>
   </p>
   <h3>
    <span class="koboSpan" id="kobo.1178.1">
     Adding cosmetics
    </span>
   </h3>
   <p>
    <span class="koboSpan" id="kobo.1179.1">
     To provide
    </span>
    <a id="_idIndexMarker381">
    </a>
    <span class="koboSpan" id="kobo.1180.1">
     visual feedback on the AI agent’s status, we will create a component that displays the battery charge level through a light.
    </span>
    <span class="koboSpan" id="kobo.1180.2">
     This visual indicator will adjust the intensity of the light based on the current charge level.
    </span>
    <span class="koboSpan" id="kobo.1180.3">
     The higher the charge, the more intense the light will be.
    </span>
    <span class="koboSpan" id="kobo.1180.4">
     This will allow users to easily gauge the agent’s battery status at a glance, enhancing the overall user experience and ensuring they are aware of the agent’s
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1181.1">
      power level.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1182.1">
     Let’s start by creating a new C++ class that inherits from the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1183.1">
      StaticMeshComponent
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1184.1">
     class, calling it
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1185.1">
      BatteryInjdicatorComponent
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1186.1">
     .
    </span>
    <span class="koboSpan" id="kobo.1186.2">
     Once the class has been created, open the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1187.1">
      BatteryIndicatorComponent.h
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1188.1">
     file and replace the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1189.1">
      UCLASS()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1190.1">
     line with the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1191.1">
      following one:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1192.1">
UCLASS(BlueprintType, Blueprintable, ClassGroup="Unreal Agility Arena", meta=(BlueprintSpawnableComponent))</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1193.1">
     This will make the component accessible to Blueprints.
    </span>
    <span class="koboSpan" id="kobo.1193.2">
     Then, after the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1194.1">
      GENERATED_BODY()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1195.1">
     line of code, add the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1196.1">
      following code:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1197.1">
public:
UBatteryIndicatorComponent();
protected:
UPROPERTY()
UMaterialInstanceDynamic* DynamicMaterialInstance;
virtual void BeginPlay() override;
UFUNCTION()
void OnBatteryStatusChange(EBatteryStatus NewBatteryStatus);</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1198.1">
     The only
    </span>
    <a id="_idIndexMarker382">
    </a>
    <span class="koboSpan" id="kobo.1199.1">
     things that need an explanation here are the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1200.1">
      DynamicMaterialInstance
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1201.1">
     property, which will be used to change the material intensity property to make it more or less bright, and the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1202.1">
      OnBatteryStatusChange()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1203.1">
     function, which will be used to handle battery status
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1204.1">
      change events.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1205.1">
     Now, to start implementing the component, open the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1206.1">
      BatteryIndicatorComponent.cpp
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1207.1">
     file, and add the following declaration at the top
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1208.1">
      of it:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1209.1">
#include "BaseDummyCharacter.h"</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1210.1">
     The constructor just needs to set the static mesh asset, so add this piece
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1211.1">
      of code:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1212.1">
UBatteryIndicatorComponent::UBatteryIndicatorComponent()
{
    static ConstructorHelpers::FObjectFinder&lt;UStaticMesh&gt;       StaticMeshAsset(
       TEXT("/Game/_GENERATED/MarcoSecchi/SM_HeadLight.SM_         Headlight"));
    if (StaticMeshAsset.Succeeded())
    {
       UStaticMeshComponent::SetStaticMesh(StaticMeshAsset.Object);
    }
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1213.1">
     Next, implement
    </span>
    <a id="_idIndexMarker383">
    </a>
    <span class="koboSpan" id="kobo.1214.1">
     the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1215.1">
      BeginPlay()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1216.1">
     function by adding this block
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1217.1">
      of code:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1218.1">
void UBatteryIndicatorComponent::BeginPlay()
{
    Super::BeginPlay();
    ABaseDummyCharacter* Owner =       Cast&lt;ABaseDummyCharacter&gt;(GetOwner());
    if(Owner == nullptr) return;
    AttachToComponent(Owner-&gt;GetMesh(),       FAttachmentTransformRules::SnapToTargetIncludingScale, "helmet");
    DynamicMaterialInstance = this-&gt;CreateDynamicMaterialInstance       (1, GetMaterial(1));
   Owner-&gt;OnBatteryStatusChanged.AddDynamic      (this, &amp;UBatteryIndicatorComponent::OnBatteryStatusChange);
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1219.1">
     In this function, we check whether the owner of this component is an instance of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1220.1">
      BaseDummyCharacter
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1221.1">
     class.
    </span>
    <span class="koboSpan" id="kobo.1221.2">
     Next, we attach this component to the owner’s mesh component on
    </span>
    <a id="_idIndexMarker384">
    </a>
    <span class="koboSpan" id="kobo.1222.1">
     a socket named
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1223.1">
      helmet
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1224.1">
     – a socket I already provided for you in the dummy skeletal mesh, as you can see in
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.1225.1">
       Figure 8
      </span>
     </em>
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.1226.1">
       .18
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1227.1">
      :
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer138">
     <span class="koboSpan" id="kobo.1228.1">
      <img alt="Figure 8.18 – The helmet socket" src="image/B31016_figure_08.18.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1229.1">
     Figure 8.18 – The helmet socket
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1230.1">
     After that, we create a dynamic material instance for this component – this will let us modify the material properties at runtime.
    </span>
    <span class="koboSpan" id="kobo.1230.2">
     Finally, we add an event handler to the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1231.1">
      OnBatteryStatusChanged
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1232.1">
     event of the owner character, which calls the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1233.1">
      OnBatteryStatusChange
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1234.1">
     function of this component whenever the battery status of the owner
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1235.1">
      character changes.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1236.1">
     With this function complete, we just need to add the event handler to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1237.1">
      our code:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.1238.1">
void UBatteryIndicatorComponent::OnBatteryStatusChange(EBatteryStatus NewBatteryStatus)
{
    const auto BatteryValue = StaticCast&lt;float&gt;(NewBatteryStatus);
    const auto Intensity = (BatteryValue - 1.f) * 25.f;
    DynamicMaterialInstance-&gt;SetScalarParameterValue(FName       ("Intensity"), Intensity);
}</span></pre>
   <p>
    <span class="koboSpan" id="kobo.1239.1">
     Here, we
    </span>
    <a id="_idIndexMarker385">
    </a>
    <span class="koboSpan" id="kobo.1240.1">
     convert the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1241.1">
      NewBatteryStatus
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1242.1">
     enum to a
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1243.1">
      float
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1244.1">
     value, calculate the light intensity, and then set a scalar parameter,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.1245.1">
      Intensity
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1246.1">
     , in the dynamic
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1247.1">
      material instance.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1248.1">
     We can finally compile the project to make this component available to the character.
    </span>
    <span class="koboSpan" id="kobo.1248.2">
     Once the compilation process is finished, open the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1249.1">
      BP_RoamerDummy
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1250.1">
     Blueprint and do
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1251.1">
      the following:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1252.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1253.1">
       Components
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1254.1">
      panel, click the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1255.1">
       +
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1256.1">
        Add
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1257.1">
       button.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1258.1">
      Select
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1259.1">
       UnrealAgilityArena
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1260.1">
      |
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1261.1">
       Battery Indicator
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1262.1">
      to add this component to
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1263.1">
       the character.
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer139">
     <span class="koboSpan" id="kobo.1264.1">
      <img alt="Figure 8.19 – Adding a component" src="image/B31016_figure_08.19.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1265.1">
     Figure 8.19 – Adding a component
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1266.1">
     Your dummy character is all set and eagerly awaiting to be tested at a suitable
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1267.1">
      gym level.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-166">
    <a id="_idTextAnchor168">
    </a>
    <span class="koboSpan" id="kobo.1268.1">
     Testing an agent in a gym
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.1269.1">
     We are now
    </span>
    <a id="_idIndexMarker386">
    </a>
    <span class="koboSpan" id="kobo.1270.1">
     ready to create a gym for our AI agent and see how it behaves.
    </span>
    <span class="koboSpan" id="kobo.1270.2">
     As you already know from
    </span>
    <a href="B31016_04.xhtml#_idTextAnchor073">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1271.1">
        Chapter 4
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.1272.1">
     ,
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.1273.1">
      Setting Up a Navigation Mesh
     </span>
    </em>
    <span class="koboSpan" id="kobo.1274.1">
     , how to properly set up a gym with a nav mesh, I won’t dive into the creation details.
    </span>
    <span class="koboSpan" id="kobo.1274.2">
     Instead, I will give you some generic info about the level creation.
    </span>
    <span class="koboSpan" id="kobo.1274.3">
     Here is what you
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1275.1">
      should do:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1276.1">
      Create a level of your choice, starting from the Level Instances and Packed Level Actors I provided in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1277.1">
       project template
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1278.1">
      Add a
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1279.1">
       NavMeshBoundsVolume
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1280.1">
      actor so that it will cover all the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1281.1">
       walkable areas
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1282.1">
      Add some obstacles to make things
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1283.1">
       more interesting
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1284.1">
      Add one or more
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1285.1">
        BP_RoamerDummyCharacter
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1286.1">
       instances
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1287.1">
      Add some
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1288.1">
       NS_Target
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1289.1">
      Niagara actors that will work as
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1290.1">
       target points
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.1291.1">
     The only thing worth noting is that your AI agent will look for target points with the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.1292.1">
      TargetPoint
     </span>
    </strong>
    <span class="koboSpan" id="kobo.1293.1">
     tag.
    </span>
    <span class="koboSpan" id="kobo.1293.2">
     If you are unfamiliar with the tag system, here’s how to tag
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1294.1">
      your actors:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.1295.1">
      For each
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1296.1">
       NS_Target
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1297.1">
      Niagara system, search for the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1298.1">
       Tags
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1299.1">
      attribute located in the
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.1300.1">
        Details
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1301.1">
       panel.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1302.1">
      Click the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1303.1">
       +
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1304.1">
      button to add a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1305.1">
       new tag.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1306.1">
      In the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.1307.1">
       Index [0]
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1308.1">
      field that will be created, insert
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.1309.1">
       TargetPoint
      </span>
     </strong>
     <span class="koboSpan" id="kobo.1310.1">
      , as shown in
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1311.1">
        Figure 8
       </span>
      </em>
     </span>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.1312.1">
        .20
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1313.1">
       .
      </span>
     </span>
    </li>
   </ol>
   <div>
    <div class="IMG---Figure" id="_idContainer140">
     <span class="koboSpan" id="kobo.1314.1">
      <img alt="Figure 8.20 – The actor tag" src="image/B31016_figure_08.20.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1315.1">
     Figure 8.20 – The actor tag
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1316.1">
     Once your level is finished, you are ready to start testing it; mine is shown in
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.1317.1">
       Figure 8
      </span>
     </em>
    </span>
    <span class="No-Break">
     <em class="italic">
      <span class="koboSpan" id="kobo.1318.1">
       .21
      </span>
     </em>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1319.1">
      :
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer141">
     <span class="koboSpan" id="kobo.1320.1">
      <img alt="Figure 8.21 – The finished level" src="image/B31016_figure_08.21.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.1321.1">
     Figure 8.21 – The finished level
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1322.1">
     Upon starting
    </span>
    <a id="_idIndexMarker387">
    </a>
    <span class="koboSpan" id="kobo.1323.1">
     the simulation, you should see the following
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1324.1">
      things happen:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.1325.1">
      Depending on the starting battery charge (which is randomized), your AI agents will start to run, walk, or
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1326.1">
       stand still
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1327.1">
      They will try to reach a target point, and once reached, they will rest for about a second and then look for
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1328.1">
       another one
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1329.1">
      If the battery charge is low, they will start walking instead
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1330.1">
       of running
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1331.1">
      If the battery charge is depleted, they will stop, start recharging, and then start
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1332.1">
       running again
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.1333.1">
      The headlight should be brighter when the AI agent is fully charged and turn off when
     </span>
     <a id="_idIndexMarker388">
     </a>
     <span class="koboSpan" id="kobo.1334.1">
      the battery
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.1335.1">
       is low
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.1336.1">
     That ends this section, where you have learned how to build a fully working behavior tree, including creating your customized tasks
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1337.1">
      and services.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-167">
    <a id="_idTextAnchor169">
    </a>
    <span class="koboSpan" id="kobo.1338.1">
     Summary
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.1339.1">
     In this quite lengthy chapter, you were introduced to the basics of creating a behavior tree in Unreal Engine.
    </span>
    <span class="koboSpan" id="kobo.1339.2">
     As you have learned, creating a fully working AI agent is a mixture of out-of-the-box features, custom classes, and a bit
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1340.1">
      of ingenuity.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.1341.1">
     We’re just getting started on a fascinating journey that will unfold in the upcoming chapters, starting with the next one, where we’ll dive into the intricate workings of tasks, services, and decorators.
    </span>
    <span class="koboSpan" id="kobo.1341.2">
     Get ready for a significant overhaul to your beloved
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.1342.1">
      dummy puppets!
     </span>
    </span>
   </p>
  </div>
 </body></html>