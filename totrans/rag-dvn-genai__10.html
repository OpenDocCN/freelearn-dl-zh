<html><head></head><body>
  <div id="_idContainer121" class="Basic-Text-Frame">
    <h1 class="chapterNumber"><span class="koboSpan" id="kobo.1.1">10</span></h1>
    <h1 id="_idParaDest-240" class="chapterTitle"><span class="koboSpan" id="kobo.2.1">RAG for Video Stock Production with Pinecone and OpenAI</span></h1>
    <p class="normal"><span class="koboSpan" id="kobo.3.1">Human creativity goes beyond the range of well-known patterns due to our unique ability to break habits and invent new ways of doing anything, anywhere. </span><span class="koboSpan" id="kobo.3.2">Conversely, Generative AI relies on our well-known established patterns across an increasing number of fields without really “creating” but rather replicating our habits. </span><span class="koboSpan" id="kobo.3.3">In this chapter, therefore, when we use the term “create” as a practical term, we only mean “generate.” </span><span class="koboSpan" id="kobo.3.4">Generative AI, with its efficiency in automating tasks, will continue its expansion until it finds ways of replicating any human task it can. </span><span class="koboSpan" id="kobo.3.5">We must, therefore, learn how these automated systems work to use them for the best in our projects. </span><span class="koboSpan" id="kobo.3.6">Think of this chapter as a journey into the architecture of RAG in the cutting-edge hybrid human and AI agent era we are living in. </span><span class="koboSpan" id="kobo.3.7">We will assume the role of a start-up aiming to build an AI-driven downloadable stock of online videos. </span><span class="koboSpan" id="kobo.3.8">To achieve this, we will establish a team of AI agents that will work together to create a stock of commented and labeled videos.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.4.1">Our journey begins with the Generator agent in </span><em class="italic"><span class="koboSpan" id="kobo.5.1">Pipeline 1: The Generator and the Commentator</span></em><span class="koboSpan" id="kobo.6.1">. </span><span class="koboSpan" id="kobo.6.2">The Generator agent creates world simulations using Sora, an OpenAI text-to-video model. </span><span class="koboSpan" id="kobo.6.3">You’ll see how the </span><em class="italic"><span class="koboSpan" id="kobo.7.1">inVideo </span></em><span class="koboSpan" id="kobo.8.1">AI application, powered by Sora, engages in “ideation,” transforming an idea into a video. </span><span class="koboSpan" id="kobo.8.2">The Commentator agent then splits the AI-generated videos into frames and generates technical comments with an OpenAI vision model. </span><span class="koboSpan" id="kobo.8.3">Next, in </span><em class="italic"><span class="koboSpan" id="kobo.9.1">Pipeline 2: The Vector Store Administrator, </span></em><span class="koboSpan" id="kobo.10.1">we will continue our journey and build the Vector Store Administrator that manages Pinecone. </span><span class="koboSpan" id="kobo.10.2">The Vector Store Administrator will embed the technical video comments generated by the Commentator, upsert the vectorized comments, and query the Pinecone vector store to verify that the system is functional. </span><span class="koboSpan" id="kobo.10.3">Finally, we will build the Video Expert that processes user inputs, queries the vector store, and retrieves the relevant video frames. </span><span class="koboSpan" id="kobo.10.4">Finally, in </span><em class="italic"><span class="koboSpan" id="kobo.11.1">Pipeline 3: The Video Expert</span></em><span class="koboSpan" id="kobo.12.1">, the Video Expert agent will augment user inputs with the raw output of the query and activate its expert OpenAI GPT-4o model, which will analyze the comment, detect imperfections, reformulate it more efficiently, and provide a label for the video.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.13.1">By the end of the chapter, you will know how to automatically generate a stock of short videos by automating the process of going from raw footage to videos with descriptions and labels. </span><span class="koboSpan" id="kobo.13.2">You’ll be able to offer a service where users can simply type a few words and obtain a video with a custom, real-time description and label.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.14.1">Summing that up, this chapter covers the following topics:</span></p>
    <ul>
      <li class="bulletList"><span class="koboSpan" id="kobo.15.1">Designing Generative AI videos and comments</span></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.16.1">Splitting videos into frames for OpenAI’s vision analysis models</span></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.17.1">Embedding the videos and upserting the vectors to a Pinecone index</span></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.18.1">Querying the vector store</span></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.19.1">Improving and correcting the video comments with OpenAI GPT-4o</span></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.20.1">Automatically labeling raw videos</span></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.21.1">Displaying the full result of the raw video process with a commented and labeled video</span></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.22.1">Evaluating outputs and implementing metric calculations</span></li>
    </ul>
    <p class="normal"><span class="koboSpan" id="kobo.23.1">Let’s begin by defining the architecture of RAG for video production.</span></p>
    <h1 id="_idParaDest-241" class="heading-1"><span class="koboSpan" id="kobo.24.1">The architecture of RAG for video production</span></h1>
    <p class="normal"><span class="koboSpan" id="kobo.25.1">Automating the process of real-world video generation, commenting, and labeling is extremely relevant in various industries, such as media, marketing, entertainment, and education. </span><span class="koboSpan" id="kobo.25.2">Businesses and creators are continuously seeking efficient ways to produce and manage content that can scale </span><a id="_idIndexMarker583"/><span class="koboSpan" id="kobo.26.1">with growing demand. </span><span class="koboSpan" id="kobo.26.2">In this chapter, you will acquire practical skills that can be directly applied to meet these needs.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.27.1">The goal of our RAG video production use case in this chapter is to process AI-generated videos using AI agents to create a video stock of labeled videos to identify them. </span><span class="koboSpan" id="kobo.27.2">The system will also dynamically generate custom descriptions by pinpointing AI-generated technical comments on specific frames within the videos that fit the user input. </span><em class="italic"><span class="koboSpan" id="kobo.28.1">Figure 10.1</span></em><span class="koboSpan" id="kobo.29.1"> illustrates the AI-agent team that processes RAG for video production:</span></p>
    <p class="packt_figref"><span class="koboSpan" id="kobo.30.1"><img src="../Images/B31169_10_01.png" alt="A diagram of a video production process  Description automatically generated"/></span></p>
    <p class="packt_figref"><span class="koboSpan" id="kobo.31.1">Figure 10.1: From raw videos to labeled and commented videos</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.32.1">We will implement AI agents for </span><a id="_idIndexMarker584"/><span class="koboSpan" id="kobo.33.1">our RAG video production pipeline that will:</span></p>
    <ul>
      <li class="bulletList"><span class="koboSpan" id="kobo.34.1">Generate raw videos automatically and download them</span></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.35.1">Split the videos into frames</span></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.36.1">Analyze a sample of frames</span></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.37.1">Activate an OpenAI LLM model to generate technical comments</span></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.38.1">Save the technical comments with a unique index, the comment itself, the frame number analyzed, and the video file name</span></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.39.1">Upsert the data in a Pinecone index vector store</span></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.40.1">Query the Pinecone vector store with user inputs</span></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.41.1">Retrieve the specific frame within a video that is most similar to its technical comment</span></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.42.1">Augment the user input with the technical comment of the retrieved frame</span></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.43.1">Ask the OpenAI LLM to analyze the logic of the technical comment that may contain contradictions and imperfections detected in the video and then produce a dynamic, well-tailored description of the video with the frame number and the video file name</span></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.44.1">Display the selected video</span></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.45.1">Evaluate the outputs and apply metric calculations</span></li>
    </ul>
    <p class="normal"><span class="koboSpan" id="kobo.46.1">We will thus go from raw videos to labeled videos with tailored descriptions based on the user input. </span><span class="koboSpan" id="kobo.46.2">For example, we will be</span><a id="_idIndexMarker585"/><span class="koboSpan" id="kobo.47.1"> able to ask precise questions such as the following:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-string"><span class="koboSpan" id="kobo.48.1">"Find a basketball player that is scoring with a dunk."</span></span>
</code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.49.1">This means that the system will be able to find a frame (image) within the initially unlabeled video, select the video, display it, and generate a tailored comment dynamically. </span><span class="koboSpan" id="kobo.49.2">To attain our goal, we will implement AI agents in three pipelines, as illustrated in the following figure:</span></p>
    <p class="packt_figref"><span class="koboSpan" id="kobo.50.1"><img src="../Images/B31169_10_02.png" alt="A diagram of a process  Description automatically generated"/></span></p>
    <p class="packt_figref"><span class="koboSpan" id="kobo.51.1">Figure 10.2: The RAG for Video Production Ecosystem with Generative AI agents</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.52.1">Now, what you see in the figure above is:</span></p>
    <ul>
      <li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.53.1">Pipeline 1</span></strong><span class="koboSpan" id="kobo.54.1">: The </span><strong class="keyWord"><span class="koboSpan" id="kobo.55.1">Generator</span></strong><span class="koboSpan" id="kobo.56.1"> and the </span><strong class="keyWord"><span class="koboSpan" id="kobo.57.1">Commentator</span></strong></li>
    </ul>
    <p class="normal-one"><span class="koboSpan" id="kobo.58.1">The </span><strong class="keyWord"><span class="koboSpan" id="kobo.59.1">Generator</span></strong><span class="koboSpan" id="kobo.60.1"> produces AI-generated videos with OpenAI Sora. </span><span class="koboSpan" id="kobo.60.2">The </span><strong class="keyWord"><span class="koboSpan" id="kobo.61.1">Commentator</span></strong><span class="koboSpan" id="kobo.62.1"> splits the videos into</span><a id="_idIndexMarker586"/><span class="koboSpan" id="kobo.63.1"> frames that are commented on by one of OpenAI’s vision models. </span><span class="koboSpan" id="kobo.63.2">The </span><strong class="keyWord"><span class="koboSpan" id="kobo.64.1">Commentator</span></strong><span class="koboSpan" id="kobo.65.1"> agent then saves the comments.</span></p>
    <ul>
      <li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.66.1">Pipeline 2</span></strong><span class="koboSpan" id="kobo.67.1">: </span><strong class="keyWord"><span class="koboSpan" id="kobo.68.1">The Vector Store Administrator</span></strong></li>
    </ul>
    <p class="normal-one"><span class="koboSpan" id="kobo.69.1">This pipeline will embed and upsert the comments made by </span><em class="italic"><span class="koboSpan" id="kobo.70.1">Pipeline 1</span></em><span class="koboSpan" id="kobo.71.1"> to a Pinecone index.</span></p>
    <ul>
      <li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.72.1">Pipeline 3</span></strong><span class="koboSpan" id="kobo.73.1">: </span><strong class="keyWord"><span class="koboSpan" id="kobo.74.1">The Video Expert</span></strong></li>
    </ul>
    <p class="normal-one"><span class="koboSpan" id="kobo.75.1">This pipeline will query the Pinecone vector store based on user input. </span><span class="koboSpan" id="kobo.75.2">The query will return the most similar frame within a video, augment the input with the technical comment, and ask OpenAI GPT-4o to find logic imperfections in the video, point them out, and then produce a tailored comment of the video for the user and a label. </span><span class="koboSpan" id="kobo.75.3">This section also contains evaluation functions (the Evaluator) and metric calculations.</span></p>
    <div class="note">
      <p class="normal"><span class="koboSpan" id="kobo.76.1">Time measurement functions are encapsulated in several of the key functions of the preceding ecosystem.</span></p>
    </div>
    <p class="normal"><span class="koboSpan" id="kobo.77.1">The RAG video production system we will build allows indefinite scaling by processing one video at a time, using only a CPU and little memory, while leveraging Pinecone’s storage capacity. </span><span class="koboSpan" id="kobo.77.2">This effectively demonstrates the concept of automated video production, but implementing this production system in a real-life project requires hard work. </span><span class="koboSpan" id="kobo.77.3">However, the technology is there, and the future of video production is undergoing a historical evolution. </span><span class="koboSpan" id="kobo.77.4">Let’s dive into the code, beginning with the environment.</span></p>
    <h1 id="_idParaDest-242" class="heading-1"><span class="koboSpan" id="kobo.78.1">The environment of the video production ecosystem</span></h1>
    <p class="normal"><span class="koboSpan" id="kobo.79.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.80.1">Chapter10</span></code><span class="koboSpan" id="kobo.81.1"> directory</span><a id="_idIndexMarker587"/><span class="koboSpan" id="kobo.82.1"> on GitHub contains the environment for all four </span><a id="_idIndexMarker588"/><span class="koboSpan" id="kobo.83.1">notebooks in this chapter:</span></p>
    <ul>
      <li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.84.1">Videos_dataset_visualization.ipynb</span></code></li>
      <li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.85.1">Pipeline_1_The_Generator_and_the_Commentator.ipynb</span></code></li>
      <li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.86.1">Pipeline_2_The_Vector_Store_Administrator.ipynb</span></code></li>
      <li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.87.1">Pipeline_3_The_Video_Expert.ipynb</span></code></li>
    </ul>
    <p class="normal"><span class="koboSpan" id="kobo.88.1">Each notebook includes an </span><em class="italic"><span class="koboSpan" id="kobo.89.1">Installing the environment</span></em><span class="koboSpan" id="kobo.90.1"> section, including a set of the following sections that</span><a id="_idIndexMarker589"/><span class="koboSpan" id="kobo.91.1"> are identical across all notebooks:</span></p>
    <ul>
      <li class="bulletList"><em class="italic"><span class="koboSpan" id="kobo.92.1">Importing modules and libraries</span></em></li>
      <li class="bulletList"><em class="italic"><span class="koboSpan" id="kobo.93.1">GitHub</span></em></li>
      <li class="bulletList"><em class="italic"><span class="koboSpan" id="kobo.94.1">Video download and display functions</span></em></li>
      <li class="bulletList"><em class="italic"><span class="koboSpan" id="kobo.95.1">OpenAI</span></em></li>
      <li class="bulletList"><em class="italic"><span class="koboSpan" id="kobo.96.1">Pinecone</span></em></li>
    </ul>
    <p class="normal"><span class="koboSpan" id="kobo.97.1">This chapter aims to establish a common pre-production installation policy that will focus on the pipelines’ content once we dive into the RAG for video production code. </span><span class="koboSpan" id="kobo.97.2">This policy is limited to the scenario described in this chapter and will vary depending on the requirements of each real-life production environment.</span></p>
    <div class="note">
      <p class="normal"><span class="koboSpan" id="kobo.98.1">The notebooks in this chapter only require a CPU, limited memory, and limited disk space. </span><span class="koboSpan" id="kobo.98.2">As such, the whole process can be streamlined indefinitely one video at a time in an optimized, scalable environment.</span></p>
    </div>
    <p class="normal"><span class="koboSpan" id="kobo.99.1">Let’s begin by importing the modules and libraries we need for our project.</span></p>
    <h2 id="_idParaDest-243" class="heading-2"><span class="koboSpan" id="kobo.100.1">Importing modules and libraries</span></h2>
    <p class="normal"><span class="koboSpan" id="kobo.101.1">The goal is to prepare a pre-production</span><a id="_idIndexMarker590"/><span class="koboSpan" id="kobo.102.1"> global environment common to all the notebooks. </span><span class="koboSpan" id="kobo.102.2">As such, the modules and libraries are present in all four notebooks regardless of whether they are used or not in a specific program:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.103.1">from</span></span><span class="koboSpan" id="kobo.104.1"> IPython.display </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.105.1">import</span></span><span class="koboSpan" id="kobo.106.1"> HTML </span><span class="hljs-comment"><span class="koboSpan" id="kobo.107.1"># to display videos</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.108.1">import</span></span><span class="koboSpan" id="kobo.109.1"> base64 </span><span class="hljs-comment"><span class="koboSpan" id="kobo.110.1"># to encode videos as base64</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.111.1">from</span></span><span class="koboSpan" id="kobo.112.1"> base64 </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.113.1">import</span></span><span class="koboSpan" id="kobo.114.1"> b64encode </span><span class="hljs-comment"><span class="koboSpan" id="kobo.115.1"># to encode videos as base64</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.116.1">import</span></span><span class="koboSpan" id="kobo.117.1"> os </span><span class="hljs-comment"><span class="koboSpan" id="kobo.118.1"># to interact with the operating system</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.119.1">import</span></span><span class="koboSpan" id="kobo.120.1"> subprocess </span><span class="hljs-comment"><span class="koboSpan" id="kobo.121.1"># to run commands</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.122.1">import</span></span><span class="koboSpan" id="kobo.123.1"> time </span><span class="hljs-comment"><span class="koboSpan" id="kobo.124.1"># to measure execution time</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.125.1">import</span></span><span class="koboSpan" id="kobo.126.1"> csv </span><span class="hljs-comment"><span class="koboSpan" id="kobo.127.1"># to save comments</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.128.1">import</span></span><span class="koboSpan" id="kobo.129.1"> uuid </span><span class="hljs-comment"><span class="koboSpan" id="kobo.130.1"># to generate unique ids</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.131.1">import</span></span><span class="koboSpan" id="kobo.132.1"> cv2 </span><span class="hljs-comment"><span class="koboSpan" id="kobo.133.1"># to split videos</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.134.1">from</span></span><span class="koboSpan" id="kobo.135.1"> PIL </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.136.1">import</span></span><span class="koboSpan" id="kobo.137.1"> Image </span><span class="hljs-comment"><span class="koboSpan" id="kobo.138.1"># to display videos</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.139.1">import</span></span><span class="koboSpan" id="kobo.140.1"> pandas </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.141.1">as</span></span><span class="koboSpan" id="kobo.142.1"> pd </span><span class="hljs-comment"><span class="koboSpan" id="kobo.143.1"># to display comments</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.144.1">import</span></span><span class="koboSpan" id="kobo.145.1"> numpy </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.146.1">as</span></span><span class="koboSpan" id="kobo.147.1"> np </span><span class="hljs-comment"><span class="koboSpan" id="kobo.148.1"># to use Numerical Python</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.149.1">from</span></span><span class="koboSpan" id="kobo.150.1"> io </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.151.1">import</span></span><span class="koboSpan" id="kobo.152.1"> BytesIO </span><span class="hljs-comment"><span class="koboSpan" id="kobo.153.1">#to manage a binary stream of data in memory</span></span>
</code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.154.1">Each of the four notebooks </span><a id="_idIndexMarker591"/><span class="koboSpan" id="kobo.155.1">contains these modules and libraries, as shown in the following table:</span></p>
    <table id="table001-2" class="table-container">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.156.1">Code</span></strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord"><span class="koboSpan" id="kobo.157.1">Comment</span></strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.158.1">from IPython.display import HTML</span></code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><span class="koboSpan" id="kobo.159.1">To display videos</span></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.160.1">import base64</span></code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><span class="koboSpan" id="kobo.161.1">To encode videos as </span><code class="inlineCode"><span class="koboSpan" id="kobo.162.1">base64</span></code></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.163.1">from base64 import b64encode</span></code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><span class="koboSpan" id="kobo.164.1">To encode videos as </span><code class="inlineCode"><span class="koboSpan" id="kobo.165.1">base64</span></code></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.166.1">import os</span></code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><span class="koboSpan" id="kobo.167.1">To interact with the operating system</span></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.168.1">import subprocess</span></code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><span class="koboSpan" id="kobo.169.1">To run commands</span></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.170.1">import time</span></code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><span class="koboSpan" id="kobo.171.1">To measure execution time</span></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.172.1">import csv</span></code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><span class="koboSpan" id="kobo.173.1">To save comments</span></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.174.1">import uuid</span></code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><span class="koboSpan" id="kobo.175.1">To generate unique IDs</span></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.176.1">import cv2</span></code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><span class="koboSpan" id="kobo.177.1">To split videos (open source computer vision library)</span></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.178.1">from PIL import Image</span></code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><span class="koboSpan" id="kobo.179.1">To display videos</span></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.180.1">import pandas as pd</span></code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><span class="koboSpan" id="kobo.181.1">To display comments</span></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.182.1">import numpy as np</span></code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><span class="koboSpan" id="kobo.183.1">To use Numerical Python</span></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.184.1">from io import BytesIO</span></code></p>
          </td>
          <td class="table-cell">
            <p class="normal"><span class="koboSpan" id="kobo.185.1">For a binary stream of data in memory</span></p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref"><span class="koboSpan" id="kobo.186.1">Table 10.1: Modules and libraries for our video production system</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.187.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.188.1">Code</span></code><span class="koboSpan" id="kobo.189.1"> column contains the module or library name, while the </span><code class="inlineCode"><span class="koboSpan" id="kobo.190.1">Comment</span></code><span class="koboSpan" id="kobo.191.1"> column provides a brief description of</span><a id="_idIndexMarker592"/><span class="koboSpan" id="kobo.192.1"> their usage. </span><span class="koboSpan" id="kobo.192.2">Let’s move on to GitHub commands.</span></p>
    <h2 id="_idParaDest-244" class="heading-2"><span class="koboSpan" id="kobo.193.1">GitHub</span></h2>
    <p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.194.1">download(directory, filename)</span></code><span class="koboSpan" id="kobo.195.1"> is present</span><a id="_idIndexMarker593"/><span class="koboSpan" id="kobo.196.1"> in all four notebooks. </span><span class="koboSpan" id="kobo.196.2">The main function of </span><code class="inlineCode"><span class="koboSpan" id="kobo.197.1">download(directory, filename)</span></code><span class="koboSpan" id="kobo.198.1"> is to</span><a id="_idIndexMarker594"/><span class="koboSpan" id="kobo.199.1"> download the files we need from the book’s GitHub repository:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.200.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.201.1">download</span></span><span class="koboSpan" id="kobo.202.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.203.1">directory, filename</span></span><span class="koboSpan" id="kobo.204.1">):
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.205.1"># The base URL of the image files in the GitHub repository</span></span><span class="koboSpan" id="kobo.206.1">
    base_url = </span><span class="hljs-string"><span class="koboSpan" id="kobo.207.1">'https://raw.githubusercontent.com/Denis2054/RAG-Driven-Generative-AI/main/'</span></span>
    <span class="hljs-comment"><span class="koboSpan" id="kobo.208.1"># Complete URL for the file</span></span><span class="koboSpan" id="kobo.209.1">
    file_url = </span><span class="hljs-string"><span class="koboSpan" id="kobo.210.1">f"</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.211.1">{base_url}{directory}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.212.1">/</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.213.1">{filename}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.214.1">"</span></span>
    <span class="hljs-comment"><span class="koboSpan" id="kobo.215.1"># Use curl to download the file</span></span>
    <span class="hljs-keyword"><span class="koboSpan" id="kobo.216.1">try</span></span><span class="koboSpan" id="kobo.217.1">:
        </span><span class="hljs-comment"><span class="koboSpan" id="kobo.218.1"># Prepare the curl command</span></span><span class="koboSpan" id="kobo.219.1">
        curl_command = </span><span class="hljs-string"><span class="koboSpan" id="kobo.220.1">f'curl -o </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.221.1">{filename}</span></span><span class="hljs-string"> </span><span class="hljs-subst"><span class="koboSpan" id="kobo.222.1">{file_url}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.223.1">'</span></span>
        <span class="hljs-comment"><span class="koboSpan" id="kobo.224.1"># Execute the curl command</span></span><span class="koboSpan" id="kobo.225.1">
        subprocess.run(curl_command, check=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.226.1">True</span></span><span class="koboSpan" id="kobo.227.1">, shell=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.228.1">True</span></span><span class="koboSpan" id="kobo.229.1">)
        </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.230.1">print</span></span><span class="koboSpan" id="kobo.231.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.232.1">f"Downloaded '</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.233.1">{filename}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.234.1">' successfully."</span></span><span class="koboSpan" id="kobo.235.1">)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.236.1">except</span></span><span class="koboSpan" id="kobo.237.1"> subprocess.CalledProcessError:
        </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.238.1">print</span></span><span class="koboSpan" id="kobo.239.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.240.1">f"Failed to download '</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.241.1">{filename}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.242.1">'. </span><span class="koboSpan" id="kobo.242.2">Check the URL, your internet connection, and if the token is correct and has appropriate permissions."</span></span><span class="koboSpan" id="kobo.243.1">)
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.244.1">The preceding function takes two arguments:</span></p>
    <ul>
      <li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.245.1">directory</span></code><span class="koboSpan" id="kobo.246.1">, which is the GitHub directory that the file we want to download is located in</span></li>
      <li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.247.1">filename</span></code><span class="koboSpan" id="kobo.248.1">, which is the name of the file we want to download</span></li>
    </ul>
    <h2 id="_idParaDest-245" class="heading-2"><span class="koboSpan" id="kobo.249.1">OpenAI</span></h2>
    <p class="normal"><span class="koboSpan" id="kobo.250.1">The OpenAI package is installed in all three</span><a id="_idIndexMarker595"/><span class="koboSpan" id="kobo.251.1"> pipeline </span><a id="_idIndexMarker596"/><span class="koboSpan" id="kobo.252.1">notebooks but not in </span><code class="inlineCode"><span class="koboSpan" id="kobo.253.1">Video_dataset_visualization.ipynb</span></code><span class="koboSpan" id="kobo.254.1">, which doesn’t require an LLM. </span><span class="koboSpan" id="kobo.254.2">You can retrieve the API key from a file or </span><a id="_idIndexMarker597"/><span class="koboSpan" id="kobo.255.1">enter it manually (but it will be visible):</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.256.1">#You can retrieve your API key from a file(1)</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.257.1"># or enter it manually(2)</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.258.1">#Comment this cell if you want to enter your key manually.</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.259.1">#(1)Retrieve the API Key from a file</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.260.1">#Store you key in a file and read it(you can type it directly in the notebook but it will be visible for somebody next to you)</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.261.1">from</span></span><span class="koboSpan" id="kobo.262.1"> google.colab </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.263.1">import</span></span><span class="koboSpan" id="kobo.264.1"> drive
drive.mount(</span><span class="hljs-string"><span class="koboSpan" id="kobo.265.1">'/content/drive'</span></span><span class="koboSpan" id="kobo.266.1">)
f = </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.267.1">open</span></span><span class="koboSpan" id="kobo.268.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.269.1">"drive/MyDrive/files/api_key.txt"</span></span><span class="koboSpan" id="kobo.270.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.271.1">"r"</span></span><span class="koboSpan" id="kobo.272.1">)
API_KEY=f.readline()o
Nf.close()
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.273.1">You will need to sign up at </span><code class="inlineCode"><span class="koboSpan" id="kobo.274.1">www.openai.com</span></code><span class="koboSpan" id="kobo.275.1"> before running the code and obtain an API key. </span><span class="koboSpan" id="kobo.275.2">The program</span><a id="_idIndexMarker598"/><span class="koboSpan" id="kobo.276.1"> installs the </span><code class="inlineCode"><span class="koboSpan" id="kobo.277.1">openai</span></code><span class="koboSpan" id="kobo.278.1"> package:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.279.1">try</span></span><span class="koboSpan" id="kobo.280.1">:
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.281.1">import</span></span><span class="koboSpan" id="kobo.282.1"> openai
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.283.1">except</span></span><span class="koboSpan" id="kobo.284.1">:
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.285.1">#!pip install openai==1.45.0</span></span>
  <span class="hljs-keyword"><span class="koboSpan" id="kobo.286.1">import</span></span><span class="koboSpan" id="kobo.287.1"> openai
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.288.1">Finally, we set an environment variable for the API key:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.289.1">#(2) Enter your manually by</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.290.1"># replacing API_KEY by your key.</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.291.1">#The OpenAI Key</span></span><span class="koboSpan" id="kobo.292.1">
os.environ[</span><span class="hljs-string"><span class="koboSpan" id="kobo.293.1">'OPENAI_API_KEY'</span></span><span class="koboSpan" id="kobo.294.1">] =API_KEY
openai.api_key = os.getenv(</span><span class="hljs-string"><span class="koboSpan" id="kobo.295.1">"OPENAI_API_KEY"</span></span><span class="koboSpan" id="kobo.296.1">)
</span></code></pre>
    <h2 id="_idParaDest-246" class="heading-2"><span class="koboSpan" id="kobo.297.1">Pinecone</span></h2>
    <p class="normal"><span class="koboSpan" id="kobo.298.1">The </span><em class="italic"><span class="koboSpan" id="kobo.299.1">Pinecone</span></em><span class="koboSpan" id="kobo.300.1"> section</span><a id="_idIndexMarker599"/><span class="koboSpan" id="kobo.301.1"> is only present in </span><code class="inlineCode"><span class="koboSpan" id="kobo.302.1">Pipeline_2_The_Vector_Store_Administrator.ipynb</span></code><span class="koboSpan" id="kobo.303.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.304.1">Pipeline_3_The_Video_Expert.ipynb</span></code><span class="koboSpan" id="kobo.305.1"> when the</span><a id="_idIndexMarker600"/><span class="koboSpan" id="kobo.306.1"> Pinecone vector store is required. </span><span class="koboSpan" id="kobo.306.2">The following command installs Pinecone, and then Pinecone is imported:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.307.1">!pip install pinecone-client==</span><span class="hljs-number"><span class="koboSpan" id="kobo.308.1">4.1.1</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.309.1">import</span></span><span class="koboSpan" id="kobo.310.1"> pinecone
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.311.1">The program then retrieves the key from a file (or you can enter it manually):</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.312.1">f = </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.313.1">open</span></span><span class="koboSpan" id="kobo.314.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.315.1">"drive/MyDrive/files/pinecone.txt"</span></span><span class="koboSpan" id="kobo.316.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.317.1">"r"</span></span><span class="koboSpan" id="kobo.318.1">)
PINECONE_API_KEY=f.readline()
f.close()
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.319.1">In production, you can</span><a id="_idIndexMarker601"/><span class="koboSpan" id="kobo.320.1"> set an environment variable or</span><a id="_idIndexMarker602"/><span class="koboSpan" id="kobo.321.1"> implement the method that best fits your project so that the API key is never visible.</span></p>
    <div class="note">
      <p class="normal"><span class="koboSpan" id="kobo.322.1">The </span><em class="italic"><span class="koboSpan" id="kobo.323.1">Evaluator</span></em><span class="koboSpan" id="kobo.324.1"> section of </span><code class="inlineCode"><span class="koboSpan" id="kobo.325.1">Pipeline_3_The_Video_Expert.ipynb</span></code><span class="koboSpan" id="kobo.326.1"> contains its own requirements and installations.</span></p>
    </div>
    <p class="normal"><span class="koboSpan" id="kobo.327.1">With that, we have defined the environment for all four notebooks, which contain the same sub-sections we just described in their respective </span><em class="italic"><span class="koboSpan" id="kobo.328.1">Installing the environment </span></em><span class="koboSpan" id="kobo.329.1">sections. </span><span class="koboSpan" id="kobo.329.2">We can now fully focus on the processes involved in the video production programs. </span><span class="koboSpan" id="kobo.329.3">We will begin with the Generator and Commentator.</span></p>
    <h1 id="_idParaDest-247" class="heading-1"><span class="koboSpan" id="kobo.330.1">Pipeline 1: Generator and Commentator</span></h1>
    <p class="normal"><span class="koboSpan" id="kobo.331.1">A revolution is on its way in computer vision with automated video generation and analysis. </span><span class="koboSpan" id="kobo.331.2">We will introduce the Generator AI agent with Sora in </span><em class="italic"><span class="koboSpan" id="kobo.332.1">The AI-generated video dataset</span></em><span class="koboSpan" id="kobo.333.1"> section. </span><span class="koboSpan" id="kobo.333.2">We will explore how OpenAI Sora was used to generate the videos for this chapter with a text-to-video diffusion transformer. </span><span class="koboSpan" id="kobo.333.3">The technology itself is something we have expected and</span><a id="_idIndexMarker603"/><span class="koboSpan" id="kobo.334.1"> experienced to some extent in professional film-making environments. </span><span class="koboSpan" id="kobo.334.2">However, the novelty relies on the fact that the software has become mainstream in a few clicks, with inVideo, for example!</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.335.1">In the </span><em class="italic"><span class="koboSpan" id="kobo.336.1">The Generator and the Commentator</span></em><span class="koboSpan" id="kobo.337.1"> section, we will extend the scope of the Generator to collecting and processing the AI-generated videos. </span><span class="koboSpan" id="kobo.337.2">The Generator splits the videos into frames and works with the Commentator, an OpenAI LLM, to produce comments on samples of video frames.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.338.1">The Generator’s task begins by producing the AI-generated video dataset.</span></p>
    <h2 id="_idParaDest-248" class="heading-2"><span class="koboSpan" id="kobo.339.1">The AI-generated video dataset</span></h2>
    <p class="normal"><span class="koboSpan" id="kobo.340.1">The first AI agent in this project is a text-to-video diffusion transformer model that generates a video dataset we </span><a id="_idIndexMarker604"/><span class="koboSpan" id="kobo.341.1">will implement. </span><span class="koboSpan" id="kobo.341.2">The videos for this chapter were specifically generated by Sora, a text-to-video AI model released by OpenAI in February 2024. </span><span class="koboSpan" id="kobo.341.3">You can access Sora to view public AI-generated videos and create your own at </span><a href="https://ai.invideo.io/"><span class="url"><span class="koboSpan" id="kobo.342.1">https://ai.invideo.io/</span></span></a><span class="koboSpan" id="kobo.343.1">. </span><span class="koboSpan" id="kobo.343.2">AI-generated videos also allow for</span><a id="_idIndexMarker605"/><span class="koboSpan" id="kobo.344.1"> free videos with flexible copyright terms that you can check out at </span><a href="https://invideo.io/terms-and-conditions/"><span class="url"><span class="koboSpan" id="kobo.345.1">https://invideo.io/terms-and-conditions/</span></span></a><span class="koboSpan" id="kobo.346.1">.</span></p>
    <div class="note">
      <p class="normal"><span class="koboSpan" id="kobo.347.1">Once you have gone through this chapter, you can also create your own video dataset with any source of videos, such as smartphones, video stocks, and social media.</span></p>
    </div>
    <p class="normal"><span class="koboSpan" id="kobo.348.1">AI-generated videos enhance the speed of creating video datasets. </span><span class="koboSpan" id="kobo.348.2">Teams do not have to spend time finding videos that fit their needs. </span><span class="koboSpan" id="kobo.348.3">They can obtain a video quickly with a prompt that can be an idea expressed in a few words. </span><span class="koboSpan" id="kobo.348.4">AI-generated videos represent a huge leap into the future of AI applications. </span><span class="koboSpan" id="kobo.348.5">Sora’s potential applies to many industries, including filmmaking, education, and marketing. </span><span class="koboSpan" id="kobo.348.6">Its ability to generate nuanced video content from simple text prompts opens new avenues for creative and educational outputs.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.349.1">Although AI-generated videos (and, in particular, diffusion transformers) have changed the way we create world simulations, this represents a risk for jobs in many areas, such as filmmaking. </span><span class="koboSpan" id="kobo.349.2">The risk of deep fakes and misinformation is real. </span><span class="koboSpan" id="kobo.349.3">At a personal level, we must take ethical considerations into account when we implement Generative AI in a project, thus producing constructive, ethical, and realistic content.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.350.1">Let’s see how a diffusion transformer can produce realistic content.</span></p>
    <h3 id="_idParaDest-249" class="heading-3"><span class="koboSpan" id="kobo.351.1">How does a diffusion transformer work?</span></h3>
    <p class="normal"><span class="koboSpan" id="kobo.352.1">At the core of Sora, as described by Liu et al., 2024 (see the </span><em class="italic"><span class="koboSpan" id="kobo.353.1">References</span></em><span class="koboSpan" id="kobo.354.1"> section), is a diffusion transformer model that operates </span><a id="_idIndexMarker606"/><span class="koboSpan" id="kobo.355.1">between an encoder and a decoder. </span><span class="koboSpan" id="kobo.355.2">It uses user text input to guide the content generation, associating it with patches from the encoder. </span><span class="koboSpan" id="kobo.355.3">The model iteratively refines these noisy latent representations, enhancing their clarity and coherence. </span><span class="koboSpan" id="kobo.355.4">Finally, the refined data is passed to the decoder to reconstruct high-fidelity video frames. </span><span class="koboSpan" id="kobo.355.5">The technology involved includes vision transformers such as CLIP and LLMs such as GPT-4, as well as other components OpenAI continually includes in its vision model releases.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.356.1">The encoder and decoder are integral components of the overall diffusion model, as illustrated in </span><em class="italic"><span class="koboSpan" id="kobo.357.1">Figure 10.3</span></em><span class="koboSpan" id="kobo.358.1">. </span><span class="koboSpan" id="kobo.358.2">They both</span><a id="_idIndexMarker607"/><span class="koboSpan" id="kobo.359.1"> play a critical role in the workflow of the transformer diffusion model:</span></p>
    <ul>
      <li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.360.1">Encoder</span></strong><span class="koboSpan" id="kobo.361.1">: The encoder’s primary function is to compress input data, such as images or videos, into a lower-dimensional latent space. </span><span class="koboSpan" id="kobo.361.2">The encoder thus transforms high-dimensional visual data into a compact representation while preserving crucial information. </span><span class="koboSpan" id="kobo.361.3">A lower-dimensional latent space obtained is a compressed representation of high-dimensional data, retaining essential features while reducing complexity. </span><span class="koboSpan" id="kobo.361.4">For example, a high-resolution image (1024x1024 pixels, 3 color channels) can be compressed by an encoder into a vector of 1000 values, capturing key details like shape and texture. </span><span class="koboSpan" id="kobo.361.5">This makes processing and manipulating images more efficient.</span></li>
      <li class="bulletList"><strong class="keyWord"><span class="koboSpan" id="kobo.362.1">Decoder</span></strong><span class="koboSpan" id="kobo.363.1">: The decoder reconstructs the original data from the latent representation produced by the encoder. </span><span class="koboSpan" id="kobo.363.2">It performs the encoder’s reverse operation, transforming the low-dimensional latent space back into high-dimensional pixel space, thus generating the final output, such as images or videos.</span></li>
    </ul>
    <p class="packt_figref"><span class="koboSpan" id="kobo.364.1"><img src="../Images/B31169_10_03.png" alt="A diagram of a workflow  Description automatically generated"/></span></p>
    <p class="packt_figref"><span class="koboSpan" id="kobo.365.1">Figure 10.3: The encoding and decoding workflow of video diffusion models</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.366.1">The process of a diffusion transformer model goes through five main steps, as you can observe in the previous figure:</span></p>
    <ol>
      <li class="numberedList" value="1"><span class="koboSpan" id="kobo.367.1">The visual encoder</span><a id="_idIndexMarker608"/><span class="koboSpan" id="kobo.368.1"> transforms datasets of images into a lower-dimensional latent space.</span></li>
      <li class="numberedList"><span class="koboSpan" id="kobo.369.1">The visual encoder splits the lower-dimensional latent space into patches that are like words in a sentence.</span></li>
      <li class="numberedList"><span class="koboSpan" id="kobo.370.1">The diffusion transformer associates user text input with its dictionary of patches.</span></li>
      <li class="numberedList"><span class="koboSpan" id="kobo.371.1">The diffusion transformer iteratively refines noisy image representations generated to produce coherent frames.</span></li>
      <li class="numberedList"><span class="koboSpan" id="kobo.372.1">The visual decoder reconstructs the refined latent representations into high-fidelity video frames that align with the user’s instructions.</span></li>
    </ol>
    <p class="normal"><span class="koboSpan" id="kobo.373.1">The video frames can then be played in a sequence. </span><span class="koboSpan" id="kobo.373.2">Every second of a video contains a set of frames. </span><span class="koboSpan" id="kobo.373.3">We will be deconstructing the AI-generated videos into frames and commenting on these frames </span><a id="_idIndexMarker609"/><span class="koboSpan" id="kobo.374.1">later. </span><span class="koboSpan" id="kobo.374.2">But for now, we will analyze the video dataset produced by the diffusion transformer.</span></p>
    <h3 id="_idParaDest-250" class="heading-3"><span class="koboSpan" id="kobo.375.1">Analyzing the diffusion transformer model video dataset</span></h3>
    <p class="normal"><span class="koboSpan" id="kobo.376.1">Open the </span><code class="inlineCode"><span class="koboSpan" id="kobo.377.1">Videos_dataset_visualization.ipynb</span></code><span class="koboSpan" id="kobo.378.1"> notebook on GitHub. </span><span class="koboSpan" id="kobo.378.2">Hopefully, you have installed the environment</span><em class="italic"> </em><span class="koboSpan" id="kobo.379.1">as described earlier in this chapter. </span><span class="koboSpan" id="kobo.379.2">We will move on to writing the download and </span><a id="_idIndexMarker610"/><span class="koboSpan" id="kobo.380.1">display functions</span><a id="_idIndexMarker611"/><span class="koboSpan" id="kobo.381.1"> we need.</span></p>
    <h4 class="heading-4"><span class="koboSpan" id="kobo.382.1">Video download and display functions</span></h4>
    <p class="normal"><span class="koboSpan" id="kobo.383.1">The three main functions each use </span><code class="inlineCode"><span class="koboSpan" id="kobo.384.1">filename</span></code><span class="koboSpan" id="kobo.385.1"> (the name of the video file) as an argument. </span><span class="koboSpan" id="kobo.385.2">The three main functions </span><a id="_idIndexMarker612"/><span class="koboSpan" id="kobo.386.1">download and display videos, and display frames in the videos.</span></p>
    <p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.387.1">download_video</span></code><span class="koboSpan" id="kobo.388.1"> downloads one video at a time from the GitHub dataset, calling the </span><code class="inlineCode"><span class="koboSpan" id="kobo.389.1">download</span></code><span class="koboSpan" id="kobo.390.1"> function defined in the </span><em class="italic"><span class="koboSpan" id="kobo.391.1">GitHub</span></em><span class="koboSpan" id="kobo.392.1"> subsection of </span><em class="italic"><span class="koboSpan" id="kobo.393.1">The environment</span></em><span class="koboSpan" id="kobo.394.1">:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.395.1"># downloading file from GitHub</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.396.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.397.1">download_video</span></span><span class="koboSpan" id="kobo.398.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.399.1">filename</span></span><span class="koboSpan" id="kobo.400.1">):
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.401.1"># Define your variables</span></span><span class="koboSpan" id="kobo.402.1">
  directory = </span><span class="hljs-string"><span class="koboSpan" id="kobo.403.1">"Chapter10/videos"</span></span><span class="koboSpan" id="kobo.404.1">
  filename = file_name
  download(directory, filename)
</span></code></pre>
    <p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.405.1">display_video(file_name)</span></code><span class="koboSpan" id="kobo.406.1"> displays the video file downloaded by first encoding in </span><code class="inlineCode"><span class="koboSpan" id="kobo.407.1">base64</span></code><span class="koboSpan" id="kobo.408.1">, a binary-to-text encoding scheme that represents binary data in ASCII string format. </span><span class="koboSpan" id="kobo.408.2">Then, the encoded video is displayed in HTML:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.409.1"># Open the file in binary mode</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.410.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.411.1">display_video</span></span><span class="koboSpan" id="kobo.412.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.413.1">file_name</span></span><span class="koboSpan" id="kobo.414.1">):
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.415.1">with</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.416.1">open</span></span><span class="koboSpan" id="kobo.417.1">(file_name, </span><span class="hljs-string"><span class="koboSpan" id="kobo.418.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.419.1">rb'</span></span><span class="koboSpan" id="kobo.420.1">) </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.421.1">as</span></span><span class="koboSpan" id="kobo.422.1"> file:
      video_data = file.read()
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.423.1"># Encode the video file as base64</span></span><span class="koboSpan" id="kobo.424.1">
  video_url = b64encode(video_data).decode()
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.425.1"># Create an HTML string with the embedded video</span></span><span class="koboSpan" id="kobo.426.1">
  html = </span><span class="hljs-string"><span class="koboSpan" id="kobo.427.1">f'''</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.428.1">  &lt;video width="640" height="480" controls&gt;</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.429.1">    &lt;source src="data:video/mp4;base64,</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.430.1">{video_url}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.431.1">" type="video/mp4"&gt;</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.432.1">  Your browser does not support the video tag.</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.433.1">  &lt;/video&gt;</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.434.1">  '''</span></span>
  <span class="hljs-comment"><span class="koboSpan" id="kobo.435.1"># Display the video</span></span><span class="koboSpan" id="kobo.436.1">
  HTML(html)
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.437.1"># Return the HTML object</span></span>
  <span class="hljs-keyword"><span class="koboSpan" id="kobo.438.1">return</span></span><span class="koboSpan" id="kobo.439.1"> HTML(html)
</span></code></pre>
    <p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.440.1">display_video_frame</span></code><span class="koboSpan" id="kobo.441.1"> takes </span><code class="inlineCode"><span class="koboSpan" id="kobo.442.1">file_name</span></code><span class="koboSpan" id="kobo.443.1">, </span><code class="inlineCode"><span class="koboSpan" id="kobo.444.1">frame_number</span></code><span class="koboSpan" id="kobo.445.1">, and </span><code class="inlineCode"><span class="koboSpan" id="kobo.446.1">size</span></code><span class="koboSpan" id="kobo.447.1"> (the image size to display) as arguments to display a frame in the video. </span><span class="koboSpan" id="kobo.447.2">The function first opens the video file and then extracts</span><a id="_idIndexMarker613"/><span class="koboSpan" id="kobo.448.1"> the frame number set by </span><code class="inlineCode"><span class="koboSpan" id="kobo.449.1">frame_number</span></code><span class="koboSpan" id="kobo.450.1">:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.451.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.452.1">display_video_frame</span></span><span class="koboSpan" id="kobo.453.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.454.1">file_name, frame_number, size</span></span><span class="koboSpan" id="kobo.455.1">):
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.456.1"># Open the video file</span></span><span class="koboSpan" id="kobo.457.1">
    cap = cv2.VideoCapture(file_name)
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.458.1"># Move to the frame_number</span></span><span class="koboSpan" id="kobo.459.1">
    cap.</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.460.1">set</span></span><span class="koboSpan" id="kobo.461.1">(cv2.CAP_PROP_POS_FRAMES, frame_number)
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.462.1"># Read the frame</span></span><span class="koboSpan" id="kobo.463.1">
    success, frame = cap.read()
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.464.1">if</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.465.1">not</span></span><span class="koboSpan" id="kobo.466.1"> success:
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.467.1">return</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.468.1">"Failed to grab frame"</span></span>
</code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.469.1">The function converts the file from the BGR (blue, green, and red) to the RGB (red, green, and blue) channel, converts it to PIL, an image array (such as one handled by OpenCV), and resizes it with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.470.1">size</span></code><span class="koboSpan" id="kobo.471.1"> parameters:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.472.1"># Convert the color from BGR to RGB</span></span><span class="koboSpan" id="kobo.473.1">
    frame = cv2.cvtColor(frame, cv2.COLOR_BGR2RGB)
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.474.1"># Convert to PIL image and resize</span></span><span class="koboSpan" id="kobo.475.1">
    img = Image.fromarray(frame)
    img = img.resize(size, Image.LANCZOS)  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.476.1"># Resize image to specified size</span></span>
</code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.477.1">Finally, the function encodes the image in string format with </span><code class="inlineCode"><span class="koboSpan" id="kobo.478.1">base64</span></code><span class="koboSpan" id="kobo.479.1"> and displays it in HTML:</span></p>
    <pre class="programlisting code"><code class="hljs-code">    <span class="hljs-comment"><span class="koboSpan" id="kobo.480.1"># Convert the PIL image to a base64 string to embed in HTML</span></span><span class="koboSpan" id="kobo.481.1">
    buffered = BytesIO()
    img.save(buffered, </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.482.1">format</span></span><span class="koboSpan" id="kobo.483.1">=</span><span class="hljs-string"><span class="koboSpan" id="kobo.484.1">"JPEG"</span></span><span class="koboSpan" id="kobo.485.1">)
    img_str = base64.b64encode(buffered.getvalue()).decode()
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.486.1"># Create an HTML string with the embedded image</span></span><span class="koboSpan" id="kobo.487.1">
    html_str = </span><span class="hljs-string"><span class="koboSpan" id="kobo.488.1">f'''</span></span>
    <span class="hljs-string"><span class="koboSpan" id="kobo.489.1">&lt;img src="data:image/jpeg;base64,</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.490.1">{img_str}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.491.1">" width="</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.492.1">{size[</span></span><span class="hljs-number"><span class="koboSpan" id="kobo.493.1">0</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.494.1">]}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.495.1">" height="</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.496.1">{size[</span></span><span class="hljs-number"><span class="koboSpan" id="kobo.497.1">1</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.498.1">]}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.499.1">"&gt;</span></span>
    <span class="hljs-string"><span class="koboSpan" id="kobo.500.1">'''</span></span>
    <span class="hljs-comment"><span class="koboSpan" id="kobo.501.1"># Display the image</span></span><span class="koboSpan" id="kobo.502.1">
    display(HTML(html_str))
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.503.1"># Return the HTML object for further use if needed</span></span>
    <span class="hljs-keyword"><span class="koboSpan" id="kobo.504.1">return</span></span><span class="koboSpan" id="kobo.505.1"> HTML(html_str)
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.506.1">Once the environment is</span><a id="_idIndexMarker614"/><span class="koboSpan" id="kobo.507.1"> installed and the video processing functions are ready, we will display the introduction video.</span></p>
    <h4 class="heading-4"><span class="koboSpan" id="kobo.508.1">Introduction video (with audio)</span></h4>
    <p class="normal"><span class="koboSpan" id="kobo.509.1">The following cells download and display the introduction video using the functions we created in the previous section. </span><span class="koboSpan" id="kobo.509.2">A video file is</span><a id="_idIndexMarker615"/><span class="koboSpan" id="kobo.510.1"> selected and downloaded with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.511.1">download_video</span></code><span class="koboSpan" id="kobo.512.1"> function:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.513.1"># select file</span></span>
<span class="hljs-built_in"><span class="koboSpan" id="kobo.514.1">print</span></span><span class="koboSpan" id="kobo.515.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.516.1">"Collecting video"</span></span><span class="koboSpan" id="kobo.517.1">)
file_name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.518.1">"AI_Professor_Introduces_New_Course.mp4"</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.519.1">#file_name = "AI_Professor_Introduces_New_Course.mp4" # Enter the name of the video file to process here</span></span>
<span class="hljs-built_in"><span class="koboSpan" id="kobo.520.1">print</span></span><span class="koboSpan" id="kobo.521.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.522.1">f"Video: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.523.1">{file_name}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.524.1">"</span></span><span class="koboSpan" id="kobo.525.1">)
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.526.1"># Downloading video</span></span>
<span class="hljs-built_in"><span class="koboSpan" id="kobo.527.1">print</span></span><span class="koboSpan" id="kobo.528.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.529.1">"Downloading video: downloading from GitHub"</span></span><span class="koboSpan" id="kobo.530.1">)
download_video(file_name)
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.531.1">The output confirms the selection and download status:</span></p>
    <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.532.1">Collecting video
Video: AI_Professor_Introduces_New_Course.mp4
Downloading video: downloading from GitHub
Downloaded 'AI_Professor_Introduces_New_Course.mp4' successfully.
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.533.1">We can choose to display only a single frame of the video as a thumbnail with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.534.1">display_video_frame</span></code><span class="koboSpan" id="kobo.535.1"> function by providing the file name, the frame number, and the image size to display. </span><span class="koboSpan" id="kobo.535.2">The program will first compute </span><code class="inlineCode"><span class="koboSpan" id="kobo.536.1">frame_count</span></code><span class="koboSpan" id="kobo.537.1"> (the number of frames in the video), </span><code class="inlineCode"><span class="koboSpan" id="kobo.538.1">frame_rate</span></code><span class="koboSpan" id="kobo.539.1"> (the number of frames per second), and </span><code class="inlineCode"><span class="koboSpan" id="kobo.540.1">video_duration</span></code><span class="koboSpan" id="kobo.541.1"> (the duration </span><a id="_idIndexMarker616"/><span class="koboSpan" id="kobo.542.1">of the video). </span><span class="koboSpan" id="kobo.542.2">Then, it will make sure </span><code class="inlineCode"><span class="koboSpan" id="kobo.543.1">frame_number</span></code><span class="koboSpan" id="kobo.544.1"> (the frame we want to display) doesn’t exceed </span><code class="inlineCode"><span class="koboSpan" id="kobo.545.1">frame_count</span></code><span class="koboSpan" id="kobo.546.1">. </span><span class="koboSpan" id="kobo.546.2">Finally, it displays the frame as a thumbnail:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-built_in"><span class="koboSpan" id="kobo.547.1">print</span></span><span class="koboSpan" id="kobo.548.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.549.1">"Displaying a frame of video: "</span></span><span class="koboSpan" id="kobo.550.1">,file_name)
video_capture = cv2.VideoCapture(file_name)
frame_count = </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.551.1">int</span></span><span class="koboSpan" id="kobo.552.1">(video_capture.get(cv2.CAP_PROP_FRAME_COUNT))
</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.553.1">print</span></span><span class="koboSpan" id="kobo.554.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.555.1">f'Total number of frames: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.556.1">{frame_count}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.557.1">'</span></span><span class="koboSpan" id="kobo.558.1">)
frame_rate = video_capture.get(cv2.CAP_PROP_FPS)
</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.559.1">print</span></span><span class="koboSpan" id="kobo.560.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.561.1">f"Frame rate: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.562.1">{frame_rate}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.563.1">"</span></span><span class="koboSpan" id="kobo.564.1">)
video_duration = frame_count / frame_rate
</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.565.1">print</span></span><span class="koboSpan" id="kobo.566.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.567.1">f"Video duration: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.568.1">{video_duration:</span></span><span class="hljs-number"><span class="koboSpan" id="kobo.569.1">.2</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.570.1">f}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.571.1"> seconds"</span></span><span class="koboSpan" id="kobo.572.1">)
video_capture.release()
</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.573.1">print</span></span><span class="koboSpan" id="kobo.574.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.575.1">f'Total number of frames: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.576.1">{frame_count}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.577.1">'</span></span><span class="koboSpan" id="kobo.578.1">)
frame_number=</span><span class="hljs-number"><span class="koboSpan" id="kobo.579.1">5</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.580.1">if</span></span><span class="koboSpan" id="kobo.581.1"> frame_number &gt; frame_count </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.582.1">and</span></span><span class="koboSpan" id="kobo.583.1"> frame_count&gt;</span><span class="hljs-number"><span class="koboSpan" id="kobo.584.1">0</span></span><span class="koboSpan" id="kobo.585.1">:
  frame_number = </span><span class="hljs-number"><span class="koboSpan" id="kobo.586.1">1</span></span><span class="koboSpan" id="kobo.587.1">
display_video_frame(file_name, frame_number, size=(</span><span class="hljs-number"><span class="koboSpan" id="kobo.588.1">135</span></span><span class="koboSpan" id="kobo.589.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.590.1">90</span></span><span class="koboSpan" id="kobo.591.1">));
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.592.1">Here, </span><code class="inlineCode"><span class="koboSpan" id="kobo.593.1">frame_number</span></code><span class="koboSpan" id="kobo.594.1"> is set to </span><code class="inlineCode"><span class="koboSpan" id="kobo.595.1">5</span></code><span class="koboSpan" id="kobo.596.1">, but you can choose another value. </span><span class="koboSpan" id="kobo.596.2">The output shows the information on the video and the thumbnail:</span></p>
    <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.597.1">Displaying a frame of video:  /content/AI_Professor_Introduces_New_Course.mp4
Total number of frames: 340
</span><span class="koboSpan" id="kobo.598.1"><img src="../Images/B31169_10_04.png" alt="A person taking a picture of a person sitting in a church  Description automatically generated"/></span>
</code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.599.1">We can also display the full video if needed:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.600.1">#print("Displaying video: ",file_name)</span></span><span class="koboSpan" id="kobo.601.1">
display_video(file_name)
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.602.1">The video will be displayed </span><a id="_idIndexMarker617"/><span class="koboSpan" id="kobo.603.1">and can be played with the audio track:</span></p>
    <figure class="mediaobject"><span class="koboSpan" id="kobo.604.1"><img src="../Images/B31169_10_05.png" alt="A person sitting in a chair  Description automatically generated"/></span></figure>
    <p class="packt_figref"><span class="koboSpan" id="kobo.605.1">Figure 10.4: AI-generated video</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.606.1">Let’s describe and display AI-generated videos in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.607.1">/videos</span></code><span class="koboSpan" id="kobo.608.1"> directory of this chapter’s GitHub directory. </span><span class="koboSpan" id="kobo.608.2">You can host this dataset in another location and scale it to the volume that meets your project’s specifications. </span><span class="koboSpan" id="kobo.608.3">The educational video dataset of this chapter is listed in </span><code class="inlineCode"><span class="koboSpan" id="kobo.609.1">lfiles</span></code><span class="koboSpan" id="kobo.610.1">:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.611.1">lfiles = [
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.612.1">"jogging1.mp4"</span></span><span class="koboSpan" id="kobo.613.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.614.1">"jogging2.mp4"</span></span><span class="koboSpan" id="kobo.615.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.616.1">"skiing1.mp4"</span></span><span class="koboSpan" id="kobo.617.1">,
    …
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.618.1">"female_player_after_scoring.mp4"</span></span><span class="koboSpan" id="kobo.619.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.620.1">"football1.mp4"</span></span><span class="koboSpan" id="kobo.621.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.622.1">"football2.mp4"</span></span><span class="koboSpan" id="kobo.623.1">,
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.624.1">"hockey1.mp4"</span></span><span class="koboSpan" id="kobo.625.1">
]
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.626.1">We can now move on</span><a id="_idIndexMarker618"/><span class="koboSpan" id="kobo.627.1"> and display any video we wish.</span></p>
    <h4 class="heading-4"><span class="koboSpan" id="kobo.628.1">Displaying thumbnails and videos in the AI-generated dataset</span></h4>
    <p class="normal"><span class="koboSpan" id="kobo.629.1">This section is a generalization of the </span><em class="italic"><span class="koboSpan" id="kobo.630.1">Introduction video (with audio)</span></em><span class="koboSpan" id="kobo.631.1"> section. </span><span class="koboSpan" id="kobo.631.2">This time, instead of downloading one video, it downloads all the videos and displays the thumbnails of all the videos. </span><span class="koboSpan" id="kobo.631.3">You </span><a id="_idIndexMarker619"/><span class="koboSpan" id="kobo.632.1">can then select a video in the list and display it.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.633.1">The program first collects the video dataset:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.634.1">for</span></span><span class="koboSpan" id="kobo.635.1"> i </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.636.1">in</span></span><span class="koboSpan" id="kobo.637.1"> range(lf):
  file_name=lfiles[i]
  </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.638.1">print</span></span><span class="koboSpan" id="kobo.639.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.640.1">"Collecting video"</span></span><span class="koboSpan" id="kobo.641.1">,file_name)
  </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.642.1">print</span></span><span class="koboSpan" id="kobo.643.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.644.1">"Downloading video"</span></span><span class="koboSpan" id="kobo.645.1">,file_name)
  download_video(file_name)
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.646.1">The output shows the file names of the downloaded videos:</span></p>
    <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.647.1">Collecting video jogging1.mp4
Downloading video jogging1.mp4
Downloaded 'jogging1.mp4' successfully.
</span><span class="koboSpan" id="kobo.647.2">Collecting video jogging2.mp4…
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.648.1">The program calculates the number of videos in the list:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.649.1">lf=</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.650.1">len</span></span><span class="koboSpan" id="kobo.651.1">(lfiles)
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.652.1">The program goes through the list and displays the information for each video and displays its thumbnail:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.653.1">for</span></span><span class="koboSpan" id="kobo.654.1"> i </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.655.1">in</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.656.1">range</span></span><span class="koboSpan" id="kobo.657.1">(lf):
  file_name=lfiles[i]
  video_capture.release()
  display_video_frame(file_name, frame_number=</span><span class="hljs-number"><span class="koboSpan" id="kobo.658.1">5</span></span><span class="koboSpan" id="kobo.659.1">, size=(</span><span class="hljs-number"><span class="koboSpan" id="kobo.660.1">100</span></span><span class="koboSpan" id="kobo.661.1">, </span><span class="hljs-number"><span class="koboSpan" id="kobo.662.1">110</span></span><span class="koboSpan" id="kobo.663.1">))
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.664.1">The information on the video and its thumbnail is displayed:</span></p>
    <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.665.1">Displaying a frame of video:  skiing1.mp4
Total number of frames: 58
Frame rate: 30.0
Video duration: 1.93 seconds
</span><span class="koboSpan" id="kobo.666.1"><img src="../Images/B31169_10_06.png" alt="A group of people skiing down a slope  Description automatically generated"/></span>
</code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.667.1">You can select a video</span><a id="_idIndexMarker620"/><span class="koboSpan" id="kobo.668.1"> in the list and display it:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.669.1">file_name=</span><span class="hljs-string"><span class="koboSpan" id="kobo.670.1">"football1.mp4"</span></span> <span class="hljs-comment"><span class="koboSpan" id="kobo.671.1"># Enter the name of the video file to process here</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.672.1">#print("Displaying video: ",file_name)</span></span><span class="koboSpan" id="kobo.673.1">
display_video(file_name)
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.674.1">You can click on the video and watch it:</span></p>
    <figure class="mediaobject"><span class="koboSpan" id="kobo.675.1"><img src="../Images/B31169_10_07.png" alt="A person in a football uniform pointing at a football  Description automatically generated"/></span></figure>
    <p class="packt_figref"><span class="koboSpan" id="kobo.676.1">Figure 10.5: Video of a football player</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.677.1">We have explored how the AI-generated videos were produced and visualized the dataset. </span><span class="koboSpan" id="kobo.677.2">We are now ready to build the Generator and the Commentator.</span></p>
    <h2 id="_idParaDest-251" class="heading-2"><span class="koboSpan" id="kobo.678.1">The Generator and the Commentator</span></h2>
    <p class="normal"><span class="koboSpan" id="kobo.679.1">The dataset of AI-generated videos is ready. </span><span class="koboSpan" id="kobo.679.2">We will now build the Generator and the Commentator, which processes one video at a time, making scaling seamless. </span><span class="koboSpan" id="kobo.679.3">An indefinite number of videos can be processed one at a time, requiring only a CPU and limited disk space. </span><span class="koboSpan" id="kobo.679.4">The Generator and </span><a id="_idIndexMarker621"/><span class="koboSpan" id="kobo.680.1">the Commentator work together, as shown in </span><em class="italic"><span class="koboSpan" id="kobo.681.1">Figure 10.8</span></em><span class="koboSpan" id="kobo.682.1">. </span><span class="koboSpan" id="kobo.682.2">These AI agents will produce raw videos from text and then split them into frames that they will comment on:</span></p>
    <figure class="mediaobject"><span class="koboSpan" id="kobo.683.1"><img src="../Images/B31169_10_08.png" alt="A diagram of a sports game  Description automatically generated with medium confidence"/></span></figure>
    <p class="packt_figref"><span class="koboSpan" id="kobo.684.1">Figure 10.6: The Generator and the Commentator work together to comment on video frames</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.685.1">The Generator and the</span><a id="_idIndexMarker622"/><span class="koboSpan" id="kobo.686.1"> Commentator produce the commented frames required in four main steps that we will build in Python:</span></p>
    <ol>
      <li class="numberedList" value="1"><span class="koboSpan" id="kobo.687.1">The </span><strong class="keyWord"><span class="koboSpan" id="kobo.688.1">Generator</span></strong><span class="koboSpan" id="kobo.689.1"> generates the text-to-video inVideo video dataset based on the video production team’s text input. </span><span class="koboSpan" id="kobo.689.2">In this chapter, it is a dataset of sports videos.</span></li>
      <li class="numberedList"><span class="koboSpan" id="kobo.690.1">The </span><strong class="keyWord"><span class="koboSpan" id="kobo.691.1">Generator</span></strong><span class="koboSpan" id="kobo.692.1"> runs a scaled process by selecting one video at a time.</span></li>
      <li class="numberedList"><span class="koboSpan" id="kobo.693.1">The </span><strong class="keyWord"><span class="koboSpan" id="kobo.694.1">Generator</span></strong><span class="koboSpan" id="kobo.695.1"> splits the video into frames (images)</span></li>
      <li class="numberedList"><span class="koboSpan" id="kobo.696.1">The </span><strong class="keyWord"><span class="koboSpan" id="kobo.697.1">Commentator</span></strong><span class="koboSpan" id="kobo.698.1"> samples frames (images) and comments on them with an OpenAI LLM model. </span><span class="koboSpan" id="kobo.698.2">Each commented frame is saved with:</span><ul>
          <li class="bulletList level-2"><span class="koboSpan" id="kobo.699.1">Unique ID</span></li>
          <li class="bulletList level-2"><span class="koboSpan" id="kobo.700.1">Comment</span></li>
          <li class="bulletList level-2"><span class="koboSpan" id="kobo.701.1">Frame</span></li>
          <li class="bulletList level-2"><span class="koboSpan" id="kobo.702.1">Video file name</span></li>
        </ul>
      </li>
    </ol>
    <p class="normal"><span class="koboSpan" id="kobo.703.1">We will now build the Generator and the Commentator in Python, starting with the AI-generated videos. </span><span class="koboSpan" id="kobo.703.2">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.704.1">Pipeline_1_The_Generator_and_the_Commentator.ipynb</span></code><span class="koboSpan" id="kobo.705.1"> in the chapter’s GitHub directory. </span><span class="koboSpan" id="kobo.705.2">See the </span><em class="italic"><span class="koboSpan" id="kobo.706.1">The environment</span></em><span class="koboSpan" id="kobo.707.1"> section of this chapter for a description of the </span><em class="italic"><span class="koboSpan" id="kobo.708.1">Installing the environment</span></em><span class="koboSpan" id="kobo.709.1"> section of this notebook. </span><span class="koboSpan" id="kobo.709.2">The process of going from a video to</span><a id="_idIndexMarker623"/><span class="koboSpan" id="kobo.710.1"> comments on a sample of frames only takes three straightforward steps in Python:</span></p>
    <ol>
      <li class="numberedList" value="1"><span class="koboSpan" id="kobo.711.1">Displaying the video</span></li>
      <li class="numberedList"><span class="koboSpan" id="kobo.712.1">Splitting the video into frames</span></li>
      <li class="numberedList"><span class="koboSpan" id="kobo.713.1">Commenting on the frames</span></li>
    </ol>
    <p class="normal"><span class="koboSpan" id="kobo.714.1">We will define functions for each step and call them in the </span><code class="inlineCode"><span class="koboSpan" id="kobo.715.1">Pipeline-1 Controller</span></code><span class="koboSpan" id="kobo.716.1"> section of the program. </span><span class="koboSpan" id="kobo.716.2">The first step is to define a function to display a video.</span></p>
    <h3 id="_idParaDest-252" class="heading-3"><span class="koboSpan" id="kobo.717.1">Step 1. </span><span class="koboSpan" id="kobo.717.2">Displaying the video</span></h3>
    <p class="normal"><span class="koboSpan" id="kobo.718.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.719.1">download</span></code><span class="koboSpan" id="kobo.720.1"> function is in the </span><em class="italic"><span class="koboSpan" id="kobo.721.1">GitHub</span></em><span class="koboSpan" id="kobo.722.1"> subsection of the </span><em class="italic"><span class="koboSpan" id="kobo.723.1">Installing the environment</span></em><span class="koboSpan" id="kobo.724.1"> section of this notebook. </span><span class="koboSpan" id="kobo.724.2">It will be called by </span><a id="_idIndexMarker624"/><span class="koboSpan" id="kobo.725.1">the </span><em class="italic"><span class="koboSpan" id="kobo.726.1">Vector Store Administrator-Pipeline 1</span></em><span class="koboSpan" id="kobo.727.1"> in the </span><em class="italic"><span class="koboSpan" id="kobo.728.1">Administrator-Pipeline 1</span></em><span class="koboSpan" id="kobo.729.1"> section of this notebook on GitHub.</span></p>
    <p class="normal"><code class="inlineCode"><span class="koboSpan" id="kobo.730.1">display_video(file_name)</span></code><span class="koboSpan" id="kobo.731.1"> is the same as defined in the previous section, </span><em class="italic"><span class="koboSpan" id="kobo.732.1">The AI-generated video dataset</span></em><span class="koboSpan" id="kobo.733.1">:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.734.1"># Open the file in binary mode</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.735.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.736.1">display_video</span></span><span class="koboSpan" id="kobo.737.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.738.1">file_name</span></span><span class="koboSpan" id="kobo.739.1">):
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.740.1">with</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.741.1">open</span></span><span class="koboSpan" id="kobo.742.1">(file_name, </span><span class="hljs-string"><span class="koboSpan" id="kobo.743.1">'rb'</span></span><span class="koboSpan" id="kobo.744.1">) </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.745.1">as</span></span><span class="koboSpan" id="kobo.746.1"> file:
      video_data = file.read()
…
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.747.1"># Return the HTML object</span></span>
  <span class="hljs-keyword"><span class="koboSpan" id="kobo.748.1">return</span></span><span class="koboSpan" id="kobo.749.1"> HTML(html)
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.750.1">The downloaded video will now be split into frames.</span></p>
    <h3 id="_idParaDest-253" class="heading-3"><span class="koboSpan" id="kobo.751.1">Step 2. </span><span class="koboSpan" id="kobo.751.2">Splitting video into frames</span></h3>
    <p class="normal"><span class="koboSpan" id="kobo.752.1">The </span><code class="inlineCode"><span class="koboSpan" id="kobo.753.1">split_file(file_name)</span></code><span class="koboSpan" id="kobo.754.1"> function extracts </span><a id="_idIndexMarker625"/><span class="koboSpan" id="kobo.755.1">frames from a video, as in the previous section, </span><em class="italic"><span class="koboSpan" id="kobo.756.1">The AI-generated video dataset</span></em><span class="koboSpan" id="kobo.757.1">. </span><span class="koboSpan" id="kobo.757.2">However, in this case, we will expand the function to save frames as JPEG files:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.758.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.759.1">split_file</span></span><span class="koboSpan" id="kobo.760.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.761.1">file_name</span></span><span class="koboSpan" id="kobo.762.1">):
  video_path = file_name
  cap = cv2.VideoCapture(video_path)
  frame_number = </span><span class="hljs-number"><span class="koboSpan" id="kobo.763.1">0</span></span>
  <span class="hljs-keyword"><span class="koboSpan" id="kobo.764.1">while</span></span><span class="koboSpan" id="kobo.765.1"> cap.isOpened():
      ret, frame = cap.read()
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.766.1">if</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.767.1">not</span></span><span class="koboSpan" id="kobo.768.1"> ret:
          </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.769.1">break</span></span><span class="koboSpan" id="kobo.770.1">
      cv2.imwrite(</span><span class="hljs-string"><span class="koboSpan" id="kobo.771.1">f"frame_</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.772.1">{frame_number}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.773.1">.jpg"</span></span><span class="koboSpan" id="kobo.774.1">, frame)
      frame_number += </span><span class="hljs-number"><span class="koboSpan" id="kobo.775.1">1</span></span>
      <span class="hljs-built_in"><span class="koboSpan" id="kobo.776.1">print</span></span><span class="koboSpan" id="kobo.777.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.778.1">f"Frame </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.779.1">{frame_number}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.780.1"> saved."</span></span><span class="koboSpan" id="kobo.781.1">)
  cap.release()
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.782.1">We have split the video into</span><a id="_idIndexMarker626"/><span class="koboSpan" id="kobo.783.1"> frames and saved them as JPEG images with their respective frame number, </span><code class="inlineCode"><span class="koboSpan" id="kobo.784.1">frame_number</span></code><span class="koboSpan" id="kobo.785.1">. </span><span class="koboSpan" id="kobo.785.2">The Generator’s job finishes here and the Commentator now takes over.</span></p>
    <h3 id="_idParaDest-254" class="heading-3"><span class="koboSpan" id="kobo.786.1">Step 3. </span><span class="koboSpan" id="kobo.786.2">Commenting on the frames</span></h3>
    <p class="normal"><span class="koboSpan" id="kobo.787.1">The Generator has gone from</span><a id="_idIndexMarker627"/><span class="koboSpan" id="kobo.788.1"> text-to-video to splitting the video and saving the frames as JPEG frames. </span><span class="koboSpan" id="kobo.788.2">The Commentator now takes over to comment on the frames with three functions:</span></p>
    <ul>
      <li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.789.1">generate_openai_comments(filename)</span></code><span class="koboSpan" id="kobo.790.1"> asks the GPT-4 series vision model to analyze a frame and produce a response that contains a comment describing the frame</span></li>
      <li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.791.1">generate_comment(response_data)</span></code><span class="koboSpan" id="kobo.792.1"> extracts the comment from the response</span></li>
      <li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.793.1">save_comment(comment, frame_number, file_name)</span></code><span class="koboSpan" id="kobo.794.1"> saves the comment</span></li>
    </ul>
    <p class="normal"><span class="koboSpan" id="kobo.795.1">We need to build the Commentator’s extraction function first:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.796.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.797.1">generate_comment</span></span><span class="koboSpan" id="kobo.798.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.799.1">response_data</span></span><span class="koboSpan" id="kobo.800.1">):
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.801.1">"""Extract relevant information from GPT-4 Vision response."""</span></span>
    <span class="hljs-keyword"><span class="koboSpan" id="kobo.802.1">try</span></span><span class="koboSpan" id="kobo.803.1">:
        caption = response_data.choices[</span><span class="hljs-number"><span class="koboSpan" id="kobo.804.1">0</span></span><span class="koboSpan" id="kobo.805.1">].message.content
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.806.1">return</span></span><span class="koboSpan" id="kobo.807.1"> caption
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.808.1">except</span></span><span class="koboSpan" id="kobo.809.1"> (KeyError, AttributeError):
        </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.810.1">print</span></span><span class="koboSpan" id="kobo.811.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.812.1">"Error extracting caption from response."</span></span><span class="koboSpan" id="kobo.813.1">)
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.814.1">return</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.815.1">"No caption available."</span></span>
</code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.816.1">We then write a function to save the extracted comment in a CSV file that bears the same name as the video file:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.817.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.818.1">save_comment</span></span><span class="koboSpan" id="kobo.819.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.820.1">comment, frame_number, file_name</span></span><span class="koboSpan" id="kobo.821.1">):
    </span><span class="hljs-string"><span class="koboSpan" id="kobo.822.1">"""Save the comment to a text file formatted for seamless loading into a pandas DataFrame."""</span></span>
    <span class="hljs-comment"><span class="koboSpan" id="kobo.823.1"># Append .csv to the provided file name to create the complete file name</span></span><span class="koboSpan" id="kobo.824.1">
    path = </span><span class="hljs-string"><span class="koboSpan" id="kobo.825.1">f"</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.826.1">{file_name}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.827.1">.csv"</span></span>
    <span class="hljs-comment"><span class="koboSpan" id="kobo.828.1"># Check if the file exists to determine if we need to write headers</span></span><span class="koboSpan" id="kobo.829.1">
    write_header = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.830.1">not</span></span><span class="koboSpan" id="kobo.831.1"> os.path.exists(path)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.832.1">with</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.833.1">open</span></span><span class="koboSpan" id="kobo.834.1">(path, </span><span class="hljs-string"><span class="koboSpan" id="kobo.835.1">'a'</span></span><span class="koboSpan" id="kobo.836.1">, newline=</span><span class="hljs-string"><span class="koboSpan" id="kobo.837.1">''</span></span><span class="koboSpan" id="kobo.838.1">) </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.839.1">as</span></span><span class="koboSpan" id="kobo.840.1"> f:
        writer = csv.writer(f, delimiter=</span><span class="hljs-string"><span class="koboSpan" id="kobo.841.1">','</span></span><span class="koboSpan" id="kobo.842.1">, quotechar=</span><span class="hljs-string"><span class="koboSpan" id="kobo.843.1">'"'</span></span><span class="koboSpan" id="kobo.844.1">, quoting=csv.QUOTE_MINIMAL)
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.845.1">if</span></span><span class="koboSpan" id="kobo.846.1"> write_header:
            writer.writerow([</span><span class="hljs-string"><span class="koboSpan" id="kobo.847.1">'ID'</span></span><span class="koboSpan" id="kobo.848.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.849.1">'FrameNumber'</span></span><span class="koboSpan" id="kobo.850.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.851.1">'Comment'</span></span><span class="koboSpan" id="kobo.852.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.853.1">'FileName'</span></span><span class="koboSpan" id="kobo.854.1">])  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.855.1"># Write the header if the file is being created</span></span>
        <span class="hljs-comment"><span class="koboSpan" id="kobo.856.1"># Generate a unique UUID for each comment</span></span><span class="koboSpan" id="kobo.857.1">
        unique_id = </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.858.1">str</span></span><span class="koboSpan" id="kobo.859.1">(uuid.uuid4())
        </span><span class="hljs-comment"><span class="koboSpan" id="kobo.860.1"># Write the data</span></span><span class="koboSpan" id="kobo.861.1">
        writer.writerow([unique_id, frame_number, comment, file_name])
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.862.1">The goal is to save</span><a id="_idIndexMarker628"/><span class="koboSpan" id="kobo.863.1"> the comment in a format that can directly be upserted to Pinecone:</span></p>
    <ul>
      <li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.864.1">ID</span></code><span class="koboSpan" id="kobo.865.1">: A unique string ID generated with </span><code class="inlineCode"><span class="koboSpan" id="kobo.866.1">str(uuid.uuid4())</span></code></li>
      <li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.867.1">FrameNumber</span></code><span class="koboSpan" id="kobo.868.1">: The frame number of the commented JPEG</span></li>
      <li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.869.1">Comment</span></code><span class="koboSpan" id="kobo.870.1">: The comment generated by the OpenAI vision model</span></li>
      <li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.871.1">FileName</span></code><span class="koboSpan" id="kobo.872.1">: The name of the video file</span></li>
    </ul>
    <p class="normal"><span class="koboSpan" id="kobo.873.1">The Commentator’s main function is to generate comments with the OpenAI vision model. </span><span class="koboSpan" id="kobo.873.2">However, in this program’s scenario, we will not save all the frames but a sample of the frames. </span><span class="koboSpan" id="kobo.873.3">The program first determines the number of frames to process:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.874.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.875.1">generate_openai_comments</span></span><span class="koboSpan" id="kobo.876.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.877.1">filename</span></span><span class="koboSpan" id="kobo.878.1">):
  video_folder = </span><span class="hljs-string"><span class="koboSpan" id="kobo.879.1">"/content"</span></span>  <span class="hljs-comment"><span class="koboSpan" id="kobo.880.1"># Folder containing your image frames</span></span><span class="koboSpan" id="kobo.881.1">
  total_frames = </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.882.1">len</span></span><span class="koboSpan" id="kobo.883.1">([file </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.884.1">for</span></span><span class="koboSpan" id="kobo.885.1"> file </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.886.1">in</span></span><span class="koboSpan" id="kobo.887.1"> os.listdir(video_folder) </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.888.1">if</span></span><span class="koboSpan" id="kobo.889.1"> file.endswith(</span><span class="hljs-string"><span class="koboSpan" id="kobo.890.1">'.jpg'</span></span><span class="koboSpan" id="kobo.891.1">)]
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.892.1">Then, a sample frequency is set that can be modified along with a counter:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.893.1">  nb=</span><span class="hljs-number"><span class="koboSpan" id="kobo.894.1">3</span></span>      <span class="hljs-comment"><span class="koboSpan" id="kobo.895.1"># sample frequency</span></span><span class="koboSpan" id="kobo.896.1">
  counter=</span><span class="hljs-number"><span class="koboSpan" id="kobo.897.1">0</span></span> <span class="hljs-comment"><span class="koboSpan" id="kobo.898.1"># sample frequency counter</span></span>
</code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.899.1">The Commentator will then go through the sampled frames and request a comment:</span></p>
    <pre class="programlisting code"><code class="hljs-code">  <span class="hljs-keyword"><span class="koboSpan" id="kobo.900.1">for</span></span><span class="koboSpan" id="kobo.901.1"> frame_number </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.902.1">in</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.903.1">range</span></span><span class="koboSpan" id="kobo.904.1">(total_frames):
      counter+=</span><span class="hljs-number"><span class="koboSpan" id="kobo.905.1">1</span></span> <span class="hljs-comment"><span class="koboSpan" id="kobo.906.1"># sampler</span></span>
      <span class="hljs-keyword"><span class="koboSpan" id="kobo.907.1">if</span></span><span class="koboSpan" id="kobo.908.1"> counter==nb </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.909.1">and</span></span><span class="koboSpan" id="kobo.910.1"> counter&lt;total_frames:
        counter=</span><span class="hljs-number"><span class="koboSpan" id="kobo.911.1">0</span></span>
        <span class="hljs-built_in"><span class="koboSpan" id="kobo.912.1">print</span></span><span class="koboSpan" id="kobo.913.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.914.1">f"Analyzing frame </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.915.1">{frame_number}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.916.1">..."</span></span><span class="koboSpan" id="kobo.917.1">)
        image_path = os.path.join(video_folder, </span><span class="hljs-string"><span class="koboSpan" id="kobo.918.1">f"frame_</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.919.1">{frame_number}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.920.1">.jpg"</span></span><span class="koboSpan" id="kobo.921.1">)
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.922.1">try</span></span><span class="koboSpan" id="kobo.923.1">:
            </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.924.1">with</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.925.1">open</span></span><span class="koboSpan" id="kobo.926.1">(image_path, </span><span class="hljs-string"><span class="koboSpan" id="kobo.927.1">"rb"</span></span><span class="koboSpan" id="kobo.928.1">) </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.929.1">as</span></span><span class="koboSpan" id="kobo.930.1"> image_file:
                image_data = image_file.read()
                response = openai.ChatCompletion.create(
                    model=</span><span class="hljs-string"><span class="koboSpan" id="kobo.931.1">"gpt-4-vision-preview"</span></span><span class="koboSpan" id="kobo.932.1">,
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.933.1">The message is very</span><a id="_idIndexMarker629"/><span class="koboSpan" id="kobo.934.1"> concise: </span><code class="inlineCode"><span class="koboSpan" id="kobo.935.1">"What is happening in this image?"</span></code><span class="koboSpan" id="kobo.936.1"> The message also includes the image of the frame:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.937.1">                    messages=[
                        {
                            </span><span class="hljs-string"><span class="koboSpan" id="kobo.938.1">"role"</span></span><span class="koboSpan" id="kobo.939.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.940.1">"user"</span></span><span class="koboSpan" id="kobo.941.1">,
                            </span><span class="hljs-string"><span class="koboSpan" id="kobo.942.1">"content"</span></span><span class="koboSpan" id="kobo.943.1">: [
                                {</span><span class="hljs-string"><span class="koboSpan" id="kobo.944.1">"type"</span></span><span class="koboSpan" id="kobo.945.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.946.1">"text"</span></span><span class="koboSpan" id="kobo.947.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.948.1">"text"</span></span><span class="koboSpan" id="kobo.949.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.950.1">"What is happening in this image?"</span></span><span class="koboSpan" id="kobo.951.1">},
                                {
                                    </span><span class="hljs-string"><span class="koboSpan" id="kobo.952.1">"type"</span></span><span class="koboSpan" id="kobo.953.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.954.1">"image"</span></span><span class="koboSpan" id="kobo.955.1">,
                                    </span><span class="hljs-string"><span class="koboSpan" id="kobo.956.1">"image_url"</span></span><span class="koboSpan" id="kobo.957.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.958.1">f"data:image/jpeg;base64,</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.959.1">{base64.b64encode(image_data).decode(</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.960.1">'utf-8'</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.961.1">)}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.962.1">"</span></span><span class="koboSpan" id="kobo.963.1">
                                },
                            ],
                       }
                    ],
                    max_tokens=</span><span class="hljs-number"><span class="koboSpan" id="kobo.964.1">150</span></span><span class="koboSpan" id="kobo.965.1">,
               )
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.966.1">Once a response is returned, the </span><code class="inlineCode"><span class="koboSpan" id="kobo.967.1">generate_comment</span></code><span class="koboSpan" id="kobo.968.1"> and </span><code class="inlineCode"><span class="koboSpan" id="kobo.969.1">save_comment</span></code><span class="koboSpan" id="kobo.970.1"> functions are called to extract and save the comment, respectively:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.971.1">            comment = generate_comment(response)
            save_comment(comment, frame_number,file_name)
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.972.1">except</span></span><span class="koboSpan" id="kobo.973.1"> FileNotFoundError:
            </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.974.1">print</span></span><span class="koboSpan" id="kobo.975.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.976.1">f"Error: Frame </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.977.1">{frame_number}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.978.1"> not found."</span></span><span class="koboSpan" id="kobo.979.1">)
        </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.980.1">except</span></span><span class="koboSpan" id="kobo.981.1"> Exception </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.982.1">as</span></span><span class="koboSpan" id="kobo.983.1"> e:
            </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.984.1">print</span></span><span class="koboSpan" id="kobo.985.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.986.1">f"Unexpected error: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.987.1">{e}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.988.1">"</span></span><span class="koboSpan" id="kobo.989.1">)
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.990.1">The final function we require of the Commentator is to display the comments by loading the CSV file produced</span><a id="_idIndexMarker630"/><span class="koboSpan" id="kobo.991.1"> in a pandas DataFrame:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.992.1"># Read the video comments file into a pandas DataFrame</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.993.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.994.1">display_comments</span></span><span class="koboSpan" id="kobo.995.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.996.1">file_name</span></span><span class="koboSpan" id="kobo.997.1">):
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.998.1"># Append .csv to the provided file name to create the complete file name</span></span><span class="koboSpan" id="kobo.999.1">
  path = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1000.1">f"</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1001.1">{file_name}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1002.1">.csv"</span></span><span class="koboSpan" id="kobo.1003.1">
  df = pd.read_csv(path)
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1004.1">return</span></span><span class="koboSpan" id="kobo.1005.1"> df
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.1006.1">The function returns the DataFrame with the comments. </span><span class="koboSpan" id="kobo.1006.2">An administrator controls </span><em class="italic"><span class="koboSpan" id="kobo.1007.1">Pipeline 1</span></em><span class="koboSpan" id="kobo.1008.1">, the Generator, and the Commentator.</span></p>
    <h3 id="_idParaDest-255" class="heading-3"><span class="koboSpan" id="kobo.1009.1">Pipeline 1 controller</span></h3>
    <p class="normal"><span class="koboSpan" id="kobo.1010.1">The controller runs jobs for the preceding</span><a id="_idIndexMarker631"/><span class="koboSpan" id="kobo.1011.1"> three steps of the Generator and the Commentator. </span><span class="koboSpan" id="kobo.1011.2">It begins with </span><em class="italic"><span class="koboSpan" id="kobo.1012.1">Step 1</span></em><span class="koboSpan" id="kobo.1013.1">, which includes selecting a video, downloading it, and displaying it. </span><span class="koboSpan" id="kobo.1013.2">In an automated pipeline, these functions can be separated. </span><span class="koboSpan" id="kobo.1013.3">For example, a script would iterate through a list of videos, automatically select each one, and encapsulate the controller </span><a id="_idIndexMarker632"/><span class="koboSpan" id="kobo.1014.1">functions. </span><span class="koboSpan" id="kobo.1014.2">In this case, in a pre-production and educational context, we will collect, download, and display the videos one by one:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1015.1">session_time = time.time()  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1016.1"># Start timing before the request</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.1017.1"># Step 1: Displaying the video</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.1018.1"># select file</span></span>
<span class="hljs-built_in"><span class="koboSpan" id="kobo.1019.1">print</span></span><span class="koboSpan" id="kobo.1020.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1021.1">"Step 1: Collecting video"</span></span><span class="koboSpan" id="kobo.1022.1">)
file_name = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1023.1">"skiing1.mp4"</span></span> <span class="hljs-comment"><span class="koboSpan" id="kobo.1024.1"># Enter the name of the video file to process here</span></span>
<span class="hljs-built_in"><span class="koboSpan" id="kobo.1025.1">print</span></span><span class="koboSpan" id="kobo.1026.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1027.1">f"Video: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1028.1">{file_name}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1029.1">"</span></span><span class="koboSpan" id="kobo.1030.1">)
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.1031.1"># Downloading video</span></span>
<span class="hljs-built_in"><span class="koboSpan" id="kobo.1032.1">print</span></span><span class="koboSpan" id="kobo.1033.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1034.1">"Step 1:downloading from GitHub"</span></span><span class="koboSpan" id="kobo.1035.1">)
directory = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1036.1">"Chapter10/videos"</span></span><span class="koboSpan" id="kobo.1037.1">
download(directory,file_name)
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.1038.1"># Displaying video</span></span>
<span class="hljs-built_in"><span class="koboSpan" id="kobo.1039.1">print</span></span><span class="koboSpan" id="kobo.1040.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1041.1">"Step 1:displaying video"</span></span><span class="koboSpan" id="kobo.1042.1">)
display_video(file_name)
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.1043.1">The controller then splits the video into frames and comments on the frames of the video:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.1044.1"># Step 2.Splitting video</span></span>
<span class="hljs-built_in"><span class="koboSpan" id="kobo.1045.1">print</span></span><span class="koboSpan" id="kobo.1046.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1047.1">"Step 2: Splitting the video into frames"</span></span><span class="koboSpan" id="kobo.1048.1">)
split_file(file_name)
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.1049.1">The controller activates the Generator to produce</span><a id="_idIndexMarker633"/><span class="koboSpan" id="kobo.1050.1"> comments on frames of the video:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.1051.1"># Step 3.Commenting on the video frames</span></span>
<span class="hljs-built_in"><span class="koboSpan" id="kobo.1052.1">print</span></span><span class="koboSpan" id="kobo.1053.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1054.1">"Step 3: Commenting on the frames"</span></span><span class="koboSpan" id="kobo.1055.1">)
start_time = time.time()  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1056.1"># Start timing before the request</span></span><span class="koboSpan" id="kobo.1057.1">
generate_openai_comments(file_name)
response_time = time.time() - session_time  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1058.1"># Measure response time</span></span>
</code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.1059.1">The response time is measured as well. </span><span class="koboSpan" id="kobo.1059.2">The controller then adds additional outputs to display the number of frames, the comments, the content generation time, and the total controller processing times:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.1060.1"># number of frames</span></span><span class="koboSpan" id="kobo.1061.1">
video_folder = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1062.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1063.1">/content"</span></span>  <span class="hljs-comment"><span class="koboSpan" id="kobo.1064.1"># Folder containing your image frames</span></span><span class="koboSpan" id="kobo.1065.1">
total_frames = </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1066.1">len</span></span><span class="koboSpan" id="kobo.1067.1">([file </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1068.1">for</span></span><span class="koboSpan" id="kobo.1069.1"> file </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1070.1">in</span></span><span class="koboSpan" id="kobo.1071.1"> os.listdir(video_folder) </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1072.1">if</span></span><span class="koboSpan" id="kobo.1073.1"> file.endswith(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1074.1">'.jpg'</span></span><span class="koboSpan" id="kobo.1075.1">)])
</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1076.1">print</span></span><span class="koboSpan" id="kobo.1077.1">(total_frames)
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.1078.1"># Display comments</span></span>
<span class="hljs-built_in"><span class="koboSpan" id="kobo.1079.1">print</span></span><span class="koboSpan" id="kobo.1080.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1081.1">"Commenting video: displaying comments"</span></span><span class="koboSpan" id="kobo.1082.1">)
display_comments(file_name)
total_time = time.time() - start_time  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1083.1"># Start timing before the request</span></span>
<span class="hljs-built_in"><span class="koboSpan" id="kobo.1084.1">print</span></span><span class="koboSpan" id="kobo.1085.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1086.1">f"Response Time: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1087.1">{response_time:</span></span><span class="hljs-number"><span class="koboSpan" id="kobo.1088.1">.2</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1089.1">f}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1090.1"> seconds"</span></span><span class="koboSpan" id="kobo.1091.1">)  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1092.1"># Print response time</span></span>
<span class="hljs-built_in"><span class="koboSpan" id="kobo.1093.1">print</span></span><span class="koboSpan" id="kobo.1094.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1095.1">f"Total Time: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1096.1">{total_time:</span></span><span class="hljs-number"><span class="koboSpan" id="kobo.1097.1">.2</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1098.1">f}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1099.1"> seconds"</span></span><span class="koboSpan" id="kobo.1100.1">)  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1101.1"># Print response time</span></span>
</code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.1102.1">The controller has completed its task of producing content. </span><span class="koboSpan" id="kobo.1102.2">However, depending on your project, you can introduce dynamic RAG for some or all the videos. </span><span class="koboSpan" id="kobo.1102.3">If you need this functionality, you can apply the process described in </span><em class="italic"><span class="koboSpan" id="kobo.1103.1">Chapter 5</span></em><span class="koboSpan" id="kobo.1104.1">, </span><em class="italic"><span class="koboSpan" id="kobo.1105.1">Boosting RAG Performance with Expert Human Feedback</span></em><span class="koboSpan" id="kobo.1106.1">, to the Commentator’s outputs, including the cosine similarity quality control metrics, as we will in the </span><em class="italic"><span class="koboSpan" id="kobo.1107.1">Pipeline 3: The Video Expert</span></em><span class="koboSpan" id="kobo.1108.1"> section of this chapter.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.1109.1">The controller can also</span><a id="_idIndexMarker634"/><span class="koboSpan" id="kobo.1110.1"> save the comments and frames.</span></p>
    <h4 class="heading-4"><span class="koboSpan" id="kobo.1111.1">Saving comments</span></h4>
    <p class="normal"><span class="koboSpan" id="kobo.1112.1">To save the</span><a id="_idIndexMarker635"/><span class="koboSpan" id="kobo.1113.1"> comments, set </span><code class="inlineCode"><span class="koboSpan" id="kobo.1114.1">save=True</span></code><span class="koboSpan" id="kobo.1115.1">. </span><span class="koboSpan" id="kobo.1115.2">To save the frames, set </span><code class="inlineCode"><span class="koboSpan" id="kobo.1116.1">save_frames=True</span></code><span class="koboSpan" id="kobo.1117.1">. </span><span class="koboSpan" id="kobo.1117.2">Set both values to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1118.1">False</span></code><span class="koboSpan" id="kobo.1119.1"> if you just want to run the program and view the outputs, but, in our case, we will set them as </span><code class="inlineCode"><span class="koboSpan" id="kobo.1120.1">True</span></code><span class="koboSpan" id="kobo.1121.1">:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.1122.1"># Ensure the file exists and double checking before saving the comments</span></span><span class="koboSpan" id="kobo.1123.1">
save=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1124.1">True</span></span>        <span class="hljs-comment"><span class="koboSpan" id="kobo.1125.1"># double checking before saving the comments</span></span><span class="koboSpan" id="kobo.1126.1">
save_frames=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1127.1">True</span></span> <span class="hljs-comment"><span class="koboSpan" id="kobo.1128.1"># double checking before saving the frames</span></span>
</code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.1129.1">The comment is saved in CSV format in </span><code class="inlineCode"><span class="koboSpan" id="kobo.1130.1">cpath</span></code><span class="koboSpan" id="kobo.1131.1"> and contains the file name with the </span><code class="inlineCode"><span class="koboSpan" id="kobo.1132.1">.csv</span></code><span class="koboSpan" id="kobo.1133.1"> extension and in the location of your choice. </span><span class="koboSpan" id="kobo.1133.2">In this case, the files are saved on Google Drive (make sure the path exists):</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.1134.1"># Save comments</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1135.1">if</span></span><span class="koboSpan" id="kobo.1136.1"> save==</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1137.1">True</span></span><span class="koboSpan" id="kobo.1138.1">:  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1139.1"># double checking before saving the comments</span></span>
  <span class="hljs-comment"><span class="koboSpan" id="kobo.1140.1"># Append .csv to the provided file name to create the complete file name</span></span><span class="koboSpan" id="kobo.1141.1">
  cpath = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1142.1">f"</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1143.1">{file_name}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1144.1">.csv"</span></span>
  <span class="hljs-keyword"><span class="koboSpan" id="kobo.1145.1">if</span></span><span class="koboSpan" id="kobo.1146.1"> os.path.exists(cpath):
      </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1147.1"># Use the Python variable 'path' correctly in the shell command</span></span><span class="koboSpan" id="kobo.1148.1">
      !cp {cpath} /content/drive/MyDrive/files/comments/{cpath}
      </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1149.1">print</span></span><span class="koboSpan" id="kobo.1150.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1151.1">f"File </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1152.1">{cpath}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1153.1"> copied successfully."</span></span><span class="koboSpan" id="kobo.1154.1">)
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1155.1">else</span></span><span class="koboSpan" id="kobo.1156.1">:
      </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1157.1">print</span></span><span class="koboSpan" id="kobo.1158.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1159.1">f"No such file: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1160.1">{cpath}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1161.1">"</span></span><span class="koboSpan" id="kobo.1162.1">)
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.1163.1">The output confirms that a file is saved:</span></p>
    <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1164.1">File alpinist1.mp4.csv copied successfully.
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.1165.1">The frames are saved in a root name direction, for which we remove the extension with </span><code class="inlineCode"><span class="koboSpan" id="kobo.1166.1">root_name = root_name + extension.strip('.')</span></code><span class="koboSpan" id="kobo.1167.1">:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.1168.1"># Save frames</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1169.1">import</span></span><span class="koboSpan" id="kobo.1170.1"> shutil
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1171.1">if</span></span><span class="koboSpan" id="kobo.1172.1"> save_frames==</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1173.1">True</span></span><span class="koboSpan" id="kobo.1174.1">:
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1175.1"># Extract the root name by removing the extension</span></span><span class="koboSpan" id="kobo.1176.1">
  root_name, extension = os.path.splitext(file_name)
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1177.1"># This removes the period from the extension</span></span><span class="koboSpan" id="kobo.1178.1">
  root_name = root_name + extension.strip(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1179.1">'.'</span></span><span class="koboSpan" id="kobo.1180.1">)
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1181.1"># Path where you want to copy the jpg files</span></span><span class="koboSpan" id="kobo.1182.1">
  target_directory = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1183.1">f'/content/drive/MyDrive/files/comments/</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1184.1">{root_name}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1185.1">'</span></span>
  <span class="hljs-comment"><span class="koboSpan" id="kobo.1186.1"># Ensure the directory exists</span></span><span class="koboSpan" id="kobo.1187.1">
  os.makedirs(target_directory, exist_ok=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1188.1">True</span></span><span class="koboSpan" id="kobo.1189.1">)
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1190.1"># Assume your jpg files are in the current directory. </span><span class="koboSpan" id="kobo.1190.2">Modify this as needed</span></span><span class="koboSpan" id="kobo.1191.1">
  source_directory = os.getcwd()  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1192.1"># or specify a different directory</span></span>
  <span class="hljs-comment"><span class="koboSpan" id="kobo.1193.1"># List all jpg files in the source directory</span></span>
  <span class="hljs-keyword"><span class="koboSpan" id="kobo.1194.1">for</span></span><span class="koboSpan" id="kobo.1195.1"> file </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1196.1">in</span></span><span class="koboSpan" id="kobo.1197.1"> os.listdir(source_directory):
      </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1198.1">if</span></span><span class="koboSpan" id="kobo.1199.1"> file.endswith(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1200.1">'.jpg'</span></span><span class="koboSpan" id="kobo.1201.1">):
        shutil.copy(os.path.join(source_directory, file), target_directory)
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.1202.1">The output is a</span><a id="_idIndexMarker636"/><span class="koboSpan" id="kobo.1203.1"> directory with all the frames generated in it. </span><span class="koboSpan" id="kobo.1203.2">We should delete the files if the controller runs in a loop over all the videos in a single session.</span></p>
    <h4 class="heading-4"><span class="koboSpan" id="kobo.1204.1">Deleting files</span></h4>
    <p class="normal"><span class="koboSpan" id="kobo.1205.1">To delete</span><a id="_idIndexMarker637"/><span class="koboSpan" id="kobo.1206.1"> the files, just set </span><code class="inlineCode"><span class="koboSpan" id="kobo.1207.1">delf=True</span></code><span class="koboSpan" id="kobo.1208.1">:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1209.1">delf=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1210.1">False</span></span>  <span class="hljs-comment"><span class="koboSpan" id="kobo.1211.1"># double checking before deleting the files in a session</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1212.1">if</span></span><span class="koboSpan" id="kobo.1213.1"> delf==</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1214.1">True</span></span><span class="koboSpan" id="kobo.1215.1">:
  !rm -f *.mp4 </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1216.1"># video files</span></span><span class="koboSpan" id="kobo.1217.1">
  !rm -f *.jpg </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1218.1"># frames</span></span><span class="koboSpan" id="kobo.1219.1">
  !rm -f *.csv </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1220.1"># comments</span></span>
</code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.1221.1">You can now process an unlimited number of videos one by one and scale to whatever size you wish, as long as you have disk space and a CPU!</span></p>
    <h1 id="_idParaDest-256" class="heading-1"><span class="koboSpan" id="kobo.1222.1">Pipeline 2: The Vector Store Administrator</span></h1>
    <p class="normal"><span class="koboSpan" id="kobo.1223.1">The Vector Store Administrator AI agent </span><a id="_idIndexMarker638"/><span class="koboSpan" id="kobo.1224.1">performs the tasks we implemented in </span><em class="italic"><span class="koboSpan" id="kobo.1225.1">Chapter 6</span></em><span class="koboSpan" id="kobo.1226.1">, </span><em class="italic"><span class="koboSpan" id="kobo.1227.1">Scaling RAG Bank Customer Data with Pinecone. </span></em><span class="koboSpan" id="kobo.1228.1">The novelty in this section relies on the fact that all the data we upsert for RAG is AI-generated. </span><span class="koboSpan" id="kobo.1228.2">Let’s open </span><code class="inlineCode"><span class="koboSpan" id="kobo.1229.1">Pipeline_2_The_Vector_Store_Administrator.ipynb</span></code><span class="koboSpan" id="kobo.1230.1"> in the GitHub repository. </span><span class="koboSpan" id="kobo.1230.2">We will build the Vector Store Administrator on top of the Generator and the Commentator AI agents in four steps, as illustrated in the following figure:</span></p>
    <figure class="mediaobject"><span class="koboSpan" id="kobo.1231.1"><img src="../Images/B31169_10_09.png" alt="A diagram of a video expert  Description automatically generated"/></span></figure>
    <p class="packt_figref"><span class="koboSpan" id="kobo.1232.1">Figure 10.7: Workflow of the Vector Store Administrator from processing to querying video frame comments</span></p>
    <ol>
      <li class="numberedList" value="1"><strong class="keyWord"><span class="koboSpan" id="kobo.1233.1">Processing the video comments</span></strong><span class="koboSpan" id="kobo.1234.1">: The</span><a id="_idIndexMarker639"/><span class="koboSpan" id="kobo.1235.1"> Vector Store Administrator will load and prepare the comments for chunking as in the </span><em class="italic"><span class="koboSpan" id="kobo.1236.1">Pipeline 2: Scaling a Pinecone Index (vector store)</span></em><span class="koboSpan" id="kobo.1237.1"> section of </span><em class="italic"><span class="koboSpan" id="kobo.1238.1">Chapter 6</span></em><span class="koboSpan" id="kobo.1239.1">. </span><span class="koboSpan" id="kobo.1239.2">Since we are processing one video at a time in a pipeline, the system deletes the files processed, which keeps disk space constant. </span><span class="koboSpan" id="kobo.1239.3">You can enhance the functionality and scale this process indefinitely.</span></li>
      <li class="numberedList"><strong class="keyWord"><span class="koboSpan" id="kobo.1240.1">Chunking and embedding the dataset</span></strong><span class="koboSpan" id="kobo.1241.1">: The column names </span><code class="inlineCode"><span class="koboSpan" id="kobo.1242.1">('ID', 'FrameNumber', 'Comment', 'FileName')</span></code><span class="koboSpan" id="kobo.1243.1"> of the dataset have already been prepared by the Commentator AI agent in </span><em class="italic"><span class="koboSpan" id="kobo.1244.1">Pipeline 1</span></em><span class="koboSpan" id="kobo.1245.1">. </span><span class="koboSpan" id="kobo.1245.2">The program chunks and embeds the dataset using the </span><a id="_idIndexMarker640"/><span class="koboSpan" id="kobo.1246.1">same functionality as in </span><em class="italic"><span class="koboSpan" id="kobo.1247.1">Chapter 6</span></em><span class="koboSpan" id="kobo.1248.1"> in the </span><em class="italic"><span class="koboSpan" id="kobo.1249.1">Chunking and embedding the dataset</span></em><span class="koboSpan" id="kobo.1250.1"> section.</span></li>
      <li class="numberedList"><strong class="keyWord"><span class="koboSpan" id="kobo.1251.1">The Pinecone index</span></strong><span class="koboSpan" id="kobo.1252.1">: The Pinecone Index is created, and the data is upserted as in the </span><em class="italic"><span class="koboSpan" id="kobo.1253.1">Creating the Pinecone Index</span></em><span class="koboSpan" id="kobo.1254.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.1255.1">Upserting</span></em><span class="koboSpan" id="kobo.1256.1"> sections of </span><em class="chapterRef"><span class="koboSpan" id="kobo.1257.1">Chapter </span></em><span class="koboSpan" id="kobo.1258.1">6.</span></li>
      <li class="numberedList"><strong class="keyWord"><span class="koboSpan" id="kobo.1259.1">Querying the vector store after upserting the dataset</span></strong><span class="koboSpan" id="kobo.1260.1">: This follows the same process as in </span><em class="chapterRef"><span class="koboSpan" id="kobo.1261.1">Chapter 6</span></em><span class="koboSpan" id="kobo.1262.1">. </span><span class="koboSpan" id="kobo.1262.2">However, in this case, the retrieval is hybrid, using both the Pinecone vector store and a separate file system to store videos and video frames.</span></li>
    </ol>
    <p class="normal"><span class="koboSpan" id="kobo.1263.1">Go through </span><em class="italic"><span class="koboSpan" id="kobo.1264.1">Steps 1</span></em><span class="koboSpan" id="kobo.1265.1"> to </span><em class="italic"><span class="koboSpan" id="kobo.1266.1">3</span></em><span class="koboSpan" id="kobo.1267.1"> in the notebook to</span><a id="_idIndexMarker641"/><span class="koboSpan" id="kobo.1268.1"> examine the Vector Store Administrator’s functions. </span><span class="koboSpan" id="kobo.1268.2">After </span><em class="italic"><span class="koboSpan" id="kobo.1269.1">Step 3</span></em><span class="koboSpan" id="kobo.1270.1">, the Pinecone index is ready for hybrid querying.</span></p>
    <h2 id="_idParaDest-257" class="heading-2"><span class="koboSpan" id="kobo.1271.1">Querying the Pinecone index</span></h2>
    <p class="normal"><span class="koboSpan" id="kobo.1272.1">In the notebook on GitHub, </span><em class="italic"><span class="koboSpan" id="kobo.1273.1">Step 4: Querying the Pinecone index</span></em><span class="koboSpan" id="kobo.1274.1"> implements functions to find a comment that matches user input and trace it to the frame of a video. </span><span class="koboSpan" id="kobo.1274.2">This leads to the video source and frame, which can</span><a id="_idIndexMarker642"/><span class="koboSpan" id="kobo.1275.1"> be displayed. </span><span class="koboSpan" id="kobo.1275.2">We can display the videos and frames from the location we wish. </span><span class="koboSpan" id="kobo.1275.3">This hybrid approach thus involves </span><a id="_idIndexMarker643"/><span class="koboSpan" id="kobo.1276.1">querying the Pinecone Index to retrieve information and also retrieve media files from another location.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.1277.1">We saw that a vector store can contain images that are queried, as implemented in </span><em class="italic"><span class="koboSpan" id="kobo.1278.1">Chapter 4</span></em><span class="koboSpan" id="kobo.1279.1">, </span><em class="italic"><span class="koboSpan" id="kobo.1280.1">Multimodal Modular RAG for Drone Technology</span></em><span class="koboSpan" id="kobo.1281.1">. </span><span class="koboSpan" id="kobo.1281.2">In this chapter, the video production use case videos and frame files are stored separately. </span><span class="koboSpan" id="kobo.1281.3">In this case, it is in the GitHub repository. </span><span class="koboSpan" id="kobo.1281.4">In production, the video and frame files can be retrieved from any storage system we need, which may or may not prove to be more cost-effective than storing data on Pinecone. </span><span class="koboSpan" id="kobo.1281.5">The decision to store images in a vector store or a separate location will depend on the project’s needs.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.1282.1">We begin by defining the number of top-k results we wish to process:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1283.1">k=</span><span class="hljs-number"><span class="koboSpan" id="kobo.1284.1">1</span></span> <span class="hljs-comment"><span class="koboSpan" id="kobo.1285.1"># number of results</span></span>
</code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.1286.1">We then design a rather difficult prompt:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1287.1">query_text = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1288.1">"Find a basketball player that is scoring with a dunk."</span></span>
</code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.1289.1">Only a handful of frames in the whole video dataset contain an image of a basketball player jumping to score a slam dunk. </span><span class="koboSpan" id="kobo.1289.2">Can our system find it? </span><span class="koboSpan" id="kobo.1289.3">Let’s find out.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.1290.1">We first embed our query to match the format of the data in the vector store:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword"><span class="koboSpan" id="kobo.1291.1">import</span></span><span class="koboSpan" id="kobo.1292.1"> time
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.1293.1"># Start timing before the request</span></span><span class="koboSpan" id="kobo.1294.1">
start_time = time.time()
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.1295.1"># Target vector</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.1296.1">#query_text = "Find a basketball player."</span></span><span class="koboSpan" id="kobo.1297.1">
query_embedding = get_embedding(query_text, model=embedding_model)
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.1298.1">Then we run a similarity vector </span><a id="_idIndexMarker644"/><span class="koboSpan" id="kobo.1299.1">search between the query and the dataset:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.1300.1"># Perform the query using the embedding</span></span><span class="koboSpan" id="kobo.1301.1">
query_results = index.query(vector=query_embedding, top_k=k, include_metadata=</span><span class="hljs-literal"><span class="koboSpan" id="kobo.1302.1">True</span></span><span class="koboSpan" id="kobo.1303.1">)  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1304.1"># Request metadata</span></span>
<span class="hljs-comment"><span class="koboSpan" id="kobo.1305.1"># Print the query results along with metadata</span></span>
<span class="hljs-built_in"><span class="koboSpan" id="kobo.1306.1">print</span></span><span class="koboSpan" id="kobo.1307.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1308.1">"Query Results:"</span></span><span class="koboSpan" id="kobo.1309.1">)
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1310.1">for</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1311.1">match</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1312.1">in</span></span><span class="koboSpan" id="kobo.1313.1"> query_results[</span><span class="hljs-string"><span class="koboSpan" id="kobo.1314.1">'matches'</span></span><span class="koboSpan" id="kobo.1315.1">]:
    </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1316.1">print</span></span><span class="koboSpan" id="kobo.1317.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1318.1">f"ID: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1319.1">{</span></span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1320.1">match</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1321.1">[</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1322.1">'id'</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1323.1">]}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1324.1">, Score: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1325.1">{</span></span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1326.1">match</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1327.1">[</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1328.1">'score'</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1329.1">]}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1330.1">"</span></span><span class="koboSpan" id="kobo.1331.1">)
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1332.1"># Check if metadata is available</span></span>
    <span class="hljs-keyword"><span class="koboSpan" id="kobo.1333.1">if</span></span> <span class="hljs-string"><span class="koboSpan" id="kobo.1334.1">'</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1335.1">metadata'</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1336.1">in</span></span> <span class="hljs-keyword"><span class="koboSpan" id="kobo.1337.1">match</span></span><span class="koboSpan" id="kobo.1338.1">:
        metadata = </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1339.1">match</span></span><span class="koboSpan" id="kobo.1340.1">[</span><span class="hljs-string"><span class="koboSpan" id="kobo.1341.1">'metadata'</span></span><span class="koboSpan" id="kobo.1342.1">]
        text = metadata.get(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1343.1">'text'</span></span><span class="koboSpan" id="kobo.1344.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1345.1">"No text metadata available."</span></span><span class="koboSpan" id="kobo.1346.1">)
        frame_number = metadata.get(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1347.1">'frame_number'</span></span><span class="koboSpan" id="kobo.1348.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1349.1">"No frame number available."</span></span><span class="koboSpan" id="kobo.1350.1">)
        file_name = metadata.get(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1351.1">'file_name'</span></span><span class="koboSpan" id="kobo.1352.1">, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1353.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1354.1">No file name available."</span></span><span class="koboSpan" id="kobo.1355.1">)
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.1356.1">Finally, we display the</span><a id="_idIndexMarker645"/><span class="koboSpan" id="kobo.1357.1"> content of the response and the response time:</span></p>
    <pre class="programlisting code"><code class="hljs-code">        <span class="hljs-built_in"><span class="koboSpan" id="kobo.1358.1">print</span></span><span class="koboSpan" id="kobo.1359.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1360.1">f"Text: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1361.1">{text}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1362.1">"</span></span><span class="koboSpan" id="kobo.1363.1">)
        </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1364.1">print</span></span><span class="koboSpan" id="kobo.1365.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1366.1">f"Frame Number: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1367.1">{frame_number}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1368.1">"</span></span><span class="koboSpan" id="kobo.1369.1">)
        </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1370.1">print</span></span><span class="koboSpan" id="kobo.1371.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1372.1">f"File Name: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1373.1">{file_name}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1374.1">"</span></span><span class="koboSpan" id="kobo.1375.1">)
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1376.1">else</span></span><span class="koboSpan" id="kobo.1377.1">:
        </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1378.1">print</span></span><span class="koboSpan" id="kobo.1379.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1380.1">"No metadata available."</span></span><span class="koboSpan" id="kobo.1381.1">)
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.1382.1"># Measure response time</span></span><span class="koboSpan" id="kobo.1383.1">
response_time = time.time() - start_time
</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1384.1">print</span></span><span class="koboSpan" id="kobo.1385.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1386.1">f"Querying response time: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1387.1">{response_time:</span></span><span class="hljs-number"><span class="koboSpan" id="kobo.1388.1">.2</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1389.1">f}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1390.1"> seconds"</span></span><span class="koboSpan" id="kobo.1391.1">)  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1392.1"># Print response time</span></span>
</code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.1393.1">The output contains the ID of the comment retrieved and its score:</span></p>
    <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1394.1">Query Results:
ID: f104138b-0be8-4f4c-bf99-86d0eb34f7ee, Score: 0.866656184
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.1395.1">The output also contains the comment generated by the OpenAI LLM (the Commentator agent):</span></p>
    <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1396.1">Text: In this image, there is a person who appears to be in the process of executing a dunk in basketball. </span><span class="koboSpan" id="kobo.1396.2">The individual is airborne, with one arm extended upwards towards the basketball hoop, holding a basketball in hand, preparing to slam it through the hoop. </span><span class="koboSpan" id="kobo.1396.3">The word "dunk" is superimposed on the image, confirming the action taking place. </span><span class="koboSpan" id="kobo.1396.4">The background shows clear skies and a modern building, suggesting this might be an outdoor basketball court in an urban setting. </span><span class="koboSpan" id="kobo.1396.5">The player is wearing athletic wear and a pair of basketball shoes, suitable for the sport. </span><span class="koboSpan" id="kobo.1396.6">The dynamic posture and the context indicate an athletic and powerful movement, typical of a basketball dunk.
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.1397.1">The final output contains the</span><a id="_idIndexMarker646"/><span class="koboSpan" id="kobo.1398.1"> frame number that was commented, the video file of the </span><a id="_idIndexMarker647"/><span class="koboSpan" id="kobo.1399.1">frame, and the retrieval time:</span></p>
    <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1400.1">Frame Number: 191
File Name: basketball3.mp4
Querying response time: 0.57 seconds
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.1401.1">We can display the video by downloading it based on the file name:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-built_in"><span class="koboSpan" id="kobo.1402.1">print</span></span><span class="koboSpan" id="kobo.1403.1">(file_name)
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.1404.1"># downloading file from GitHub</span></span><span class="koboSpan" id="kobo.1405.1">
directory = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1406.1">"Chapter10/videos"</span></span><span class="koboSpan" id="kobo.1407.1">
filename = file_name
download(directory,file_name)
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.1408.1">Then, use a standard Python function to display it:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.1409.1"># Open the file in binary mode</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1410.1">def</span></span> <span class="hljs-title"><span class="koboSpan" id="kobo.1411.1">display_video</span></span><span class="koboSpan" id="kobo.1412.1">(</span><span class="hljs-params"><span class="koboSpan" id="kobo.1413.1">file_name</span></span><span class="koboSpan" id="kobo.1414.1">):
  </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1415.1">with</span></span> <span class="hljs-built_in"><span class="koboSpan" id="kobo.1416.1">open</span></span><span class="koboSpan" id="kobo.1417.1">(file_name, </span><span class="hljs-string"><span class="koboSpan" id="kobo.1418.1">'rb'</span></span><span class="koboSpan" id="kobo.1419.1">) </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1420.1">as</span></span><span class="koboSpan" id="kobo.1421.1"> file:
      video_data = file.read()
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1422.1"># Encode the video file as base64</span></span><span class="koboSpan" id="kobo.1423.1">
  video_url = b64encode(video_data).decode()
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1424.1"># Create an HTML string with the embedded video</span></span><span class="koboSpan" id="kobo.1425.1">
  html = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1426.1">f'''</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1427.1">  &lt;video width="640" height="480" controls&gt;</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1428.1">    &lt;source src="data:video/mp4;base64,</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1429.1">{video_url}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1430.1">" type="video/mp4"&gt;</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1431.1">  Your browser does not support the video tag.</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1432.1">  &lt;/video&gt;</span></span>
<span class="hljs-string"><span class="koboSpan" id="kobo.1433.1">  '''</span></span>
  <span class="hljs-comment"><span class="koboSpan" id="kobo.1434.1"># Display the video</span></span><span class="koboSpan" id="kobo.1435.1">
  HTML(html)
  </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1436.1"># Return the HTML object</span></span>
  <span class="hljs-keyword"><span class="koboSpan" id="kobo.1437.1">return</span></span><span class="koboSpan" id="kobo.1438.1"> HTML(html)
display_video(file_name)
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.1439.1">The video containing a </span><a id="_idIndexMarker648"/><span class="koboSpan" id="kobo.1440.1">basketball player performing a dunk is displayed:</span></p>
    <figure class="mediaobject"><span class="koboSpan" id="kobo.1441.1"><img src="../Images/B31169_10_10.png" alt="A basketball hoop with net  Description automatically generated"/></span></figure>
    <p class="packt_figref"><span class="koboSpan" id="kobo.1442.1">Figure 10.8: Video output</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.1443.1">We can take this further </span><a id="_idIndexMarker649"/><span class="koboSpan" id="kobo.1444.1">with more precision by displaying the frame of the comment retrieved:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1445.1">file_name_root = file_name.split(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1446.1">'.'</span></span><span class="koboSpan" id="kobo.1447.1">)[</span><span class="hljs-number"><span class="koboSpan" id="kobo.1448.1">0</span></span><span class="koboSpan" id="kobo.1449.1">]
…
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1450.1">from</span></span><span class="koboSpan" id="kobo.1451.1"> IPython.display </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1452.1">import</span></span><span class="koboSpan" id="kobo.1453.1"> Image, display
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.1454.1"># Specify the directory and file name</span></span><span class="koboSpan" id="kobo.1455.1">
directory = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1456.1">'/content/'</span></span>  <span class="hljs-comment"><span class="koboSpan" id="kobo.1457.1"># Adjust the directory if needed</span></span><span class="koboSpan" id="kobo.1458.1">
file_path = os.path.join(directory, frame)
</span><span class="hljs-comment"><span class="koboSpan" id="kobo.1459.1"># Check if the file exists and verify its size</span></span>
<span class="hljs-keyword"><span class="koboSpan" id="kobo.1460.1">if</span></span><span class="koboSpan" id="kobo.1461.1"> os.path.exists(file_path):
    file_size = os.path.getsize(file_path)
    </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1462.1">print</span></span><span class="koboSpan" id="kobo.1463.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1464.1">f"File '</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1465.1">{frame}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1466.1">' exists. </span><span class="koboSpan" id="kobo.1466.2">Size: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1467.1">{file_size}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1468.1"> bytes."</span></span><span class="koboSpan" id="kobo.1469.1">)
    </span><span class="hljs-comment"><span class="koboSpan" id="kobo.1470.1"># Define a logical size value in bytes, for example, 1000 bytes</span></span><span class="koboSpan" id="kobo.1471.1">
    logical_size = </span><span class="hljs-number"><span class="koboSpan" id="kobo.1472.1">1000</span></span>  <span class="hljs-comment"><span class="koboSpan" id="kobo.1473.1"># You can adjust this threshold as needed</span></span>
    <span class="hljs-keyword"><span class="koboSpan" id="kobo.1474.1">if</span></span><span class="koboSpan" id="kobo.1475.1"> file_size &gt; logical_size:
        </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1476.1">print</span></span><span class="koboSpan" id="kobo.1477.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1478.1">"The file size is greater than the logical value."</span></span><span class="koboSpan" id="kobo.1479.1">)
        display(Image(filename=file_path))
    </span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1480.1">else</span></span><span class="koboSpan" id="kobo.1481.1">:
        </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1482.1">print</span></span><span class="koboSpan" id="kobo.1483.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1484.1">"The file size is less than or equal to the logical value."</span></span><span class="koboSpan" id="kobo.1485.1">)
</span><span class="hljs-keyword"><span class="koboSpan" id="kobo.1486.1">else</span></span><span class="koboSpan" id="kobo.1487.1">:
    </span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1488.1">print</span></span><span class="koboSpan" id="kobo.1489.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1490.1">f"File '</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1491.1">{frame}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1492.1">' does not exist in the specified directory."</span></span><span class="koboSpan" id="kobo.1493.1">)
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.1494.1">The output shows the exact frame that corresponds to the user input:</span></p>
    <figure class="mediaobject"><span class="koboSpan" id="kobo.1495.1"><img src="../Images/B31169_10_11.png" alt="A person holding a ball  Description automatically generated"/></span></figure>
    <p class="packt_figref"><span class="koboSpan" id="kobo.1496.1">Figure 10.9: Video frame corresponding to our input</span></p>
    <div class="note">
      <p class="normal"><span class="koboSpan" id="kobo.1497.1">Only the frames of </span><code class="inlineCode"><span class="koboSpan" id="kobo.1498.1">basketball3.mp4</span></code><span class="koboSpan" id="kobo.1499.1"> were saved in the GitHub repository for disk space reasons for this program. </span><span class="koboSpan" id="kobo.1499.2">In production, all the frames you decide you need can be stored and retrieved.</span></p>
    </div>
    <p class="normal"><span class="koboSpan" id="kobo.1500.1">The team of AI agents in </span><a id="_idIndexMarker650"/><span class="koboSpan" id="kobo.1501.1">this chapter worked together to generate videos (the Generator), comment on the video frames (the Commentator), upsert embedded comments in the vector store (the Vector Store Administrator), and prepare the retrieval process (the Vector Store Administrator). </span><span class="koboSpan" id="kobo.1501.2">We also saw that the retrieval process already</span><a id="_idIndexMarker651"/><span class="koboSpan" id="kobo.1502.1"> contained augmented input and output thanks to the OpenAI LLM (the Commentator) that generated natural language comments. </span><span class="koboSpan" id="kobo.1502.2">The process that led to this point will definitely be applied in many domains: firefighting, medical imagery, marketing, and more.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.1503.1">What more can we expect from this system? </span><span class="koboSpan" id="kobo.1503.2">The Video Expert AI agent will answer that.</span></p>
    <h1 id="_idParaDest-258" class="heading-1"><span class="koboSpan" id="kobo.1504.1">Pipeline 3: The Video Expert</span></h1>
    <p class="normal"><span class="koboSpan" id="kobo.1505.1">The role of the OpenAI GPT-4o Video Expert is to analyze the comment made by the Commentator OpenAI LLM agent, point out the </span><a id="_idIndexMarker652"/><span class="koboSpan" id="kobo.1506.1">cognitive dissonances (things that don’t seem to fit together in the description), rewrite the comment, and provide a label. </span><span class="koboSpan" id="kobo.1506.2">The workflow of the Video Expert, as illustrated in the following figure, also includes the code of the </span><em class="italic"><span class="koboSpan" id="kobo.1507.1">Metrics calculations and display </span></em><span class="koboSpan" id="kobo.1508.1">section of </span><em class="italic"><span class="koboSpan" id="kobo.1509.1">Chapter 7</span></em><span class="koboSpan" id="kobo.1510.1">, </span><em class="italic"><span class="koboSpan" id="kobo.1511.1">Building Scalable Knowledge-Graph-Based RAG with Wikipedia API and LlamaIndex</span></em><span class="koboSpan" id="kobo.1512.1">.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.1513.1">The Commentator’s role was only to describe what it saw. </span><span class="koboSpan" id="kobo.1513.2">The Video Expert is there to make sure it makes sense and also label the videos so they can be classified in the dataset for further use.</span></p>
    <figure class="mediaobject"><span class="koboSpan" id="kobo.1514.1"><img src="../Images/B31169_10_12.png" alt="A diagram of a video expert  Description automatically generated"/></span></figure>
    <p class="packt_figref"><span class="koboSpan" id="kobo.1515.1">Figure 10.10: Workflow of the Video Expert for automated dynamics descriptions and labeling</span></p>
    <ol>
      <li class="numberedList" value="1"><strong class="keyWord"><span class="koboSpan" id="kobo.1516.1">The Pinecone index</span></strong><span class="koboSpan" id="kobo.1517.1"> will connect to the Pinecone index as described in the </span><em class="italic"><span class="koboSpan" id="kobo.1518.1">Pipeline 2. </span><span class="koboSpan" id="kobo.1518.2">The Vector Store Administrator</span></em><span class="koboSpan" id="kobo.1519.1"> section of this chapter. </span><span class="koboSpan" id="kobo.1519.2">This time, we will not upsert data but connect to the vector store.</span></li>
      <li class="numberedList"><strong class="keyWord"><span class="koboSpan" id="kobo.1520.1">Define the RAG functions</span></strong><span class="koboSpan" id="kobo.1521.1"> utilizing the straightforward functions we built in </span><em class="italic"><span class="koboSpan" id="kobo.1522.1">Pipeline 1</span></em><span class="koboSpan" id="kobo.1523.1"> and </span><em class="italic"><span class="koboSpan" id="kobo.1524.1">Pipeline 2</span></em><span class="koboSpan" id="kobo.1525.1"> of this chapter.</span></li>
      <li class="numberedList"><strong class="keyWord"><span class="koboSpan" id="kobo.1526.1">Querying the vector store</span></strong><span class="koboSpan" id="kobo.1527.1"> is nothing but querying the Pinecone Index as described in </span><em class="italic"><span class="koboSpan" id="kobo.1528.1">Pipeline 2</span></em><span class="koboSpan" id="kobo.1529.1"> of this chapter.</span></li>
      <li class="numberedList"><strong class="keyWord"><span class="koboSpan" id="kobo.1530.1">Retrieval augmented generation</span></strong><span class="koboSpan" id="kobo.1531.1"> finally determines the main role of Video Expert GPT-4o, which is to analyze and improve the vector store query responses. </span><span class="koboSpan" id="kobo.1531.2">This final step will include evaluation and metric functions.</span></li>
    </ol>
    <p class="normal"><span class="koboSpan" id="kobo.1532.1">There are as many strategies as projects to implement the video production use case we explored in this chapter, but the Video Expert plays an important role. </span><span class="koboSpan" id="kobo.1532.2">Open </span><code class="inlineCode"><span class="koboSpan" id="kobo.1533.1">Pipeline_3_The_Video_Expert.ipynb</span></code><span class="koboSpan" id="kobo.1534.1"> on GitHub and go to the </span><em class="italic"><span class="koboSpan" id="kobo.1535.1">Augmented Retrieval Generation</span></em><span class="koboSpan" id="kobo.1536.1"> section in </span><em class="italic"><span class="koboSpan" id="kobo.1537.1">Step 2: Defining the RAG functions</span></em><span class="koboSpan" id="kobo.1538.1">.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.1539.1">The function makes an OpenAI GPT-4o </span><a id="_idIndexMarker653"/><span class="koboSpan" id="kobo.1540.1">call, like for the Commentator in </span><em class="italic"><span class="koboSpan" id="kobo.1541.1">Pipeline 1</span></em><span class="koboSpan" id="kobo.1542.1">. </span><span class="koboSpan" id="kobo.1542.2">However, this time, the role of the LLM is quite different:</span></p>
    <pre class="programlisting code"><code class="hljs-code">             <span class="hljs-string"><span class="koboSpan" id="kobo.1543.1">"role"</span></span><span class="koboSpan" id="kobo.1544.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.1545.1">"system"</span></span><span class="koboSpan" id="kobo.1546.1">,
                </span><span class="hljs-string"><span class="koboSpan" id="kobo.1547.1">"content"</span></span><span class="koboSpan" id="kobo.1548.1">: </span><span class="hljs-string"><span class="koboSpan" id="kobo.1549.1">"You will be provided with comments of an image frame taken from a video. </span><span class="koboSpan" id="kobo.1549.2">Analyze the text and 1. </span><span class="koboSpan" id="kobo.1549.3">Point out the cognitive dissonances 2. </span><span class="koboSpan" id="kobo.1549.4">Rewrite the comment in a logical engaging style. </span><span class="koboSpan" id="kobo.1549.5">3. </span><span class="koboSpan" id="kobo.1549.6">Provide a label for this image such as Label: basketball, football, soccer or other label."</span></span>
</code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.1550.1">The instructions for GPT-4o are:</span></p>
    <ul>
      <li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1551.1">You will be provided with comments of an image frame taken from a video</span></code><span class="koboSpan" id="kobo.1552.1">: This instructs the LLM to analyze the AI-generated comments. </span><span class="koboSpan" id="kobo.1552.2">The Commentator had to remain neutral and describe the frame as it saw it. </span><span class="koboSpan" id="kobo.1552.3">The role of the Video Expert agent is different: it has to analyze and enhance the comment.</span></li>
      <li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1553.1">1. </span><span class="koboSpan" id="kobo.1553.2">Point out the cognitive dissonances</span></code><span class="koboSpan" id="kobo.1554.1">: This instructs the model to find contradictions or discrepancies in the comment that can come from the way the AI-generated video was produced as well (lack of logic in the video).</span></li>
      <li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1555.1">2. </span><span class="koboSpan" id="kobo.1555.2">Rewrite the comment in a logical engaging style</span></code><span class="koboSpan" id="kobo.1556.1">: This instructs the Video Expert agent to rewrite the comment going from a technical comment to a description.</span></li>
      <li class="bulletList"><code class="inlineCode"><span class="koboSpan" id="kobo.1557.1">3. </span><span class="koboSpan" id="kobo.1557.2">Provide a label for this image such as Label: basketball, football, soccer or other label</span></code><span class="koboSpan" id="kobo.1558.1">: This instructs the model to provide a label for further use. </span><span class="koboSpan" id="kobo.1558.2">On GitHub, </span><em class="italic"><span class="koboSpan" id="kobo.1559.1">Step 3: Querying the Vector Store</span></em><span class="koboSpan" id="kobo.1560.1"> reproduces the query and output described in </span><em class="italic"><span class="koboSpan" id="kobo.1561.1">Pipeline 2</span></em><span class="koboSpan" id="kobo.1562.1"> for a basketball player scoring with a dunk, with the corresponding video and frame. </span><span class="koboSpan" id="kobo.1562.2">The output is:
        </span><pre class="programlisting con-one"><code class="hljs-con"><span class="koboSpan" id="kobo.1563.1">ID=f104138b-0be8-4f4c-bf99-86d0eb34f7ee
score=0.866193652
text=In this image, there is a person who appears to be in the process of executing a dunk in basketball. </span><span class="koboSpan" id="kobo.1563.2">The individual is airborne, with one arm extended upwards towards the basketball hoop, holding a basketball in hand, preparing to slam it through the hoop. </span><span class="koboSpan" id="kobo.1563.3">The word "dunk" is superimposed on the image, confirming the action taking place. </span><span class="koboSpan" id="kobo.1563.4">The background shows clear skies and a modern building, suggesting this might be an outdoor basketball court in an urban setting. </span><span class="koboSpan" id="kobo.1563.5">The player is wearing athletic wear and a pair of basketball shoes, suitable for the sport. </span><span class="koboSpan" id="kobo.1563.6">The dynamic posture and the context indicate an athletic and powerful movement, typical of a basketball dunk.
</span><span class="koboSpan" id="kobo.1563.7">frame_number=191
file_name=basketball3.mp4
</span></code></pre>
      </li>
    </ul>
    <p class="normal"><span class="koboSpan" id="kobo.1564.1">The comment provided seems</span><a id="_idIndexMarker654"/><span class="koboSpan" id="kobo.1565.1"> acceptable. </span><span class="koboSpan" id="kobo.1565.2">However, let’s see what GPT-4o thinks of it. </span><span class="koboSpan" id="kobo.1565.3">The </span><em class="italic"><span class="koboSpan" id="kobo.1566.1">Step 4: Retrieval Augmented Generation</span></em><span class="koboSpan" id="kobo.1567.1"> section on GitHub takes the output and submits it as the user prompt to the Video Expert agent:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1568.1">prompt=text
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.1569.1">We then call the Video Expert agent to obtain its expertise:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1570.1">response_content = get_openai_response(prompt)
</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1571.1">print</span></span><span class="koboSpan" id="kobo.1572.1">(response_content)
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.1573.1">The output provides the Video Expert’s insights:</span></p>
    <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1574.1">1. </span><span class="koboSpan" id="kobo.1574.2">Cognitive Dissonances:
   - The comment redundantly describes the action of dunking multiple times.
   </span><span class="koboSpan" id="kobo.1574.3">- The mention of "the word 'dunk' is superimposed on the image" is unnecessary and breaks the flow of the description.
   </span><span class="koboSpan" id="kobo.1574.4">- The background details about clear skies and a modern building are somewhat extraneous and could be more succinctly integrated.
</span><span class="koboSpan" id="kobo.1574.5">2. </span><span class="koboSpan" id="kobo.1574.6">Rewritten Comment:
   In this image, a basketball player is captured mid-air, executing a powerful dunk. </span><span class="koboSpan" id="kobo.1574.7">With one arm extended towards the hoop and the basketball firmly in hand, the athlete's dynamic posture showcases the intensity of the moment. </span><span class="koboSpan" id="kobo.1574.8">The outdoor court, set against a backdrop of clear skies and a modern building, highlights the urban setting. </span><span class="koboSpan" id="kobo.1574.9">Dressed in athletic wear and basketball shoes, the player epitomizes the energy and skill of the sport.
</span><span class="koboSpan" id="kobo.1574.10">3. </span><span class="koboSpan" id="kobo.1574.11">Label: Basketball
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.1575.1">The response is well-structured and acceptable. </span><span class="koboSpan" id="kobo.1575.2">The output may vary from one run to another due to the stochastic “creative” nature of Generative AI agents.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.1576.1">The </span><em class="italic"><span class="koboSpan" id="kobo.1577.1">Evaluator</span></em><span class="koboSpan" id="kobo.1578.1"> section that follows </span><em class="italic"><span class="koboSpan" id="kobo.1579.1">Step 4</span></em><span class="koboSpan" id="kobo.1580.1"> runs ten examples using the same process as the basketball request we just made. </span><span class="koboSpan" id="kobo.1580.2">Each </span><a id="_idIndexMarker655"/><span class="koboSpan" id="kobo.1581.1">example thus contains:</span></p>
    <ul>
      <li class="bulletList"><span class="koboSpan" id="kobo.1582.1">A user prompt</span></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.1583.1">The comment returned by the vector store query</span></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.1584.1">The enhanced comment made by the GPT-4o model</span></li>
    </ul>
    <p class="normal"><span class="koboSpan" id="kobo.1585.1">Each example also contains the same evaluation process as in </span><em class="italic"><span class="koboSpan" id="kobo.1586.1">Chapter 7, Building Scalable Knowledge-Graph-Based RAG with Wikipedia API and LlamaIndex, </span></em><span class="koboSpan" id="kobo.1587.1">in the</span><em class="italic"><span class="koboSpan" id="kobo.1588.1"> Examples for metrics</span></em><span class="koboSpan" id="kobo.1589.1"> section. </span><span class="koboSpan" id="kobo.1589.2">However, in this case, the human evaluator suggests content instead of a score (0 to 1). </span><span class="koboSpan" id="kobo.1589.3">The human content becomes the ground truth, the expected output.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.1590.1">Before beginning the evaluation, the program creates scores to keep track of the original response made by the query.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.1591.1">The human evaluator rewrites the output provided by the Video Expert:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.1592.1"># Human feedback flashcard comment</span></span><span class="koboSpan" id="kobo.1593.1">
text1 = </span><span class="hljs-string"><span class="koboSpan" id="kobo.1594.1">"</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1595.1">This image shows soccer players on a field dribbling and passing the ball."</span></span>
</code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.1596.1">The content rewritten by the Video Expert is extracted from the response:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-comment"><span class="koboSpan" id="kobo.1597.1"># Extract rewritten comment</span></span><span class="koboSpan" id="kobo.1598.1">
text2 = extract_rewritten_comment(response_content)
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.1599.1">The human comment (ground truth, the reference output) and the LLM comments are displayed:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="hljs-built_in"><span class="koboSpan" id="kobo.1600.1">print</span></span><span class="koboSpan" id="kobo.1601.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1602.1">f"Human Feedback Comment: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1603.1">{text1}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1604.1">"</span></span><span class="koboSpan" id="kobo.1605.1">)
</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1606.1">print</span></span><span class="koboSpan" id="kobo.1607.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1608.1">f"Rewritten Comment: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1609.1">{text2}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1610.1">"</span></span><span class="koboSpan" id="kobo.1611.1">)
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.1612.1">Then, the cosine similarity score between the human and LLM comments is calculated and appended to </span><code class="inlineCode"><span class="koboSpan" id="kobo.1613.1">scores</span></code><span class="koboSpan" id="kobo.1614.1">:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1615.1">similarity_score3=calculate_cosine_similarity_with_embeddings(text1, text2)
</span><span class="hljs-built_in"><span class="koboSpan" id="kobo.1616.1">print</span></span><span class="koboSpan" id="kobo.1617.1">(</span><span class="hljs-string"><span class="koboSpan" id="kobo.1618.1">f"Cosine Similarity Score with sentence transformer: </span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1619.1">{similarity_score3:</span></span><span class="hljs-number"><span class="koboSpan" id="kobo.1620.1">.3</span></span><span class="hljs-subst"><span class="koboSpan" id="kobo.1621.1">f}</span></span><span class="hljs-string"><span class="koboSpan" id="kobo.1622.1">"</span></span><span class="koboSpan" id="kobo.1623.1">)
scores.append(similarity_score3)
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.1624.1">The original score provided with the query is appended to the query’s retrieval score, </span><code class="inlineCode"><span class="koboSpan" id="kobo.1625.1">rscores</span></code><span class="koboSpan" id="kobo.1626.1">:</span></p>
    <pre class="programlisting code"><code class="hljs-code"><span class="koboSpan" id="kobo.1627.1">rscores.append(score)
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.1628.1">The output displays the human</span><a id="_idIndexMarker656"/><span class="koboSpan" id="kobo.1629.1"> feedback, the comment rewritten by GPT-4o (the Video Expert), and the similarity score:</span></p>
    <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1630.1">Human Feedback Comment: This image shows soccer players on a field dribbling and passing the ball.
</span><span class="koboSpan" id="kobo.1630.2">Rewritten Comment: "A group of people are engaged in a casual game of soccer on a grassy field. </span><span class="koboSpan" id="kobo.1630.3">One player is dribbling the ball while others are either defending or waiting for a pass. </span><span class="koboSpan" id="kobo.1630.4">They are dressed in athletic attire, indicating this is a recreational game among friends or acquaintances. </span><span class="koboSpan" id="kobo.1630.5">Interestingly, there is a superimposed text 'female' that seems unrelated to the activity shown in the image."
</span><span class="koboSpan" id="kobo.1630.6">Cosine Similarity Score with sentence transformer: 0.621
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.1631.1">This program contains ten examples, but we can enter a corpus of as many examples as we wish to evaluate the system. </span><span class="koboSpan" id="kobo.1631.2">The evaluation of each example applies the same choice of metrics as in </span><em class="chapterRef"><span class="koboSpan" id="kobo.1632.1">Chapter 7</span></em><em class="italic"><span class="koboSpan" id="kobo.1633.1">.</span></em><span class="koboSpan" id="kobo.1634.1"> After the examples have been evaluated, the </span><em class="italic"><span class="koboSpan" id="kobo.1635.1">Metrics calculations and display</span></em><span class="koboSpan" id="kobo.1636.1"> section in the program also runs the metric calculations defined in the section of the same name in </span><em class="chapterRef"><span class="koboSpan" id="kobo.1637.1">Chapter 7</span></em><span class="koboSpan" id="kobo.1638.1">.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.1639.1">We can use all the metrics to analyze the performance of the system. </span><span class="koboSpan" id="kobo.1639.2">The time measurements throughout the program also provide insights. </span><span class="koboSpan" id="kobo.1639.3">The first metric, accuracy, is a good metric to start with. </span><span class="koboSpan" id="kobo.1639.4">In this case, it shows that there is room for progress:</span></p>
    <pre class="programlisting con"><code class="hljs-con"><span class="koboSpan" id="kobo.1640.1">Mean: 0.65
</span></code></pre>
    <p class="normal"><span class="koboSpan" id="kobo.1641.1">Some requests and responses were challenging and required further work to improve the system:</span></p>
    <ul>
      <li class="bulletList"><span class="koboSpan" id="kobo.1642.1">Checking the quality of the videos and their content</span></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.1643.1">Checking the comments and possibly modifying them with human feedback, as we did in </span><em class="chapterRef"><span class="koboSpan" id="kobo.1644.1">Chapter 5</span></em><span class="koboSpan" id="kobo.1645.1">, </span><em class="italic"><span class="koboSpan" id="kobo.1646.1">Boosting RAG Performance with Expert Human Feedback</span></em></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.1647.1">Fine-tuning a model with images and text as we did in </span><em class="chapterRef"><span class="koboSpan" id="kobo.1648.1">Chapter 9</span></em><span class="koboSpan" id="kobo.1649.1">, </span><em class="italic"><span class="koboSpan" id="kobo.1650.1">Empowering AI Models: Fine-Tuning RAG Data and Human Feedback</span></em></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.1651.1">Designing any other constructive idea that the video production team comes up with</span></li>
    </ul>
    <p class="normal"><span class="koboSpan" id="kobo.1652.1">We can see that RAG-driven</span><a id="_idIndexMarker657"/><span class="koboSpan" id="kobo.1653.1"> Generative AI systems in production are very effective. </span><span class="koboSpan" id="kobo.1653.2">However, the road from design to production requires hard human effort! </span><span class="koboSpan" id="kobo.1653.3">Though AI technology has made tremendous progress, it still requires humans to design, develop, and implement it in production.</span></p>
    <h1 id="_idParaDest-259" class="heading-1"><span class="koboSpan" id="kobo.1654.1">Summary</span></h1>
    <p class="normal"><span class="koboSpan" id="kobo.1655.1">In this chapter, we explored the hybrid era of human and AI agents, focusing on the creation of a streamlined process for generating, commenting, and labeling videos. </span><span class="koboSpan" id="kobo.1655.2">By integrating cutting-edge Generative AI models, we demonstrated how to build an automated pipeline that transforms raw video inputs into structured, informative, and accessible video content.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.1656.1">Our journey began with the </span><strong class="keyWord"><span class="koboSpan" id="kobo.1657.1">Generator</span></strong><span class="koboSpan" id="kobo.1658.1"> agent in </span><em class="italic"><span class="koboSpan" id="kobo.1659.1">Pipeline 1</span></em><span class="koboSpan" id="kobo.1660.1">:</span><em class="italic"><span class="koboSpan" id="kobo.1661.1"> The Generator and the Commentator</span></em><span class="koboSpan" id="kobo.1662.1">, which was tasked with creating video content from textual ideas. </span><span class="koboSpan" id="kobo.1662.2">We can see that video generation processes will continue to expand through seamless integration ideation and descriptive augmentation generative agents. </span><span class="koboSpan" id="kobo.1662.3">In </span><em class="italic"><span class="koboSpan" id="kobo.1663.1">Pipeline 2</span></em><span class="koboSpan" id="kobo.1664.1">:</span><em class="italic"><span class="koboSpan" id="kobo.1665.1"> The Vector Store Administrator</span></em><span class="koboSpan" id="kobo.1666.1">, we focused on organizing and embedding the generated comments and metadata into a searchable vector store. </span><span class="koboSpan" id="kobo.1666.2">In this pipeline, we highlighted the optimization process of building a scalable video content library with minimal machine resources using only a CPU and no GPU. </span><span class="koboSpan" id="kobo.1666.3">Finally, in </span><em class="italic"><span class="koboSpan" id="kobo.1667.1">Pipeline 3</span></em><span class="koboSpan" id="kobo.1668.1">:</span><em class="italic"><span class="koboSpan" id="kobo.1669.1"> The Video Expert</span></em><span class="koboSpan" id="kobo.1670.1">, we introduced the Expert AI agent, a video specialist designed to enhance and label the video content based on user inputs. </span><span class="koboSpan" id="kobo.1670.2">We also implemented evaluation methods and metric calculations.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.1671.1">By the end of this chapter, we had constructed a comprehensive, automated RAG-driven Generative AI system capable of generating, commenting on, and labeling videos with minimal human intervention. </span><span class="koboSpan" id="kobo.1671.2">This journey demonstrated the power and potential of combining multiple AI agents and models to create an efficient pipeline for video content creation.</span></p>
    <p class="normal"><span class="koboSpan" id="kobo.1672.1">The techniques and tools we explored can revolutionize various industries by automating repetitive tasks, enhancing content quality, and making information retrieval more efficient. </span><span class="koboSpan" id="kobo.1672.2">This chapter not only provided a detailed technical roadmap but also underscored the transformative impact of AI in modern content creation and management. </span><span class="koboSpan" id="kobo.1672.3">You are now all set to implement RAG-driven Generative AI in real-life projects.</span></p>
    <h1 id="_idParaDest-260" class="heading-1"><span class="koboSpan" id="kobo.1673.1">Questions</span></h1>
    <p class="normal"><span class="koboSpan" id="kobo.1674.1">Answer the following questions with yes or no:</span></p>
    <ol>
      <li class="numberedList" value="1"><span class="koboSpan" id="kobo.1675.1">Can AI now automatically comment and label videos?</span></li>
      <li class="numberedList"><span class="koboSpan" id="kobo.1676.1">Does video processing involve splitting the video into frames?</span></li>
      <li class="numberedList"><span class="koboSpan" id="kobo.1677.1">Can the programs in this chapter create a 200-minute movie?</span></li>
      <li class="numberedList"><span class="koboSpan" id="kobo.1678.1">Do the programs in this chapter require a GPU?</span></li>
      <li class="numberedList"><span class="koboSpan" id="kobo.1679.1">Are the embedded vectors of the video content stored on disk?</span></li>
      <li class="numberedList"><span class="koboSpan" id="kobo.1680.1">Do the scripts involve querying a database for retrieving data?</span></li>
      <li class="numberedList"><span class="koboSpan" id="kobo.1681.1">Is there functionality for displaying images in the scripts?</span></li>
      <li class="numberedList"><span class="koboSpan" id="kobo.1682.1">Is it useful to have functions that specifically check file existence and size in any of the scripts?</span></li>
      <li class="numberedList"><span class="koboSpan" id="kobo.1683.1">Is there a focus on multimodal data in these scripts?</span></li>
      <li class="numberedList"><span class="koboSpan" id="kobo.1684.1">Do any of the scripts mention applications of AI in real-world scenarios?</span></li>
    </ol>
    <h1 id="_idParaDest-261" class="heading-1"><span class="koboSpan" id="kobo.1685.1">References</span></h1>
    <ul>
      <li class="bulletList"><span class="koboSpan" id="kobo.1686.1">Sora video generation model information and access:</span><ul>
          <li class="bulletList level-2"><strong class="keyWord"><span class="koboSpan" id="kobo.1687.1">Sora</span></strong><span class="koboSpan" id="kobo.1688.1"> | </span><strong class="keyWord"><span class="koboSpan" id="kobo.1689.1">OpenAI</span></strong><span class="koboSpan" id="kobo.1690.1">: </span><a href="https://ai.invideo.io/"><span class="url"><span class="koboSpan" id="kobo.1691.1">https://ai.invideo.io/</span></span></a></li>
          <li class="bulletList level-2"><a href="https://openai.com/index/video-generation-models-as-world-simulators/"><span class="url"><span class="koboSpan" id="kobo.1692.1">https://openai.com/index/video-generation-models-as-world-simulators/</span></span></a></li>
        </ul>
      </li>
      <li class="bulletList"><em class="italic"><span class="koboSpan" id="kobo.1693.1">Sora: A Review on Background, Technology, Limitations, and Opportunities of Large Vision Models</span></em><span class="koboSpan" id="kobo.1694.1"> by Yixin Liu, Kai Zhang, Yuan Li, et al.: </span><a href="https://arxiv.org/pdf/2402.17177"><span class="url"><span class="koboSpan" id="kobo.1695.1">https://arxiv.org/pdf/2402.17177</span></span></a></li>
    </ul>
    <h1 id="_idParaDest-262" class="heading-1"><span class="koboSpan" id="kobo.1696.1">Further reading</span></h1>
    <ul>
      <li class="bulletList"><span class="koboSpan" id="kobo.1697.1">OpenAI, ChatGPT: </span><a href="https://openai.com/chatgpt/"><span class="url"><span class="koboSpan" id="kobo.1698.1">https://openai.com/chatgpt/</span></span></a></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.1699.1">OpenAI, Research: </span><a href="https://openai.com/research/"><span class="url"><span class="koboSpan" id="kobo.1700.1">https://openai.com/research/</span></span></a></li>
      <li class="bulletList"><span class="koboSpan" id="kobo.1701.1">Pinecone: </span><a href="https://docs.pinecone.io/home"><span class="url"><span class="koboSpan" id="kobo.1702.1">https://docs.pinecone.io/home</span></span></a></li>
    </ul>
    <h1 id="_idParaDest-263" class="heading-1"><span class="koboSpan" id="kobo.1703.1">Join our community on Discord</span></h1>
    <p class="normal"><span class="koboSpan" id="kobo.1704.1">Join our community’s Discord space for discussions with the author and other readers:</span></p>
    <p class="normal"><a href="https://www.packt.link/rag"><span class="url"><span class="koboSpan" id="kobo.1705.1">https://www.packt.link/rag</span></span></a></p>
    <p class="normal"><span class="koboSpan" id="kobo.1706.1"><img src="../Images/QR_Code50409000288080484.png" alt=""/></span></p>
  </div>
</body></html>