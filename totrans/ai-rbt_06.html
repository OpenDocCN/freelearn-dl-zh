<html><head></head><body>
<div id="_idContainer071">
<h1 class="chapter-number" id="_idParaDest-98"><a id="_idTextAnchor205"/><span class="koboSpan" id="kobo.1.1">6</span></h1>
<h1 id="_idParaDest-99"><a id="_idTextAnchor206"/><span class="koboSpan" id="kobo.2.1">Teaching a Robot to Listen</span></h1>
<p><span class="koboSpan" id="kobo.3.1">Teaching a robot to listen to spoken instructions is a whole discipline in itself. </span><span class="koboSpan" id="kobo.3.2">It is not sufficient for the robot to just recognize individual words or some canned phrase. </span><span class="koboSpan" id="kobo.3.3">We want the robot to respond to normal spoken commands with a normal variety of phrasing. </span><span class="koboSpan" id="kobo.3.4">We might say, “Pick up the toys,” or “Please pick up all the toys,” or “Clean this mess up,” any of which would be a valid command to instruct the robot to begin searching the room for toys to pick up and put away. </span><span class="koboSpan" id="kobo.3.5">We will be using a variety of techniques and processes for this chapter. </span><span class="koboSpan" id="kobo.3.6">We are going to be building on an open source verbal </span><a id="_idIndexMarker442"/><span class="koboSpan" id="kobo.4.1">assistant called </span><strong class="bold"><span class="koboSpan" id="kobo.5.1">Mycroft</span></strong><span class="koboSpan" id="kobo.6.1">, an AI-based speech recognition and </span><strong class="bold"><span class="koboSpan" id="kobo.7.1">natural language processing</span></strong><span class="koboSpan" id="kobo.8.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.9.1">NLP</span></strong><span class="koboSpan" id="kobo.10.1">) engine that can be programmed and extended by us. </span><span class="koboSpan" id="kobo.10.2">We will </span><a id="_idIndexMarker443"/><span class="koboSpan" id="kobo.11.1">be adding some additional capability to Mycroft – we will use a technique I call the “fill in the blank” method of command processing to extract the intent of the user’s voice instructions, so that the robot does what you want it to do, even if that is not exactly what you said. </span><span class="koboSpan" id="kobo.11.2">We will complete this chapter by teaching the robot to both tell and respond to a specific form of human communication – </span><span class="No-Break"><span class="koboSpan" id="kobo.12.1">knock-knock jokes.</span></span></p>
<p><span class="koboSpan" id="kobo.13.1">The following topics will be covered in </span><span class="No-Break"><span class="koboSpan" id="kobo.14.1">the chapter:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.15.1">Exploring robot </span><a id="_idIndexMarker444"/><span class="koboSpan" id="kobo.16.1">speech recognition with NLP – both </span><strong class="bold"><span class="koboSpan" id="kobo.17.1">speech to text</span></strong><span class="koboSpan" id="kobo.18.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.19.1">STT</span></strong><span class="koboSpan" id="kobo.20.1">) and </span><strong class="bold"><span class="koboSpan" id="kobo.21.1">text to </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.22.1">speech</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.23.1"> (</span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.24.1">TTS</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.25.1">)</span></span></li>
<li><span class="koboSpan" id="kobo.26.1">Programming </span><a id="_idIndexMarker445"/><span class="No-Break"><span class="koboSpan" id="kobo.27.1">our robot</span></span></li>
</ul>
<h1 id="_idParaDest-100"><a id="_idTextAnchor207"/><span class="koboSpan" id="kobo.28.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.29.1">This chapter uses the </span><span class="No-Break"><span class="koboSpan" id="kobo.30.1">following tools:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.31.1">Mycroft Open </span><a id="_idIndexMarker446"/><span class="koboSpan" id="kobo.32.1">Source Voice Assistant (</span><a href="http://mycroft.ai"><span class="koboSpan" id="kobo.33.1">http://mycroft.ai</span></a><span class="koboSpan" id="kobo.34.1">) – I had to build it from source from the GitHub repository (</span><a href="https://github.com/MycroftAI"><span class="koboSpan" id="kobo.35.1">https://github.com/MycroftAI</span></a><span class="koboSpan" id="kobo.36.1">), so expect to do the same to keep it compatible with </span><a id="_idIndexMarker447"/><span class="koboSpan" id="kobo.37.1">the </span><strong class="bold"><span class="koboSpan" id="kobo.38.1">Robot Operating System</span></strong><span class="koboSpan" id="kobo.39.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.40.1">ROS</span></strong><span class="koboSpan" id="kobo.41.1">) we run the </span><span class="No-Break"><span class="koboSpan" id="kobo.42.1">robot with.</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.43.1">Python 3.2.</span></span></li>
<li><span class="koboSpan" id="kobo.44.1">You will need a GitHub account </span><span class="No-Break"><span class="koboSpan" id="kobo.45.1">at </span></span><a href="https://github.com/"><span class="No-Break"><span class="koboSpan" id="kobo.46.1">https://github.com/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.47.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.48.1">I used a miniature USB speaker and microphone for this project, which worked very well with the Jetson. </span><span class="koboSpan" id="kobo.48.2">They can be found </span><span class="No-Break"><span class="koboSpan" id="kobo.49.1">at </span></span><a href="https://www.amazon.com/gp/product/B08R95XJW8"><span class="No-Break"><span class="koboSpan" id="kobo.50.1">https://www.amazon.com/gp/product/B08R95XJW8</span></span></a></li>
</ul>
<p><span class="koboSpan" id="kobo.51.1">The code used in this chapter can be found in the GitHub repository for this book </span><span class="No-Break"><span class="koboSpan" id="kobo.52.1">at </span></span><a href="https://github.com/PacktPublishing/Artificial-Intelligence-for-Robotics-2e"><span class="No-Break"><span class="koboSpan" id="kobo.53.1">https://github.com/PacktPublishing/Artificial-Intelligence-for-Robotics-2e</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.54.1">.</span></span></p>
<h1 id="_idParaDest-101"><a id="_idTextAnchor208"/><span class="koboSpan" id="kobo.55.1">Exploring robot speech recognition with NLP</span></h1>
<p><span class="koboSpan" id="kobo.56.1">This is going </span><a id="_idIndexMarker448"/><span class="koboSpan" id="kobo.57.1">to be a rather involved chapter, but all of the concepts are fairly easy to understand. </span><span class="koboSpan" id="kobo.57.2">We will end up with a very strong </span><a id="_idIndexMarker449"/><span class="koboSpan" id="kobo.58.1">framework to build voice recognition and commands upon. </span><span class="koboSpan" id="kobo.58.2">Not only will you get a voice-based command system for a robot, but also a full-featured digital assistant that tells jokes. </span><span class="koboSpan" id="kobo.58.3">Let’s first quickly </span><span class="No-Break"><span class="koboSpan" id="kobo.59.1">introduce NLP.</span></span></p>
<h2 id="_idParaDest-102"><a id="_idTextAnchor209"/><span class="koboSpan" id="kobo.60.1">Briefly introducing the NLP concept</span></h2>
<p><span class="koboSpan" id="kobo.61.1">NLP is not just converting sound waves to written words (speech to text, or STT), but also understanding what </span><a id="_idIndexMarker450"/><span class="koboSpan" id="kobo.62.1">those words mean. </span><span class="koboSpan" id="kobo.62.2">We don’t want to just have some rigid, pre-programmed spoken commands, but some ability for the robot to respond to </span><span class="No-Break"><span class="koboSpan" id="kobo.63.1">human speech.</span></span></p>
<p><span class="koboSpan" id="kobo.64.1">We will be using two different forms of </span><span class="No-Break"><span class="koboSpan" id="kobo.65.1">STT processing:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.66.1">Spectrum analysis</span></strong><span class="koboSpan" id="kobo.67.1">: This type helps to detect when you say the robot’s name. </span><span class="koboSpan" id="kobo.67.2">This technique </span><a id="_idIndexMarker451"/><span class="koboSpan" id="kobo.68.1">recognizes words or phrases by sampling which frequencies and amplitudes make up the word. </span><span class="koboSpan" id="kobo.68.2">This process has the </span><a id="_idIndexMarker452"/><span class="koboSpan" id="kobo.69.1">advantage of not taking a lot of computer resources and it is good at recognizing just one word or phrase – our “wake word” that will cause the computer to switch to the second type of voice recognition. </span><span class="koboSpan" id="kobo.69.2">This is the reason other voice-operated assistants require you to use a specific word (e.g., Siri, or Alexa) to enable them to </span><span class="No-Break"><span class="koboSpan" id="kobo.70.1">start listening.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.71.1">Phoneme recognition</span></strong><span class="koboSpan" id="kobo.72.1">: This technique converts STT by recognizing the parts of sounds – phonemes – that make up words. </span><span class="koboSpan" id="kobo.72.2">This technique, which seeks to interpret all </span><a id="_idIndexMarker453"/><span class="koboSpan" id="kobo.73.1">sounds as words, is much more difficult, so we use the wake word to trigger the change. </span><span class="koboSpan" id="kobo.73.2">We’ll cover this in more detail later in </span><span class="No-Break"><span class="koboSpan" id="kobo.74.1">this chapter.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.75.1">Next, let’s explore our primary goals for implementing </span><span class="No-Break"><span class="koboSpan" id="kobo.76.1">speech recognition.</span></span></p>
<h2 id="_idParaDest-103"><a id="_idTextAnchor210"/><span class="koboSpan" id="kobo.77.1">Setting our goals</span></h2>
<p><span class="koboSpan" id="kobo.78.1">We set several goals for our robot in </span><a href="B19846_02.xhtml#_idTextAnchor032"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.79.1">Chapter 2</span></em></span></a><span class="koboSpan" id="kobo.80.1">, which included being able to give voice commands to the robot since we may be using the robot without a base station. </span><span class="koboSpan" id="kobo.80.2">I also wanted the </span><a id="_idIndexMarker454"/><span class="koboSpan" id="kobo.81.1">robot to be able to interact with my grandchildren, and specifically to be able to tell and respond to knock-knock jokes, a favorite activity of my grandson, William. </span><span class="koboSpan" id="kobo.81.2">For our robot, we do not want to use canned or memorized speech commands but rather have it be able to do some NLP to create a form of robot understanding of the spoken word. </span><span class="koboSpan" id="kobo.81.3">For example, if we want to have a command for picking up a toy, we humans could phrase that several ways: </span><em class="italic"><span class="koboSpan" id="kobo.82.1">grab a toy</span></em><span class="koboSpan" id="kobo.83.1">, </span><em class="italic"><span class="koboSpan" id="kobo.84.1">grasp a toy</span></em><span class="koboSpan" id="kobo.85.1">, </span><em class="italic"><span class="koboSpan" id="kobo.86.1">pick up that toy car</span></em><span class="koboSpan" id="kobo.87.1">, or even </span><em class="italic"><span class="koboSpan" id="kobo.88.1">get that</span></em><span class="koboSpan" id="kobo.89.1">. </span><span class="koboSpan" id="kobo.89.2">We want the robot to understand or at least respond to all of those utterances with the same action, to drive to the nearest toy and pick it up with the robot arm. </span><span class="koboSpan" id="kobo.89.3">STT systems are fairly commonplace today, but we would like to have some natural variations in the robot’s speech patterns to help create the illusion that the robot is smarter than it really is. </span><span class="koboSpan" id="kobo.89.4">We can break this process down into several steps, which we will be </span><span class="No-Break"><span class="koboSpan" id="kobo.90.1">handling independently:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.91.1">Receive audio (sound) inputs. </span><span class="koboSpan" id="kobo.91.2">We need the robot to be able to hear or have the ability to convert sound into a </span><span class="No-Break"><span class="koboSpan" id="kobo.92.1">digital form.</span></span></li>
<li><span class="koboSpan" id="kobo.93.1">Those sounds need to be converted into text that the robot </span><span class="No-Break"><span class="koboSpan" id="kobo.94.1">can process.</span></span></li>
<li><span class="koboSpan" id="kobo.95.1">Use processing on those text words to understand the intent of the speaker. </span><span class="koboSpan" id="kobo.95.2">We need to not just recognize individual words but combine those words into sentences and from those sentences, infer the intent of the speaker to understand what the robot is </span><span class="No-Break"><span class="koboSpan" id="kobo.96.1">to do.</span></span></li>
<li><span class="koboSpan" id="kobo.97.1">Use that intent as a command to perform </span><span class="No-Break"><span class="koboSpan" id="kobo.98.1">some task.</span></span></li>
<li><span class="koboSpan" id="kobo.99.1">Provide verbal responses in the form of spoken words (text to speech, or TTS) back to the operator to confirm the robot heard and understood </span><span class="No-Break"><span class="koboSpan" id="kobo.100.1">the command.</span></span></li>
<li><span class="koboSpan" id="kobo.101.1">Create a custom verbal interface that both tells and responds to </span><span class="No-Break"><span class="koboSpan" id="kobo.102.1">knock-knock jokes.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.103.1">We will start </span><a id="_idIndexMarker455"/><span class="koboSpan" id="kobo.104.1">in the next section by introducing the process of STT, which is how the robot will receive voice input </span><span class="No-Break"><span class="koboSpan" id="kobo.105.1">from you.</span></span></p>
<h2 id="_idParaDest-104"><a id="_idTextAnchor211"/><span class="koboSpan" id="kobo.106.1">Understanding the STT process</span></h2>
<p><span class="koboSpan" id="kobo.107.1">In the rest of this chapter, we will be implementing an AI-based voice recognition and response system </span><a id="_idIndexMarker456"/><span class="koboSpan" id="kobo.108.1">in the robot and creating our own custom voice interface. </span><span class="koboSpan" id="kobo.108.2">We will be using Mycroft, an open source voice-activated digital assistant that is adept at understanding speech and is easily extended for new functions and </span><span class="No-Break"><span class="koboSpan" id="kobo.109.1">custom interfaces.</span></span></p>
<p><span class="koboSpan" id="kobo.110.1">We will discuss each of the steps involved in voice interaction in detail. </span><span class="koboSpan" id="kobo.110.2">There are two forms of STT involved in this process that greatly simplify matters for </span><a id="_idIndexMarker457"/><span class="koboSpan" id="kobo.111.1">the robot: </span><strong class="bold"><span class="koboSpan" id="kobo.112.1">wake word recognition</span></strong><span class="koboSpan" id="kobo.113.1"> and </span><strong class="bold"><span class="koboSpan" id="kobo.114.1">STT recognition</span></strong><span class="koboSpan" id="kobo.115.1">. </span><span class="koboSpan" id="kobo.115.2">Let’s explore wake word </span><span class="No-Break"><span class="koboSpan" id="kobo.116.1">recognition first.</span></span></p>
<h3><span class="koboSpan" id="kobo.117.1">Listening for the wake word</span></h3>
<p><span class="koboSpan" id="kobo.118.1">In the first approach, the robot is listening continuously for only one sound – the wake word. </span><span class="koboSpan" id="kobo.118.2">This is a </span><a id="_idIndexMarker458"/><span class="koboSpan" id="kobo.119.1">specific sound that just means one thing – get ready to process the next sound into a command. </span><span class="koboSpan" id="kobo.119.2">Why is this necessary? </span><span class="koboSpan" id="kobo.119.3">Since the robot has only a very small processor – the Jetson Nano – it really does not have the sort of onboard compute power to run a robust STT engine. </span><span class="koboSpan" id="kobo.119.4">But it can run a simple sound recognizer that can listen for the wake word. </span><span class="koboSpan" id="kobo.119.5">You are familiar with this from other voice command systems, such as Alexa or Siri, that also either use a special wake word or a button </span><a id="_idIndexMarker459"/><span class="koboSpan" id="kobo.120.1">to have the interface pay attention (</span><span class="No-Break"><span class="koboSpan" id="kobo.121.1">see </span></span><a href="https://www.howtogeek.com/427686/how-alexa-listens-for-wake-words/"><span class="No-Break"><span class="koboSpan" id="kobo.122.1">https://www.howtogeek.com/427686/how-alexa-listens-for-wake-words/</span></span></a><span class="No-Break"><span class="koboSpan" id="kobo.123.1">).</span></span></p>
<p><span class="koboSpan" id="kobo.124.1">Once the wake word is received, the Jetson Nano switches into record mode and records the next thing we say. </span><span class="koboSpan" id="kobo.124.2">It then transfers that information to an online system, the Google Cloud Speech to Text system (the same thing that runs the </span><span class="No-Break"><span class="koboSpan" id="kobo.125.1">Google Assistant).</span></span></p>
<p><span class="koboSpan" id="kobo.126.1">How does the robot recognize the wake word? </span><span class="koboSpan" id="kobo.126.2">The speech system we will be using, the open source system Mycroft, uses one of </span><span class="No-Break"><span class="koboSpan" id="kobo.127.1">two methods:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.128.1">The first is a </span><strong class="bold"><span class="koboSpan" id="kobo.129.1">phoneme recognition system</span></strong><span class="koboSpan" id="kobo.130.1"> called Sphynx. </span><span class="koboSpan" id="kobo.130.2">What is a phoneme? </span><span class="koboSpan" id="kobo.130.3">You can </span><a id="_idIndexMarker460"/><span class="koboSpan" id="kobo.131.1">understand that words are made up of individual sounds, which we roughly assign to letters of the alphabet. </span><span class="koboSpan" id="kobo.131.2">An example </span><a id="_idIndexMarker461"/><span class="koboSpan" id="kobo.132.1">would be the </span><em class="italic"><span class="koboSpan" id="kobo.133.1">p</span></em><span class="koboSpan" id="kobo.134.1"> sound in the word </span><em class="italic"><span class="koboSpan" id="kobo.135.1">pet</span></em><span class="koboSpan" id="kobo.136.1"> or </span><em class="italic"><span class="koboSpan" id="kobo.137.1">pick</span></em><span class="koboSpan" id="kobo.138.1"> – this is an example of a phoneme. </span><span class="koboSpan" id="kobo.138.2">The word “Albert” has several phonemes – the </span><em class="italic"><span class="koboSpan" id="kobo.139.1">A</span></em><span class="koboSpan" id="kobo.140.1"> sound, (ah), the </span><em class="italic"><span class="koboSpan" id="kobo.141.1">L</span></em><span class="koboSpan" id="kobo.142.1"> sound, the </span><em class="italic"><span class="koboSpan" id="kobo.143.1">B</span></em><span class="koboSpan" id="kobo.144.1">, the </span><em class="italic"><span class="koboSpan" id="kobo.145.1">ER</span></em><span class="koboSpan" id="kobo.146.1"> together, and finally, the </span><em class="italic"><span class="koboSpan" id="kobo.147.1">T</span></em><span class="koboSpan" id="kobo.148.1">. </span><span class="koboSpan" id="kobo.148.2">The letters we associate with the sounds – for example, the </span><em class="italic"><span class="koboSpan" id="kobo.149.1">ch</span></em><span class="koboSpan" id="kobo.150.1"> in </span><em class="italic"><span class="koboSpan" id="kobo.151.1">cherry</span></em><span class="koboSpan" id="kobo.152.1">, and the </span><em class="italic"><span class="koboSpan" id="kobo.153.1">er</span></em><span class="koboSpan" id="kobo.154.1"> in </span><em class="italic"><span class="koboSpan" id="kobo.155.1">Albert</span></em><span class="koboSpan" id="kobo.156.1">, are called </span><strong class="bold"><span class="koboSpan" id="kobo.157.1">graphemes</span></strong><span class="koboSpan" id="kobo.158.1">, as they graphically represent these sounds. </span><span class="koboSpan" id="kobo.158.2">We could say </span><a id="_idIndexMarker462"/><span class="koboSpan" id="kobo.159.1">that the STT problem is one of mapping these phonemes to graphemes, but we know that this is too easy – English has all sorts of borrowed words and phrases where the pronunciation and the spelling are </span><span class="No-Break"><span class="koboSpan" id="kobo.160.1">far apart.</span></span><p class="list-inset"><span class="koboSpan" id="kobo.161.1">The frontend of the Mycroft speech recognition process uses phonemes to recognize the wake word. </span><span class="koboSpan" id="kobo.161.2">You will find that it is quite sensitive. </span><span class="koboSpan" id="kobo.161.3">I had no problem getting the speech processor to receive the wake word from eight feet away. </span><span class="koboSpan" id="kobo.161.4">When we get to the setup, we will change the default Mycroft wake word from “Hey, Mycroft,” to “</span><span class="No-Break"><span class="koboSpan" id="kobo.162.1">Hey, Albert.”</span></span></p></li>
<li><span class="koboSpan" id="kobo.163.1">Mycroft can also </span><a id="_idIndexMarker463"/><span class="koboSpan" id="kobo.164.1">use a trained </span><strong class="bold"><span class="koboSpan" id="kobo.165.1">neural network</span></strong><span class="koboSpan" id="kobo.166.1"> that has been taught to recognize entire words all at once by their </span><strong class="bold"><span class="koboSpan" id="kobo.167.1">spectral power graph</span></strong><span class="koboSpan" id="kobo.168.1">. </span><span class="koboSpan" id="kobo.168.2">What is </span><a id="_idIndexMarker464"/><span class="koboSpan" id="kobo.169.1">a spectral graph? </span><span class="koboSpan" id="kobo.169.2">The sound of your voice is not one frequency of sound energy – it is a complex congregation of different frequencies produced by our mouths and vocal cords. </span><span class="koboSpan" id="kobo.169.3">If we spoke in pure frequencies, we would sound like a flute – pure tones at mostly one frequency. </span><span class="koboSpan" id="kobo.169.4">We can use a </span><a id="_idIndexMarker465"/><span class="koboSpan" id="kobo.170.1">process called a </span><strong class="bold"><span class="koboSpan" id="kobo.171.1">fast Fourier transform</span></strong><span class="koboSpan" id="kobo.172.1"> to convert a selection of speech into a graph that shows the amount of energy (volume) at each frequency. </span><span class="koboSpan" id="kobo.172.2">This is called a spectral plot or spectral graph. </span><span class="koboSpan" id="kobo.172.3">The low frequencies are on the left, and higher frequencies are on the right. </span><span class="koboSpan" id="kobo.172.4">Most human speech’s energy is concentrated in the frequencies between 300 Hz and 4,000 Hz. </span><span class="koboSpan" id="kobo.172.5">Each word has a unique distribution of sound energy amounts in these frequencies, and can be recognized by a neural network in </span><span class="No-Break"><span class="koboSpan" id="kobo.173.1">this manner:</span></span></li>
</ul>
<div>
<div class="IMG---Figure" id="_idContainer070">
<span class="koboSpan" id="kobo.174.1"><img alt="Figure 6.1 – Analog audio waveform (top) and the spectral graph for the phrase “Hey, Albert” (bottom)﻿" src="image/B19846_06_1.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.175.1">Figure 6.1 – Analog audio waveform (top) and the spectral graph for the phrase “Hey, Albert” (bottom)</span></p>
<p class="list-inset"><span class="koboSpan" id="kobo.176.1">This preceding diagram shows both the audio waveform (top graph) in the time domain and the spectral plot in the frequency domain for the phrase “</span><span class="No-Break"><span class="koboSpan" id="kobo.177.1">Hey, Albert.”</span></span></p>
<p><span class="koboSpan" id="kobo.178.1">Both the phoneme </span><a id="_idIndexMarker466"/><span class="koboSpan" id="kobo.179.1">method and the neural network method use spectral plots to recognize sounds as words, but the phoneme process divides words into individual sounds, and the neural network listens and recognizes the entire word all at once. </span><span class="koboSpan" id="kobo.179.2">Why does this make a big difference? </span><span class="koboSpan" id="kobo.179.3">The phoneme system can be developed to recognize any word in English without reprogramming or retraining, while the neural network has to be trained on each word individually, and hopefully by a lot of different speakers with a lot of different accents. </span><span class="koboSpan" id="kobo.179.4">We’ll be using the neural network method </span><span class="No-Break"><span class="koboSpan" id="kobo.180.1">for Albert.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.181.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.182.1">You can remember from </span><a href="B19846_04.xhtml#_idTextAnchor126"><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.183.1">Chapter 4</span></em></span></a><span class="koboSpan" id="kobo.184.1"> that we needed labeled data to train a neural network. </span><span class="koboSpan" id="kobo.184.2">You recall </span><a id="_idIndexMarker467"/><span class="koboSpan" id="kobo.185.1">we had pictures in categories and trained on each category. </span><span class="koboSpan" id="kobo.185.2">Training </span><strong class="bold"><span class="koboSpan" id="kobo.186.1">artificial neural networks</span></strong><span class="koboSpan" id="kobo.187.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.188.1">ANNs</span></strong><span class="koboSpan" id="kobo.189.1">) for sound is the same: we need sounds and the associated words. </span><span class="koboSpan" id="kobo.189.2">Can you think of a place to get samples of lots of different voices where you also have the exact written script to match? </span><span class="koboSpan" id="kobo.189.3">Have you ever listened to a book </span><span class="No-Break"><span class="koboSpan" id="kobo.190.1">on tape?</span></span></p>
<h3><span class="koboSpan" id="kobo.191.1">Converting STT</span></h3>
<p><span class="koboSpan" id="kobo.192.1">Our next step after receiving the wake word is to record the next sounds that the robot hears. </span><span class="koboSpan" id="kobo.192.2">The Mycroft </span><a id="_idIndexMarker468"/><span class="koboSpan" id="kobo.193.1">system then transfers that audio data over the internet to the Google online STT engine (</span><a href="https://cloud.google.com/speech-to-text/"><span class="koboSpan" id="kobo.194.1">https://cloud.google.com/speech-to-text/</span></a><span class="koboSpan" id="kobo.195.1">). </span><span class="koboSpan" id="kobo.195.2">This is a quick way to resolve the problem of our little Jetson Nano not having enough processing power or storage to have a robust speech </span><span class="No-Break"><span class="koboSpan" id="kobo.196.1">recognition capability.</span></span></p>
<p><span class="koboSpan" id="kobo.197.1">What goes on in Google Cloud? </span><span class="koboSpan" id="kobo.197.2">The STT engine breaks the speech down into phonemes (sounds) and uses a neural network to assign the most probable graphemes (letters) to those sounds. </span><span class="koboSpan" id="kobo.197.3">The output would be spelled out more phonetically than we want to receive. </span><span class="koboSpan" id="kobo.197.4">For example, as per the </span><em class="italic"><span class="koboSpan" id="kobo.198.1">Carnegie Mellon University Pronouncing Dictionary</span></em><span class="koboSpan" id="kobo.199.1">, the sentence “Pick up the toys, please?” </span><span class="koboSpan" id="kobo.199.2">comes out as  </span><strong class="source-inline"><span class="koboSpan" id="kobo.200.1">P IH K . </span><span class="koboSpan" id="kobo.200.2">AH P . </span><span class="koboSpan" id="kobo.200.3">DH AH . </span><span class="koboSpan" id="kobo.200.4">T OY Z . </span><span class="koboSpan" id="kobo.200.5">P L IY Z</span></strong><span class="koboSpan" id="kobo.201.1">. </span><span class="koboSpan" id="kobo.201.2">Why is this the case? </span><span class="koboSpan" id="kobo.201.3">What happened? </span><span class="koboSpan" id="kobo.201.4">These are the phonemes that make up that sentence. </span><span class="koboSpan" id="kobo.201.5">The periods indicate spaces between words. </span><span class="koboSpan" id="kobo.201.6">Now the system has to convert this into the words we are expecting. </span><span class="koboSpan" id="kobo.201.7">The STT system uses word rules and dictionaries to come up with the most likely conversion into regular words. </span><span class="koboSpan" id="kobo.201.8">This includes both expert systems (word rules) and trained neural networks that predict output words based </span><span class="No-Break"><span class="koboSpan" id="kobo.202.1">on phonemes.</span></span></p>
<p><span class="koboSpan" id="kobo.203.1">We can call this step the </span><strong class="bold"><span class="koboSpan" id="kobo.204.1">language model</span></strong><span class="koboSpan" id="kobo.205.1">. </span><span class="koboSpan" id="kobo.205.2">Our STT outputs the sentence “How many ounces in a gallon?” </span><span class="koboSpan" id="kobo.205.3">and sends it back to the robot, all in less than </span><span class="No-Break"><span class="koboSpan" id="kobo.206.1">two seconds.</span></span></p>
<p><span class="koboSpan" id="kobo.207.1">Now that we have the command in text, an English sentence, how does the robot recognize what your </span><span class="No-Break"><span class="koboSpan" id="kobo.208.1">intent is?</span></span></p>
<h2 id="_idParaDest-105"><a id="_idTextAnchor212"/><span class="koboSpan" id="kobo.209.1">Clarifying the intent</span></h2>
<p><span class="koboSpan" id="kobo.210.1">The NLP we are </span><a id="_idIndexMarker469"/><span class="koboSpan" id="kobo.211.1">doing has one aim, or goal. </span><span class="koboSpan" id="kobo.211.2">We are giving commands to our robot using a voice interface. </span><span class="koboSpan" id="kobo.211.3">Commands in English normally follow a sentence pattern, something like “You – do this.” </span><span class="koboSpan" id="kobo.211.4">Often the “you” subject of the sentence is implied or understood and left out. </span><span class="koboSpan" id="kobo.211.5">We are left with statements such as “Clean this room,” or “Pick up those toys.” </span><span class="koboSpan" id="kobo.211.6">The intent of these commands is to have the robot initiate a program that results in the robot picking up toys and putting them away. </span><span class="koboSpan" id="kobo.211.7">The robot and its processor have to divine or derive the intent of the user from the words that are spoken. </span><span class="koboSpan" id="kobo.211.8">What we want is for any reasonable sentence to have as its meaning: “You, robot, start your </span><span class="No-Break"><span class="koboSpan" id="kobo.212.1">pick-up-toys process.”</span></span></p>
<p><span class="koboSpan" id="kobo.213.1">Think of how many ways we can say that command to the robot. </span><span class="koboSpan" id="kobo.213.2">Here are </span><span class="No-Break"><span class="koboSpan" id="kobo.214.1">some examples:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.215.1">Let’s clean up </span><span class="No-Break"><span class="koboSpan" id="kobo.216.1">this room</span></span></li>
<li><span class="koboSpan" id="kobo.217.1">Put away </span><span class="No-Break"><span class="koboSpan" id="kobo.218.1">the toys</span></span></li>
<li><span class="koboSpan" id="kobo.219.1">Pick up </span><span class="No-Break"><span class="koboSpan" id="kobo.220.1">the toys</span></span></li>
<li><span class="koboSpan" id="kobo.221.1">Pick up all </span><span class="No-Break"><span class="koboSpan" id="kobo.222.1">the toys</span></span></li>
<li><span class="koboSpan" id="kobo.223.1">Clean up </span><span class="No-Break"><span class="koboSpan" id="kobo.224.1">this room</span></span></li>
<li><span class="koboSpan" id="kobo.225.1">Put </span><span class="No-Break"><span class="koboSpan" id="kobo.226.1">those away</span></span></li>
<li><span class="koboSpan" id="kobo.227.1">Put </span><span class="No-Break"><span class="koboSpan" id="kobo.228.1">this away</span></span></li>
<li><span class="koboSpan" id="kobo.229.1">Time to </span><span class="No-Break"><span class="koboSpan" id="kobo.230.1">clean up</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.231.1">What do </span><a id="_idIndexMarker470"/><span class="koboSpan" id="kobo.232.1">these phrases have in common? </span><span class="koboSpan" id="kobo.232.2">They all imply the subject who is doing the action is the robot. </span><span class="koboSpan" id="kobo.232.3">There are no words such as “You,” “robot,” or “Albert” to indicate to whom the command is intended for. </span><span class="koboSpan" id="kobo.232.4">The word “toys” appears a lot, as does “pick,” “clean,” and “put away.” </span><span class="koboSpan" id="kobo.232.5">It is possible that we can just pay attention to those keywords to understand this command. </span><span class="koboSpan" id="kobo.232.6">If we get rid of all of the common conjunction and pronoun words, what does the list </span><span class="No-Break"><span class="koboSpan" id="kobo.233.1">look like?</span></span></p>
<ul>
<li><span class="No-Break"><span class="koboSpan" id="kobo.234.1">Clean room</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.235.1">Put toys</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.236.1">Pick toys</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.237.1">Pick toys</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.238.1">Clean room</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.239.1">Put away</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.240.1">Put away</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.241.1">Time clean</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.242.1">An important concept for this chapter is to understand that we are not trying to understand all speech, but only that subset of speech that are commands that the robot can execute. </span><span class="koboSpan" id="kobo.242.2">A general solution to this voice recognition problem would be to have some ability to </span><a id="_idIndexMarker471"/><span class="koboSpan" id="kobo.243.1">predict from the command given to the robot, the likelihood that the intent of the user points to one command more than any of the others. </span><span class="koboSpan" id="kobo.243.2">You can see that in the case of the word “clean,” none of our other commands (“drive around,” “move arm,” or “stop”) relate to “clean” at all. </span><span class="koboSpan" id="kobo.243.3">Thus, a sentence with “clean” in it is likely associated with the </span><em class="italic"><span class="koboSpan" id="kobo.244.1">pick up toys</span></em><span class="koboSpan" id="kobo.245.1"> command. </span><span class="koboSpan" id="kobo.245.2">This process of deciding intent will be used later in this chapter to send commands to the robot </span><span class="No-Break"><span class="koboSpan" id="kobo.246.1">using Mycroft.</span></span></p>
<p><span class="koboSpan" id="kobo.247.1">Now we are going to jump right into programming the Albert robot to listen and understand commands </span><span class="No-Break"><span class="koboSpan" id="kobo.248.1">using Mycroft.</span></span></p>
<h1 id="_idParaDest-106"><a id="_idTextAnchor213"/><span class="koboSpan" id="kobo.249.1">Programming our robot</span></h1>
<p><span class="koboSpan" id="kobo.250.1">As discussed earlier in this chapter, Mycroft is a version of a digital assistant similar to Siri from Apple </span><a id="_idIndexMarker472"/><span class="koboSpan" id="kobo.251.1">or Alexa from Amazon in that it can listen to voice commands in a mostly normal fashion and interface those commands to a computer. </span><span class="koboSpan" id="kobo.251.2">We are using it because it has an interface that runs on a Jetson Nano 3. </span><span class="koboSpan" id="kobo.251.3">In this section, we will be setting up our hardware and our software (</span><span class="No-Break"><span class="koboSpan" id="kobo.252.1">i.e., Mycroft).</span></span></p>
<h2 id="_idParaDest-107"><a id="_idTextAnchor214"/><span class="koboSpan" id="kobo.253.1">Setting up the hardware</span></h2>
<p><span class="koboSpan" id="kobo.254.1">We will be installing Mycroft on Nvidia Jetson Nano (or whatever microprocessor you’re using). </span><span class="koboSpan" id="kobo.254.2">One of </span><a id="_idIndexMarker473"/><span class="koboSpan" id="kobo.255.1">the few things that the Jetson Nano did not come with is </span><strong class="bold"><span class="koboSpan" id="kobo.256.1">audio capability</span></strong><span class="koboSpan" id="kobo.257.1">. </span><span class="koboSpan" id="kobo.257.2">It has no speakers or microphones. </span><span class="koboSpan" id="kobo.257.3">I found that a quick and effective way to add that capability was to use an existing hardware kit that provided both a very high-quality speaker and an excellent set of stereo </span><a id="_idIndexMarker474"/><span class="koboSpan" id="kobo.258.1">microphones in a robot-friendly form factor. </span><span class="koboSpan" id="kobo.258.2">Note that this works with pretty much any Linux </span><strong class="bold"><span class="koboSpan" id="kobo.259.1">single-board </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.260.1">computer</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.261.1"> (</span></span><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.262.1">SBC</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.263.1">).</span></span></p>
<p><span class="koboSpan" id="kobo.264.1">The kit is a miniature USB audio board that plugs into the Jetson Nano. </span><span class="koboSpan" id="kobo.264.2">It has both speakers and </span><span class="No-Break"><span class="koboSpan" id="kobo.265.1">a microphone.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.266.1"> Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.267.1">I used a USB audio board (the brand is not important as any of them will do) for the Jetson Nano, which has been working very well for me and fits in the very small space we have on the robot. </span><span class="koboSpan" id="kobo.267.2">Installation could not be simpler. </span><span class="koboSpan" id="kobo.267.3">Plug in the audio board. </span><span class="koboSpan" id="kobo.267.4">You will need to go to </span><strong class="bold"><span class="koboSpan" id="kobo.268.1">Settings</span></strong><span class="koboSpan" id="kobo.269.1"> in the upper-right corner of your screen to select the USB audio version. </span><span class="koboSpan" id="kobo.269.2">There will be several other </span><span class="No-Break"><span class="koboSpan" id="kobo.270.1">options listed.</span></span></p>
<p><span class="koboSpan" id="kobo.271.1">Turn on </span><a id="_idIndexMarker475"/><span class="koboSpan" id="kobo.272.1">your Jetson Nano 3 with the new speaker and microphone. </span><span class="koboSpan" id="kobo.272.2">I ran a quick test with YouTube to make sure the audio worked, and you can test it directly in the </span><strong class="bold"><span class="koboSpan" id="kobo.273.1">Settings</span></strong><span class="koboSpan" id="kobo.274.1"> user interface. </span><span class="koboSpan" id="kobo.274.2">Now we can dive into </span><span class="No-Break"><span class="koboSpan" id="kobo.275.1">the software.</span></span></p>
<h2 id="_idParaDest-108"><a id="_idTextAnchor215"/><span class="koboSpan" id="kobo.276.1">Setting up the Mycroft software</span></h2>
<p><span class="koboSpan" id="kobo.277.1">There are </span><a id="_idIndexMarker476"/><span class="koboSpan" id="kobo.278.1">several ways to install Mycroft, as we </span><a id="_idIndexMarker477"/><span class="koboSpan" id="kobo.279.1">have to put Mycroft on top of the other software we </span><span class="No-Break"><span class="koboSpan" id="kobo.280.1">have already:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.281.1">Since Mycroft must get along with the ROS, and all of the AI libraries we installed, such as TensorFlow, Theano, and Keras, it is best that we use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.282.1">git clone</span></strong><span class="koboSpan" id="kobo.283.1"> method to download the source code and build Mycroft on the </span><span class="No-Break"><span class="koboSpan" id="kobo.284.1">Jetson Nano:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.285.1">git clone https://github.com/MycroftAI/mycroft-core.git cd Mycroft-core</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.286.1">bash dev_setup.sh</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.287.1">Mycroft will create a virtual environment it needs to run. </span><span class="koboSpan" id="kobo.287.2">It also isolates the Mycroft package from the rest of the packages on the </span><span class="No-Break"><span class="koboSpan" id="kobo.288.1">Jetson Nano.</span></span></p></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.289.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.290.1">Please do not install Mycroft as the root user (or superuser). </span><span class="koboSpan" id="kobo.290.2">This will cause permissions problems with the </span><span class="No-Break"><span class="koboSpan" id="kobo.291.1">configuration files.</span></span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.292.1">In order to get the Mycroft system to work in this manner, I also had to do one more step. </span><span class="koboSpan" id="kobo.292.2">The Mycroft system kept failing when I first tried to get it to run. </span><span class="koboSpan" id="kobo.292.3">It would quit or get stuck when I tried to start the debugger. </span><span class="koboSpan" id="kobo.292.4">In order to correct this problem, I had to recompile the entire system using the </span><span class="No-Break"><span class="koboSpan" id="kobo.293.1">following steps:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.294.1">sudo rm -R -/.virtualenvs/Mycroft</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.295.1">cd ~/mycroft-core</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.296.1">./dev_setup.sh</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.297.1">Once that is done (and it took quite a while – as in several hours), you should be able to run the Mycroft system with the startup commands from the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.298.1">mycroft-core</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.299.1"> directory.</span></span></p></li> <li><span class="koboSpan" id="kobo.300.1">You can </span><a id="_idIndexMarker478"/><span class="koboSpan" id="kobo.301.1">start in </span><span class="No-Break"><span class="koboSpan" id="kobo.302.1">debug mode:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.303.1">./start-mycroft.sh debug</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.304.1">Alternatively, you can start in </span><span class="No-Break"><span class="koboSpan" id="kobo.305.1">normal mode:</span></span></p><pre class="source-code"><strong class="bold"><span class="koboSpan" id="kobo.306.1">./start-mycroft.sh all</span></strong></pre><p class="list-inset"><span class="koboSpan" id="kobo.307.1">You will </span><a id="_idIndexMarker479"/><span class="koboSpan" id="kobo.308.1">probably be using debug mode quite a bit when you are developing your speech commands. </span><span class="koboSpan" id="kobo.308.2">You can’t see what’s going on without it. </span><span class="koboSpan" id="kobo.308.3">Once everything is working properly, you can switch to normal mode, but there will be no user interface except for the </span><span class="No-Break"><span class="koboSpan" id="kobo.309.1">robot’s voice.</span></span></p></li> <li><span class="koboSpan" id="kobo.310.1">Now test that Mycroft is working properly. </span><span class="koboSpan" id="kobo.310.2">When you first get Mycroft to run, it will want to be paired with your account on the Mycroft web server. </span><span class="koboSpan" id="kobo.310.3">You need to set up a services account on the Mycroft website at </span><a href="http://home.mycroft.ai"><span class="koboSpan" id="kobo.311.1">http://home.mycroft.ai</span></a><span class="koboSpan" id="kobo.312.1">. </span><span class="koboSpan" id="kobo.312.2">Then the Jetson Nano will give you a six-letter code to put into the website under </span><strong class="bold"><span class="koboSpan" id="kobo.313.1">Devices</span></strong><span class="koboSpan" id="kobo.314.1"> (on the hamburger menu on the far right-hand side of </span><span class="No-Break"><span class="koboSpan" id="kobo.315.1">the website).</span></span><p class="list-inset"><span class="koboSpan" id="kobo.316.1">Once the robot is paired with the Mycroft server, it can transfer data back and forth. </span><span class="koboSpan" id="kobo.316.2">The wake word will start out being the default, “Hey, Mycroft.” </span><span class="koboSpan" id="kobo.316.3">You can test that everything is working by first asking, “Hey, Mycroft, what time is it?” </span><span class="koboSpan" id="kobo.316.4">Mycroft divides its capabilities into skills that are each controlled by a separate script. </span><span class="koboSpan" id="kobo.316.5">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.317.1">Time</span></strong><span class="koboSpan" id="kobo.318.1"> skill is totally self-contained inside the Jetson Nano. </span><span class="koboSpan" id="kobo.318.2">The robot should give you a voice response that is replicated on the </span><span class="No-Break"><span class="koboSpan" id="kobo.319.1">debug console.</span></span></p></li>
<li><span class="koboSpan" id="kobo.320.1">Next, you can ask Mycroft a more advanced skill, such as looking up information on the internet. </span><span class="koboSpan" id="kobo.320.2">Ask, “Hey, Mycroft, how many ounces in a gallon?” </span><span class="koboSpan" id="kobo.320.3">Mycroft will use the internet to look up the answer </span><span class="No-Break"><span class="koboSpan" id="kobo.321.1">and reply.</span></span></li>
<li><span class="koboSpan" id="kobo.322.1">Next, you can change the wake word on the Mycroft website to something more appropriate – we did not name this robot Mycroft. </span><span class="koboSpan" id="kobo.322.2">We have been calling this robot Albert, but you can choose to call the robot anything you want. </span><span class="koboSpan" id="kobo.322.3">You may find </span><a id="_idIndexMarker480"/><span class="koboSpan" id="kobo.323.1">that a very short name </span><a id="_idIndexMarker481"/><span class="koboSpan" id="kobo.324.1">such as Bob is too quick to be a good wake word, so pick a name with at least two syllables. </span><span class="koboSpan" id="kobo.324.2">To do this, navigate to the Mycroft web page (</span><a href="http://home.mycroft.ai"><span class="koboSpan" id="kobo.325.1">http://home.mycroft.ai</span></a><span class="koboSpan" id="kobo.326.1">) and log in to your account, which we created back in </span><em class="italic"><span class="koboSpan" id="kobo.327.1">Step 4</span></em><span class="koboSpan" id="kobo.328.1">. </span><span class="koboSpan" id="kobo.328.2">Click on your name in the upper right corner and select </span><strong class="bold"><span class="koboSpan" id="kobo.329.1">Settings</span></strong><span class="koboSpan" id="kobo.330.1"> from the menu. </span><span class="koboSpan" id="kobo.330.2">You can select several settings on this page, such as the type of voice you want, the units of measurement, and time and date formats. </span><span class="koboSpan" id="kobo.330.3">Select </span><strong class="bold"><span class="koboSpan" id="kobo.331.1">Advanced Settings</span></strong><span class="koboSpan" id="kobo.332.1">, which will take you to the page where we can change the </span><span class="No-Break"><span class="koboSpan" id="kobo.333.1">wake word.</span></span></li>
<li><span class="koboSpan" id="kobo.334.1">We change the first field, the </span><strong class="bold"><span class="koboSpan" id="kobo.335.1">Wake word</span></strong><span class="koboSpan" id="kobo.336.1"> field, to </span><strong class="bold"><span class="koboSpan" id="kobo.337.1">Custom</span></strong><span class="koboSpan" id="kobo.338.1">. </span><span class="koboSpan" id="kobo.338.2">We change the next line to put in our custom wake word – “</span><span class="No-Break"><span class="koboSpan" id="kobo.339.1">Hey, Albert.”</span></span></li>
<li><span class="koboSpan" id="kobo.340.1">We also need to look up the phonemes for this wake word. </span><span class="koboSpan" id="kobo.340.2">Go to </span><em class="italic"><span class="koboSpan" id="kobo.341.1">The CMU Pronouncing Dictionary</span></em><span class="koboSpan" id="kobo.342.1"> from Carnegie Mellon University (</span><a href="http://www.speech.cs.cmu.edu/cgi-bin/cmudict"><span class="koboSpan" id="kobo.343.1">http://www.speech.cs.cmu.edu/cgi-bin/cmudict</span></a><span class="koboSpan" id="kobo.344.1">). </span><span class="koboSpan" id="kobo.344.2">Put in our phrase and you will get out the phoneme phrase. </span><span class="koboSpan" id="kobo.344.3">Copy and paste this phrase and go back to the Mycroft page to paste the phoneme phrase into the </span><strong class="bold"><span class="koboSpan" id="kobo.345.1">Phonemes</span></strong><span class="koboSpan" id="kobo.346.1"> field. </span><span class="koboSpan" id="kobo.346.2">You are done – don’t change any of the </span><span class="No-Break"><span class="koboSpan" id="kobo.347.1">other settings.</span></span></li>
<li><span class="koboSpan" id="kobo.348.1">Hit </span><strong class="bold"><span class="koboSpan" id="kobo.349.1">Save</span></strong><span class="koboSpan" id="kobo.350.1"> at the top of the page before you </span><span class="No-Break"><span class="koboSpan" id="kobo.351.1">navigate away.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.352.1">You can test your new wake word back on the Jetson Nano. </span><span class="koboSpan" id="kobo.352.2">Start Mycroft up again in debug mode and wait for it to come up. </span><span class="koboSpan" id="kobo.352.3">Say your new wake phrase and enjoy the response. </span><span class="koboSpan" id="kobo.352.4">I have a standard test set of phrases to show Mycroft’s skill at being the voice of our robot. </span><span class="koboSpan" id="kobo.352.5">Try </span><span class="No-Break"><span class="koboSpan" id="kobo.353.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.354.1">Hey, Albert. </span><span class="koboSpan" id="kobo.354.2">What time </span><span class="No-Break"><span class="koboSpan" id="kobo.355.1">is it?</span></span></li>
<li><span class="koboSpan" id="kobo.356.1">Hey, Albert. </span><span class="koboSpan" id="kobo.356.2">What is the weather for tomorrow? </span><span class="koboSpan" id="kobo.356.3">Hey, Albert. </span><span class="koboSpan" id="kobo.356.4">How many ounces in </span><span class="No-Break"><span class="koboSpan" id="kobo.357.1">a gallon?</span></span></li>
<li><span class="koboSpan" id="kobo.358.1">Hey, Albert. </span><span class="koboSpan" id="kobo.358.2">Who is the king </span><span class="No-Break"><span class="koboSpan" id="kobo.359.1">of England?</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.360.1">You should get the appropriate answers to </span><span class="No-Break"><span class="koboSpan" id="kobo.361.1">these questions.</span></span></p>
<p><span class="koboSpan" id="kobo.362.1">Mycroft has </span><a id="_idIndexMarker482"/><span class="koboSpan" id="kobo.363.1">many other skills that we </span><a id="_idIndexMarker483"/><span class="koboSpan" id="kobo.364.1">can take advantage of, such as setting a timer, setting an alarm, listening to music on Pandora, or playing the news. </span><span class="koboSpan" id="kobo.364.2">What we will be doing next is adding to these skills by creating our own that are specific to our </span><span class="No-Break"><span class="koboSpan" id="kobo.365.1">room-cleaning robot.</span></span></p>
<h2 id="_idParaDest-109"><a id="_idTextAnchor216"/><span class="koboSpan" id="kobo.366.1">Adding skills</span></h2>
<p><span class="koboSpan" id="kobo.367.1">The first skill </span><a id="_idIndexMarker484"/><span class="koboSpan" id="kobo.368.1">we will create is a command to pick up toys. </span><span class="koboSpan" id="kobo.368.2">We are going to connect this command to the ROS to control the robot. </span><span class="koboSpan" id="kobo.368.3">Later on, we will add a skill to tell </span><span class="No-Break"><span class="koboSpan" id="kobo.369.1">knock-knock jokes.</span></span></p>
<h3><span class="koboSpan" id="kobo.370.1">Designing our dialogs</span></h3>
<p><span class="koboSpan" id="kobo.371.1">Our first step is to design our dialog on how we will talk to the robot. </span><span class="koboSpan" id="kobo.371.2">Start by making a list of what </span><a id="_idIndexMarker485"/><span class="koboSpan" id="kobo.372.1">ways you might tell the robot to pick up the toys in the playroom. </span><span class="koboSpan" id="kobo.372.2">Here is my list, which I generated using ChatGPT (</span><span class="No-Break"><span class="koboSpan" id="kobo.373.1">version 3.5):</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.374.1">Hey robot, could you please start picking up all </span><span class="No-Break"><span class="koboSpan" id="kobo.375.1">the toys?</span></span></li>
<li><span class="koboSpan" id="kobo.376.1">It’s time to tidy up. </span><span class="koboSpan" id="kobo.376.2">Can you gather all the toys </span><span class="No-Break"><span class="koboSpan" id="kobo.377.1">for me?</span></span></li>
<li><span class="koboSpan" id="kobo.378.1">Need your help, robot. </span><span class="koboSpan" id="kobo.378.2">Could you please pick up all the toys and put them in the </span><span class="No-Break"><span class="koboSpan" id="kobo.379.1">toy bin?</span></span></li>
<li><span class="koboSpan" id="kobo.380.1">Let’s clean up together. </span><span class="koboSpan" id="kobo.380.2">Begin by collecting all the </span><span class="No-Break"><span class="koboSpan" id="kobo.381.1">toys, please.</span></span></li>
<li><span class="koboSpan" id="kobo.382.1">I need a clean room. </span><span class="koboSpan" id="kobo.382.2">Can you please start by picking up the toys </span><span class="No-Break"><span class="koboSpan" id="kobo.383.1">scattered around?</span></span></li>
<li><span class="koboSpan" id="kobo.384.1">Dear robot, would you be so kind as to tidy up the room by gathering all </span><span class="No-Break"><span class="koboSpan" id="kobo.385.1">the toys?</span></span></li>
<li><span class="koboSpan" id="kobo.386.1">Let’s make </span><a id="_idIndexMarker486"/><span class="koboSpan" id="kobo.387.1">this room spotless. </span><span class="koboSpan" id="kobo.387.2">Begin with collecting all the </span><span class="No-Break"><span class="koboSpan" id="kobo.388.1">toys, please.</span></span></li>
<li><span class="koboSpan" id="kobo.389.1">It’s </span><span class="No-Break"><span class="koboSpan" id="kobo.390.1">clean-up time.</span></span></li>
<li><span class="koboSpan" id="kobo.391.1">Can you pick up all </span><span class="No-Break"><span class="koboSpan" id="kobo.392.1">the toys?</span></span></li>
<li><span class="koboSpan" id="kobo.393.1">Pick up all </span><span class="No-Break"><span class="koboSpan" id="kobo.394.1">the toys.</span></span></li>
<li><span class="koboSpan" id="kobo.395.1">You could collect all the toys and place them in the </span><span class="No-Break"><span class="koboSpan" id="kobo.396.1">toy box.</span></span></li>
<li><span class="koboSpan" id="kobo.397.1">It’s time to showcase your cleaning skills. </span><span class="koboSpan" id="kobo.397.2">Start by picking up all the </span><span class="No-Break"><span class="koboSpan" id="kobo.398.1">toys, please.</span></span></li>
<li><span class="koboSpan" id="kobo.399.1">Could you please make the room tidy by picking up all </span><span class="No-Break"><span class="koboSpan" id="kobo.400.1">the toys?</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.401.1">You will note that there are several keywords that are specific to the command to clean up the room. </span><span class="koboSpan" id="kobo.401.2">We have the word “clean,” of course. </span><span class="koboSpan" id="kobo.401.3">We have the phrase “pick up,” and “away.” </span><span class="koboSpan" id="kobo.401.4">We also have the words “toys” or “toy”, and finally, “mess.” </span><span class="koboSpan" id="kobo.401.5">These keywords will cue the natural language processor and allow some variation in the exact </span><span class="No-Break"><span class="koboSpan" id="kobo.402.1">words used.</span></span></p>
<p><span class="koboSpan" id="kobo.403.1">Next, we write down what we want the robot to say back. </span><span class="koboSpan" id="kobo.403.2">We don’t want the same canned response each time; it would be good to have some natural variation in the robot’s responses. </span><span class="koboSpan" id="kobo.403.3">Here is my list of responses, created again by ChatGPT3, with a variety of robot </span><span class="No-Break"><span class="koboSpan" id="kobo.404.1">attitudes represented:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.405.1">Command received – picking </span><span class="No-Break"><span class="koboSpan" id="kobo.406.1">up toys.</span></span></li>
<li><span class="koboSpan" id="kobo.407.1">Of course, I will start cleaning the room </span><span class="No-Break"><span class="koboSpan" id="kobo.408.1">right away.</span></span></li>
<li><span class="koboSpan" id="kobo.409.1">Understood, I will tidy up the room and ensure everything is in its </span><span class="No-Break"><span class="koboSpan" id="kobo.410.1">proper place.</span></span></li>
<li><span class="koboSpan" id="kobo.411.1">Cleaning mode activated! </span><span class="koboSpan" id="kobo.411.2">I will make sure to leave your room spotless </span><span class="No-Break"><span class="koboSpan" id="kobo.412.1">and organized.</span></span></li>
<li><span class="koboSpan" id="kobo.413.1">As you wish, I will take care of cleaning the room </span><span class="No-Break"><span class="koboSpan" id="kobo.414.1">for you.</span></span></li>
<li><span class="koboSpan" id="kobo.415.1">No problem, I will use my cleaning capabilities to efficiently tidy up the room and remove </span><span class="No-Break"><span class="koboSpan" id="kobo.416.1">any clutter.</span></span></li>
<li><span class="koboSpan" id="kobo.417.1">Consider it done! </span><span class="koboSpan" id="kobo.417.2">I will sweep, dust, and mop the room to make it pristine </span><span class="No-Break"><span class="koboSpan" id="kobo.418.1">for you.</span></span></li>
<li><span class="koboSpan" id="kobo.419.1">Cleaning in progress! </span><span class="koboSpan" id="kobo.419.2">I will diligently clean up the room and ensure it’s tidy </span><span class="No-Break"><span class="koboSpan" id="kobo.420.1">and presentable.</span></span></li>
<li><span class="koboSpan" id="kobo.421.1">I’m on it! </span><span class="koboSpan" id="kobo.421.2">I will use my cleaning tools and techniques to make your room look spick </span><span class="No-Break"><span class="koboSpan" id="kobo.422.1">and span.</span></span></li>
<li><span class="koboSpan" id="kobo.423.1">Acknowledged, I will clean up the room and ensure it’s organized and ready for </span><span class="No-Break"><span class="koboSpan" id="kobo.424.1">your use.</span></span></li>
<li><span class="koboSpan" id="kobo.425.1">Cleaning task accepted! </span><span class="koboSpan" id="kobo.425.2">I will work diligently to make your room clean and inviting, just the way you </span><span class="No-Break"><span class="koboSpan" id="kobo.426.1">like it.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.427.1">You can use </span><a id="_idIndexMarker487"/><span class="koboSpan" id="kobo.428.1">as many of these as you want. </span><span class="koboSpan" id="kobo.428.2">The Mycroft system will grab a random phrase from this list. </span><span class="koboSpan" id="kobo.428.3">This gives us some room for creativity and gives the illusion that the robot is more intelligent than it really is. </span><span class="koboSpan" id="kobo.428.4">This type of response system enables us to quickly develop </span><span class="No-Break"><span class="koboSpan" id="kobo.429.1">our dialogs.</span></span></p>
<p><span class="koboSpan" id="kobo.430.1">In the next section, we’ll look at how we can connect voice commands to the </span><span class="No-Break"><span class="koboSpan" id="kobo.431.1">ROS interface.</span></span></p>
<h3><span class="koboSpan" id="kobo.432.1">Creating skills</span></h3>
<p><span class="koboSpan" id="kobo.433.1">In this section, we’ll build the framework in Mycroft that allows it to associate our spoken phrases with the commands to be sent to the robot. </span><span class="koboSpan" id="kobo.433.2">This will involve adding each skill that we want the robot </span><span class="No-Break"><span class="koboSpan" id="kobo.434.1">to possess.</span></span></p>
<h4><span class="koboSpan" id="kobo.435.1">Cleaning up the toys</span></h4>
<p><span class="koboSpan" id="kobo.436.1">First, let’s </span><a id="_idIndexMarker488"/><span class="koboSpan" id="kobo.437.1">add the most basic skill for Albert – cleaning the room by picking up toys. </span><span class="koboSpan" id="kobo.437.2">To do this, follow </span><span class="No-Break"><span class="koboSpan" id="kobo.438.1">these steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.439.1">Use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.440.1">mycroft-msk create</span></strong><span class="koboSpan" id="kobo.441.1"> command, which helps us put together our skills in the </span><span class="No-Break"><span class="koboSpan" id="kobo.442.1">proper format:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.443.1">mycroft-msk create</span></strong></pre></li> <li><span class="koboSpan" id="kobo.444.1">It will ask for a skill name. </span><span class="koboSpan" id="kobo.444.2">Let’s </span><span class="No-Break"><span class="koboSpan" id="kobo.445.1">use </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.446.1">cleanroomrobot-skill</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.447.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.448.1">Then it will ask for a class name and a repository name, for both of which I </span><span class="No-Break"><span class="koboSpan" id="kobo.449.1">used </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.450.1">Cleanroomrobot</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.451.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.452.1">Enter a one-line description for your skill: </span><strong class="source-inline"><span class="koboSpan" id="kobo.453.1">Pick up all of the toys in </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.454.1">the room</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.455.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.456.1">Enter a long description, such as </span><strong class="source-inline"><span class="koboSpan" id="kobo.457.1">Command the robot to detect toys, move to grab a toy, pick it up, and put it into </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.458.1">the toybox</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.459.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.460.1">Enter </span><a id="_idIndexMarker489"/><span class="koboSpan" id="kobo.461.1">some example phrases to trigger </span><span class="No-Break"><span class="koboSpan" id="kobo.462.1">your skill:</span></span><ul><li><strong class="source-inline"><span class="koboSpan" id="kobo.463.1">Hey robot, could you please start picking up all </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.464.1">the toys?</span></strong></span></li><li><strong class="source-inline"><span class="koboSpan" id="kobo.465.1">It's time to tidy up. </span><span class="koboSpan" id="kobo.465.2">Can you gather all the toys </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.466.1">for me?</span></strong></span></li><li><strong class="source-inline"><span class="koboSpan" id="kobo.467.1">Can you pick up all </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.468.1">the toys?</span></strong></span></li></ul></li>
<li><span class="koboSpan" id="kobo.469.1">Enter the </span><span class="No-Break"><span class="koboSpan" id="kobo.470.1">following parameters:</span></span><ul><li><strong class="bold"><span class="koboSpan" id="kobo.471.1">Author</span></strong><span class="koboSpan" id="kobo.472.1">: </span><strong class="source-inline"><span class="koboSpan" id="kobo.473.1">&lt;your </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.474.1">name here&gt;</span></strong></span></li><li><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.475.1">Category</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.476.1">: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.477.1">Productivity</span></strong></span></li><li><strong class="bold"><span class="koboSpan" id="kobo.478.1">Secondary </span></strong><span class="No-Break"><strong class="bold"><span class="koboSpan" id="kobo.479.1">Category</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.480.1">: </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.481.1">IoT</span></strong></span></li></ul></li>
<li><span class="koboSpan" id="kobo.482.1">Entering tags makes it easier to search for your skill (although this is optional): </span><strong class="source-inline"><span class="koboSpan" id="kobo.483.1">robot</span></strong><span class="koboSpan" id="kobo.484.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.485.1">cleanup</span></strong><span class="koboSpan" id="kobo.486.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.487.1">pick up</span></strong><span class="koboSpan" id="kobo.488.1">, </span><span class="No-Break"><span class="koboSpan" id="kobo.489.1">and </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.490.1">toys</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.491.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.492.1">We will end up with a directory structure in </span><strong class="source-inline"><span class="koboSpan" id="kobo.493.1">/opt/Mycroft/skills/cleanroomrobot-skill</span></strong><span class="koboSpan" id="kobo.494.1"> like </span><span class="No-Break"><span class="koboSpan" id="kobo.495.1">the following:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.496.1">Cleanroomrobot-skill</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.497.1">   Git</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.498.1">   __pycache__</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.499.1">  Locale</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.500.1">    En-us</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.501.1">        cleanroomrobot.dialog</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.502.1">        cleanroomrobot.intent</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.503.1">__init__.py</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.504.1">LISCENSE.md</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.505.1">Manifest.yml</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.506.1">README.md</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.507.1">Settingsmeta.yaml</span></strong></pre></li> <li><span class="koboSpan" id="kobo.508.1">Now we </span><a id="_idIndexMarker490"/><span class="koboSpan" id="kobo.509.1">can populate the Python code that will activate the command to the robot. </span><span class="koboSpan" id="kobo.509.2">We need to edit the </span><strong class="source-inline"><span class="koboSpan" id="kobo.510.1">init.py</span></strong><span class="koboSpan" id="kobo.511.1"> file in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.512.1">skill_pickup_toys</span></strong><span class="koboSpan" id="kobo.513.1"> directory that we copied from </span><span class="No-Break"><span class="koboSpan" id="kobo.514.1">the template.</span></span></li>
<li><span class="koboSpan" id="kobo.515.1">We are going to import the libraries we need from Mycroft (</span><strong class="source-inline"><span class="koboSpan" id="kobo.516.1">IntentBuilder</span></strong><span class="koboSpan" id="kobo.517.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.518.1">MycroftSkill</span></strong><span class="koboSpan" id="kobo.519.1">, </span><strong class="source-inline"><span class="koboSpan" id="kobo.520.1">getLogger</span></strong><span class="koboSpan" id="kobo.521.1">, and </span><strong class="source-inline"><span class="koboSpan" id="kobo.522.1">intent_handler</span></strong><span class="koboSpan" id="kobo.523.1">). </span><span class="koboSpan" id="kobo.523.2">We also import </span><strong class="source-inline"><span class="koboSpan" id="kobo.524.1">rclpy</span></strong><span class="koboSpan" id="kobo.525.1">, the ROS Python interface, and the ROS standard message </span><strong class="source-inline"><span class="koboSpan" id="kobo.526.1">String</span></strong><span class="koboSpan" id="kobo.527.1">, which we use to send commands to the robot by publishing on the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.528.1">syscommand</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.529.1"> topic:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.530.1">
from mycroft import MycroftSkill, intent_handler, intent_file_handler
import rclpy
from rclpy.node import Node
from std_msgs.msg import String, Int32MultiArray, Int32
from adapt.intent import IntentBuilder
from mycroft.util.log import getLogger</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.531.1">Note</span></p>
<p class="callout"><strong class="source-inline"><span class="koboSpan" id="kobo.532.1">MycroftSkill</span></strong><span class="koboSpan" id="kobo.533.1"> is a function that is called when one of its phrases is recognized by the Mycroft Intent Engine. </span><span class="koboSpan" id="kobo.533.2">As such, it has no body or main function, just a function definition for the </span><strong class="source-inline"><span class="koboSpan" id="kobo.534.1">create_skill</span></strong><span class="koboSpan" id="kobo.535.1"> function that instantiates a </span><strong class="source-inline"><span class="koboSpan" id="kobo.536.1">MycroftSkill</span></strong><span class="koboSpan" id="kobo.537.1"> object. </span><span class="koboSpan" id="kobo.537.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.538.1">init</span></strong><span class="koboSpan" id="kobo.539.1"> function does most of the work of setting up the various dialogs, intent handlers, and vocabulary for the skill. </span><span class="koboSpan" id="kobo.539.2">This arrangement works very well in our limited environment of giving the robot commands or </span><span class="No-Break"><span class="koboSpan" id="kobo.540.1">telling jokes.</span></span></p>
<ol>
<li value="12"><span class="koboSpan" id="kobo.541.1">The next line is the logger for Mycroft so that we can save our responses. </span><span class="koboSpan" id="kobo.541.2">Anything </span><a id="_idIndexMarker491"/><span class="koboSpan" id="kobo.542.1">we put out to stdout, such as print statements, will end up in the log, or on the screen if you are in </span><span class="No-Break"><span class="koboSpan" id="kobo.543.1">debug mode:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.544.1">LOGGER = getLogger(  name  )</span></strong></pre></li> <li><span class="koboSpan" id="kobo.545.1">The next step is to set up a class for our skill object. </span><span class="koboSpan" id="kobo.545.2">We’ll call it </span><strong class="source-inline"><span class="koboSpan" id="kobo.546.1">Cleanroomrobot</span></strong><span class="koboSpan" id="kobo.547.1"> to match what we </span><span class="No-Break"><span class="koboSpan" id="kobo.548.1">defined previously:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.549.1">
class Cleanroomrobot(MycroftSkill):
    def __init__(self):
        MycroftSkill.__init__(self)
    def setRobotInterface(self,interfce):
        self.interface = interfce
    def initialize(self):
        pass  # just return for now</span></pre></li> <li><span class="koboSpan" id="kobo.550.1">We set up the publisher for our </span><strong class="source-inline"><span class="koboSpan" id="kobo.551.1">syscommand</span></strong><span class="koboSpan" id="kobo.552.1"> topic in the ROS. </span><span class="koboSpan" id="kobo.552.2">This is how we send commands to the robot control program via the ROS publish/subscribe system. </span><span class="koboSpan" id="kobo.552.3">We will be publishing commands only, and the only message format we need </span><span class="No-Break"><span class="koboSpan" id="kobo.553.1">is </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.554.1">String</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.555.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.556.1">
pub = rospy.Publisher('/syscommand', String, queue_size=1000)
# define our service for publishing commands to the robot control system # all our robot commands go out on the topic syscommand
def pubMessage(str):
pub.publish(str)</span></pre></li> <li><span class="koboSpan" id="kobo.557.1">Our Mycroft </span><a id="_idIndexMarker492"/><span class="koboSpan" id="kobo.558.1">skill is created as a child object of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.559.1">MycroftSkill</span></strong><span class="koboSpan" id="kobo.560.1"> object. </span><span class="koboSpan" id="kobo.560.2">We rename our skill object class </span><span class="No-Break"><span class="koboSpan" id="kobo.561.1">to </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.562.1">CleanRoomSkill</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.563.1">:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.564.1">
class CleanRoomSkill(MycroftSkill):
def   init  (self):
super(CleanRoomSkill, self).  init  (name="PickupToys")</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.565.1">According to the template, Mycroft requires both an </span><strong class="source-inline"><span class="koboSpan" id="kobo.566.1">init</span></strong><span class="koboSpan" id="kobo.567.1"> method and an </span><strong class="source-inline"><span class="koboSpan" id="kobo.568.1">initialize</span></strong><span class="koboSpan" id="kobo.569.1"> method. </span><span class="koboSpan" id="kobo.569.2">These commands set up the intent in the Intent Builder part of Mycroft and register our handler when any of our phrases </span><span class="No-Break"><span class="koboSpan" id="kobo.570.1">are spoken.</span></span></p></li> <li><span class="koboSpan" id="kobo.571.1">Next, we refer to the dialogs we built back in the </span><em class="italic"><span class="koboSpan" id="kobo.572.1">Creating skills</span></em><span class="koboSpan" id="kobo.573.1"> section with </span><strong class="source-inline"><span class="koboSpan" id="kobo.574.1">require("CleanRoomKeyword")</span></strong><span class="koboSpan" id="kobo.575.1">, so be careful that all the spelling </span><span class="No-Break"><span class="koboSpan" id="kobo.576.1">is correct:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.577.1">
def initialize(self):
        clean_room_intent = IntentBuilder("cleanroomrobot").require("cleanroomrobot").build()
        self.register_intent(clean_room_intent, self.handle_cleanroomrobot)</span></pre></li> <li><span class="koboSpan" id="kobo.578.1">This next section creates our handler for when the system has recognized one of our phrases, and we want to perform the action for this command. </span><span class="koboSpan" id="kobo.578.2">This is where we kick off the publish command to the robot’s control program via the ROS using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.579.1">pubMessage</span></strong><span class="koboSpan" id="kobo.580.1"> function we </span><span class="No-Break"><span class="koboSpan" id="kobo.581.1">defined earlier:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.582.1">
    @intent_file_handler('cleanroomrobot.intent')
    ##@intent_handler('cleanroomrobot.intent')
    def handle_cleanroomrobot(self, message):
        self.speak_dialog('cleanroomrobot')
        self.interface.cmdPublisher("CleanRoom")</span></pre></li> <li><span class="koboSpan" id="kobo.583.1">We also </span><a id="_idIndexMarker493"/><span class="koboSpan" id="kobo.584.1">need a </span><strong class="source-inline"><span class="koboSpan" id="kobo.585.1">stop</span></strong><span class="koboSpan" id="kobo.586.1"> function, where we can command the robot to stop cleaning, if necessary, to prevent any sort of </span><em class="italic"><span class="koboSpan" id="kobo.587.1">Mickey Mouse – Sorcerer’s </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.588.1">Apprentice</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.589.1"> accident:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.590.1">
    def stop(self):
        self.interface.cmdPublisher("STOPCleanRoom")
        pass</span></pre></li> </ol>
<p class="callout-heading"><span class="koboSpan" id="kobo.591.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.592.1">In the movie </span><em class="italic"><span class="koboSpan" id="kobo.593.1">Fantasia</span></em><span class="koboSpan" id="kobo.594.1">, Mickey Mouse acts out the part of the Sorcerer’s Apprentice from a fairy tale. </span><span class="koboSpan" id="kobo.594.2">In the story, the Apprentice learns to animate a broom, which he teaches to fetch water from a well. </span><span class="koboSpan" id="kobo.594.3">The problem is the Apprentice never learned how to stop the enchantment, and soon the room </span><span class="No-Break"><span class="koboSpan" id="kobo.595.1">is flooded.</span></span></p>
<ol>
<li value="19"><span class="koboSpan" id="kobo.596.1">We now need a block of code to create the skill in the program where we can associate the ROS interface to the robot into the skill. </span><span class="koboSpan" id="kobo.596.2">We will add a </span><strong class="source-inline"><span class="koboSpan" id="kobo.597.1">create_skill</span></strong><span class="koboSpan" id="kobo.598.1"> function to allow Mycroft to create the skill and to have a function pointer to enable </span><span class="No-Break"><span class="koboSpan" id="kobo.599.1">the skill:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.600.1">
def create_skill():
    newSkill = Cleanroomrobot()
    newSkill.setRobotInterface(rosInterface())
    return newSkill</span></pre></li> <li><span class="koboSpan" id="kobo.601.1">Next, we have the ROS interface. </span><span class="koboSpan" id="kobo.601.2">All we need to do is send a command to the robot to publish mode commands on our </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.602.1">RobotCmd</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.603.1"> topic:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.604.1">
class rosInterface(Node):
    def __init__(self):
        super().__init__('mycroftROS') # node name
        self.cmdSubscribe = self.create_subscription(String, 'RobotCmd', self.cmdCallback,10)
        self.cmdPublisher = self.create_publisher(String, 'RobotCmd', 10)
    def cmdCallback(self,msg):
        robotCmd = msg.data</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.605.1">We define </span><a id="_idIndexMarker494"/><span class="koboSpan" id="kobo.606.1">our ROS interface and create a control node called </span><strong class="source-inline"><span class="koboSpan" id="kobo.607.1">mycroftROS</span></strong><span class="koboSpan" id="kobo.608.1"> to serve as our interface. </span><span class="koboSpan" id="kobo.608.2">Then we create a subscriber and publisher to the </span><strong class="source-inline"><span class="koboSpan" id="kobo.609.1">RobotCmd</span></strong><span class="koboSpan" id="kobo.610.1"> topic so we can send and receive commands from the ROS </span><span class="No-Break"><span class="koboSpan" id="kobo.611.1">2 interface.</span></span></p></li> <li><span class="koboSpan" id="kobo.612.1">The rest of the program is just housekeeping. </span><span class="koboSpan" id="kobo.612.2">We need to start up our ROS node, start the Mycroft logger, and instantiate the ROS interface object and the </span><strong class="source-inline"><span class="koboSpan" id="kobo.613.1">cleanSkill</span></strong><span class="koboSpan" id="kobo.614.1"> objects for ROS and Mycroft, respectively. </span><span class="koboSpan" id="kobo.614.2">Then we point the </span><strong class="source-inline"><span class="koboSpan" id="kobo.615.1">cleanSkill</span></strong><span class="koboSpan" id="kobo.616.1"> object to the ROS interface so they can communicate. </span><span class="koboSpan" id="kobo.616.2">Finally, we start the ROS 2 interface with the </span><strong class="source-inline"><span class="koboSpan" id="kobo.617.1">.spin</span></strong><span class="koboSpan" id="kobo.618.1"> function. </span><span class="koboSpan" id="kobo.618.2">When the program is stopped, we fall out of </span><strong class="source-inline"><span class="koboSpan" id="kobo.619.1">.spin</span></strong><span class="koboSpan" id="kobo.620.1"> and shut down </span><span class="No-Break"><span class="koboSpan" id="kobo.621.1">our program:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.622.1">
## main ###
rclpy.init()
LOGGER = getLogger(__name__)
interface = rosInterface()
cleanSkill = Cleanroomrobot()
cleanSkill.setRobotInterface(interface)
rclpy.spin(interface)
rosInterface.destroy_node()
rclpy.shutdown()</span></pre></li> <li><span class="koboSpan" id="kobo.623.1">In order </span><a id="_idIndexMarker495"/><span class="koboSpan" id="kobo.624.1">for our skill to work, we need to copy our directory to </span><strong class="source-inline"><span class="koboSpan" id="kobo.625.1">/opt/mycroft/skills</span></strong><span class="koboSpan" id="kobo.626.1">. </span><span class="koboSpan" id="kobo.626.2">From there, we can test it in debug mode. </span><span class="koboSpan" id="kobo.626.3">Remember that you have to source the ROS 2 directory (</span><strong class="source-inline"><span class="koboSpan" id="kobo.627.1">source /opt/ros/foxy/local_setup.sh</span></strong><span class="koboSpan" id="kobo.628.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.629.1">source ~/ros2_ws/install/local_setup.sh</span></strong><span class="koboSpan" id="kobo.630.1">) or the program won’t be able to find all of the inclusion files or </span><span class="No-Break"><span class="koboSpan" id="kobo.631.1">ROS nodes.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.632.1">Our next skill comes at the request of my grandson, William, who just adores knock-knock jokes. </span><span class="koboSpan" id="kobo.632.2">William is seven, so he is just the right age for this. </span><span class="koboSpan" id="kobo.632.3">Let’s look at how we can </span><span class="No-Break"><span class="koboSpan" id="kobo.633.1">implement this.</span></span></p>
<h4><span class="koboSpan" id="kobo.634.1">Telling jokes</span></h4>
<p><span class="koboSpan" id="kobo.635.1">In this section, we will handle the case where the robot is telling the knock-knock joke. </span><span class="koboSpan" id="kobo.635.2">As you </span><a id="_idIndexMarker496"/><span class="koboSpan" id="kobo.636.1">probably know, knock-knock jokes are pun-based jokes that always take the </span><span class="No-Break"><span class="koboSpan" id="kobo.637.1">same form:</span></span></p>
<p class="uthor-quote"><span class="koboSpan" id="kobo.638.1">Person 1: Knock, knock</span></p>
<p class="uthor-quote"><span class="koboSpan" id="kobo.639.1">Person 2: Who’s there?</span></p>
<p class="uthor-quote"><span class="koboSpan" id="kobo.640.1">Person 1: Wooden</span></p>
<p class="uthor-quote"><span class="koboSpan" id="kobo.641.1">Person 2: Wooden Who?</span></p>
<p class="uthor-quote"><span class="koboSpan" id="kobo.642.1">Person 1: Wooden you like to know!</span></p>
<p><span class="koboSpan" id="kobo.643.1">As you can see, the dialog is very simple. </span><span class="koboSpan" id="kobo.643.2">Several parts of it are standard, such as the first two lines – “Knock, knock” and “Who’s there?” </span><span class="koboSpan" id="kobo.643.3">We can create a generic knock-knock joke in the </span><span class="No-Break"><span class="koboSpan" id="kobo.644.1">following form:</span></span></p>
<ol>
<li><span class="No-Break"><span class="koboSpan" id="kobo.645.1">Knock, knock.</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.646.1">Who’s there?</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.647.1">&lt;</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.648.1">word 1&gt;</span></strong></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.649.1">&lt;word </span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.650.1">1&gt;</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.651.1"> who?</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.652.1">&lt;</span></strong><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.653.1">punchline phrase&gt;</span></strong></span></li>
</ol>
<p><span class="koboSpan" id="kobo.654.1">In defining our joke, you can see we just have two variable elements – the word in </span><em class="italic"><span class="koboSpan" id="kobo.655.1">Step 3</span></em><span class="koboSpan" id="kobo.656.1">, and the punchline phrase in </span><em class="italic"><span class="koboSpan" id="kobo.657.1">Step 5</span></em><span class="koboSpan" id="kobo.658.1">. </span><span class="koboSpan" id="kobo.658.2">Our word is repeated in </span><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.659.1">Step 4</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.660.1">.</span></span></p>
<p><span class="koboSpan" id="kobo.661.1">We begin </span><a id="_idIndexMarker497"/><span class="koboSpan" id="kobo.662.1">by creating a joke database of one-line jokes, which we will put in a text file. </span><span class="koboSpan" id="kobo.662.2">Since we just have two elements, we can separate them with a slash (</span><strong class="source-inline"><span class="koboSpan" id="kobo.663.1">/)</span></strong><span class="koboSpan" id="kobo.664.1">. </span><span class="koboSpan" id="kobo.664.2">Here is </span><span class="No-Break"><span class="koboSpan" id="kobo.665.1">an example:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.666.1">
tarzan / tarzan stripes forever
orange / orange you glad I can tell jokes?</span></pre> <p><span class="koboSpan" id="kobo.667.1">I’m providing you with a database of about 10 jokes in the files section of the repository for this chapter. </span><span class="koboSpan" id="kobo.667.2">Please feel free to add all of your favorites, or send them to me and I’ll </span><span class="No-Break"><span class="koboSpan" id="kobo.668.1">add them.</span></span></p>
<p><span class="koboSpan" id="kobo.669.1">Now, let’s look at the steps involved in telling </span><span class="No-Break"><span class="koboSpan" id="kobo.670.1">the joke:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.671.1">We will start, as with any skill, with the wake word, “</span><span class="No-Break"><span class="koboSpan" id="kobo.672.1">Hey, Albert.”</span></span></li>
<li><span class="koboSpan" id="kobo.673.1">Then we need a phrase to indicate we want to hear a joke, so we will use variations of “Tell me a knock-knock joke,” such as “I want to hear a </span><span class="No-Break"><span class="koboSpan" id="kobo.674.1">knock-knock joke.”</span></span></li>
<li><span class="koboSpan" id="kobo.675.1">This will trigger our skill program to look up a joke. </span><span class="koboSpan" id="kobo.675.2">We will create several intents, or response capabilities, to respond to the user (or child) talking to the robot. </span><span class="koboSpan" id="kobo.675.3">We will start with the “Who’s there?” </span><span class="koboSpan" id="kobo.675.4">dialog intent. </span><span class="koboSpan" id="kobo.675.5">That will let the robot know to proceed to the next part of the joke, which is to say </span><span class="No-Break"><span class="koboSpan" id="kobo.676.1">our word.</span></span></li>
<li><span class="koboSpan" id="kobo.677.1">Then we disable the “Who’s there?” </span><span class="koboSpan" id="kobo.677.2">dialog and enable a dialog for listening for </span><strong class="source-inline"><span class="koboSpan" id="kobo.678.1">&lt;word&gt;</span></strong><span class="koboSpan" id="kobo.679.1"> and the </span><span class="No-Break"><span class="koboSpan" id="kobo.680.1">phrase “who.”</span></span></li>
<li><span class="koboSpan" id="kobo.681.1">Then we can deliver the final part of the joke by reciting the punchline phrase, and we </span><span class="No-Break"><span class="koboSpan" id="kobo.682.1">are done.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.683.1">How can we implement this? </span><span class="koboSpan" id="kobo.683.2">You can follow </span><span class="No-Break"><span class="koboSpan" id="kobo.684.1">these steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.685.1">We start by creating our vocabulary files, of which we will need three. </span><span class="koboSpan" id="kobo.685.2">These are the things that the user will be saying to the robot. </span><span class="koboSpan" id="kobo.685.3">We have our first “tell me a knock, knock joke” phrase – so let’s create a file called </span><strong class="source-inline"><span class="koboSpan" id="kobo.686.1">knockknock.voc</span></strong><span class="koboSpan" id="kobo.687.1"> (you can use any text editor to create the file) and put the following </span><span class="No-Break"><span class="koboSpan" id="kobo.688.1">in it:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.689.1">
Tell me a knock-knock joke Can I have a knock-knock joke Give me a knock-knock joke Play me a knock-knock joke</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.690.1">Please note that the Mycroft STT system interprets the phrase “knock, knock” as </span><strong class="source-inline"><span class="koboSpan" id="kobo.691.1">knock-knock</span></strong><span class="koboSpan" id="kobo.692.1"> with a hyphen, so it is important to put that into </span><span class="No-Break"><span class="koboSpan" id="kobo.693.1">our script.</span></span></p></li> <li><span class="koboSpan" id="kobo.694.1">Now our </span><a id="_idIndexMarker498"/><span class="koboSpan" id="kobo.695.1">second vocabulary is just “Who’s there,” so we can create this as a second </span><strong class="source-inline"><span class="koboSpan" id="kobo.696.1">.voc</span></strong><span class="koboSpan" id="kobo.697.1"> file, </span><strong class="source-inline"><span class="koboSpan" id="kobo.698.1">whosthere.voc</span></strong><span class="koboSpan" id="kobo.699.1">, which contains the line </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.700.1">Whos there</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.701.1">.</span></span></li>
<li><span class="koboSpan" id="kobo.702.1">Our final line is a bit trickier. </span><span class="koboSpan" id="kobo.702.2">We really only care about the keyword “who” to trigger the punchline, so we can look only for that. </span><span class="koboSpan" id="kobo.702.3">Make a file called </span><strong class="source-inline"><span class="koboSpan" id="kobo.703.1">who.voc</span></strong><span class="koboSpan" id="kobo.704.1"> and put the one word </span><strong class="source-inline"><span class="koboSpan" id="kobo.705.1">who</span></strong><span class="koboSpan" id="kobo.706.1"> in it. </span><span class="koboSpan" id="kobo.706.2">Remember these all go in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.707.1">dialog/en-us</span></strong><span class="koboSpan" id="kobo.708.1"> folder in our </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.709.1">skill</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.710.1"> directory.</span></span></li>
<li><span class="koboSpan" id="kobo.711.1">Now for our responses. </span><span class="koboSpan" id="kobo.711.2">We have one canned response, which is to reply to “tell me a knock-knock joke” with the phrase “knock, knock.” </span><span class="koboSpan" id="kobo.711.3">We don’t need any sophisticated dialog system, we just have the robot say the “knock, knock” phrase. </span><span class="koboSpan" id="kobo.711.4">To do this, we first import the libraries we need to call in this program, which are the </span><strong class="source-inline"><span class="koboSpan" id="kobo.712.1">MycroftSkill</span></strong><span class="koboSpan" id="kobo.713.1"> class and the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.714.1">intent_file_handler</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.715.1"> function:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.716.1">
from mycroft import MycroftSkill, intent_file_handler</span></pre></li> <li><span class="koboSpan" id="kobo.717.1">We define our skill as a child object of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.718.1">MycroftSkill</span></strong><span class="koboSpan" id="kobo.719.1"> object – this is a standard object-oriented design. </span><span class="koboSpan" id="kobo.719.2">We are inheriting all of the functions and data of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.720.1">MycroftSkill</span></strong><span class="koboSpan" id="kobo.721.1"> parent object and adding our own functionality to it. </span><span class="koboSpan" id="kobo.721.2">We create an initialize function and then call the </span><strong class="source-inline"><span class="koboSpan" id="kobo.722.1">init</span></strong><span class="koboSpan" id="kobo.723.1"> parent function to execute the code of the parent class as well. </span><span class="koboSpan" id="kobo.723.2">We are augmenting the functionality of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.724.1">init</span></strong><span class="koboSpan" id="kobo.725.1"> parent function. </span><span class="koboSpan" id="kobo.725.2">Without this call, we would be replacing the </span><strong class="source-inline"><span class="koboSpan" id="kobo.726.1">init</span></strong><span class="koboSpan" id="kobo.727.1"> function with our own, and might have to duplicate a considerable amount </span><span class="No-Break"><span class="koboSpan" id="kobo.728.1">of work:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.729.1">
class Knockknock(MycroftSkill):
  def __init__(self):
     MycroftSkill.__init__(self)</span></pre></li> <li><span class="koboSpan" id="kobo.730.1">The next step is to create our </span><strong class="bold"><span class="koboSpan" id="kobo.731.1">intent handler</span></strong><span class="koboSpan" id="kobo.732.1">. </span><span class="koboSpan" id="kobo.732.2">The intent handler is called when the Intent </span><a id="_idIndexMarker499"/><span class="koboSpan" id="kobo.733.1">Engine sees the keywords that indicate that this is what we want. </span><span class="koboSpan" id="kobo.733.2">Whenever the user asks, “Do you know any knock-knock jokes?” </span><span class="koboSpan" id="kobo.733.3">or phrases with that meaning, this code will be invoked. </span><span class="koboSpan" id="kobo.733.4">We put our phrases into the </span><strong class="source-inline"><span class="koboSpan" id="kobo.734.1">knockknock.intent</span></strong><span class="koboSpan" id="kobo.735.1"> file and place that file in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.736.1">voc</span></strong><span class="koboSpan" id="kobo.737.1"> directory (which </span><span class="No-Break"><span class="koboSpan" id="kobo.738.1">was </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.739.1">dialog/voc-en</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.740.1">):</span></span><pre class="source-code"><span class="koboSpan" id="kobo.741.1">
@intent_file_handler('knockknock.intent') 
def handle_knockknock(self, message):</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.742.1">We now need to pick a joke from our database of wonderful, witty knock-knock jokes. </span><span class="koboSpan" id="kobo.742.2">We will define our </span><strong class="source-inline"><span class="koboSpan" id="kobo.743.1">pick_joke</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.744.1">function next:</span></span></p><pre class="source-code"><span class="koboSpan" id="kobo.745.1">name,punchline = self.pick_joke()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.746.1">Here, we get two parts from the </span><span class="No-Break"><span class="koboSpan" id="kobo.747.1">joke database:</span></span></p><ul><li><span class="koboSpan" id="kobo.748.1">The name to say after “</span><span class="No-Break"><span class="koboSpan" id="kobo.749.1">who’s there”</span></span></li><li><span class="koboSpan" id="kobo.750.1">The punchline that ends </span><span class="No-Break"><span class="koboSpan" id="kobo.751.1">the joke</span></span></li></ul></li> <li><span class="koboSpan" id="kobo.752.1">We use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.753.1">get_response</span></strong><span class="koboSpan" id="kobo.754.1"> function from </span><strong class="source-inline"><span class="koboSpan" id="kobo.755.1">MycroftSkill</span></strong><span class="koboSpan" id="kobo.756.1"> to have the robot make a statement and then wait for a reply, which will get turned into a text string and stored in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.757.1">response</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.758.1"> variable:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.759.1">
response=self.get_response(announcement="knock, knock") 
# response will always be "who's there" 
response=self.get_response(announcement=name)</span></pre></li> <li><span class="koboSpan" id="kobo.760.1">Now we are at the part where the robot says the name in response. </span><span class="koboSpan" id="kobo.760.2">For example, the user asks “who’s there?” </span><span class="koboSpan" id="kobo.760.3">and the robot replies “Harold.” </span><span class="koboSpan" id="kobo.760.4">What we are expecting next is for the user to say “Harold (or whatever name) who?” </span><span class="koboSpan" id="kobo.760.5">We will check our response, and see whether the word “who” is included. </span><span class="koboSpan" id="kobo.760.6">If it is not, we can </span><a id="_idIndexMarker500"/><span class="koboSpan" id="kobo.761.1">prompt the user to follow along with the joke. </span><span class="koboSpan" id="kobo.761.2">We will only do this one time to keep from getting stuck in a loop. </span><span class="koboSpan" id="kobo.761.3">If they are not playing along, the robot will </span><span class="No-Break"><span class="koboSpan" id="kobo.762.1">just continue:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.763.1">
# response will be "name who"
# if end of respose is not the word who, we can re-prompt 
if "who" not in response:
  prompt = "You are supposed to say "+name+" who" 
  response=self.get_response(announcement=prompt)</span></pre></li> <li><span class="koboSpan" id="kobo.764.1">We have moved through the joke, so now we get to say the punchline, such as “Harold you like a hug?” </span><span class="koboSpan" id="kobo.764.2">(How would you like a hug?). </span><span class="koboSpan" id="kobo.764.3">The task is complete and we exit the routine; both the comedy routine and the </span><span class="No-Break"><span class="koboSpan" id="kobo.765.1">program routine:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.766.1">
self.speak(punchline)</span></pre></li> <li><span class="koboSpan" id="kobo.767.1">We need a function to read the joke database we defined earlier. </span><span class="koboSpan" id="kobo.767.2">As described earlier, the database has one knock-knock joke per line, with a forward slash (</span><strong class="source-inline"><span class="koboSpan" id="kobo.768.1">/</span></strong><span class="koboSpan" id="kobo.769.1">) between the name and the punchline. </span><span class="koboSpan" id="kobo.769.2">We read all of the jokes, put them in a list, and then choose one at random using the (wait for it) </span><strong class="source-inline"><span class="koboSpan" id="kobo.770.1">random.choice</span></strong><span class="koboSpan" id="kobo.771.1"> function. </span><span class="koboSpan" id="kobo.771.2">We return the name and the punchline separately. </span><span class="koboSpan" id="kobo.771.3">We should only call this routine once per instance of </span><span class="No-Break"><span class="koboSpan" id="kobo.772.1">the joke:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.773.1">
def pick_joke(): 
  jokeFile="knockknock.jokes" 
  jfile = open(jokeFile,"r") 
  jokes = []
  for jokeline in jfile:
    jokes.append(jokeline)
  joke = choice(jokes) 
  jokeParts = joke.split("/") 
  name = jokeParts[0] 
  punchline = jokeParts[1] 
  return name, punchline</span></pre></li> <li><span class="koboSpan" id="kobo.774.1">We finish the program by defining our instance of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.775.1">Knockknock</span></strong><span class="koboSpan" id="kobo.776.1"> class and returning that object to the calling </span><span class="No-Break"><span class="koboSpan" id="kobo.777.1">program, Mycroft:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.778.1">
def create_skill():
  return Knockknock()</span></pre></li> </ol>
<p><span class="koboSpan" id="kobo.779.1">Next, we’ll discuss the other end of the knock-knock joke concept, which is to receive a joke – where the </span><a id="_idIndexMarker501"/><span class="koboSpan" id="kobo.780.1">child wants to tell the robot a joke. </span><span class="koboSpan" id="kobo.780.2">If you know any seven-year-olds, then you know that this is a requirement also – the child will want to tell the robot a joke </span><span class="No-Break"><span class="koboSpan" id="kobo.781.1">as well.</span></span></p>
<h4><span class="koboSpan" id="kobo.782.1">Receiving jokes</span></h4>
<p><span class="koboSpan" id="kobo.783.1">The receiving dialog is pretty simple as well. </span><span class="koboSpan" id="kobo.783.2">The user will say “knock, knock”, which is the cue </span><a id="_idIndexMarker502"/><span class="koboSpan" id="kobo.784.1">to the robot to go into the </span><em class="italic"><span class="koboSpan" id="kobo.785.1">receive knock-knock joke</span></em><span class="koboSpan" id="kobo.786.1"> mode. </span><span class="koboSpan" id="kobo.786.2">The robot then has only one response – “who’s there.” </span><span class="koboSpan" id="kobo.786.3">We could also add “who is there?” </span><span class="koboSpan" id="kobo.786.4">if we want to keep to the common sci-fi concept that robots do not </span><span class="No-Break"><span class="koboSpan" id="kobo.787.1">use contractions.</span></span></p>
<p class="callout-heading"><span class="koboSpan" id="kobo.788.1">Note</span></p>
<p class="callout"><span class="koboSpan" id="kobo.789.1">Data, the android from </span><em class="italic"><span class="koboSpan" id="kobo.790.1">Star Trek: The Next Generation</span></em><span class="koboSpan" id="kobo.791.1">, stated many times he was not able to use contractions, although the writers slipped up from time </span><span class="No-Break"><span class="koboSpan" id="kobo.792.1">to time.</span></span></p>
<p><span class="koboSpan" id="kobo.793.1">In order to </span><a id="_idIndexMarker503"/><span class="koboSpan" id="kobo.794.1">create our schema for our new Mycroft skill, we will be using the </span><strong class="bold"><span class="koboSpan" id="kobo.795.1">Mycroft Skill Kit</span></strong><span class="koboSpan" id="kobo.796.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.797.1">MSK</span></strong><span class="koboSpan" id="kobo.798.1">). </span><span class="koboSpan" id="kobo.798.2">You can install MSK by typing </span><strong class="source-inline"><span class="koboSpan" id="kobo.799.1">pip3 install msk</span></strong><span class="koboSpan" id="kobo.800.1">. </span><span class="koboSpan" id="kobo.800.2">MSK provides a dialog-driven approach to building skills that will make a framework, including all of the subdirectories for dialog files and vocabulary. </span><span class="koboSpan" id="kobo.800.3">This saves a lot of time, so let’s try </span><span class="No-Break"><span class="koboSpan" id="kobo.801.1">it out:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.802.1">The following is the command for creating the </span><em class="italic"><span class="koboSpan" id="kobo.803.1">receive knock-knock </span></em><span class="No-Break"><em class="italic"><span class="koboSpan" id="kobo.804.1">joke</span></em></span><span class="No-Break"><span class="koboSpan" id="kobo.805.1"> code:</span></span><pre class="source-code">
<strong class="bold"><span class="koboSpan" id="kobo.806.1">$ msk create</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.807.1">Enter a short unique skill name (ie. </span><span class="koboSpan" id="kobo.807.2">"siren alarm" or "pizza orderer"): receiveKnock</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.808.1">Class name: ReceiveKnockSkill</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.809.1">Repo name: receive-knock-skill</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.810.1">Looks good? </span><span class="koboSpan" id="kobo.810.2">(Y/n) y</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.811.1">Enter some example phrases to trigger your skill:</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.812.1">knock knock</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.813.1">-</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.814.1">Enter what your skill should say to respond:</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.815.1">who's there</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.816.1">Enter a one line description for your skill (ie. </span><span class="koboSpan" id="kobo.816.2">Orders fresh pizzas from the store): This skill receives a knock knock joke from the user</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.817.1">Enter a long description:</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.818.1">This is the other half of the Knock Knock joke continuum - we are giving the robot the ability to receive knock knock jokes. </span><span class="koboSpan" id="kobo.818.2">The user says knock knock, the robot responds whos there and so on</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.819.1">&gt;</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.820.1">Enter author: Francis Govers</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.821.1">Would you like to create a GitHub repo for it? </span><span class="koboSpan" id="kobo.821.2">(Y/n) Y</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.822.1">=== GitHub Credentials === Username: ********** Password:*********</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.823.1">Counting objects: 12, done.</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.824.1">Delta compression using up to 4 threads. </span><span class="koboSpan" id="kobo.824.2">Compressing objects: 100% (5/5), done.</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.825.1">Writing objects: 100% (12/12), 1.35 KiB | 0 bytes/s, done. </span><span class="koboSpan" id="kobo.825.2">Total 12 (delta 0), reused 0 (delta 0)</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.826.1">To https://github.com/FGovers/receive-knock-skill</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.827.1">* [new branch] master -&gt; master</span></strong>
<strong class="bold"><span class="koboSpan" id="kobo.828.1">Branch master set up to track remote branch master from origin. </span><span class="koboSpan" id="kobo.828.2">Created GitHub repo: https://github.com/FGovers/receive-knock-skill Created skill at: /opt/mycroft/skills/receive-knock-skill</span></strong></pre></li> <li><span class="koboSpan" id="kobo.829.1">We can then </span><a id="_idIndexMarker504"/><span class="koboSpan" id="kobo.830.1">either log in to the GitHub repository we just created (using your name rather than mine) and edit the program, or edit the source code at </span><strong class="source-inline"><span class="koboSpan" id="kobo.831.1">/opt/Mycroft/skills/receive-knock-skill</span></strong><span class="koboSpan" id="kobo.832.1">. </span><span class="koboSpan" id="kobo.832.2">The program is still the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.833.1">init.py</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.834.1"> file.</span></span></li>
<li><span class="koboSpan" id="kobo.835.1">We start with our imports, which are </span><strong class="source-inline"><span class="koboSpan" id="kobo.836.1">MycroftSkill</span></strong><span class="koboSpan" id="kobo.837.1"> and </span><strong class="source-inline"><span class="koboSpan" id="kobo.838.1">intent_file_handler</span></strong><span class="koboSpan" id="kobo.839.1">. </span><span class="koboSpan" id="kobo.839.2">We will also need the </span><strong class="source-inline"><span class="koboSpan" id="kobo.840.1">time</span></strong><span class="koboSpan" id="kobo.841.1"> library to do </span><span class="No-Break"><span class="koboSpan" id="kobo.842.1">some pauses:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.843.1">
from mycroft import MycroftSkill, intent_file_handler import time</span></pre></li> <li><span class="koboSpan" id="kobo.844.1">Here is our class definition for our </span><strong class="source-inline"><span class="koboSpan" id="kobo.845.1">ReceiveKnock</span></strong><span class="koboSpan" id="kobo.846.1"> class, which is a child class of the </span><strong class="source-inline"><span class="koboSpan" id="kobo.847.1">MycroftSkill</span></strong><span class="koboSpan" id="kobo.848.1"> object we imported. </span><span class="koboSpan" id="kobo.848.2">We start the </span><strong class="source-inline"><span class="koboSpan" id="kobo.849.1">init</span></strong><span class="koboSpan" id="kobo.850.1"> function by passing an </span><strong class="source-inline"><span class="koboSpan" id="kobo.851.1">init</span></strong><span class="koboSpan" id="kobo.852.1"> command back up to the parent class (</span><strong class="source-inline"><span class="koboSpan" id="kobo.853.1">MycroftSkill</span></strong><span class="koboSpan" id="kobo.854.1">) and have it do its initialization. </span><span class="koboSpan" id="kobo.854.2">Then we add our custom functionality on top </span><span class="No-Break"><span class="koboSpan" id="kobo.855.1">of that:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.856.1">
class ReceiveKnock(MycroftSkill):
  def __init__(self):
       MycroftSkill.__init__(self)</span></pre></li> <li><span class="koboSpan" id="kobo.857.1">The next section is our intent handler for receiving a knock-knock joke. </span><span class="koboSpan" id="kobo.857.2">We use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.858.1">@decorator</span></strong><span class="koboSpan" id="kobo.859.1"> to extend the intent handler, in this case, reading the parameters of the intent from a file called </span><strong class="source-inline"><span class="koboSpan" id="kobo.860.1">knock.receive.intent</span></strong><span class="koboSpan" id="kobo.861.1">. </span><span class="koboSpan" id="kobo.861.2">The intent handler just has our two key words, the immortal phrase: </span><strong class="source-inline"><span class="koboSpan" id="kobo.862.1">knock, knock</span></strong><span class="koboSpan" id="kobo.863.1">. </span><span class="koboSpan" id="kobo.863.2">We are fortunate that all jokes start exactly the same way, so we only have these </span><span class="No-Break"><span class="koboSpan" id="kobo.864.1">two words.</span></span><p class="list-inset"><span class="koboSpan" id="kobo.865.1">After the </span><strong class="source-inline"><span class="koboSpan" id="kobo.866.1">handle_knock_receive</span></strong><span class="koboSpan" id="kobo.867.1"> function has been activated by the Intent Engine seeing the phrase “knock, knock,” we then get control passed to our handler. </span><span class="koboSpan" id="kobo.867.2">What is our next step? </span><span class="koboSpan" id="kobo.867.3">We reply with the single answer “Who is there?” </span><span class="koboSpan" id="kobo.867.4">You will remember we said robots do not use contractions. </span><span class="koboSpan" id="kobo.867.5">We use a different function to do this. </span><span class="koboSpan" id="kobo.867.6">We don’t want to use another intent handler, but fortunately, Mycroft provides a free-form interface called </span><strong class="source-inline"><span class="koboSpan" id="kobo.868.1">get_response</span></strong><span class="koboSpan" id="kobo.869.1">. </span><span class="koboSpan" id="kobo.869.2">You need </span><a id="_idIndexMarker505"/><span class="koboSpan" id="kobo.870.1">to look up the documentation for this versatile function, but it makes our joke routine a lot simpler. </span><span class="koboSpan" id="kobo.870.2">The </span><strong class="source-inline"><span class="koboSpan" id="kobo.871.1">get_response</span></strong><span class="koboSpan" id="kobo.872.1"> function both lets us speak our reply and then receive whatever the user says next and store it as a string in the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.873.1">response</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.874.1"> variable:</span></span></p><pre class="source-code"><span class="koboSpan" id="kobo.875.1">
@intent_file_handler('knock.receive.intent') 
def handle_knock_receive(self, message):
  response =self.get_response('who.is.there')</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.876.1">Now that we have our response, we can just repeat it back with the robot’s voice, with the additional word “who?” </span><span class="koboSpan" id="kobo.876.2">So, if the child says, “Howard,” the robot responds “</span><span class="No-Break"><span class="koboSpan" id="kobo.877.1">Howard who?”</span></span></p></li> <li><span class="koboSpan" id="kobo.878.1">We use </span><strong class="source-inline"><span class="koboSpan" id="kobo.879.1">get_response</span></strong><span class="koboSpan" id="kobo.880.1"> again to have the robot speak and then record whatever the child or adult says next. </span><span class="koboSpan" id="kobo.880.2">We don’t need it, but we want to have the robot’s speech system listen to whatever is said next. </span><span class="koboSpan" id="kobo.880.3">We toss away the response, but insert our own comment to the joke from our dialog </span><strong class="source-inline"><span class="koboSpan" id="kobo.881.1">veryfunny.dialog</span></strong><span class="koboSpan" id="kobo.882.1">, which is a file in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.883.1">dialog</span></strong><span class="koboSpan" id="kobo.884.1"> directory. </span><span class="koboSpan" id="kobo.884.2">I created this file to hold responses to our jokes from the robot. </span><span class="koboSpan" id="kobo.884.3">I tried to make some responses that the grandchildren would find funny – I guess I can add “robot joke writer” to my resume, as I seem to have done this a lot in my career. </span><span class="koboSpan" id="kobo.884.4">After this, I added a sleep timer to allow everything to settle down before returning control. </span><span class="koboSpan" id="kobo.884.5">We include the standard </span><strong class="source-inline"><span class="koboSpan" id="kobo.885.1">stop</span></strong><span class="koboSpan" id="kobo.886.1"> function required of all </span><strong class="source-inline"><span class="koboSpan" id="kobo.887.1">MycroftSkills</span></strong><span class="koboSpan" id="kobo.888.1">, and make our </span><strong class="source-inline"><span class="koboSpan" id="kobo.889.1">create_skill</span></strong><span class="koboSpan" id="kobo.890.1"> function make a </span><strong class="source-inline"><span class="koboSpan" id="kobo.891.1">ReceiveCall</span></strong><span class="koboSpan" id="kobo.892.1"> object and </span><span class="No-Break"><span class="koboSpan" id="kobo.893.1">return it:</span></span><pre class="source-code"><span class="koboSpan" id="kobo.894.1">
response2= response + " who?"
</span><span class="koboSpan" id="kobo.894.2">response3 =self.get_response(announcement=response2)
self.speak_dialog('veryfunny') 
time.sleep(3)
def stop(self):
  pass
def create_skill():
  return ReceiveKnock()</span></pre><p class="list-inset"><span class="koboSpan" id="kobo.895.1">You can </span><a id="_idIndexMarker506"/><span class="koboSpan" id="kobo.896.1">get as creative as you want with the responses, but here are </span><span class="No-Break"><span class="koboSpan" id="kobo.897.1">my suggestions:</span></span></p><ul><li><span class="koboSpan" id="kobo.898.1">That was </span><span class="No-Break"><span class="koboSpan" id="kobo.899.1">very funny!</span></span></li><li><span class="koboSpan" id="kobo.900.1">Ha </span><span class="No-Break"><span class="koboSpan" id="kobo.901.1">ha ha.</span></span></li><li><span class="koboSpan" id="kobo.902.1">Very </span><span class="No-Break"><span class="koboSpan" id="kobo.903.1">good joke.</span></span></li><li><span class="koboSpan" id="kobo.904.1">I like that one. </span><span class="No-Break"><span class="koboSpan" id="kobo.905.1">Thank you!</span></span></li><li><span class="koboSpan" id="kobo.906.1">Ho </span><span class="No-Break"><span class="koboSpan" id="kobo.907.1">HO! </span><span class="koboSpan" id="kobo.907.2">Ho.</span></span></li><li><span class="koboSpan" id="kobo.908.1">That </span><span class="No-Break"><span class="koboSpan" id="kobo.909.1">was cute!</span></span></li><li><span class="koboSpan" id="kobo.910.1">I do not have a sound for a </span><span class="No-Break"><span class="koboSpan" id="kobo.911.1">groan thththththpppppp!</span></span></li></ul></li> </ol>
<p><span class="koboSpan" id="kobo.912.1">Here is our directory structure and files for our receive knock-knock </span><span class="No-Break"><span class="koboSpan" id="kobo.913.1">jokes skill:</span></span></p>
<pre class="source-code"><span class="koboSpan" id="kobo.914.1">
receive-knock-skill directory:
init .py README.md
settingsmeta.json
./dialog/en-us:
knock.receive.dialog veryfunny.dialog
./vocab/en-us:
knock.receive.intent</span></pre> <p><span class="koboSpan" id="kobo.915.1">Remember the local version of the skill goes in the </span><strong class="source-inline"><span class="koboSpan" id="kobo.916.1">/opt/mycroft/skills/receive-knock-skill</span></strong><span class="koboSpan" id="kobo.917.1"> directory. </span><span class="koboSpan" id="kobo.917.2">Now test to your heart’s content – how many knock-knock jokes can you tell </span><span class="No-Break"><span class="koboSpan" id="kobo.918.1">the robot?</span></span></p>
<h1 id="_idParaDest-110"><a id="_idTextAnchor217"/><span class="koboSpan" id="kobo.919.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.920.1">This chapter introduced NLP for robotics and concentrated on developing a natural language interface for the robot that accomplished three tasks: starting the </span><em class="italic"><span class="koboSpan" id="kobo.921.1">pick up toys</span></em><span class="koboSpan" id="kobo.922.1"> process, telling knock-knock jokes, and listening to </span><span class="No-Break"><span class="koboSpan" id="kobo.923.1">knock-knock jokes.</span></span></p>
<p><span class="koboSpan" id="kobo.924.1">The concepts introduced included recognizing words by phonemes, turning phonemes into graphemes and graphemes into words, parsing intent from sentences, and executing computer programs with a voice interface. </span><span class="koboSpan" id="kobo.924.2">We introduced the open source AI engine, Mycroft, which is an AI-based voice assistant program that runs on the Jetson Nano. </span><span class="koboSpan" id="kobo.924.3">We also wrote a joke database to entertain small children with some very </span><span class="No-Break"><span class="koboSpan" id="kobo.925.1">simple dialog.</span></span></p>
<p><span class="koboSpan" id="kobo.926.1">In the next chapter, we’ll be learning about </span><strong class="bold"><span class="koboSpan" id="kobo.927.1">robot navigation</span></strong><span class="koboSpan" id="kobo.928.1"> using landmarks, neural networks, obstacle avoidance, and </span><span class="No-Break"><span class="koboSpan" id="kobo.929.1">machine learning.</span></span></p>
<h1 id="_idParaDest-111"><a id="_idTextAnchor218"/><span class="koboSpan" id="kobo.930.1">Questions</span></h1>
<ol>
<li><span class="koboSpan" id="kobo.931.1">Do some internet research on why the AI engine was named Mycroft. </span><span class="koboSpan" id="kobo.931.2">How many different stories did you find, and which one did </span><span class="No-Break"><span class="koboSpan" id="kobo.932.1">you like?</span></span></li>
<li><span class="koboSpan" id="kobo.933.1">In the discussion of intent, how would you design a neural network to predict command intent from natural </span><span class="No-Break"><span class="koboSpan" id="kobo.934.1">language sentences?</span></span></li>
<li><span class="koboSpan" id="kobo.935.1">Rewrite “Receive knock-knock jokes” to remember the jokes told to the robot by adding them to the joke database used by the “tell knock knock jokes” program. </span><span class="koboSpan" id="kobo.935.2">Is this </span><span class="No-Break"><span class="koboSpan" id="kobo.936.1">machine learning?</span></span></li>
<li><span class="koboSpan" id="kobo.937.1">Modify the “tell jokes” program to play sounds from a wave file, such as a music clip, as well as </span><span class="No-Break"><span class="koboSpan" id="kobo.938.1">doing TTS.</span></span></li>
<li><span class="koboSpan" id="kobo.939.1">The sentence structures used in this chapter are all based on English grammar. </span><span class="koboSpan" id="kobo.939.2">Other languages, such as French and Japanese, have different structures. </span><span class="koboSpan" id="kobo.939.3">How does that change the parsing of sentences? </span><span class="koboSpan" id="kobo.939.4">Would the program we wrote be able to </span><span class="No-Break"><span class="koboSpan" id="kobo.940.1">understand Yoda?</span></span></li>
<li><span class="koboSpan" id="kobo.941.1">Do you think that Mycroft’s Intent Engine is actually understanding intent, or just pulling </span><span class="No-Break"><span class="koboSpan" id="kobo.942.1">out keywords?</span></span></li>
<li><span class="koboSpan" id="kobo.943.1">Describe the voice commands necessary to instruct the robot to drive to an object and pick it up without the robot being able to recognize the object. </span><span class="koboSpan" id="kobo.943.2">How many commands do </span><span class="No-Break"><span class="koboSpan" id="kobo.944.1">you need?</span></span></li>
<li><span class="koboSpan" id="kobo.945.1">From </span><em class="italic"><span class="koboSpan" id="kobo.946.1">Question 7</span></em><span class="koboSpan" id="kobo.947.1">, work to minimize the number of commands. </span><span class="koboSpan" id="kobo.947.2">How many can you eliminate </span><span class="No-Break"><span class="koboSpan" id="kobo.948.1">or combine?</span></span></li>
<li><span class="koboSpan" id="kobo.949.1">Also from </span><em class="italic"><span class="koboSpan" id="kobo.950.1">Question 7</span></em><span class="koboSpan" id="kobo.951.1">, how many unique keywords are involved? </span><span class="koboSpan" id="kobo.951.2">How many </span><span class="No-Break"><span class="koboSpan" id="kobo.952.1">non-unique keywords?</span></span></li>
</ol>
<h1 id="_idParaDest-112"><a id="_idTextAnchor219"/><span class="koboSpan" id="kobo.953.1"> Further reading</span></h1>
<ul>
<li><em class="italic"><span class="koboSpan" id="kobo.954.1">Python Natural Language Processing</span></em><span class="koboSpan" id="kobo.955.1"> by Jalaj Thanaki, </span><span class="No-Break"><span class="koboSpan" id="kobo.956.1">Packt Publishing</span></span></li>
<li><em class="italic"><span class="koboSpan" id="kobo.957.1">Artificial Intelligence with Python</span></em><span class="koboSpan" id="kobo.958.1"> by Prateek Joshi, </span><span class="No-Break"><span class="koboSpan" id="kobo.959.1">Packt Publishing</span></span></li>
<li><span class="koboSpan" id="kobo.960.1">Mycroft tutorial for developing skills is located </span><span class="No-Break"><span class="koboSpan" id="kobo.961.1">at </span></span><a href="https://mycroft.gitbook.io/mycroft-docs/developing_a_skill/introduction-developing-skills"><span class="No-Break"><span class="koboSpan" id="kobo.962.1">https://mycroft.gitbook.io/mycroft-docs/developing_a_skill/introduction-developing-skills</span></span></a></li>
<li><span class="koboSpan" id="kobo.963.1">Additional documentation for using Mycroft is located </span><span class="No-Break"><span class="koboSpan" id="kobo.964.1">at </span></span><a href="https://media.readthedocs.org/pdf/mycroft-core/stable/mycroft-core.pdf"><span class="No-Break"><span class="koboSpan" id="kobo.965.1">https://media.readthedocs.org/pdf/mycroft-core/stable/mycroft-core.pdf</span></span></a></li>
</ul>
</div>


<div class="Content" id="_idContainer072">
<h1 id="_idParaDest-113" lang="en-US" xml:lang="en-US"><a id="_idTextAnchor220"/><span class="koboSpan" id="kobo.1.1">Part 3: Advanced Concepts – Navigation, Manipulation, Emotions, and More</span></h1>
<p><span class="koboSpan" id="kobo.2.1">In the last part of the book, we tackle more advanced topics including AI-based navigation and obstacle avoidance. </span><span class="koboSpan" id="kobo.2.2">We learn about decision trees and classification algorithms for unsupervised learning and then start an exciting chapter on creating a simulation of a robot personality. </span><span class="koboSpan" id="kobo.2.3">While we can’t give a robot real emotions, we can create a simulation of emotion using state machines and Monte Carlo techniques. </span><span class="koboSpan" id="kobo.2.4">Finally, we end the book with a discussion of AI philosophy and a look at the future from the author’s perspective, and provide advice for people wanting to pursue robotics and autonomy as </span><span class="No-Break"><span class="koboSpan" id="kobo.3.1">a career.</span></span></p>
<p><span class="koboSpan" id="kobo.4.1">This part has the </span><span class="No-Break"><span class="koboSpan" id="kobo.5.1">following chapters:</span></span></p>
<ul>
<li><a href="B19846_07.xhtml#_idTextAnchor221"><em class="italic"><span class="koboSpan" id="kobo.6.1">Chapter 7</span></em></a><span class="koboSpan" id="kobo.7.1">, </span><em class="italic"><span class="koboSpan" id="kobo.8.1">Teaching the Robot to Navigate and Avoid Stairs</span></em></li>
<li><a href="B19846_08.xhtml#_idTextAnchor235"><em class="italic"><span class="koboSpan" id="kobo.9.1">Chapter 8</span></em></a><span class="koboSpan" id="kobo.10.1">, </span><em class="italic"><span class="koboSpan" id="kobo.11.1">Putting Things Away</span></em></li>
<li><a href="B19846_09.xhtml#_idTextAnchor294"><em class="italic"><span class="koboSpan" id="kobo.12.1">Chapter 9</span></em></a><span class="koboSpan" id="kobo.13.1">, </span><em class="italic"><span class="koboSpan" id="kobo.14.1">Giving the Robot an Artificial Personality</span></em></li>
<li><a href="B19846_10.xhtml#_idTextAnchor366"><em class="italic"><span class="koboSpan" id="kobo.15.1">Chapter 10</span></em></a><span class="koboSpan" id="kobo.16.1">, </span><em class="italic"><span class="koboSpan" id="kobo.17.1">Conclusions and Reflections</span></em></li>
</ul>
</div>
<div>
<div id="_idContainer073">
</div>
</div>
</body></html>