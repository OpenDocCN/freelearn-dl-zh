<html><head></head><body>
  <div><h1 class="chapter-number" id="_idParaDest-71">
    <a id="_idTextAnchor073">
    </a>
    
     4
    
   </h1>
   <h1 id="_idParaDest-72">
    <a id="_idTextAnchor074">
    </a>
    
     Setting Up a Navigation Mesh
    
   </h1>
   <p>
    
     I’m pretty confident that, by now, you are aware that a pivotal element in AI game development is establishing a fully functional nav mesh.
    
    
     This entity acts as the cornerstone for directing AI-controlled agents through the game world with accuracy
    
    
     
      and effectiveness.
     
    
   </p>
   <p>
    
     In this chapter, we will begin to put this understanding into practice by initiating a new project.
    
    
     By the conclusion of the chapter, you will have hands-on experience in developing and refining a navigation system within your
    
    
     
      own project.
     
    
   </p>
   <p>
    
     This knowledge will serve as a crucial milestone in shaping your path as an AI programmer, propelling you toward the creation of groundbreaking games that will revolutionize the
    
    
     
      gaming industry!
     
    
   </p>
   <p>
    
     In this chapter, we will be covering the
    
    
     
      following topics:
     
    
   </p>
   <ul>
    <li>
     
      Introducing Unreal
     
     
      
       Agility Arena
      
     
    </li>
    <li>
     
      Creating an
     
     
      
       AI agent
      
     
    </li>
    <li>
     
      Setting up a
     
     
      
       basic level
      
     
    </li>
    <li>
     
      Adding
     
     
      
       navigation modifiers
      
     
    </li>
    <li>
     
      Working with navigation
     
     
      
       link proxies
      
     
    </li>
   </ul>
   <h1 id="_idParaDest-73">
    <a id="_idTextAnchor075">
    </a>
    
     Technical requirements
    
   </h1>
   <p>
    
     To follow along with this chapter, you should have set up Visual Studio (or JetBrains Rider) with all Unreal dependencies, as explained in
    
    <a href="B31016_01.xhtml#_idTextAnchor015">
     
      <em class="italic">
       
        Chapter 1
       
      </em>
     
    </a>
    
     ,
    
    <em class="italic">
     
      Getting Started with AI
     
    </em>
    
     <em class="italic">
      
       Game Development
      
     </em>
    
    
     
      .
     
    
   </p>
   <p>
    
     You’ll be using some starter content that’s available in this book’s companion repository at
    
    <a href="https://github.com/PacktPublishing/Artificial-Intelligence-in-Unreal-Engine-5">
     
      https://github.com/PacktPublishing/Artificial-Intelligence-in-Unreal-Engine-5
     
    </a>
    
     .
    
    
     Through this link, locate the section for this chapter and download the following
    
    <strong class="source-inline">
     
      .zip
     
    </strong>
    
     file:
    
    <strong class="source-inline">
     
      Unreal Agility Arena –
     
    </strong>
    
     <strong class="source-inline">
      
       Starter Content
      
     </strong>
    
    
     
      .
     
    
   </p>
   <p>
    
     If you somehow get lost while going through this chapter, in the repository, you will also find the up-to-date project files here:
    
    <strong class="source-inline">
     
      Unreal Agility Arena –
     
    </strong>
    
     <strong class="source-inline">
      
       Chapter 04
      
     </strong>
    
    <strong class="source-inline">
     
      End
     
    </strong>
    
     .
    
    
     Also, to fully understand this chapter, it is necessary to have some basic knowledge about Blueprint visual scripting while I guide you through the key characteristics of setting up an
    
    
     
      AI agent.
     
    
   </p>
   <h1 id="_idParaDest-74">
    <a id="_idTextAnchor076">
    </a>
    
     Introducing Unreal Agility Arena
    
   </h1>
   <p>
    
     To kick off a
    
    <a id="_idIndexMarker158">
    </a>
    
     successful project, it’s essential to have a solid foundation.
    
    
     Imagine diving into a short novel starting
    
    
     
      like this:
     
    
   </p>
   <p>
    <em class="italic">
     
      In a secret underground lab hidden beneath a nondescript building, an eccentric scientist named Dr.
     
     
      Markus toiled away on his latest invention: AI dummy puppets.
     
     
      These puppets were no ordinary puppets; they were equipped with advanced AI technology that made them capable of interacting with the environment in the most
     
    </em>
    
     <em class="italic">
      
       unexpected ways.
      
     </em>
    
   </p>
   <p>
    <em class="italic">
     
      Dr.
     
     
      Markus was known for his quirky personality and wild ideas.
     
     
      He believed that these puppets held the key to understanding human behavior and improving social interactions.
     
     
      With his trusty sidekick, Professor Viktoria, by his side, he embarked on a series of
     
    </em>
    
     <em class="italic">
      
       hilarious experiments.
      
     </em>
    
   </p>
   <p>
    
     Well, it looks like you’ve stumbled upon the perfect starting point for creating the next big hit in the video game industry, and your task is to craft mind-blowingly awesome AI agents that will rock the world of gaming by seamlessly interacting with their
    
    
     
      virtual surroundings!
     
    
   </p>
   <h2 id="_idParaDest-75">
    <a id="_idTextAnchor077">
    </a>
    
     Explaining the project brief
    
   </h2>
   <p>
    
     The
    
    <a id="_idIndexMarker159">
    </a>
    
     project you’ll be working on will be a set of
    
    <strong class="bold">
     
      gym
     
    </strong>
    
     levels, where you will be creating different behaviors for your
    
    
     
      AI agents.
     
    
   </p>
   <p class="callout-heading">
    
     Note
    
   </p>
   <p class="callout">
    
     In game development, a gym typically refers to a training environment where developers can test and train their AI algorithms and models.
    
    
     This term is also commonly used in the context of reinforcement learning, where AI agents learn to play games through trial and error in simulated environments.
    
    
     For the purpose of this book, we will stick to the
    
    
     
      first definition.
     
    
   </p>
   <p>
    
     In my personal opinion, working on a gym is one of the most entertaining parts of the prototyping phase of a game because you don’t need to worry a lot about things working perfectly; you can experiment with all sort of things, and – in the end – you will most probably come up with creative and
    
    
     
      unconventional solutions!
     
    
   </p>
   <p>
    
     So, to start with, I have
    
    <a id="_idIndexMarker160">
    </a>
    
     provided a project template – called Unreal Agility Arena – that you will be using during the rest of this book.
    
    
     After downloading and opening it in Unreal Engine, our main focus will be on creating self-contained levels to experiment with the knowledge acquired thus far.
    
    
     This will involve addressing small tasks and resolving
    
    
     
      them effectively.
     
    
   </p>
   <p>
    
     Once you reach
    
    <a href="B31016_07.xhtml#_idTextAnchor132">
     
      <em class="italic">
       
        Chapter 7
       
      </em>
     
    </a>
    
     ,
    
    <em class="italic">
     
      Introducing Behavior Trees
     
    </em>
    
     , you will be ready for something more challenging, and things will get a bit tougher, but also – I promise you – much more engaging
    
    
     
      and interesting!
     
    
   </p>
   <p class="callout-heading">
    
     Note
    
   </p>
   <p class="callout">
    
     As this book is about AI game programming rather than game design, balancing game mechanics will not be a primary focus of gameplay.
    
    
     Instead, the focus will be on making things
    
    
     
      work effectively.
     
    
   </p>
   <p>
    
     The very first step involves cracking open the project and diving into the delicious assets I’ve served up for you.
    
    
     So, let’s
    
    
     
      get started!
     
    
   </p>
   <h2 id="_idParaDest-76">
    <a id="_idTextAnchor078">
    </a>
    
     Starting the project
    
   </h2>
   <p>
    
     While the
    
    <a id="_idIndexMarker161">
    </a>
    
     project will mainly focus on gym levels, we aim for a visually appealing, or – as we game developers like to say –
    
    <em class="italic">
     
      juicy
     
    </em>
    
     look and feel.
    
    
     I understand that many of you may not have a background in 3D modeling (and neither do I!).
    
    
     That’s why we will be using some fantastic assets by Kay Lousberg (
    
    <a href="https://kaylousberg.com/">
     
      https://kaylousberg.com/
     
    </a>
    
     ) that are available for personal and
    
    
     
      commercial purposes.
     
    
   </p>
   <div><div><img alt="Figure 4.1 – Kay Lousberg’s website" src="img/B31016_04_1.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 4.1 – Kay Lousberg’s website
    
   </p>
   <p class="callout-heading">
    
     Note
    
   </p>
   <p class="callout">
    
     In this project, I have mainly used the
    
    <strong class="source-inline">
     
      Prototypes Bits Extra
     
    </strong>
    
     package that is freely distributable once you have bought a license.
    
    
     If you are thinking about using the models for a commercial project, please consider buying a license from Kay’s website
    
    
     
      as well.
     
    
   </p>
   <p>
    
     After
    
    <a id="_idIndexMarker162">
    </a>
    
     downloading the file from the link provided at the start of this chapter, unzip it and open the project by double-clicking the
    
    
     <strong class="source-inline">
      
       UnrealAgilityArena.uproject
      
     </strong>
    
    
     
      file.
     
    
   </p>
   <p>
    
     Once the project is open, please check what’s inside the
    
    <strong class="source-inline">
     
      Content
     
    </strong>
    
     folder.
    
    
     You will see
    
    
     
      these subfolders:
     
    
   </p>
   <ul>
    <li>
     
      A
     
     <strong class="source-inline">
      
       _GENERATED
      
     </strong>
     
      folder that has some additional models I have created with the Unreal
     
     <a id="_idIndexMarker163">
     </a>
     
      Engine
     
     
      <strong class="bold">
       
        modeling tools
       
      </strong>
     
    </li>
    <li>
     
      A
     
     <strong class="source-inline">
      
       KayKit
      
     </strong>
     
      folder that includes all models
     
     
      
       from Kay
      
     
    </li>
    <li>
     
      A
     
     <strong class="source-inline">
      
       Maps
      
     </strong>
     
      folder that includes some pre-made levels that are ready
     
     
      
       for use
      
     
    </li>
    <li>
     
      A
     
     <strong class="source-inline">
      
       Materials
      
     </strong>
     
      folder that contains some materials needed by the
     
     
      
       project assets
      
     
    </li>
    <li>
     
      A
     
     <strong class="source-inline">
      
       Textures
      
     </strong>
     
      folder that contains some textures used by the
     
     
      
       project materials
      
     
    </li>
    <li>
     
      A
     
     <strong class="source-inline">
      
       Vfx
      
     </strong>
     
      folder that
     
     <a id="_idIndexMarker164">
     </a>
     
      contains some Niagara effects that we will be
     
     
      
       using later
      
     
    </li>
   </ul>
   <p>
    
     With all these resources at our disposal, we are prepared to begin creating elements for the project, starting with an agent that will navigate through
    
    
     
      our level.
     
    
   </p>
   <h1 id="_idParaDest-77">
    <a id="_idTextAnchor079">
    </a>
    
     Creating an AI agent
    
   </h1>
   <p>
    
     As the
    
    <a id="_idIndexMarker165">
    </a>
    
     first step in testing the pathfinding system, we are going to create an agent whose sole aim is to reach a target actor inside the level; it won’t be anything fancy, just an actor that will be able to reach a target point in
    
    
     
      the level.
     
    
   </p>
   <p>
    
     Let’s start by creating a new folder inside
    
    <strong class="bold">
     
      Content Drawer
     
    </strong>
    
     and calling it
    
    <strong class="source-inline">
     
      Blueprints
     
    </strong>
    
     .
    
    
     Double-click on the newly created folder to open it and perform the
    
    
     
      following steps:
     
    
   </p>
   <ol>
    <li>
     
      Right-click on
     
     <strong class="bold">
      
       Content Drawer
      
     </strong>
     
      and, from the menu that opens, select
     
     
      <strong class="bold">
       
        Blueprint Class
       
      </strong>
     
     
      
       .
      
     
    </li>
    <li>
     
      From the
     
     <strong class="bold">
      
       Pick Parent Class
      
     </strong>
     
      window that will open, select
     
     <strong class="bold">
      
       Character
      
     </strong>
     
      , as depicted in
     
     
      <em class="italic">
       
        Figure 4
       
      </em>
     
     
      <em class="italic">
       
        .2
       
      </em>
     
     
      
       :
      
     
    </li>
   </ol>
   <div><div><img alt="Figure 4.2 – Character creation" src="img/B31016_04_2.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 4.2 – Character creation
    
   </p>
   <ol>
    <li value="3">
     
      Name the newly created
     
     
      
       asset
      
     
     
      <strong class="bold">
       
        BP_NavMeshAgent
       
      </strong>
     
     
      
       .
      
     
    </li>
    <li>
     
      Double-click on it to
     
     
      
       open it.
      
     
    </li>
   </ol>
   <p>
    
     As you
    
    <a id="_idIndexMarker166">
    </a>
    
     probably already know, the
    
    <strong class="source-inline">
     
      Character
     
    </strong>
    
     class refers to a specific type of pawn that is designed to represent players or AI agents in a vertically oriented manner, allowing them to walk, jump, fly, and swim through the
    
    
     
      game world.
     
    
   </p>
   <p>
    
     We will start by giving it a visual representation and setting up the
    
    
     
      main values.
     
    
   </p>
   <h2 id="_idParaDest-78">
    <a id="_idTextAnchor080">
    </a>
    
     Creating the agent
    
   </h2>
   <p>
    
     With the
    
    <strong class="source-inline">
     
      Blueprint
     
    </strong>
    
     class opened and the
    
    <strong class="bold">
     
      Viewport
     
    </strong>
    
     tab selected, locate the
    
    <strong class="bold">
     
      Details
     
    </strong>
    
     panel and follow
    
    
     
      these steps:
     
    
   </p>
   <ol>
    <li>
     
      Open the
     
     <strong class="bold">
      
       Skeletal Mesh Asset
      
     </strong>
     
      property dropdown and select the
     
     
      <strong class="bold">
       
        Dummy
       
      </strong>
     
     
      
       asset.
      
     
    </li>
    <li>
     
      Open the
     
     <strong class="bold">
      
       Anim Class
      
     </strong>
     
      property dropdown and select the
     
     
      <strong class="bold">
       
        ABP_Dummy
       
      </strong>
     
     
      
       asset.
      
     
    </li>
    <li>
     
      In the
     
     <strong class="bold">
      
       Character Movement (Rotation Settings)
      
     </strong>
     
      category, locate the
     
     <strong class="bold">
      
       Max Walk Speed
      
     </strong>
     
      property and set the value to
     
     
      <strong class="source-inline">
       
        500.0 cm/s
       
      </strong>
     
     
      
       .
      
     
    </li>
    <li>
     
      In the
     
     <strong class="bold">
      
       Character Movement (Rotation Settings)
      
     </strong>
     
      category, locate the
     
     <strong class="bold">
      
       Rotation Rate
      
     </strong>
     
      property and set the
     
     <strong class="bold">
      
       Z
      
     </strong>
     
      value
     
     
      
       to
      
     
     
      <strong class="source-inline">
       
        640.0°
       
      </strong>
     
     
      
       .
      
     
    </li>
    <li>
     
      In the same category, check the
     
     <strong class="bold">
      
       Orient Rotation to
      
     </strong>
     
      <strong class="bold">
       
        Movement
       
      </strong>
     
     
      
       checkbox.
      
     
    </li>
    <li>
     
      In the
     
     <strong class="bold">
      
       Shape
      
     </strong>
     
      category, set the
     
     <strong class="bold">
      
       Capsule Half Height
      
     </strong>
     
      property to
     
     <strong class="source-inline">
      
       120.0
      
     </strong>
     
      and the
     
     <strong class="bold">
      
       Capsule Radius
      
     </strong>
     
      property
     
     
      
       to
      
     
     
      <strong class="source-inline">
       
        50.0
       
      </strong>
     
     
      
       .
      
     
    </li>
    <li>
     
      In the
     
     <strong class="bold">
      
       Pawn
      
     </strong>
     
      category, uncheck the
     
     <strong class="bold">
      
       Use Controller Rotation
      
     </strong>
     
      <strong class="bold">
       
        Yaw
       
      </strong>
     
     
      
       property.
      
     
    </li>
   </ol>
   <p>
    
     The previous steps are quite straightforward, and they will just set up the character mesh, assign an animation Blueprint – that has already been created for you – and, finally, set the capsule component size and the movement rotation settings.
    
    
     The final result for the agent is shown in
    
    
     <em class="italic">
      
       Figure 4
      
     </em>
    
    
     <em class="italic">
      
       .3
      
     </em>
    
    
     
      :
     
    
   </p>
   <div><div><img alt="Figure 4.3 – The agent Blueprint" src="img/B31016_04_3.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 4.3 – The agent Blueprint
    
   </p>
   <p>
    
     The agent is
    
    <a id="_idIndexMarker167">
    </a>
    
     almost ready, we just need to add some simple code logic in order to make it reach a target in
    
    
     
      the level.
     
    
   </p>
   <h2 id="_idParaDest-79">
    <a id="_idTextAnchor081">
    </a>
    
     Adding the navigation logic
    
   </h2>
   <p>
    
     Open the
    
    <strong class="bold">
     
      Event Graph
     
    </strong>
    
     tab
    
    <a id="_idIndexMarker168">
    </a>
    
     and follow
    
    
     
      these steps:
     
    
   </p>
   <ol>
    <li>
     
      Add a
     
     <strong class="bold">
      
       Get AIController
      
     </strong>
     
      node in the graph and connect its incoming
     
     <strong class="bold">
      
       Controlled Actor
      
     </strong>
     
      pin to a
     
     <strong class="bold">
      
       Reference to
      
     </strong>
     
      <strong class="bold">
       
        Self
       
      </strong>
     
     
      
       node.
      
     
    </li>
    <li>
     
      Click and drag from the outgoing
     
     <strong class="bold">
      
       Return Value
      
     </strong>
     
      pin of the
     
     <strong class="bold">
      
       Get AIController
      
     </strong>
     
      node and add a
     
     <strong class="bold">
      
       Move to Actor
      
     </strong>
     
      node to
     
     
      
       the graph.
      
     
    </li>
    <li>
     
      Connect the outgoing execution pin of the
     
     <strong class="bold">
      
       Event BeginPlay
      
     </strong>
     
      node to the incoming execution pin of the
     
     <strong class="bold">
      
       Move to
      
     </strong>
     
      <strong class="bold">
       
        Actor
       
      </strong>
     
     
      
       node.
      
     
    </li>
    <li>
     
      From the incoming
     
     <strong class="bold">
      
       Goal
      
     </strong>
     
      pin of the
     
     <strong class="bold">
      
       Move to Actor
      
     </strong>
     
      , click and drag and, once released, select the
     
     <strong class="bold">
      
       Promote to variable
      
     </strong>
     
      option; name the newly created
     
     
      
       variable
      
     
     
      <strong class="source-inline">
       
        TargetActor
       
      </strong>
     
     
      
       .
      
     
    </li>
    <li>
     
      In the
     
     <strong class="bold">
      
       My Blueprint
      
     </strong>
     
      tab, select the
     
     <strong class="bold">
      
       TargetActor
      
     </strong>
     
      variable and, in its
     
     <strong class="bold">
      
       Detail
      
     </strong>
     
      panel, check the
     
     <strong class="bold">
      
       Instance
      
     </strong>
     
      <strong class="bold">
       
        Editable
       
      </strong>
     
     
      
       property.
      
     
     <p class="list-inset">
      
       This is pretty simple; at the start of the game, the agent will try to navigate to a target actor; setting a variable to
      
      <strong class="bold">
       
        Instance Editable
       
      </strong>
      
       will make it visible in the level, in order to pick up the agent destination.
      
      
       The visual scripting code you
      
      <a id="_idIndexMarker169">
      </a>
      
       have just created is shown in
      
      
       <em class="italic">
        
         Figure 4
        
       </em>
      
      
       <em class="italic">
        
         .4
        
       </em>
      
      
       
        :
       
      
     </p>
    </li>
   </ol>
   <div><div><img alt="Figure 4.4 – The Blueprint graph" src="img/B31016_04_4.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 4.4 – The Blueprint graph
    
   </p>
   <p>
    
     Our maybe not-so-clever agent is now fully equipped to navigate toward its designated target position.
    
    
     In the upcoming section, we will create a suitable environment for the agent to freely move around
    
    
     
      and explore.
     
    
   </p>
   <h1 id="_idParaDest-80">
    <a id="_idTextAnchor082">
    </a>
    
     Setting up a basic level
    
   </h1>
   <p>
    
     We
    
    <a id="_idIndexMarker170">
    </a>
    
     are now
    
    <a id="_idIndexMarker171">
    </a>
    
     going to create our first level and start testing the pathfinding system for the agent.
    
    
     The project template has some prefabs I created for you, particularly a set of
    
    <strong class="bold">
     
      Packed Level Actors
     
    </strong>
    
     for quickly prototyping your maps and a
    
    <strong class="bold">
     
      Level Instance
     
    </strong>
    
     for
    
    <a id="_idIndexMarker172">
    </a>
    
     setting up the lighting system.
    
    
     You are more than welcome to create your own game levels, but during this phase, my advice is to follow along with what I will
    
    
     
      be doing.
     
    
   </p>
   <p class="callout-heading">
    
     Note
    
   </p>
   <p class="callout">
    
     In Unreal Engine, a Level Instance allows you to create reusable instances of a level or a portion of a level; this way, you can efficiently duplicate and reuse parts of your level design without having to recreate them from scratch.
    
    
     A Packed Level Actor is a type of Level Instance that is optimized for rendering and can only contain static meshes.
    
    
     Level Instances and Packed Level Actors are particularly useful when you have complex or repetitive elements in your level that you want to reuse
    
    
     
      multiple times.
     
    
   </p>
   <h2 id="_idParaDest-81">
    <a id="_idTextAnchor083">
    </a>
    
     Creating the level
    
   </h2>
   <p>
    
     To create our
    
    <a id="_idIndexMarker173">
    </a>
    
     first gym, follow
    
    
     
      these steps:
     
    
   </p>
   <ol>
    <li>
     
      From the main menu, select
     
     <strong class="bold">
      
       File
      
     </strong>
     
      |
     
     
      <strong class="bold">
       
        New Level
       
      </strong>
     
     
      
       .
      
     
    </li>
    <li>
     
      Navigate to the
     
     <strong class="source-inline">
      
       Maps/LevelInstances
      
     </strong>
     
      folder and drag an instance of
     
     <strong class="bold">
      
       LI_Lighting
      
     </strong>
     
      inside your level; set its transform
     
     <strong class="bold">
      
       Location
      
     </strong>
     
      to
     
     <strong class="source-inline">
      
       (0,
      
     </strong>
     
      <strong class="source-inline">
       
        0, 0)
       
      </strong>
     
     
      
       .
      
     
    </li>
    <li>
     
      Navigate to the
     
     <strong class="source-inline">
      
       Maps/PackedLevelActors
      
     </strong>
     
      folder and drag an instance of
     
     <strong class="bold">
      
       PLA_Lab_01
      
     </strong>
     
      inside your level; set its transform
     
     <strong class="bold">
      
       Location
      
     </strong>
     
      to
     
     <strong class="source-inline">
      
       (0,
      
     </strong>
     
      <strong class="source-inline">
       
        0, 0)
       
      </strong>
     
     
      
       .
      
     
    </li>
    <li>
     
      From the
     
     <strong class="source-inline">
      
       KayKit/PrototypeBits/Models
      
     </strong>
     
      folder, drag some obstacles into the level just to make things a bit more engaging for your agent; my level is shown in
     
     
      <em class="italic">
       
        Figure 4
       
      </em>
     
     
      <em class="italic">
       
        .5
       
      </em>
     
     
      
       :
      
     
    </li>
   </ol>
   <div><div><img alt="Figure 4.5 – The base level" src="img/B31016_04_5.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 4.5 – The base level
    
   </p>
   <ol>
    <li value="5">
     
      Save the level in the
     
     <strong class="source-inline">
      
       Maps
      
     </strong>
     
      folder and name
     
     
      
       it
      
     
     
      <strong class="source-inline">
       
        Gym_NavMesh_01
       
      </strong>
     
     
      
       .
      
     
    </li>
   </ol>
   <h2 id="_idParaDest-82">
    <a id="_idTextAnchor084">
    </a>
    
     Adding the nav mesh
    
   </h2>
   <p>
    
     You are
    
    <a id="_idIndexMarker174">
    </a>
    
     now ready to add the nav mesh on
    
    
     
      the level:
     
    
   </p>
   <ol>
    <li>
     
      From the
     
     <strong class="bold">
      
       Quickly add to the project
      
     </strong>
     
      button in the toolbar, select
     
     <strong class="bold">
      
       Nav Mesh Bounds Volume
      
     </strong>
     
      and drag an instance in the level; a
     
     <strong class="bold">
      
       Recast Nav Mesh
      
     </strong>
     
      actor will be automatically added along with
     
     
      
       the volume.
      
     
    </li>
    <li>
     
      Set
     
     <strong class="bold">
      
       Location
      
     </strong>
     
      for the volume to
     
     <strong class="source-inline">
      
       (0, 0, 0)
      
     </strong>
     
      and
     
     <strong class="bold">
      
       Scale
      
     </strong>
     
      to
     
     <strong class="source-inline">
      
       (20,
      
     </strong>
     
      <strong class="source-inline">
       
        20, 1)
       
      </strong>
     
     
      
       .
      
     
    </li>
    <li>
     
      Click inside the level and hit the
     
     <em class="italic">
      
       P
      
     </em>
     
      key on your keyboard to show the generated nav mesh, as depicted in
     
     
      <em class="italic">
       
        Figure 4
       
      </em>
     
     
      <em class="italic">
       
        .6
       
      </em>
     
     
      
       :
      
     
    </li>
   </ol>
   <div><div><img alt="Figure 4.6 – The nav mesh" src="img/B31016_04_6.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 4.6 – The nav mesh
    
   </p>
   <p>
    
     As you can see, the obstacles you have added will carve the nav mesh and make things more interesting for the
    
    
     
      soon-to-be-added agent.
     
    
   </p>
   <h2 id="_idParaDest-83">
    <a id="_idTextAnchor085">
    </a>
    
     Adding the agent
    
   </h2>
   <p>
    
     As a
    
    <a id="_idIndexMarker175">
    </a>
    
     last step, we need to add the agent and a target point to be reached.
    
    
     So, let’s start by
    
    
     
      doing this:
     
    
   </p>
   <ol>
    <li>
     
      From the
     
     <strong class="source-inline">
      
       Vfx
      
     </strong>
     
      folder, drag an instance of the
     
     <strong class="bold">
      
       NS_Target
      
     </strong>
     
      Niagara system and place it anywhere on the
     
     
      
       nav mesh.
      
     
    </li>
    <li>
     
      From the
     
     <strong class="source-inline">
      
       Blueprints
      
     </strong>
     
      folder, drag an instance of the
     
     <strong class="bold">
      
       BP_NavMeshAgent
      
     </strong>
     
      Blueprint and place it on the blue-colored tile of the level; the
     
     <strong class="bold">
      
       Location
      
     </strong>
     
      value should be approximately
     
     <strong class="source-inline">
      
       (-1650,
      
     </strong>
     
      <strong class="source-inline">
       
        30, 180)
       
      </strong>
     
     
      
       .
      
     
    </li>
    <li>
     
      With the
     
     <a id="_idIndexMarker176">
     </a>
     
      agent selected, locate the
     
     <strong class="bold">
      
       Target Actor
      
     </strong>
     
      property in the
     
     <strong class="bold">
      
       Details
      
     </strong>
     
      panel and, from the dropdown menu, set its value to
     
     <strong class="bold">
      
       NS_Target
      
     </strong>
     
      , which is the previously added Niagara system.
     
     
      The final level should be similar to
     
     
      <em class="italic">
       
        Figure 4
       
      </em>
     
     
      <em class="italic">
       
        .7
       
      </em>
     
     
      
       :
      
     
    </li>
   </ol>
   <div><div><img alt="Figure 4.7 – The final level" src="img/B31016_04_7.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 4.7 – The final level
    
   </p>
   <p>
    
     Now that the level is complete, we can start testing
    
    
     
      it out.
     
    
   </p>
   <h2 id="_idParaDest-84">
    <a id="_idTextAnchor086">
    </a>
    
     Testing the gym
    
   </h2>
   <p>
    
     Now that
    
    <a id="_idIndexMarker177">
    </a>
    
     the gym is finished, you can start testing your agent to see how it behaves in
    
    
     
      the level.
     
    
   </p>
   <p>
    
     You can simply hit the
    
    <strong class="bold">
     
      Play
     
    </strong>
    
     button in the toolbar, or you can use the
    
    <strong class="bold">
     
      Simulate
     
    </strong>
    
     button that will not enter play mode but will show a simulation of how the level works.
    
    
     In this context, I personally prefer this second option as it will keep the nav
    
    
     
      mesh visible.
     
    
   </p>
   <p>
    
     Once the simulation starts, you will see the agent reaching the target actor by taking the shortest route possible.
    
    
     You are free to experiment with obstacles to check how the agent behaves in
    
    
     
      different scenarios.
     
    
   </p>
   <p>
    
     In this section, you
    
    <a id="_idIndexMarker178">
    </a>
    
     have begun to experiment hands-on with how the pathfinding system operates.
    
    
     You achieved this by creating an agent and a simple gym environment for your agent
    
    
     
      to navigate.
     
    
   </p>
   <p>
    
     In the next section, you will be adding modifiers to the nav mesh to give your agent a bit more of
    
    
     
      a challenge.
     
    
   </p>
   <h1 id="_idParaDest-85">
    <a id="_idTextAnchor087">
    </a>
    
     Adding navigation modifiers
    
   </h1>
   <p>
    
     In this section, we are
    
    <a id="_idIndexMarker179">
    </a>
    
     going to create another gym that will let us test nav mesh modifiers – actors that can be used to define areas where the cost to enter an area is different than the regular
    
    
     
      nav mesh.
     
    
   </p>
   <p>
    
     We’ll start by creating the level and then by adding
    
    
     
      the modifiers.
     
    
   </p>
   <h2 id="_idParaDest-86">
    <a id="_idTextAnchor088">
    </a>
    
     Creating the level
    
   </h2>
   <p>
    
     To create
    
    <a id="_idIndexMarker180">
    </a>
    
     our second gym, follow
    
    
     
      these steps:
     
    
   </p>
   <ol>
    <li>
     
      From the main menu, select
     
     <strong class="bold">
      
       File
      
     </strong>
     
      |
     
     
      <strong class="bold">
       
        New Level
       
      </strong>
     
     
      
       .
      
     
    </li>
    <li>
     
      Navigate to the
     
     <strong class="source-inline">
      
       Maps/LevelInstances
      
     </strong>
     
      folder and drag an instance of
     
     <strong class="bold">
      
       LI_Lighting
      
     </strong>
     
      inside your level; set its transform
     
     <strong class="bold">
      
       Location
      
     </strong>
     
      to
     
     <strong class="source-inline">
      
       (0,
      
     </strong>
     
      <strong class="source-inline">
       
        0, 0)
       
      </strong>
     
     
      
       .
      
     
    </li>
    <li>
     
      Navigate to the
     
     <strong class="source-inline">
      
       Maps/PackedLevelActors
      
     </strong>
     
      folder and drag an instance of
     
     <strong class="bold">
      
       PLA_Lab_04
      
     </strong>
     
      inside your level; set its transform
     
     <strong class="bold">
      
       Location
      
     </strong>
     
      to
     
     <strong class="source-inline">
      
       (0,
      
     </strong>
     
      <strong class="source-inline">
       
        0, 0)
       
      </strong>
     
     
      
       .
      
     
    </li>
    <li>
     
      Save the level in the
     
     <strong class="source-inline">
      
       Maps
      
     </strong>
     
      folder and name
     
     
      
       it
      
     
     
      <strong class="source-inline">
       
        Gym_NavMesh_02
       
      </strong>
     
     
      
       .
      
     
     <p class="list-inset">
      
       Now, repeat the same steps you have done for the previous gym by doing
      
      
       
        the following:
       
      
     </p>
    </li>
    <li>
     
      Add the
     
     <strong class="bold">
      
       Nav Mesh Bounds Volume
      
     </strong>
     
      actor and set its boundaries so they cover the full
     
     
      
       walkable area.
      
     
    </li>
    <li>
     
      Add the
     
     <strong class="bold">
      
       NS_Target
      
     </strong>
     
      Niagara System on the opposite side of the level in relation to the
     
     
      
       blue tile.
      
     
    </li>
    <li>
     
      Add the
     
     <strong class="bold">
      
       BP_NavMeshAgent
      
     </strong>
     
      Blueprint on the blue tile and set the
     
     <strong class="bold">
      
       Target Actor
      
     </strong>
     
      property
     
     <a id="_idIndexMarker181">
     </a>
     
      value to
     
     <strong class="bold">
      
       NS_Target
      
     </strong>
     
      .
     
     
      The level should now look like
     
     
      <em class="italic">
       
        Figure 4
       
      </em>
     
     
      <em class="italic">
       
        .8
       
      </em>
     
     
      
       :
      
     
    </li>
   </ol>
   <div><div><img alt="Figure 4.8 – The updated nav mesh" src="img/B31016_04_8.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 4.8 – The updated nav mesh
    
   </p>
   <p>
    
     So far, everything is quite similar to the previous gym; we are now going to insert a modifier and see how
    
    
     
      it behaves.
     
    
   </p>
   <h2 id="_idParaDest-87">
    <a id="_idTextAnchor089">
    </a>
    
     Incorporating a modifier
    
   </h2>
   <p>
    
     We are now
    
    <a id="_idIndexMarker182">
    </a>
    
     ready to change the way the pathfinding system behaves by adding a modifier.
    
    
     To do so, follow
    
    
     
      these steps:
     
    
   </p>
   <ol>
    <li>
     
      From the
     
     <strong class="bold">
      
       Quickly add to the project
      
     </strong>
     
      button in the toolbar, select
     
     <strong class="bold">
      
       Nav Modifier Volume
      
     </strong>
     
      and drag an instance in
     
     
      
       the level.
      
     
    </li>
    <li>
     
      Set
     
     <strong class="bold">
      
       Location
      
     </strong>
     
      for the volume to
     
     <strong class="source-inline">
      
       (0, 0, 0)
      
     </strong>
     
      and
     
     <strong class="bold">
      
       Scale
      
     </strong>
     
      to
     
     <strong class="source-inline">
      
       (5,
      
     </strong>
     
      <strong class="source-inline">
       
        20, 1)
       
      </strong>
     
     
      
       .
      
     
     <p class="list-inset">
      
       You will notice that the nav mesh has now been modified and that it has been carved where the brown – let’s say muddy – tiles
      
      
       
        are placed.
       
      
     </p>
    </li>
   </ol>
   <div><div><img alt="Figure 4.9 – The level with the modifier added to it" src="img/B31016_04_9.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 4.9 – The level with the modifier added to it
    
   </p>
   <p>
    
     If you test the
    
    <a id="_idIndexMarker183">
    </a>
    
     level now, you will see the agent moving toward the target point but stopping next to the muddy terrain; this is happening because the modifier volume has changed the nav mesh and now there’s no way for the agent to reach
    
    
     
      its target.
     
    
   </p>
   <p>
    
     By selecting the
    
    <strong class="bold">
     
      Nav Modifier Volume
     
    </strong>
    
     actor and checking the
    
    <strong class="bold">
     
      Area Class
     
    </strong>
    
     attribute in the
    
    <strong class="bold">
     
      Details
     
    </strong>
    
     panel, you will notice that it has been set to a value equal to
    
    <strong class="source-inline">
     
      NavArea_Null
     
    </strong>
    
     .
    
    
     This value applies an infinite cost to the area it is applied to, making it impossible for the agent to
    
    
     
      traverse it.
     
    
   </p>
   <div><div><img alt="Figure 4.10 – The Area Class attribute" src="img/B31016_04_10.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 4.10 – The Area Class attribute
    
   </p>
   <p>
    
     If you try setting this value to
    
    <strong class="source-inline">
     
      NavArea_Default
     
    </strong>
    
     , you will notice that the nav mesh will behave as it would without any modifier in it, and that’s exactly what it does for this value; the cost
    
    <a id="_idIndexMarker184">
    </a>
    
     for traversing this section is the same as that for the regular mesh.
    
    
     By testing the gym now, you will notice that the agent will walk through the muddy terrain and get to the
    
    
     
      target point.
     
    
   </p>
   <p>
    
     If you need to check the cost for traversing each polygon in your nav mesh, you can do it by selecting the
    
    <strong class="bold">
     
      Recast Nav Mesh
     
    </strong>
    
     actor and – from the
    
    <strong class="bold">
     
      Details
     
    </strong>
    
     panel – checking the
    
    <strong class="bold">
     
      Draw Polygon Cost
     
    </strong>
    
     attribute.
    
    
     <em class="italic">
      
       Figure 4
      
     </em>
    
    <em class="italic">
     
      .11
     
    </em>
    
     shows the cost visualization in
    
    
     
      the level:
     
    
   </p>
   <div><div><img alt="Figure 4.11 – The nav mesh traversal costs" src="img/B31016_04_11.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 4.11 – The nav mesh traversal costs
    
   </p>
   <p>
    
     Let’s make the level a bit more interesting and add some custom-made
    
    
     
      modifier volumes.
     
    
   </p>
   <h2 id="_idParaDest-88">
    <a id="_idTextAnchor090">
    </a>
    
     Improving the level
    
   </h2>
   <p>
    
     Let’s now
    
    <a id="_idIndexMarker185">
    </a>
    
     create a safe path for our agent so it doesn’t get its feet dirty in the muddy area.
    
    
     We will create a passage through it by using some additional models.
    
    
     To do this, follow
    
    
     
      these steps:
     
    
   </p>
   <ol>
    <li>
     
      In the
     
     <strong class="source-inline">
      
       KayKit/PrototypeBits/Models
      
     </strong>
     
      folder, locate the
     
     
      <strong class="bold">
       
        Pallet_Large_Pallet_Large
       
      </strong>
     
     
      
       model.
      
     
    </li>
    <li>
     
      Drag
     
     <a id="_idIndexMarker186">
     </a>
     
      three instances of this model in the level in order to create a passage through the muddy area, as depicted in
     
     
      <em class="italic">
       
        Figure 4
       
      </em>
     
     
      <em class="italic">
       
        .12
       
      </em>
     
     
      
       :
      
     
    </li>
   </ol>
   <div><div><img alt="Figure 4.12 – The bridge" src="img/B31016_04_12.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 4.12 – The bridge
    
   </p>
   <p>
    
     It’s time to add another modifier for
    
    
     
      the bridge:
     
    
   </p>
   <ol>
    <li>
     
      Modify the size of the previously added
     
     <strong class="bold">
      
       Nav Modifier Volume
      
     </strong>
     
      actor in the level so that it covers the muddy passage on the left of
     
     
      
       the river.
      
     
    </li>
    <li>
     
      Add another
     
     <strong class="bold">
      
       Nav Modifier Volume
      
     </strong>
     
      actor to the level so that it covers the muddy passage on the right of
     
     
      
       the river.
      
     
    </li>
    <li>
     
      Add a third
     
     <strong class="bold">
      
       Nav Modifier Volume
      
     </strong>
     
      actor to the level and place it so it creates an area covering the
     
     
      
       whole bridge.
      
     
    </li>
   </ol>
   <p>
    
     In Unreal Engine, a
    
    <strong class="bold">
     
      Nav Modifier Volume
     
    </strong>
    
     is an actor that is used to change the way the nav mesh is generated and that can be added to the level to specify certain areas of the nav
    
    
     
      mesh itself.
     
    
   </p>
   <p>
    
     You should now have a totally impassable zone, created by three modifiers, as shown in
    
    
     <em class="italic">
      
       Figure 4
      
     </em>
    
    
     <em class="italic">
      
       .13
      
     </em>
    
    
     
      :
     
    
   </p>
   <div><div><img alt="Figure 4.13 – The bridge with the modifiers" src="img/B31016_04_13.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 4.13 – The bridge with the modifiers
    
   </p>
   <p>
    
     Now that we
    
    <a id="_idIndexMarker187">
    </a>
    
     have added a safe passage, we are going to create custom modifiers in order to experiment with
    
    
     
      different settings.
     
    
   </p>
   <h2 id="_idParaDest-89">
    <a id="_idTextAnchor091">
    </a>
    
     Creating custom modifiers
    
   </h2>
   <p>
    
     A modifier is a Blueprint
    
    <a id="_idIndexMarker188">
    </a>
    
     extending the
    
    <strong class="source-inline">
     
      NavArea
     
    </strong>
    
     class; this means that you can create your own modifiers by subclassing this type and setting your
    
    
     
      own parameters.
     
    
   </p>
   <p>
    
     We are now going to create one for the muddy surface and one for the bridge.
    
    
     Let’s start with the
    
    
     
      first one:
     
    
   </p>
   <ol>
    <li>
     
      Open
     
     <strong class="bold">
      
       Content Drawer
      
     </strong>
     
      and, in the
     
     <strong class="source-inline">
      
       Blueprints
      
     </strong>
     
      folder, right-click and choose
     
     
      <strong class="bold">
       
        Blueprint Class
       
      </strong>
     
     
      
       .
      
     
    </li>
    <li>
     
      From the
     
     <strong class="bold">
      
       ALL CLASSES
      
     </strong>
     
      dropdown list, select the
     
     
      <strong class="bold">
       
        NavArea
       
      </strong>
     
     
      
       type.
      
     
    </li>
    <li>
     
      Name the newly created asset
     
     <strong class="source-inline">
      
       NavArea_Mud
      
     </strong>
     
      and double-click on it to
     
     
      
       open it.
      
     
    </li>
    <li>
     
      Change its values
     
     
      
       as follows:
      
     
     <ul>
      <li>
       
        Change
       
       <strong class="bold">
        
         Default Cost
        
       </strong>
       
        
         to
        
       
       
        <strong class="source-inline">
         
          10.0
         
        </strong>
       
       
        
         .
        
       
      </li>
      <li>
       
        Change
       
       <strong class="bold">
        
         Fixed Area Entering Cost
        
       </strong>
       
        
         to
        
       
       
        <strong class="source-inline">
         
          2.0
         
        </strong>
       
       
        
         .
        
       
      </li>
      <li>
       
        Change
       
       <strong class="bold">
        
         Draw Color
        
       </strong>
       
        to a recognizable color of
       
       
        
         your choice.
        
       
      </li>
     </ul>
    </li>
   </ol>
   <p class="IMG---Figure">
   </p>
   <div><div><img alt="Figure 4.14 – The cost settings for the muddy nav area" src="img/B31016_04_14.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 4.14 – The cost settings for the muddy nav area
    
   </p>
   <p>
    
     While
    
    <a id="_idIndexMarker189">
    </a>
    
     the
    
    <strong class="bold">
     
      Draw Color
     
    </strong>
    
     value is almost self-explanatory – it will be used to color the nav mesh area covered by the volume –
    
    <strong class="bold">
     
      Default Cost
     
    </strong>
    
     is a multiplier applied to the overall cost for traversing the area.
    
    
     This means that the pathfinding system will compute the traversal cost multiplied by the value of
    
    <strong class="bold">
     
      Default Cost
     
    </strong>
    
     .
    
    <strong class="bold">
     
      Fixed Area Entering Cost
     
    </strong>
    
     , on the other hand, is a cost that is applied only once – when the agent enters the area covered by the volume.
    
    
     In this case, we have opted for a fixed cost for entering the muddy area and a high cost for
    
    
     
      traversing it.
     
    
   </p>
   <p>
    
     Now, let’s do the same steps for the
    
    
     
      bridge area:
     
    
   </p>
   <ol>
    <li>
     
      Open
     
     <strong class="bold">
      
       Content Drawer
      
     </strong>
     
      and, in the
     
     <strong class="source-inline">
      
       Blueprints
      
     </strong>
     
      folder, right-click and choose
     
     
      <strong class="bold">
       
        Blueprint Class
       
      </strong>
     
     
      
       .
      
     
    </li>
    <li>
     
      From the
     
     <strong class="bold">
      
       ALL CLASSES
      
     </strong>
     
      dropdown list, select the
     
     
      <strong class="bold">
       
        NavArea
       
      </strong>
     
     
      
       type.
      
     
    </li>
    <li>
     
      Name the newly created asset
     
     <strong class="source-inline">
      
       NavArea_Bridge
      
     </strong>
     
      and double-click on it to
     
     
      
       open it.
      
     
    </li>
    <li>
     
      Change its values
     
     
      
       as follows:
      
     
     <ul>
      <li>
       
        Change
       
       <strong class="bold">
        
         Default Cost
        
       </strong>
       
        
         to
        
       
       
        <strong class="source-inline">
         
          5.0
         
        </strong>
       
       
        
         .
        
       
      </li>
      <li>
       
        Change
       
       <strong class="bold">
        
         Fixed Area Entering Cost
        
       </strong>
       
        
         to
        
       
       
        <strong class="source-inline">
         
          0.0
         
        </strong>
       
       
        
         .
        
       
      </li>
      <li>
       
        Change
       
       <strong class="bold">
        
         Draw Color
        
       </strong>
       
        to a recognizable color of
       
       
        
         your choice.
        
       
      </li>
     </ul>
    </li>
   </ol>
   <div><div><img alt="Figure 4.15 – The cost settings for the bridge nav area" src="img/B31016_04_15.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 4.15 – The cost settings for the bridge nav area
    
   </p>
   <p>
    
     In this case, we
    
    <a id="_idIndexMarker190">
    </a>
    
     want to create an easier path for the agent, so we have set the fixed cost to
    
    <strong class="source-inline">
     
      0.0
     
    </strong>
    
     and the traversal cost to a
    
    
     
      lower value.
     
    
   </p>
   <p>
    
     We now need to apply these classes to the modifiers in
    
    
     
      the level.
     
    
   </p>
   <h2 id="_idParaDest-90">
    <a id="_idTextAnchor092">
    </a>
    
     Applying the custom modifiers
    
   </h2>
   <p>
    
     We are now
    
    <a id="_idIndexMarker191">
    </a>
    
     ready to get the newly created classes and apply them to the level modifiers.
    
    
     To do so, follow
    
    
     
      these steps:
     
    
   </p>
   <ol>
    <li>
     
      Select the two mud
     
     <strong class="bold">
      
       Nav Modifier Volumes
      
     </strong>
     
      and, in the
     
     <strong class="bold">
      
       Area Class
      
     </strong>
     
      property dropdown of the
     
     <strong class="bold">
      
       Details
      
     </strong>
     
      panel,
     
     
      
       select
      
     
     
      <strong class="bold">
       
        NavArea_Mud
       
      </strong>
     
     
      
       .
      
     
    </li>
    <li>
     
      Select the bridge
     
     <strong class="bold">
      
       Nav Modifier Volume
      
     </strong>
     
      and, in the
     
     <strong class="bold">
      
       Area Class
      
     </strong>
     
      property dropdown of the
     
     <strong class="bold">
      
       Details
      
     </strong>
     
      panel,
     
     
      
       select
      
     
     
      <strong class="bold">
       
        NavArea_Bridge
       
      </strong>
     
     
      
       .
      
     
    </li>
   </ol>
   <p>
    
     The nav mesh should be updated and should look like the one shown in
    
    
     <em class="italic">
      
       Figure 4
      
     </em>
    
    
     <em class="italic">
      
       .16
      
     </em>
    
    
     
      :
     
    
   </p>
   <div><div><img alt="Figure 4.16 – The modified nav mesh area" src="img/B31016_04_16.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 4.16 – The modified nav mesh area
    
   </p>
   <p class="callout-heading">
    
     Note
    
   </p>
   <p class="callout">
    
     Depending on how you created your bridge, you may have a less regular modifier area than mine; additionally, the nav mesh may be generated so that it is not fully walkable.
    
    
     To solve these issues, you will need to play a bit with the pallet model’s
    
    <strong class="bold">
     
      Z
     
    </strong>
    
     value and the size of
    
    
     
      your modifier.
     
    
   </p>
   <p>
    
     We are finally
    
    <a id="_idIndexMarker192">
    </a>
    
     ready to test
    
    
     
      this level.
     
    
   </p>
   <h2 id="_idParaDest-91">
    <a id="_idTextAnchor093">
    </a>
    
     Testing the level
    
   </h2>
   <p>
    
     To test your gym, simply
    
    <a id="_idIndexMarker193">
    </a>
    
     start the level simulation; you should see your agent going toward the bridge, crossing it, and reaching the target point.
    
    
     Although the muddy terrain is walkable, passing through it has a higher cost than traversing
    
    
     
      the bridge.
     
    
   </p>
   <p>
    
     To double-check it, add some impassable obstacles on the bridge, just like I did in
    
    
     <em class="italic">
      
       Figure 4
      
     </em>
    
    
     <em class="italic">
      
       .17
      
     </em>
    
    
     
      :
     
    
   </p>
   <div><div><img alt="Figure 4.17 – The obstructed bridge" src="img/B31016_04_17.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 4.17 – The obstructed bridge
    
   </p>
   <p>
    
     If you start
    
    <a id="_idIndexMarker194">
    </a>
    
     the simulation, you will see the agent going straight to the target point; although the muddy terrain has a high traversal cost, there is no other viable solution so the agent will opt
    
    
     
      for it.
     
    
   </p>
   <p>
    
     This concludes this section, where you learned about how modifiers work.
    
    
     In the next section, I will show you another method to modify your nav meshes using
    
    
     
      link proxies.
     
    
   </p>
   <h1 id="_idParaDest-92">
    <a id="_idTextAnchor094">
    </a>
    
     Working with navigation link proxies
    
   </h1>
   <p>
    
     As we have already seen in
    
    <a href="B31016_03.xhtml#_idTextAnchor058">
     
      <em class="italic">
       
        Chapter 3
       
      </em>
     
    </a>
    
     ,
    
    <em class="italic">
     
      Presenting the Unreal Engine Navigation System
     
    </em>
    
     , a
    
    <strong class="bold">
     
      Nav Link Proxy
     
    </strong>
    
     is
    
    <a id="_idIndexMarker195">
    </a>
    
     an actor used to define specific areas where agents can navigate even if a portion of the level cannot be traversed.
    
    
     A
    
    <strong class="bold">
     
      Nav Link Proxy
     
    </strong>
    
     is placed
    
    <a id="_idIndexMarker196">
    </a>
    
     in the game world to mark a start point and an endpoint, creating a navigation link.
    
    
     This link will provide a connection – which can be mono- or bi-directional – between two areas that may not be
    
    
     
      directly accessible.
     
    
   </p>
   <p>
    
     To check how this link works, we’ll be creating a
    
    
     
      new gym.
     
    
   </p>
   <h2 id="_idParaDest-93">
    <a id="_idTextAnchor095">
    </a>
    
     Creating the level
    
   </h2>
   <p>
    
     To create
    
    <a id="_idIndexMarker197">
    </a>
    
     this new gym, follow
    
    
     
      these steps:
     
    
   </p>
   <ol>
    <li>
     
      From the main menu, select
     
     <strong class="bold">
      
       File
      
     </strong>
     
      |
     
     
      <strong class="bold">
       
        New Level
       
      </strong>
     
     
      
       .
      
     
    </li>
    <li>
     
      Navigate to the
     
     <strong class="source-inline">
      
       Maps/LevelInstances
      
     </strong>
     
      folder and drag an instance of
     
     <strong class="bold">
      
       LI_Lighting
      
     </strong>
     
      inside your level; set its transform
     
     <strong class="bold">
      
       Location
      
     </strong>
     
      to
     
     <strong class="source-inline">
      
       (0,
      
     </strong>
     
      <strong class="source-inline">
       
        0, 0)
       
      </strong>
     
     
      
       .
      
     
    </li>
    <li>
     
      Navigate to the
     
     <strong class="source-inline">
      
       Maps/PackedLevelActors
      
     </strong>
     
      folder and drag an instance of
     
     <strong class="bold">
      
       PLA_Lab_03
      
     </strong>
     
      inside your level; set its transform
     
     <strong class="bold">
      
       Location
      
     </strong>
     
      to
     
     <strong class="source-inline">
      
       (0,
      
     </strong>
     
      <strong class="source-inline">
       
        0, 0)
       
      </strong>
     
     
      
       .
      
     
    </li>
    <li>
     
      Save the level in the
     
     <strong class="source-inline">
      
       Maps
      
     </strong>
     
      folder and name
     
     
      
       it
      
     
     
      <strong class="source-inline">
       
        Gym_NavMesh_03
       
      </strong>
     
     
      
       .
      
     
    </li>
   </ol>
   <p>
    
     This gym has a
    
    <a id="_idIndexMarker198">
    </a>
    
     wide water channel in the middle of it, along with a bridge, as depicted in
    
    
     <em class="italic">
      
       Figure 4
      
     </em>
    
    
     <em class="italic">
      
       .18
      
     </em>
    
    
     
      :
     
    
   </p>
   <div><div><img alt="Figure 4.18 – The gym" src="img/B31016_04_18.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 4.18 – The gym
    
   </p>
   <p>
    
     Now, let’s add a few nav meshes – one for each walkable area – along with the agent and the
    
    
     
      target point:
     
    
   </p>
   <ol>
    <li>
     
      Add two
     
     <strong class="bold">
      
       Nav Mesh Bounds Volume
      
     </strong>
     
      actors and set their boundaries so that they cover the walkable areas on each side of
     
     
      
       the river.
      
     
    </li>
    <li>
     
      Add the
     
     <strong class="bold">
      
       NS_Target
      
     </strong>
     
      Niagara System on the opposite side of the level from the
     
     
      
       blue tile.
      
     
    </li>
    <li>
     
      Add the
     
     <strong class="bold">
      
       BP_NavMeshAgent
      
     </strong>
     
      Blueprint on the blue tile and set the
     
     <strong class="bold">
      
       Target Actor
      
     </strong>
     
      property value to
     
     <strong class="source-inline">
      
       NS_Target
      
     </strong>
     
      .
     
     
      The level should now look like
     
     
      <em class="italic">
       
        Figure 4
       
      </em>
     
     
      <em class="italic">
       
        .19
       
      </em>
     
     
      
       :
      
     
    </li>
   </ol>
   <div><div><img alt="Figure 4.19 – The gym with the nav mesh" src="img/B31016_04_19.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 4.19 – The gym with the nav mesh
    
   </p>
   <p>
    
     If you test
    
    <a id="_idIndexMarker199">
    </a>
    
     your gym right now, you will notice your agent walking toward the target point but stopping near the channel.
    
    
     Well, I guess that’s about as unexpected as a penguin wearing a tuxedo to a fancy party – there is no connection, so there can be no
    
    
     
      successful pathfinding!
     
    
   </p>
   <p>
    
     Let’s now allow the agent to walk through
    
    
     
      the bridge.
     
    
   </p>
   <h2 id="_idParaDest-94">
    <a id="_idTextAnchor096">
    </a>
    
     Adding a Nav Link Proxy
    
   </h2>
   <p>
    
     To add a
    
    <a id="_idIndexMarker200">
    </a>
    
     link that will connect the two sides of the channel, do the
    
    
     
      following steps:
     
    
   </p>
   <ol>
    <li>
     
      From the
     
     <strong class="bold">
      
       Quickly add to the project
      
     </strong>
     
      button in the toolbar, select
     
     <strong class="bold">
      
       Nav Link Proxy
      
     </strong>
     
      and drag an instance in
     
     
      
       the level.
      
     
     <p class="list-inset">
      
       You will notice that this actor has a couple of diamond-shaped gizmos called, respectively,
      
      <strong class="bold">
       
        PointLinks[0].Left
       
      </strong>
      
       and
      
      <strong class="bold">
       
        PointLinks[0].Right
       
      </strong>
      
       ; those are the connection points that will shape your
      
      
       
        link proxy.
       
      
     </p>
    </li>
   </ol>
   <div><div><img alt="Figure 4.20 – One of the two point links" src="img/B31016_04_20.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 4.20 – One of the two point links
    
   </p>
   <ol>
    <li value="2">
     
      Select
     
     <a id="_idIndexMarker201">
     </a>
     
      each of the point links and move them so that they are placed on each side of the bridge, as depicted in
     
     
      <em class="italic">
       
        Figure 4
       
      </em>
     
     
      <em class="italic">
       
        .21
       
      </em>
     
     
      
       :
      
     
    </li>
   </ol>
   <div><div><img alt="Figure 4.21 – A nav mesh proxy" src="img/B31016_04_21.jpg"/>
     
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    
     Figure 4.21 – A nav mesh proxy
    
   </p>
   <p>
    
     The
    
    <strong class="bold">
     
      Point Links
     
    </strong>
    
     attribute is a list of elements that can be used to create connections between unreachable locations.
    
    
     By default, there is just one, but you can add as many as
    
    
     
      you want.
     
    
   </p>
   <h2 id="_idParaDest-95">
    <a id="_idTextAnchor097">
    </a>
    
     Testing the gym
    
   </h2>
   <p>
    
     Now
    
    <a id="_idIndexMarker202">
    </a>
    
     that also this gym is finished, you can test it to see how your agent behaves.
    
    
     Once the simulation starts, you will see the agent reach the target point by traversing the bridge as if a nav mesh existed
    
    
     
      on it.
     
    
   </p>
   <p class="callout-heading">
    
     Note
    
   </p>
   <p class="callout">
    
     If you try placing some obstacles on the bridge, you will notice your agent running straight on them and stopping; this happens because there is no actual nav mesh on the bridge, but a straight link.
    
    
     This means that Nav Link Proxies are a powerful tool, but they need to be
    
    
     
      used wisely.
     
    
   </p>
   <p>
    
     In this section, you
    
    <a id="_idIndexMarker203">
    </a>
    
     have seen how to use Nav Link Proxies to connect unreachable sections of your nav mesh; with this new knowledge, you’re all set to make your AI friends do some epic cliff dives and pull off all sorts of
    
    
     
      wacky tricks!
     
    
   </p>
   <h1 id="_idParaDest-96">
    <a id="_idTextAnchor098">
    </a>
    
     Summary
    
   </h1>
   <p>
    
     In this chapter, you started working with the Navigation System; by starting from a simple navigable area, you added some obstacles and checked how the agent behaves.
    
    
     Next, you learned how to modify your walkable areas by adding non-traversable zones or difficult terrain.
    
    
     Lastly, you gained some understanding of how to link disconnected parts of the
    
    
     
      nav mesh.
     
    
   </p>
   <p>
    
     All this knowledge is crucial because it helps your AI agents figure out where they can go without bumping into walls or getting stuck in a maze of confusion.
    
    
     You can think of the nav mesh as the GPS for your digital pals, ensuring they don’t end up lost in the
    
    
     
      virtual wilderness!
     
    
   </p>
   <p>
    
     In the next chapter, we will get deeper into the realm of the nav mesh; get ready to create some more advanced and fascinating stuff in
    
    
     
      Unreal Engine!
     
    
   </p>
  </div>
 </body></html>