# 前言

在短短十年间，**图神经网络**（**GNNs**）已成为一种重要且流行的深度学习架构。它们已经在多个行业产生了重大影响，比如在药物发现领域，GNNs 预测出了一种名为 halicin 的新型抗生素，并改善了 Google Maps 上的预计到达时间计算。科技公司和大学正在探索 GNNs 在各种应用中的潜力，包括推荐系统、假新闻检测和芯片设计等。GNNs 具有巨大的潜力和许多尚未发现的应用，成为解决全球问题的重要工具。

本书旨在提供关于 GNNs 世界的全面且实用的概述。我们将首先探讨图论和图学习的基本概念，然后深入了解最广泛使用和最成熟的 GNN 架构。随着进展，我们还将涵盖 GNNs 的最新进展，并介绍专门设计用于处理特定任务的架构，如图生成、链接预测等。

除了这些专门的章节外，我们还将通过三个实践项目提供实际操作经验。这些项目将涵盖 GNNs 的关键现实世界应用，包括交通预测、异常检测和推荐系统。通过这些项目，你将深入理解 GNNs 是如何工作的，并且掌握将其应用于实际场景中的技能。

最后，本书通过每章技术和相关应用的可读代码提供动手学习经验，这些代码可在 GitHub 和 Google Colab 上轻松获取。

到本书结束时，你将全面了解图学习和 GNNs 领域，并且能够设计和实现这些模型，用于广泛的应用场景。

# 本书适用人群

本书面向那些有兴趣学习 GNNs 及其如何应用于各种现实问题的读者。**数据科学家**、**机器学习工程师**和**人工智能**（**AI**）专业人士，尤其是希望获得设计和实现 GNNs 的实际经验的读者，将从本书中受益。此书适合已有深度学习和机器学习知识的读者，但对于初学者，它也提供了关于图论和图学习的基础概念的全面介绍。此外，本书对于计算机科学、数学和工程领域的研究人员和学生也具有很大价值，尤其是那些希望扩展在这一迅速发展的研究领域中的知识的人。

# 本书内容

*第一章*，*图学习入门*，全面介绍了图神经网络（GNN），包括其在现代数据分析和机器学习中的重要性。本章首先探讨了图作为数据表示的相关性，以及它们在各个领域中的广泛应用。接着深入讨论了图学习的重要性，包括不同的应用和技术。最后，本章聚焦于 GNN 架构，突出了其独特的特性和与其他方法相比的性能。

*第二章*，*图神经网络的图论基础*，涵盖了图论的基础知识，并介绍了各种类型的图，包括它们的属性和应用。本章还讨论了基本的图概念，如邻接矩阵、图度量（例如中心性）和图算法，**广度优先搜索**（**BFS**）和**深度优先搜索**（**DFS**）。

*第三章*，*使用 DeepWalk 创建节点表示*，专注于 DeepWalk，作为将机器学习应用于图数据的开创者。DeepWalk 架构的主要目标是生成节点表示，供其他模型用于下游任务，例如节点分类。本章介绍了 DeepWalk 的两个关键组件——Word2Vec 和随机游走——特别强调了 Word2Vec 跳字模型（skip-gram model）。

*第四章*，*通过 Node2Vec 中的有偏随机游走改进嵌入*，专注于 Node2Vec 架构，该架构基于前一章介绍的 DeepWalk 架构。本章介绍了 Node2Vec 中随机游走生成的修改，以及如何为特定图选择最佳参数。本章将 Node2Vec 的实现与 DeepWalk 在扎卡里武术俱乐部（Zachary's Karate Club）上的表现进行对比，突显了两种架构的不同。最后，本章通过构建电影推荐系统，展示了 Node2Vec 的实际应用。

*第五章*，*使用传统神经网络包含节点特征*，探讨了将附加信息（如节点和边的特征）集成到图嵌入中，以产生更准确的结果。本章首先比较了传统神经网络仅在节点特征上的表现，节点特征被视为表格数据集。然后，我们将实验通过将拓扑信息添加到神经网络中，从而创建一个简单的传统 GNN 架构。

*第六章*，*引入图卷积网络*，重点介绍了**图卷积网络**（**GCN**）架构及其作为图神经网络（GNN）的蓝图的重要性。它讨论了之前的基本 GNN 层的局限性，并解释了 GCN 背后的动机。本章详细介绍了 GCN 层的工作原理、相较于传统 GNN 层的性能提升，并展示了如何在 Cora 和 Facebook Page-Page 数据集上使用 PyTorch Geometric 进行实现。本章还涉及了节点回归任务以及将表格数据转化为图结构的好处。

*第七章*，*图注意力网络*，重点介绍了**图注意力网络**（**GAT**），它是对 GCN 的改进。章节解释了 GAT 如何通过自注意力机制工作，并提供了图注意力层的逐步理解。该章节还从零开始使用 NumPy 实现了一个图注意力层。最后，章节讨论了在两个节点分类数据集（Cora 和 CiteSeer）上使用 GAT，并与 GCN 的准确度进行了对比。

*第八章*，*使用 GraphSAGE 扩展图神经网络*，重点介绍了 GraphSAGE 架构及其有效处理大规模图的能力。章节讲解了 GraphSAGE 的两大核心思想，包括其邻居采样技术和聚合操作符。你将了解像 Uber Eats 和 Pinterest 等技术公司提出的变种，以及 GraphSAGE 的归纳方法的好处。本章最后通过实现 GraphSAGE 进行节点分类和多标签分类任务的示范。

*第九章*，*定义图分类的表现力*，探索了 GNN 中的表现力概念及其如何用于设计更好的模型。它介绍了**Weisfeiler-Leman**（**WL**）测试，这为理解 GNN 中的表现力提供了框架。本章使用 WL 测试对不同的 GNN 层进行比较，确定最具表现力的层。基于这一结果，设计并实现了一个更强大的 GNN，并使用 PyTorch Geometric 进行了实现。章节最后对 PROTEINS 数据集上的图分类进行了不同方法的比较。

*第十章*，*使用图神经网络预测链接*，重点讲解图中的链接预测。内容涵盖了传统技术，如矩阵分解和基于 GNN 的方法。章节解释了链接预测的概念及其在社交网络和推荐系统中的重要性。你将了解传统技术的局限性以及使用基于 GNN 的方法的优势。我们将探索来自两个不同类别的三种基于 GNN 的技术，包括节点嵌入和子图表示。最后，你将实现各种链接预测技术，并在 PyTorch Geometric 中选择最适合给定问题的方法。

*第十一章*，*使用图神经网络生成图*，探索了图生成领域，该领域涉及寻找创建新图的方法。章节首先介绍了传统技术，如 Erdős–Rényi 模型和小世界模型。接着，你将重点学习三类基于 GNN 的图生成解决方案：基于 VAE 的模型、基于自回归的模型和基于 GAN 的模型。章节最后通过**强化学习**（**RL**）实现一个基于 GAN 的框架，使用 DeepChem 库和 TensorFlow 生成新的化学化合物。

*第十二章*，*来自异构图的学习*，重点讲解异构 GNN（图神经网络）。异构图包含不同类型的节点和边，与只涉及一种类型节点和边的同构图相对。章节首先回顾了用于同构 GNN 的**消息传递神经网络**（**MPNN**）框架，然后将该框架扩展到异构网络。最后，我们介绍了一种创建异构数据集的技术，如何将同构架构转化为异构架构，并讨论了专门设计用于处理异构网络的架构。

*第十三章*，*时序图神经网络*，重点讲解时序 GNN 或时空 GNN，这是一种能够处理随着时间变化的边和特征的图神经网络。章节首先解释了动态图的概念及时序 GNN 的应用，重点介绍了时间序列预测。接着，章节讲解了时序 GNN 在网页流量预测中的应用，利用时序信息来改善结果。最后，章节介绍了另一种专门为动态图设计的时序 GNN 架构，并将其应用于疫情预测任务。

*第十四章*，*解释图神经网络*，介绍了各种技术，用于更好地理解 GNN 模型的预测和行为。本章重点介绍了两种流行的解释方法：GNNExplainer 和集成梯度。接着，您将看到这些技术在使用 MUTAG 数据集进行图分类任务和使用 Twitch 社交网络进行节点分类任务中的应用。

*第十五章*，*使用 A3T-GCN 预测交通*，重点介绍了时序图神经网络在交通预测领域的应用。它突出了在智能城市中准确交通预测的重要性，以及由于复杂的时空依赖性导致的交通预测挑战。本章涵盖了处理新数据集以创建时序图的步骤，并实现了一种新的时序 GNN 类型来预测未来的交通速度。最后，结果与基准解决方案进行了比较，以验证该架构的相关性。

*第十六章*，*使用异构 GNN 进行异常检测*，重点介绍了 GNN 在异常检测中的应用。GNN 具有捕捉复杂关系的能力，使其非常适合用于异常检测，并且能够高效地处理大量数据。在本章中，您将学习如何使用 CIDDS-001 数据集实现一个用于计算机网络入侵检测的 GNN。该章节涵盖了数据集处理、构建相关特征、实现异构 GNN，以及评估结果以确定其在检测网络流量异常中的有效性。

*第十七章*，*使用 LightGCN 推荐书籍*，重点介绍了 GNN 在推荐系统中的应用。推荐系统的目标是根据用户的兴趣和过去的互动，提供个性化的推荐。GNN 非常适合这一任务，因为它们可以有效地整合用户与物品之间的复杂关系。在本章中，介绍了 LightGCN 架构，它是专为推荐系统设计的 GNN。通过使用 Book-Crossing 数据集，本章演示了如何使用 LightGCN 架构构建一个基于协同过滤的书籍推荐系统。

*第十八章*，*解锁图神经网络在现实世界应用中的潜力*，总结了我们在整本书中学到的内容，并展望了 GNN 的未来。

# 为了最大程度地从本书中受益

您应该对图论和机器学习概念（如监督学习和无监督学习、训练和模型评估）有基本的了解，以便最大化您的学习体验。熟悉深度学习框架（如 PyTorch）也会有所帮助，尽管不是必需的，因为本书将提供数学概念及其实现的全面介绍。

| **书中涉及的软件** | **操作系统要求** |
| --- | --- |
| Python 3.8.15 | Windows、macOS 或 Linux |
| PyTorch 1.13.1 | Windows、macOS 或 Linux |
| PyTorch Geometric 2.2.0 | Windows、macOS 或 Linux |

要安装 Python 3.8.15，您可以从 Python 官网上下载最新版本：[`www.python.org/downloads/`](https://www.python.org/downloads/)。我们强烈建议使用虚拟环境，例如`venv`或`conda`。

可选地，如果您希望使用 NVIDIA 的**图形处理单元**（**GPU**）来加速训练和推理，您需要安装**CUDA**和**cuDNN**：

CUDA 是 NVIDIA 开发的并行计算平台和 API，用于 GPU 上的通用计算。要安装 CUDA，您可以按照 NVIDIA 官网上的说明进行操作：[`developer.nvidia.com/cuda-downloads`](https://developer.nvidia.com/cuda-downloads)。

cuDNN 是 NVIDIA 开发的一个库，它提供了深度学习算法的 GPU 优化实现。要安装 cuDNN，您需要在 NVIDIA 官网上创建一个账户，并从 cuDNN 下载页面下载库：[`developer.nvidia.com/cudnn`](https://developer.nvidia.com/cudnn)。

您可以在 NVIDIA 官网上查看支持 CUDA 的 GPU 产品列表：[`developer.nvidia.com/cuda-gpus`](https://developer.nvidia.com/cuda-gpus)。

要安装 PyTorch 1.13.1，您可以按照 PyTorch 官网上的说明进行操作：[`pytorch.org/`](https://pytorch.org/)。您可以选择最适合您系统（包括 CUDA 和 cuDNN）的安装方法。

要安装 PyTorch Geometric 2.2.0，您可以按照 GitHub 仓库中的说明进行操作：[`pytorch-geometric.readthedocs.io/en/2.2.0/notes/installation.xhtml`](https://pytorch-geometric.readthedocs.io/en/2.2.0/notes/installation.xhtml)。您需要首先在系统上安装 PyTorch。

*第十一章*需要 TensorFlow 2.4 版本。要安装它，您可以按照 TensorFlow 官网上的说明进行操作：[`www.tensorflow.org/install`](https://www.tensorflow.org/install)。您可以选择最适合您的系统和所需 TensorFlow 版本的安装方法。

*第十四章*需要一个旧版本的 PyTorch Geometric（版本 2.0.4）。建议为本章创建一个专门的虚拟环境。

*第十五章*，*第十六章*，和*第十七章*需要较高的 GPU 内存使用。你可以通过减少代码中训练集的大小来降低内存使用。

一些章节或大多数章节需要其他 Python 库。你可以使用 `pip install <name==version>` 安装它们，或者根据你的配置使用其他安装程序（如 `conda`）。以下是所需软件包及其相应版本的完整列表：

+   `pandas`==1.5.2

+   `gensim`==4.3.0

+   `networkx`==2.8.8

+   `matplotlib`==3.6.3

+   `node2vec`==0.4.6

+   `seaborn`==0.12.2

+   `scikit-learn`==1.2.0

+   `deepchem`==2.7.1

+   `torch-geometric-temporal`==0.54.0

+   `captum`==0.6.0

所有的需求列表可在 GitHub 上查阅：[`github.com/PacktPublishing/Hands-On-Graph-Neural-Networks-Using-Python`](https://github.com/PacktPublishing/Hands-On-Graph-Neural-Networks-Using-Python)。另外，你也可以直接在 Google Colab 上导入笔记本：[`colab.research.google.com`](https://colab.research.google.com)。

**如果你使用的是本书的电子版，我们建议你自己输入代码，或者访问本书 GitHub 仓库中的代码（链接将在下一节提供）。这样可以帮助你避免与复制粘贴代码相关的潜在错误。**

# 下载示例代码文件

你可以从 GitHub 下载本书的示例代码文件：[`github.com/PacktPublishing/Hands-On-Graph-Neural-Networks-Using-Python`](https://github.com/PacktPublishing/Hands-On-Graph-Neural-Networks-Using-Python)。如果代码有更新，它将会在 GitHub 仓库中更新。

我们还提供了来自丰富书籍和视频目录的其他代码包，欢迎访问 [`github.com/PacktPublishing/`](https://github.com/PacktPublishing/) 查看！

# 下载彩色图像

我们还提供了一份包含本书截图和图表的彩色图像的 PDF 文件。你可以在这里下载：[`packt.link/gaFU6`](https://packt.link/gaFU6)。

# 使用的约定

本书中使用了多种文本约定。

`文本中的代码`：表示文本中的代码词、数据库表名、文件夹名称、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 用户名。以下是一个示例：“我们初始化了两个列表（`visited` 和 `queue`），并添加了起始节点。”

代码块设置如下：

```py
DG = nx.DiGraph()
DG.add_edges_from([('A', 'B'), ('A', 'C'), ('B', 'D'), ('B', 'E'), ('C', 'F'), ('C', 'G')])
```

提示或重要说明

显示如图所示。

# 联系我们

我们始终欢迎读者的反馈。

`customercare@packtpub.com`，并在邮件主题中提及书名。

**勘误表**：虽然我们已尽最大努力确保内容的准确性，但仍可能发生错误。如果你在本书中发现错误，欢迎反馈给我们。请访问 [www.packtpub.com/support/errata](http://www.packtpub.com/support/errata) 填写表单。

`copyright@packt.com`并附上材料链接。

**如果您有兴趣成为作者**：如果您在某个主题上有专长，并且有意撰写或为书籍贡献内容，请访问[authors.packtpub.com](http://authors.packtpub.com)。

# 分享您的想法

阅读完《动手实践图神经网络与 Python》，我们很乐意听到您的想法！请[点击这里直接前往亚马逊书评页面](https://packt.link/r/1-804-61752-0)分享您的反馈。

您的评价对我们和技术社区非常重要，将帮助我们确保提供优质的内容。

# 下载这本书的免费 PDF 副本

感谢您购买本书！

您是否喜欢在旅途中阅读，但又无法随身携带纸质书籍？

您的电子书购买是否无法在您选择的设备上兼容？

别担心，现在购买每本 Packt 书籍，您都能免费获得该书的无 DRM PDF 版本。

随时随地，在任何设备上阅读。直接从您喜爱的技术书籍中搜索、复制并粘贴代码到您的应用程序中。

福利不仅仅如此，您还可以独家获得每日的折扣、新闻通讯以及精彩的免费内容。

按照以下简单步骤获取福利：

1.  扫描二维码或访问以下链接

![](img/B19153_QR_Free_PDF.jpg)

[`packt.link/free-ebook/9781804617526`](https://packt.link/free-ebook/9781804617526)

1.  提交您的购买证明

1.  就是这样！我们会将您的免费 PDF 和其他福利直接发送到您的电子邮件。

# 第一部分：图学习简介

近年来，数据的图表示在各个领域越来越普及，从社交网络到分子生物学。要充分挖掘这一表示的潜力，深入理解**图神经网络**（**GNN**）至关重要，因为 GNN 专门用于处理图结构数据。

本部分包含两章，是本书其余部分的坚实基础。它介绍了图学习和 GNN 的概念，并探讨了它们在多个任务和行业中的相关性。同时，它还涵盖了图论的基本概念及其在图学习中的应用，例如图中心性度量。本部分还突出了 GNN 架构相较于其他方法的独特特点和性能。

到本部分结束时，您将全面了解 GNN 在解决许多现实世界问题中的重要性。您将熟悉图学习的基础知识及其在各个领域的应用。此外，您还将全面了解图论的主要概念，这些概念将在后续章节中使用。有了这个坚实的基础，您将为后续更深入的图学习和 GNN 概念做好准备。

本部分包括以下章节：

+   *第一章**, 图学习入门*

+   *第二章**, 图神经网络的图论*
