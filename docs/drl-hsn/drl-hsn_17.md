

# ç¬¬åä¸ƒç« ï¼šå¼ºåŒ–å­¦ä¹ ä¸­çš„é»‘ç›’ä¼˜åŒ–

åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†å†æ¬¡æ”¹å˜å¯¹å¼ºåŒ–å­¦ä¹ ï¼ˆRLï¼‰è®­ç»ƒçš„çœ‹æ³•ï¼Œè½¬å‘æ‰€è°“çš„é»‘ç›’ä¼˜åŒ–æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•è‡³å°‘å·²æœ‰åå¹´å†å²ï¼Œä½†æœ€è¿‘è¿›è¡Œçš„ä¸€äº›ç ”ç©¶è¡¨æ˜ï¼Œå®ƒä»¬åœ¨å¤§è§„æ¨¡ RL é—®é¢˜ä¸­çš„é€‚ç”¨æ€§ï¼Œå¹¶ä¸”ä¸ä»·å€¼è¿­ä»£å’Œç­–ç•¥æ¢¯åº¦æ–¹æ³•å…·æœ‰ç«äº‰åŠ›ã€‚å°½ç®¡å®ƒä»¬å·²ç»æœ‰äº›å¹´å¤´ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™ç±»æ–¹æ³•ä»ç„¶æ›´ä¸ºé«˜æ•ˆã€‚æœ¬ç« å°†ä»‹ç»ä¸¤ç§é»‘ç›’ä¼˜åŒ–æ–¹æ³•çš„ä¾‹å­ï¼š

+   è¿›åŒ–ç­–ç•¥

+   é—ä¼ ç®—æ³•

# é»‘ç›’æ–¹æ³•

é¦–å…ˆï¼Œè®©æˆ‘ä»¬è®¨è®ºä¸€ä¸‹é»‘ç›’æ–¹æ³•çš„æ•´ä½“å®¶æ—ï¼Œä»¥åŠå®ƒä¸æˆ‘ä»¬ä¹‹å‰è®¨è®ºè¿‡çš„å†…å®¹çš„åŒºåˆ«ã€‚é»‘ç›’ä¼˜åŒ–æ–¹æ³•æ˜¯ä¼˜åŒ–é—®é¢˜çš„é€šç”¨æ–¹æ³•ï¼Œå®ƒå°†ä½ æ­£åœ¨ä¼˜åŒ–çš„ç›®æ ‡è§†ä¸ºé»‘ç›’ï¼Œä¸å¯¹ç›®æ ‡çš„å¯å¾®æ€§ã€ä»·å€¼å‡½æ•°ã€ç›®æ ‡çš„å¹³æ»‘æ€§ç­‰åšä»»ä½•å‡è®¾ã€‚å”¯ä¸€çš„è¦æ±‚æ˜¯è¿™äº›æ–¹æ³•èƒ½å¤Ÿè®¡ç®—é€‚åº”åº¦å‡½æ•°ï¼Œè¿™åº”è¯¥ä¸ºæˆ‘ä»¬æä¾›ä¼˜åŒ–å®ä½“çš„ç‰¹å®šå®ä¾‹çš„é€‚åº”åº¦åº¦é‡ã€‚è¿™ä¸ªå®¶æ—ä¸­æœ€ç®€å•çš„ä¸€ä¸ªä¾‹å­æ˜¯éšæœºæœç´¢ï¼Œå®ƒæ˜¯æŒ‡ä½ éšæœºé€‰æ‹©ä½ è¦å¯»æ‰¾çš„å¯¹è±¡ï¼ˆåœ¨ RL ä¸­æ˜¯ç­–ç•¥Ï€(a|s)ï¼‰ï¼Œæ£€æŸ¥è¯¥å€™é€‰å¯¹è±¡çš„é€‚åº”åº¦ï¼Œå¦‚æœç»“æœè¶³å¤Ÿå¥½ï¼ˆæ ¹æ®æŸäº›å¥–åŠ±æ ‡å‡†ï¼‰ï¼Œé‚£ä¹ˆä½ å°±å®Œæˆäº†ã€‚å¦åˆ™ï¼Œä½ ä¼šä¸€éåˆä¸€éåœ°é‡å¤è¿™ä¸ªè¿‡ç¨‹ã€‚å°½ç®¡è¿™ç§æ–¹æ³•ç®€å•ï¼Œç”šè‡³æœ‰äº›å¤©çœŸï¼Œç‰¹åˆ«æ˜¯ä¸åˆ°ç›®å‰ä¸ºæ­¢ä½ æ‰€çœ‹åˆ°çš„å¤æ‚æ–¹æ³•ç›¸æ¯”ï¼Œä½†å®ƒæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œèƒ½è¯´æ˜é»‘ç›’æ–¹æ³•çš„æ€æƒ³ã€‚

æ­¤å¤–ï¼Œé€šè¿‡ä¸€äº›ä¿®æ”¹ï¼Œæ­£å¦‚ä½ å¾ˆå¿«ä¼šçœ‹åˆ°çš„ï¼Œè¿™ç§ç®€å•çš„æ–¹æ³•åœ¨æ•ˆç‡å’Œç”Ÿæˆçš„ç­–ç•¥è´¨é‡æ–¹é¢ï¼Œå¯ä»¥ä¸æ·±åº¦ Q ç½‘ç»œï¼ˆDQNï¼‰å’Œç­–ç•¥æ¢¯åº¦æ–¹æ³•ç›¸æ¯”è¾ƒã€‚é™¤æ­¤ä¹‹å¤–ï¼Œé»‘ç›’æ–¹æ³•è¿˜æœ‰ä¸€äº›éå¸¸å¸å¼•äººçš„ç‰¹æ€§ï¼š

+   å®ƒä»¬è‡³å°‘æ¯”åŸºäºæ¢¯åº¦çš„æ–¹æ³•å¿«ä¸¤å€ï¼Œå› ä¸ºæˆ‘ä»¬ä¸éœ€è¦æ‰§è¡Œåå‘ä¼ æ’­æ­¥éª¤æ¥è·å¾—æ¢¯åº¦ã€‚

+   å¯¹äºä¼˜åŒ–ç›®æ ‡å’Œä½œä¸ºé»‘ç›’å¤„ç†çš„ç­–ç•¥ï¼Œå‡ ä¹æ²¡æœ‰ä»»ä½•å‡è®¾ã€‚ä¼ ç»Ÿæ–¹æ³•åœ¨å¥–åŠ±å‡½æ•°ä¸å¹³æ»‘æˆ–ç­–ç•¥ä¸­åŒ…å«éšæœºé€‰æ‹©æ­¥éª¤æ—¶ä¼šé‡åˆ°å›°éš¾ã€‚è€Œè¿™ä¸€åˆ‡å¯¹äºé»‘ç›’æ–¹æ³•æ¥è¯´éƒ½ä¸æ˜¯é—®é¢˜ï¼Œå› ä¸ºå®ƒä»¬å¯¹é»‘ç›’çš„å†…éƒ¨å®ç°æ²¡æœ‰å¤ªå¤šè¦æ±‚ã€‚

+   è¿™äº›æ–¹æ³•é€šå¸¸å¯ä»¥å¾ˆå¥½åœ°å¹¶è¡ŒåŒ–ã€‚ä¾‹å¦‚ï¼Œä¸Šè¿°çš„éšæœºæœç´¢å¯ä»¥è½»æ¾æ‰©å±•åˆ°æ•°åƒä¸ªä¸­å¤®å¤„ç†å•å…ƒï¼ˆCPUï¼‰æˆ–å›¾å½¢å¤„ç†å•å…ƒï¼ˆGPUï¼‰å¹¶è¡Œå·¥ä½œï¼Œä¸”å½¼æ­¤ä¹‹é—´æ²¡æœ‰ä»»ä½•ä¾èµ–å…³ç³»ã€‚å¯¹äº DQN æˆ–ç­–ç•¥æ¢¯åº¦æ–¹æ³•è€Œè¨€ï¼Œæƒ…å†µåˆ™ä¸åŒï¼Œå› ä¸ºéœ€è¦ç§¯ç´¯æ¢¯åº¦å¹¶å°†å½“å‰ç­–ç•¥ä¼ æ’­ç»™æ‰€æœ‰å¹¶è¡Œå·¥ä½œè€…ï¼Œè¿™ä¼šé™ä½å¹¶è¡Œæ€§ã€‚

å‰è¿°æ–¹æ³•çš„ç¼ºç‚¹é€šå¸¸æ˜¯æ ·æœ¬æ•ˆç‡è¾ƒä½ã€‚ç‰¹åˆ«æ˜¯ï¼Œä½¿ç”¨å…·æœ‰äº”åä¸‡ä¸ªå‚æ•°çš„ç¥ç»ç½‘ç»œï¼ˆNNï¼‰è¿›è¡Œçš„å¤©çœŸéšæœºæœç´¢ç­–ç•¥ï¼ŒæˆåŠŸçš„æ¦‚ç‡éå¸¸ä½ã€‚

# è¿›åŒ–ç­–ç•¥

é»‘ç›’ä¼˜åŒ–æ–¹æ³•çš„ä¸€ç±»è¢«ç§°ä¸ºè¿›åŒ–ç­–ç•¥ï¼ˆESï¼‰ï¼Œå®ƒçš„çµæ„Ÿæ¥æºäºè¿›åŒ–è¿‡ç¨‹ã€‚åœ¨ ES ä¸­ï¼Œæœ€æˆåŠŸçš„ä¸ªä½“å¯¹æœç´¢çš„æ•´ä½“æ–¹å‘æœ‰æœ€å¤§çš„å½±å“ã€‚è¿™ä¸ªç±»åˆ«ä¸‹æœ‰è®¸å¤šä¸åŒçš„æ–¹æ³•ï¼Œåœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®º OpenAI ç ”ç©¶äººå‘˜ Salimans ç­‰äººåœ¨ä»–ä»¬çš„è®ºæ–‡ã€Šè¿›åŒ–ç­–ç•¥ä½œä¸ºå¼ºåŒ–å­¦ä¹ çš„å¯æ‰©å±•æ›¿ä»£æ–¹æ³•ã€‹[Sal+17]ä¸­æå‡ºçš„æ–¹æ³•ï¼Œè¯¥è®ºæ–‡äº 2017 å¹´ 3 æœˆå‘å¸ƒã€‚

ES æ–¹æ³•çš„åŸºæœ¬æ€æƒ³æ˜¯åœ¨æ¯æ¬¡è¿­ä»£æ—¶ï¼Œæˆ‘ä»¬å¯¹å½“å‰çš„ç­–ç•¥å‚æ•°è¿›è¡Œéšæœºæ‰°åŠ¨ï¼Œå¹¶è¯„ä¼°ç”±æ­¤äº§ç”Ÿçš„ç­–ç•¥é€‚åº”åº¦å‡½æ•°ã€‚ç„¶åï¼Œæˆ‘ä»¬æ ¹æ®ç›¸å¯¹çš„é€‚åº”åº¦å‡½æ•°å€¼è°ƒæ•´ç­–ç•¥æƒé‡ã€‚

Salimans ç­‰äººä½¿ç”¨çš„å…·ä½“æ–¹æ³•è¢«ç§°ä¸ºåæ–¹å·®çŸ©é˜µé€‚åº”è¿›åŒ–ç­–ç•¥ï¼ˆCMA-ESï¼‰ï¼Œå…¶ä¸­æ‰§è¡Œçš„æ‰°åŠ¨æ˜¯ä»å‡å€¼ä¸ºé›¶ã€æ–¹å·®ä¸ºå•ä½çŸ©é˜µçš„æ­£æ€åˆ†å¸ƒä¸­é‡‡æ ·çš„éšæœºå™ªå£°ã€‚ç„¶åï¼Œæˆ‘ä»¬è®¡ç®—å…·æœ‰æƒé‡ç­‰äºåŸå§‹ç­–ç•¥æƒé‡åŠ ä¸Šç¼©æ”¾å™ªå£°çš„ç­–ç•¥çš„é€‚åº”åº¦å‡½æ•°å€¼ã€‚æ¥ä¸‹æ¥ï¼Œæ ¹æ®å¾—åˆ°çš„å€¼ï¼Œæˆ‘ä»¬é€šè¿‡å°†å™ªå£°ä¹˜ä»¥é€‚åº”åº¦å‡½æ•°å€¼æ¥è°ƒæ•´åŸå§‹ç­–ç•¥æƒé‡ï¼Œè¿™æ ·å¯ä»¥ä½¿æˆ‘ä»¬çš„ç­–ç•¥æœç€å…·æœ‰æ›´é«˜é€‚åº”åº¦å‡½æ•°å€¼çš„æƒé‡æ–¹å‘ç§»åŠ¨ã€‚ä¸ºäº†æé«˜ç¨³å®šæ€§ï¼Œæƒé‡æ›´æ–°æ˜¯é€šè¿‡å¯¹å…·æœ‰ä¸åŒéšæœºå™ªå£°çš„å¤šä¸ªæ­¥éª¤æ‰¹æ¬¡è¿›è¡Œå¹³å‡æ¥å®Œæˆçš„ã€‚

æ›´æ­£å¼åœ°è¯´ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥è¡¨è¾¾ä¸ºä»¥ä¸‹æ­¥éª¤åºåˆ—ï¼š

1.  åˆå§‹åŒ–å­¦ä¹ ç‡ Î±ã€å™ªå£°æ ‡å‡†å·® Ïƒ å’Œåˆå§‹ç­–ç•¥å‚æ•° ğœƒ[0]ã€‚

1.  å¯¹ t = 0,1,â€¦ æ‰§è¡Œï¼š

    1.  å™ªå£°æ ·æœ¬æ‰¹æ¬¡ï¼Œå…¶å½¢çŠ¶ä¸æ¥è‡ªå‡å€¼ä¸ºé›¶ã€æ–¹å·®ä¸ºä¸€çš„æ­£æ€åˆ†å¸ƒçš„æƒé‡ç›¸åŒï¼šğœ–[1],â€¦,ğœ–[n] âˆ¼ğ’©(0,I)

    1.  è®¡ç®—å›æŠ¥ F[i] = F(ğœƒ[t] + Ïƒğœ–[i])ï¼Œå…¶ä¸­ i = 1,â€¦,n

    1.  æ›´æ–°æƒé‡ï¼š

        ![Ï€ (a |s) = P[At = a|St = s] ](img/eq69.png)

è¯¥ç®—æ³•æ˜¯è®ºæ–‡ä¸­æå‡ºæ–¹æ³•çš„æ ¸å¿ƒï¼Œä½†åƒå¼ºåŒ–å­¦ä¹ é¢†åŸŸä¸­çš„å¸¸è§æƒ…å†µä¸€æ ·ï¼Œå•é è¿™ä¸ªæ–¹æ³•ä¸è¶³ä»¥è·å¾—è‰¯å¥½çš„ç»“æœã€‚å› æ­¤ï¼Œè®ºæ–‡ä¸­åŒ…å«äº†å‡ ä¸ªè°ƒæ•´ä»¥æ”¹å–„æ–¹æ³•ï¼Œå°½ç®¡æ ¸å¿ƒæ–¹æ³•ä¿æŒä¸å˜ã€‚

## åœ¨ CartPole ä¸Šå®ç° ES

è®©æˆ‘ä»¬åœ¨æˆ‘ä»¬çš„æœè‡ç¯å¢ƒä¸­å®ç°å¹¶æµ‹è¯•è®ºæ–‡ä¸­çš„æ–¹æ³•ï¼šå€’ç«‹æ‘†ï¼ˆCartPoleï¼‰ã€‚ä½ å¯ä»¥åœ¨ Chapter17/01_cartpole_es.py æ–‡ä»¶ä¸­æ‰¾åˆ°å®Œæ•´çš„ä¾‹å­ã€‚

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å•ä¸€ç¯å¢ƒæ¥æ£€æŸ¥æ‰°åŠ¨åçš„ç½‘ç»œæƒé‡çš„é€‚åº”åº¦ã€‚æˆ‘ä»¬çš„é€‚åº”åº¦å‡½æ•°å°†æ˜¯è¯¥å›åˆçš„æœªæŠ˜æ‰£æ€»å¥–åŠ±ã€‚

æˆ‘ä»¬ä»å¯¼å…¥å¼€å§‹ï¼š

```py
import gymnasium as gym 
import time 
import numpy as np 
import typing as tt 

import torch 
import torch.nn as nn 

from torch.utils.tensorboard.writer import SummaryWriter
```

ä»å¯¼å…¥è¯­å¥ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„ä¾‹å­æ˜¯å¤šä¹ˆè‡ªåŒ…å«ã€‚æˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨ PyTorch ä¼˜åŒ–å™¨ï¼Œå› ä¸ºæˆ‘ä»¬æ ¹æœ¬ä¸è¿›è¡Œåå‘ä¼ æ’­ã€‚äº‹å®ä¸Šï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥é¿å…ä½¿ç”¨ PyTorchï¼Œåªä½¿ç”¨ NumPyï¼Œå› ä¸ºæˆ‘ä»¬å”¯ä¸€ç”¨ PyTorch çš„åœ°æ–¹å°±æ˜¯æ‰§è¡Œå‰å‘ä¼ æ’­å¹¶è®¡ç®—ç½‘ç»œçš„è¾“å‡ºã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®šä¹‰è¶…å‚æ•°ï¼š

```py
MAX_BATCH_EPISODES = 100 
MAX_BATCH_STEPS = 10000 
NOISE_STD = 0.001 
LEARNING_RATE = 0.001 

TNoise = tt.List[torch.Tensor]
```

è¶…å‚æ•°çš„æ•°é‡ä¹Ÿå¾ˆå°‘ï¼ŒåŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªå€¼ï¼š

+   MAX_BATCH_EPISODES å’Œ MAX_BATCH_STEPSï¼šç”¨äºè®­ç»ƒçš„å›åˆæ•°å’Œæ­¥éª¤æ•°çš„é™åˆ¶

+   NOISE_STDï¼šç”¨äºæƒé‡æ‰°åŠ¨çš„å™ªå£°æ ‡å‡†å·®ï¼ŒÏƒ

+   LEARNING_RATEï¼šç”¨äºè°ƒæ•´è®­ç»ƒæ­¥éª¤ä¸­æƒé‡çš„ç³»æ•°

æˆ‘ä»¬è¿˜å®šä¹‰äº†ä¸€ä¸ªç±»å‹åˆ«åï¼Œè¡¨ç¤ºåŒ…å«æƒé‡å™ªå£°çš„å¼ é‡åˆ—è¡¨ã€‚è¿™æ ·å¯ä»¥ç®€åŒ–ä»£ç ï¼Œå› ä¸ºæˆ‘ä»¬å°†ä¼šé¢‘ç¹å¤„ç†å™ªå£°ã€‚

ç°åœ¨è®©æˆ‘ä»¬æ£€æŸ¥ç½‘ç»œï¼š

```py
class Net(nn.Module): 
    def __init__(self, obs_size: int, action_size: int): 
        super(Net, self).__init__() 
        self.net = nn.Sequential( 
            nn.Linear(obs_size, 32), 
            nn.ReLU(), 
            nn.Linear(32, action_size), 
            nn.Softmax(dim=1) 
        ) 

    def forward(self, x: torch.Tensor) -> torch.Tensor: 
        return self.net(x)
```

æˆ‘ä»¬ä½¿ç”¨çš„æ¨¡å‹æ˜¯ä¸€ä¸ªç®€å•çš„å•éšå±‚ç¥ç»ç½‘ç»œï¼ˆNNï¼‰ï¼Œå®ƒæ ¹æ®è§‚å¯Ÿç»“æœç»™å‡ºéœ€è¦é‡‡å–çš„è¡ŒåŠ¨ã€‚æˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨ PyTorch çš„ç¥ç»ç½‘ç»œæ¨¡å—ä»…æ˜¯ä¸ºäº†æ–¹ä¾¿ï¼Œå› ä¸ºæˆ‘ä»¬åªéœ€è¦å‰å‘ä¼ æ’­ï¼Œä½†å®ƒä¹Ÿå¯ä»¥é€šè¿‡çŸ©é˜µä¹˜æ³•å’Œéçº¿æ€§åº”ç”¨æ¥æ›¿ä»£ã€‚

evaluate() å‡½æ•°ä½¿ç”¨ç»™å®šçš„ç­–ç•¥è¿›è¡Œå®Œæ•´çš„å›åˆï¼Œå¹¶è¿”å›æ€»å¥–åŠ±å’Œæ­¥æ•°ï¼š

```py
def evaluate(env: gym.Env, net: Net) -> tt.Tuple[float, int]: 
    obs, _ = env.reset() 
    reward = 0.0 
    steps = 0 
    while True: 
        obs_v = torch.FloatTensor(np.expand_dims(obs, 0)) 
        act_prob = net(obs_v) 
        acts = act_prob.max(dim=1)[1] 
        obs, r, done, is_tr, _ = env.step(acts.data.numpy()[0]) 
        reward += r 
        steps += 1 
        if done or is_tr: 
            break 
    return reward, steps
```

å¥–åŠ±å°†ä½œä¸ºé€‚åº”åº¦å€¼ï¼Œè€Œæ­¥æ•°åˆ™ç”¨äºé™åˆ¶æˆ‘ä»¬èŠ±è´¹åœ¨å½¢æˆæ‰¹æ¬¡ä¸Šçš„æ—¶é—´ã€‚è¡ŒåŠ¨é€‰æ‹©é€šè¿‡è®¡ç®—ç½‘ç»œè¾“å‡ºçš„æœ€å¤§å€¼ï¼ˆargmaxï¼‰ä»¥ç¡®å®šæ€§æ–¹å¼è¿›è¡Œã€‚åŸåˆ™ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ä»åˆ†å¸ƒä¸­è¿›è¡Œéšæœºé‡‡æ ·ï¼Œä½†æˆ‘ä»¬å·²ç»é€šè¿‡å‘ç½‘ç»œå‚æ•°æ·»åŠ å™ªå£°æ¥è¿›è¡Œæ¢ç´¢ï¼Œå› æ­¤åœ¨è¿™é‡Œè¿›è¡Œç¡®å®šæ€§è¡ŒåŠ¨é€‰æ‹©æ˜¯å¯ä»¥çš„ã€‚

åœ¨ sample_noise() å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†å‡å€¼ä¸ºé›¶ã€æ–¹å·®ä¸ºä¸€çš„éšæœºå™ªå£°ï¼Œå…¶å½¢çŠ¶ä¸æˆ‘ä»¬çš„ç½‘ç»œå‚æ•°ç›¸åŒï¼š

```py
def sample_noise(net: Net) -> tt.Tuple[TNoise, TNoise]: 
    pos = [] 
    neg = [] 
    for p in net.parameters(): 
        noise = np.random.normal(size=p.data.size()) 
        noise_t = torch.FloatTensor(noise) 
        pos.append(noise_t) 
        neg.append(-noise_t) 
    return pos, neg
```

è¯¥å‡½æ•°è¿”å›ä¸¤ç»„å™ªå£°å¼ é‡ï¼šä¸€ç»„æ˜¯æ­£å™ªå£°ï¼Œå¦ä¸€ç»„æ˜¯å–è´Ÿå·åçš„ç›¸åŒéšæœºå€¼ã€‚è¿™ä¸¤ç»„æ ·æœ¬ç¨åä¼šä½œä¸ºç‹¬ç«‹æ ·æœ¬æ”¾å…¥ä¸€ä¸ªæ‰¹æ¬¡ä¸­ã€‚è¿™ç§æŠ€æœ¯ç§°ä¸ºé•œåƒé‡‡æ ·ï¼Œç”¨æ¥æé«˜æ”¶æ•›çš„ç¨³å®šæ€§ã€‚å®é™…ä¸Šï¼Œå¦‚æœæ²¡æœ‰è´Ÿå™ªå£°ï¼Œæ”¶æ•›ä¼šå˜å¾—éå¸¸ä¸ç¨³å®šï¼Œå› ä¸ºæ­£å™ªå£°ä¼šå°†æƒé‡æ¨å‘å•ä¸€æ–¹å‘ã€‚

eval_with_noise() å‡½æ•°æ¥å—ç”± sample_noise() åˆ›å»ºçš„å™ªå£°æ•°ç»„ï¼Œå¹¶åœ¨æ·»åŠ å™ªå£°åè¯„ä¼°ç½‘ç»œï¼š

```py
def eval_with_noise(env: gym.Env, net: nn.Module, noise: TNoise, noise_std: float, 
        get_max_action: bool = True, device: torch.device = torch.device("cpu") 
    old_params = net.state_dict() 
    for p, p_n in zip(net.parameters(), noise): 
        p.data += NOISE_STD * p_n 
    r, s = evaluate(env, net) 
    net.load_state_dict(old_params) 
    return r, s
```

ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°†å™ªå£°åŠ åˆ°ç½‘ç»œçš„å‚æ•°ä¸Šï¼Œå¹¶è°ƒç”¨è¯„ä¼°å‡½æ•°æ¥è·å¾—å¥–åŠ±å’Œæ‰€é‡‡å–çš„æ­¥éª¤æ•°ã€‚ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦æ¢å¤ç½‘ç»œçš„æƒé‡åˆ°å…¶åŸå§‹çŠ¶æ€ï¼Œè¿™é€šè¿‡åŠ è½½ç½‘ç»œçš„çŠ¶æ€å­—å…¸æ¥å®Œæˆã€‚

æ–¹æ³•çš„æœ€åä¸€ä¸ªä¹Ÿæ˜¯æ ¸å¿ƒçš„å‡½æ•°æ˜¯`train_step()`ï¼Œå®ƒæ¥å—å¸¦å™ªå£°å’Œç›¸åº”å¥–åŠ±çš„æ‰¹æ¬¡ï¼Œå¹¶é€šè¿‡åº”ç”¨å…¬å¼è®¡ç®—å¯¹ç½‘ç»œå‚æ•°çš„æ›´æ–°ï¼š

![Ï€ (a |s) = P[At = a|St = s] ](img/eq69.png)

è¿™å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°ï¼š

```py
def train_step(net: Net, batch_noise: tt.List[common.TNoise], batch_reward: tt.List[float], 
               writer: SummaryWriter, step_idx: int): 
    weighted_noise = None 
    norm_reward = np.array(batch_reward) 
    norm_reward -= np.mean(norm_reward) 
    s = np.std(norm_reward) 
    if abs(s) > 1e-6: 
        norm_reward /= s
```

åœ¨å¼€å§‹æ—¶ï¼Œæˆ‘ä»¬å¯¹å¥–åŠ±è¿›è¡Œå½’ä¸€åŒ–ï¼Œä½¿å…¶å‡å€¼ä¸ºé›¶ï¼Œæ–¹å·®ä¸ºä¸€ï¼Œè¿™æœ‰åŠ©äºæé«˜æ–¹æ³•çš„ç¨³å®šæ€§ã€‚

ç„¶åï¼Œæˆ‘ä»¬éå†æ‰¹æ¬¡ä¸­çš„æ¯ä¸€å¯¹ï¼ˆå™ªå£°ï¼Œå¥–åŠ±ï¼‰ï¼Œå°†å™ªå£°å€¼ä¸å½’ä¸€åŒ–çš„å¥–åŠ±ç›¸ä¹˜ï¼Œå¹¶å°†æ¯ä¸ªå‚æ•°çš„ç›¸åº”å™ªå£°ç›¸åŠ ï¼š

```py
 for noise, reward in zip(batch_noise, norm_reward): 
        if weighted_noise is None: 
            weighted_noise = [reward * p_n for p_n in noise] 
        else: 
            for w_n, p_n in zip(weighted_noise, noise): 
                w_n += reward * p_n
```

æœ€åä¸€æ­¥æ˜¯ä½¿ç”¨ç§¯ç´¯çš„ç¼©æ”¾å™ªå£°æ¥è°ƒæ•´ç½‘ç»œå‚æ•°ï¼š

```py
 m_updates = [] 
    for p, p_update in zip(net.parameters(), weighted_noise): 
        update = p_update / (len(batch_reward) * NOISE_STD) 
        p.data += LEARNING_RATE * update 
        m_updates.append(torch.norm(update)) 
    writer.add_scalar("update_l2", np.mean(m_updates), step_idx)
```

ä»æŠ€æœ¯ä¸Šè®²ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œåšçš„æ˜¯æ¢¯åº¦ä¸Šå‡ï¼Œå°½ç®¡æ¢¯åº¦å¹¶ä¸æ˜¯é€šè¿‡åå‘ä¼ æ’­è·å¾—çš„ï¼Œè€Œæ˜¯é€šè¿‡éšæœºé‡‡æ ·ï¼ˆä¹Ÿç§°ä¸ºè’™ç‰¹å¡æ´›é‡‡æ ·ï¼‰å¾—åˆ°çš„ã€‚Salimans ç­‰äººä¹Ÿè¯æ˜äº†è¿™ä¸€ç‚¹ï¼Œä½œè€…å±•ç¤ºäº† CMA-ES ä¸ç­–ç•¥æ¢¯åº¦æ–¹æ³•éå¸¸ç›¸ä¼¼ï¼ŒåŒºåˆ«ä»…åœ¨äºæˆ‘ä»¬è·å¾—æ¢¯åº¦ä¼°è®¡çš„æ–¹å¼ã€‚

è®­ç»ƒå¾ªç¯å‰çš„å‡†å¤‡å·¥ä½œå¾ˆç®€å•ï¼›æˆ‘ä»¬åˆ›å»ºç¯å¢ƒå’Œç½‘ç»œï¼š

```py
if __name__ == "__main__": 
    writer = SummaryWriter(comment="-cartpole-es") 
    env = gym.make("CartPole-v1") 

    net = Net(env.observation_space.shape[0], env.action_space.n) 
    print(net)
```

æ¯æ¬¡è®­ç»ƒå¾ªç¯çš„è¿­ä»£éƒ½ä»æ‰¹æ¬¡åˆ›å»ºå¼€å§‹ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å¯¹å™ªå£°è¿›è¡Œé‡‡æ ·å¹¶è·å¾—æ­£å‘å’Œåå‘å™ªå£°çš„å¥–åŠ±ï¼š

```py
 step_idx = 0 
    while True: 
        t_start = time.time() 
        batch_noise = [] 
        batch_reward = [] 
        batch_steps = 0 
        for _ in range(MAX_BATCH_EPISODES): 
            noise, neg_noise = sample_noise(net) 
            batch_noise.append(noise) 
            batch_noise.append(neg_noise) 
            reward, steps = eval_with_noise(env, net, noise) 
            batch_reward.append(reward) 
            batch_steps += steps 
            reward, steps = eval_with_noise(env, net, neg_noise) 
            batch_reward.append(reward) 
            batch_steps += steps 
            if batch_steps > MAX_BATCH_STEPS: 
                break
```

å½“æˆ‘ä»¬è¾¾åˆ°æ‰¹æ¬¡çš„æœ€å¤§é›†æ•°ï¼Œæˆ–è€…æ€»æ­¥æ•°çš„ä¸Šé™æ—¶ï¼Œæˆ‘ä»¬åœæ­¢æ”¶é›†æ•°æ®å¹¶è¿›è¡Œè®­ç»ƒæ›´æ–°ã€‚

è¦æ‰§è¡Œç½‘ç»œçš„æ›´æ–°ï¼Œæˆ‘ä»¬è°ƒç”¨å·²ç»çœ‹åˆ°çš„`train_step()`å‡½æ•°ï¼š

```py
 step_idx += 1 
        m_reward = float(np.mean(batch_reward)) 
        if m_reward > 199: 
            print("Solved in %d steps" % step_idx) 
            break 

        train_step(net, batch_noise, batch_reward, writer, step_idx)
```

`train_step()`å‡½æ•°çš„ç›®æ ‡æ˜¯æ ¹æ®æ€»å¥–åŠ±æ¥ç¼©æ”¾å™ªå£°ï¼Œç„¶åå°†ç­–ç•¥æƒé‡è°ƒæ•´åˆ°å¹³å‡å™ªå£°çš„æ–¹å‘ã€‚

è®­ç»ƒå¾ªç¯çš„æœ€åæ­¥éª¤å°†åº¦é‡æ•°æ®å†™å…¥ TensorBoardï¼Œå¹¶åœ¨æ§åˆ¶å°ä¸Šæ˜¾ç¤ºè®­ç»ƒè¿›åº¦ï¼š

```py
 writer.add_scalar("reward_mean", m_reward, step_idx) 
        writer.add_scalar("reward_std", np.std(batch_reward), step_idx) 
        writer.add_scalar("reward_max", np.max(batch_reward), step_idx) 
        writer.add_scalar("batch_episodes", len(batch_reward), step_idx) 
        writer.add_scalar("batch_steps", batch_steps, step_idx) 
        speed = batch_steps / (time.time() - t_start) 
        writer.add_scalar("speed", speed, step_idx) 
        print("%d: reward=%.2f, speed=%.2f f/s" % ( 
            step_idx, m_reward, speed))
```

## CartPole ç»“æœ

è®­ç»ƒå¯ä»¥é€šè¿‡ç›´æ¥è¿è¡Œç¨‹åºè€Œä¸éœ€è¦å‚æ•°æ¥å¼€å§‹ï¼š

```py
Chapter17$ ./01_cartpole_es.py 
Net( 
Â Â (net): Sequential( 
Â Â Â (0): Linear(in_features=4, out_features=32, bias=True) 
Â Â Â (1): ReLU() 
Â Â Â (2): Linear(in_features=32, out_features=2, bias=True) 
Â Â Â (3): Softmax(dim=1) 
Â Â ) 
) 
1: reward=10.00, speed=7458.03 f/s 
2: reward=11.93, speed=8454.54 f/s 
3: reward=13.71, speed=8677.55 f/s 
4: reward=15.96, speed=8905.25 f/s 
5: reward=18.75, speed=9098.71 f/s 
6: reward=22.08, speed=9220.68 f/s 
7: reward=23.57, speed=9272.45 f/s 
...
```

æ ¹æ®æˆ‘çš„å®éªŒï¼ŒES é€šå¸¸éœ€è¦å¤§çº¦ 40 åˆ° 60 ä¸ªæ‰¹æ¬¡æ¥è§£å†³ CartPoleã€‚å‰é¢è¿è¡Œçš„æ”¶æ•›åŠ¨æ€å¦‚å›¾ 17.1 å’Œå›¾ 17.2 æ‰€ç¤ºã€‚

![PIC](img/B22150_17_01.png)

å›¾ 17.1ï¼šES åœ¨ CartPole ä¸Šçš„æœ€å¤§å¥–åŠ±ï¼ˆå·¦ï¼‰å’Œç­–ç•¥æ›´æ–°ï¼ˆå³ï¼‰

![PIC](img/B22150_17_02.png)

å›¾ 17.2ï¼šES åœ¨ CartPole ä¸Šçš„å¥–åŠ±å‡å€¼ï¼ˆå·¦ï¼‰å’Œæ ‡å‡†å·®ï¼ˆå³ï¼‰

å‰é¢çš„å›¾è¡¨çœ‹èµ·æ¥ç›¸å½“ä¸é”™â€”â€”åœ¨ 30 ç§’å†…è§£å†³ç¯å¢ƒé—®é¢˜ä¸ç¬¬å››ç« ä¸­çš„äº¤å‰ç†µæ–¹æ³•ç›¸å½“ã€‚

## ES åœ¨ HalfCheetah ä¸Šçš„è¡¨ç°

åœ¨ä¸‹ä¸€ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†è¶…è¶Šæœ€ç®€å•çš„ ES å®ç°ï¼Œæ¢è®¨å¦‚ä½•ä½¿ç”¨ Salimans ç­‰äººæå‡ºçš„å…±äº«ç§å­ç­–ç•¥é«˜æ•ˆåœ°å¹¶è¡ŒåŒ–è¯¥æ–¹æ³•ã€‚ä¸ºäº†å±•ç¤ºè¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ MuJoCo ç‰©ç†æ¨¡æ‹Ÿå™¨ä¸­çš„ HalfCheetah ç¯å¢ƒã€‚æˆ‘ä»¬å·²ç»åœ¨å‰ä¸€ç« ä¸­è¿›è¡Œäº†å®éªŒï¼Œå› æ­¤å¦‚æœä½ è¿˜æ²¡æœ‰å®‰è£… gymnasium[mujoco]åŒ…ï¼Œåº”è¯¥å…ˆå®‰è£…ã€‚

é¦–å…ˆï¼Œè®©æˆ‘ä»¬è®¨è®ºå…±äº«ç§å­çš„æ¦‚å¿µã€‚ES ç®—æ³•çš„æ€§èƒ½ä¸»è¦å–å†³äºæˆ‘ä»¬æ”¶é›†è®­ç»ƒæ‰¹æ¬¡çš„é€Ÿåº¦ï¼Œè®­ç»ƒæ‰¹æ¬¡ç”±é‡‡æ ·å™ªå£°å’Œæ£€æŸ¥æ‰°åŠ¨å™ªå£°çš„æ€»å¥–åŠ±ç»„æˆã€‚ç”±äºæˆ‘ä»¬çš„è®­ç»ƒæ‰¹æ¬¡é¡¹æ˜¯ç‹¬ç«‹çš„ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°å°†è¿™ä¸€æ­¥å¹¶è¡ŒåŒ–åˆ°å¤§é‡ä½äºè¿œç¨‹æœºå™¨ä¸Šçš„å·¥äººï¼ˆè¿™æœ‰ç‚¹ç±»ä¼¼äºç¬¬åäºŒç« ä¸­çš„ç¤ºä¾‹ï¼Œå½“æ—¶æˆ‘ä»¬ä» A3C å·¥äººé‚£é‡Œæ”¶é›†æ¢¯åº¦ï¼‰ã€‚ç„¶è€Œï¼Œå¤©çœŸçš„å¹¶è¡ŒåŒ–å®ç°å°†éœ€è¦å°†å¤§é‡æ•°æ®ä»å·¥äººè¿›ç¨‹ä¼ è¾“åˆ°ä¸­å¤®ä¸»è¿›ç¨‹ï¼Œä¸»è¿›ç¨‹åº”å½“åˆå¹¶å·¥äººæ£€æŸ¥è¿‡çš„å™ªå£°å¹¶æ‰§è¡Œç­–ç•¥æ›´æ–°ã€‚å¤§éƒ¨åˆ†æ•°æ®æ˜¯å™ªå£°å‘é‡ï¼Œå…¶å¤§å°ç­‰äºæˆ‘ä»¬ç­–ç•¥å‚æ•°çš„å¤§å°ã€‚

ä¸ºäº†é¿å…è¿™ç§å¼€é”€ï¼ŒSalimans ç­‰äººæå‡ºäº†ä¸€ä¸ªç›¸å½“ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆã€‚ç”±äºå·¥äººä¸Šé‡‡æ ·çš„å™ªå£°æ˜¯ç”±ä¼ªéšæœºæ•°ç”Ÿæˆå™¨äº§ç”Ÿçš„ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥è®¾ç½®éšæœºç§å­å¹¶é‡ç°ç”Ÿæˆçš„éšæœºåºåˆ—ï¼Œå› æ­¤å·¥äººåªéœ€å°†ç”¨äºç”Ÿæˆå™ªå£°çš„ç§å­ä¼ è¾“ç»™ä¸»è¿›ç¨‹ã€‚ç„¶åï¼Œä¸»è¿›ç¨‹å¯ä»¥ä½¿ç”¨è¯¥ç§å­å†æ¬¡ç”Ÿæˆç›¸åŒçš„å™ªå£°å‘é‡ã€‚å½“ç„¶ï¼Œæ¯ä¸ªå·¥äººçš„ç§å­éœ€è¦éšæœºç”Ÿæˆï¼Œä»¥ä¿æŒéšæœºä¼˜åŒ–è¿‡ç¨‹çš„æ€§è´¨ã€‚è¿™æ ·åšçš„æ•ˆæœæ˜¯æ˜¾è‘—å‡å°‘äº†éœ€è¦ä»å·¥äººä¼ è¾“åˆ°ä¸»è¿›ç¨‹çš„æ•°æ®é‡ï¼Œä»è€Œæé«˜äº†æ–¹æ³•çš„å¯æ‰©å±•æ€§ã€‚ä¾‹å¦‚ï¼ŒSalimans ç­‰äººæŠ¥å‘Šäº†åœ¨äº‘ç«¯ä½¿ç”¨ 1,440 ä¸ª CPU è¿›è¡Œä¼˜åŒ–æ—¶çš„çº¿æ€§åŠ é€Ÿã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ç›¸åŒçš„æ–¹æ³•è¿›è¡Œæœ¬åœ°å¹¶è¡ŒåŒ–ã€‚

## åœ¨ HalfCheetah ä¸Šå®ç° ES

ä»£ç ä½äº Chapter17/02_cheetah_es.py ä¸­ã€‚ç”±äºä»£ç ä¸ CartPole ç‰ˆæœ¬æœ‰æ˜¾è‘—é‡å ï¼Œæˆ‘ä»¬åœ¨æ­¤åªå…³æ³¨å…¶ä¸­çš„å·®å¼‚ã€‚

æˆ‘ä»¬å°†ä»å·¥äººå¼€å§‹ï¼Œå·¥äººä½œä¸ºå•ç‹¬çš„è¿›ç¨‹ä½¿ç”¨ PyTorch çš„å¤šè¿›ç¨‹å°è£…å™¨å¯åŠ¨ã€‚å·¥äººçš„èŒè´£å¾ˆç®€å•ï¼šæ¯æ¬¡è¿­ä»£æ—¶ï¼Œå®ƒä»ä¸»è¿›ç¨‹è·å–ç½‘ç»œå‚æ•°ï¼Œç„¶åæ‰§è¡Œå›ºå®šæ¬¡æ•°çš„è¿­ä»£ï¼Œåœ¨æ¯æ¬¡è¿­ä»£ä¸­å®ƒé‡‡æ ·å™ªå£°å¹¶è¯„ä¼°å¥–åŠ±ã€‚å¸¦æœ‰éšæœºç§å­çš„ç»“æœé€šè¿‡é˜Ÿåˆ—å‘é€ç»™ä¸»è¿›ç¨‹ã€‚

ä»¥ä¸‹æ•°æ®ç±»ç”±å·¥äººä½¿ç”¨ï¼Œç”¨äºå°†æ‰°åŠ¨ç­–ç•¥è¯„ä¼°çš„ç»“æœå‘é€åˆ°ä¸»è¿›ç¨‹ï¼š

```py
@dataclass(frozen=True) 
class RewardsItem: 
    seed: int 
    pos_reward: float 
    neg_reward: float 
    steps: int
```

å®ƒåŒ…æ‹¬éšæœºç§å­ã€é€šè¿‡æ­£è´Ÿå™ªå£°è·å¾—çš„å¥–åŠ±ï¼Œä»¥åŠæˆ‘ä»¬åœ¨ä¸¤ä¸ªæµ‹è¯•ä¸­æ‰§è¡Œçš„æ€»æ­¥éª¤æ•°ã€‚

æ¯æ¬¡è®­ç»ƒè¿­ä»£æ—¶ï¼Œå·¥ä½œç¨‹åºä¼šç­‰å¾…ä¸»æ§ç¨‹åºå¹¿æ’­ç½‘ç»œå‚æ•°ï¼š

```py
def worker_func(params_queue: mp.Queue, rewards_queue: mp.Queue, 
                device: torch.device, noise_std: float): 
    env = make_env() 
    net = Net(env.observation_space.shape[0], env.action_space.shape[0]).to(device) 
    net.eval() 

    while True: 
        params = params_queue.get() 
        if params is None: 
            break 
        net.load_state_dict(params)
```

None çš„å€¼è¡¨ç¤ºä¸»æ§ç¨‹åºå¸Œæœ›åœæ­¢å·¥ä½œç¨‹åºã€‚

å…¶ä½™éƒ¨åˆ†å‡ ä¹ä¸å‰ä¸€ä¸ªç¤ºä¾‹ç›¸åŒï¼Œä¸»è¦çš„åŒºåˆ«åœ¨äºåœ¨å™ªå£°ç”Ÿæˆä¹‹å‰ç”Ÿæˆå¹¶åˆ†é…çš„éšæœºç§å­ã€‚è¿™ä½¿å¾—ä¸»æ§ç¨‹åºèƒ½å¤Ÿé‡æ–°ç”Ÿæˆç›¸åŒçš„å™ªå£°ï¼Œåªæ˜¯ä»ç§å­å¼€å§‹ï¼š

```py
 for _ in range(ITERS_PER_UPDATE): 
            seed = np.random.randint(low=0, high=65535) 
            np.random.seed(seed) 
            noise, neg_noise = common.sample_noise(net, device=device) 
            pos_reward, pos_steps = common.eval_with_noise(env, net, noise, noise_std, 
                get_max_action=False, device=device) 
            neg_reward, neg_steps = common.eval_with_noise(env, net, neg_noise, noise_std, 
                get_max_action=False, device=device) 
            rewards_queue.put(RewardsItem(seed=seed, pos_reward=pos_reward, 
                neg_reward=neg_reward, steps=pos_steps+neg_steps))
```

å¦ä¸€ä¸ªåŒºåˆ«åœ¨äºä¸»æ§ç¨‹åºæ‰§è¡Œè®­ç»ƒæ­¥éª¤æ—¶ä½¿ç”¨çš„å‡½æ•°ï¼š

```py
def train_step(optimizer: optim.Optimizer, net: Net, batch_noise: tt.List[common.TNoise], 
               batch_reward: tt.List[float], writer: SummaryWriter, step_idx: int, 
               noise_std: float): 
    weighted_noise = None 
    norm_reward = compute_centered_ranks(np.array(batch_reward))
```

åœ¨ CartPole ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å‡å»å‡å€¼å¹¶é™¤ä»¥æ ‡å‡†å·®å¯¹å¥–åŠ±æ‰¹æ¬¡è¿›è¡Œäº†å½’ä¸€åŒ–ã€‚æ ¹æ® Salimans ç­‰äººçš„è¯´æ³•ï¼Œä½¿ç”¨ç§©è€Œéå®é™…å¥–åŠ±å¯ä»¥è·å¾—æ›´å¥½çš„ç»“æœã€‚ç”±äº ES å¯¹é€‚åº”åº¦å‡½æ•°ï¼ˆåœ¨æˆ‘ä»¬çš„æ¡ˆä¾‹ä¸­å³ä¸ºå¥–åŠ±ï¼‰æ²¡æœ‰å‡è®¾ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å¥–åŠ±è¿›è¡Œä»»ä½•é‡æ–°æ’åˆ—ï¼Œè¿™åœ¨ DQN çš„æƒ…å†µä¸‹æ˜¯ä¸å¯è¡Œçš„ã€‚

åœ¨è¿™é‡Œï¼Œæ•°ç»„çš„ç§©å˜æ¢æ„å‘³ç€ç”¨æ’åºæ•°ç»„çš„ç´¢å¼•æ›¿æ¢åŸæ•°ç»„ã€‚ä¾‹å¦‚ï¼Œæ•°ç»„ [0.1, 10, 0.5] å°†å˜ä¸ºç§©æ•°ç»„ [0, 2, 1]ã€‚`compute_centered_ranks` å‡½æ•°æ¥å—ä¸€ä¸ªåŒ…å«æ‰¹æ¬¡æ€»å¥–åŠ±çš„æ•°ç»„ï¼Œè®¡ç®—æ•°ç»„ä¸­æ¯ä¸ªé¡¹ç›®çš„ç§©ï¼Œç„¶åå¯¹è¿™äº›ç§©è¿›è¡Œå½’ä¸€åŒ–ã€‚ä¾‹å¦‚ï¼Œè¾“å…¥æ•°ç»„ [21.0, 5.8, 7.0] å°†å¾—åˆ°ç§© [2, 0, 1]ï¼Œæœ€ç»ˆçš„å±…ä¸­ç§©å°†æ˜¯ [0.5, -0.5, 0.0]ã€‚

è®­ç»ƒå‡½æ•°çš„å¦ä¸€ä¸ªä¸»è¦åŒºåˆ«æ˜¯ä½¿ç”¨äº† PyTorch ä¼˜åŒ–å™¨ï¼š

```py
 for noise, reward in zip(batch_noise, norm_reward): 
        if weighted_noise is None: 
            weighted_noise = [reward * p_n for p_n in noise] 
        else: 
            for w_n, p_n in zip(weighted_noise, noise): 
                w_n += reward * p_n 
    m_updates = [] 
    optimizer.zero_grad() 
    for p, p_update in zip(net.parameters(), weighted_noise): 
        update = p_update / (len(batch_reward) * noise_std) 
        p.grad = -update 
        m_updates.append(torch.norm(update)) 
    writer.add_scalar("update_l2", np.mean(m_updates), step_idx) 
    optimizer.step()
```

ä¸ºäº†ç†è§£ä¸ºä»€ä¹ˆä½¿ç”¨è¿™äº›æ–¹æ³•ä»¥åŠå¦‚ä½•åœ¨ä¸è¿›è¡Œåå‘ä¼ æ’­çš„æƒ…å†µä¸‹å®ç°è¿™ä¸€ç‚¹ï¼Œå¿…é¡»åšä¸€äº›è§£é‡Šã€‚

é¦–å…ˆï¼ŒSalimans ç­‰äººè¡¨æ˜ï¼ŒES ç®—æ³•ä½¿ç”¨çš„ä¼˜åŒ–æ–¹æ³•ä¸æ¢¯åº¦ä¸Šå‡æ³•éå¸¸ç›¸ä¼¼ï¼ŒåŒºåˆ«åœ¨äºæ¢¯åº¦çš„è®¡ç®—æ–¹å¼ã€‚é€šå¸¸åº”ç”¨éšæœºæ¢¯åº¦ä¸‹é™ï¼ˆSGDï¼‰æ–¹æ³•æ—¶ï¼Œæ¢¯åº¦æ˜¯é€šè¿‡è®¡ç®—ç½‘ç»œå‚æ•°å…³äºæŸå¤±å€¼çš„å¯¼æ•°ä»æŸå¤±å‡½æ•°ä¸­è·å¾—çš„ã€‚è¿™è¦æ±‚ç½‘ç»œå’ŒæŸå¤±å‡½æ•°æ˜¯å¯å¾®çš„ï¼Œä½†è¿™å¹¶éæ€»æ˜¯æˆç«‹ï¼›ä¾‹å¦‚ï¼ŒES æ–¹æ³•æ‰§è¡Œçš„ç§©å˜æ¢æ˜¯ä¸å¯å¾®çš„ã€‚

å¦ä¸€æ–¹é¢ï¼ŒES æ‰§è¡Œçš„ä¼˜åŒ–è¿‡ç¨‹åˆ™æœ‰æ‰€ä¸åŒã€‚æˆ‘ä»¬é€šè¿‡å‘å½“å‰å‚æ•°æ·»åŠ å™ªå£°å¹¶è®¡ç®—é€‚åº”åº¦å‡½æ•°ï¼Œéšæœºé‡‡æ ·å‘¨å›´çš„é‚»åŸŸã€‚æ ¹æ®é€‚åº”åº¦å‡½æ•°çš„å˜åŒ–ï¼Œæˆ‘ä»¬è°ƒæ•´å‚æ•°ï¼Œæ¨åŠ¨å‚æ•°æœç€æ›´é«˜çš„é€‚åº”åº¦å‡½æ•°æ–¹å‘å‰è¿›ã€‚å…¶ç»“æœä¸åŸºäºæ¢¯åº¦çš„æ–¹æ³•éå¸¸ç›¸ä¼¼ï¼Œä½†å¯¹é€‚åº”åº¦å‡½æ•°çš„è¦æ±‚è¦å®½æ¾å¾—å¤šï¼šå”¯ä¸€çš„è¦æ±‚æ˜¯èƒ½å¤Ÿè®¡ç®—å®ƒã€‚

ç„¶è€Œï¼Œå¦‚æœæˆ‘ä»¬é€šè¿‡éšæœºé‡‡æ ·é€‚åº”åº¦å‡½æ•°æ¥ä¼°è®¡æŸç§æ¢¯åº¦ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ PyTorch ä¸­çš„æ ‡å‡†ä¼˜åŒ–å™¨ã€‚é€šå¸¸ï¼Œä¼˜åŒ–å™¨ä½¿ç”¨ç§¯ç´¯åœ¨å‚æ•° `grad` å­—æ®µä¸­çš„æ¢¯åº¦æ¥è°ƒæ•´ç½‘ç»œçš„å‚æ•°ã€‚

è¿™äº›æ¢¯åº¦åœ¨åå‘ä¼ æ’­æ­¥éª¤åè¢«ç§¯ç´¯ï¼Œä½†ç”±äº PyTorch çš„çµæ´»æ€§ï¼Œä¼˜åŒ–å™¨ä¸å…³å¿ƒæ¢¯åº¦çš„æ¥æºã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åšçš„å”¯ä¸€äº‹æƒ…å°±æ˜¯å°†ä¼°è®¡çš„å‚æ•°æ›´æ–°å¤åˆ¶åˆ° `grad` å­—æ®µï¼Œå¹¶è¦æ±‚ä¼˜åŒ–å™¨æ›´æ–°å®ƒä»¬ã€‚è¯·æ³¨æ„ï¼Œæ›´æ–°æ˜¯å¸¦æœ‰è´Ÿå·çš„ï¼Œå› ä¸ºä¼˜åŒ–å™¨é€šå¸¸æ‰§è¡Œæ¢¯åº¦ä¸‹é™ï¼ˆå¦‚åŒæ­£å¸¸æ“ä½œä¸­æˆ‘ä»¬æœ€å°åŒ–æŸå¤±å‡½æ•°ä¸€æ ·ï¼‰ï¼Œä½†åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›æ‰§è¡Œæ¢¯åº¦ä¸Šå‡ã€‚è¿™ä¸æˆ‘ä»¬åœ¨ç¬¬åäºŒç« ä¸­æ¶‰åŠçš„æ¼”å‘˜-è¯„è®ºå‘˜æ–¹æ³•éå¸¸ç›¸ä¼¼ï¼Œå…¶ä¸­ä¼°è®¡çš„ç­–ç•¥æ¢¯åº¦å¸¦æœ‰è´Ÿå·ï¼Œå› ä¸ºå®ƒæ˜¾ç¤ºäº†æ”¹è¿›ç­–ç•¥çš„æ–¹å‘ã€‚ä»£ç ä¸­çš„æœ€åä¸€éƒ¨åˆ†å·®å¼‚æ¥è‡ªä¸»è¿›ç¨‹æ‰§è¡Œçš„è®­ç»ƒå¾ªç¯ã€‚å®ƒçš„èŒè´£æ˜¯ç­‰å¾…æ¥è‡ªå·¥ä½œè¿›ç¨‹çš„æ•°æ®ï¼Œæ‰§è¡Œå‚æ•°çš„è®­ç»ƒæ›´æ–°ï¼Œå¹¶å°†ç»“æœå¹¿æ’­åˆ°å·¥ä½œè¿›ç¨‹ã€‚ä¸»è¿›ç¨‹å’Œå·¥ä½œè¿›ç¨‹ä¹‹é—´çš„é€šä¿¡é€šè¿‡ä¸¤ç»„é˜Ÿåˆ—æ¥å®Œæˆã€‚ç¬¬ä¸€ç»„é˜Ÿåˆ—æ˜¯æ¯ä¸ªå·¥ä½œè¿›ç¨‹çš„é˜Ÿåˆ—ï¼Œç”¨äºä¸»è¿›ç¨‹å‘é€å½“å‰ä½¿ç”¨çš„ç­–ç•¥å‚æ•°ã€‚ç¬¬äºŒç»„é˜Ÿåˆ—æ˜¯ç”±å·¥ä½œè¿›ç¨‹å…±äº«çš„ï¼Œç”¨äºå‘é€å·²ç»æåˆ°çš„ `RewardItem` ç»“æ„ï¼Œå…¶ä¸­åŒ…å«éšæœºç§å­å’Œå¥–åŠ±ï¼š

```py
 params_queues = [mp.Queue(maxsize=1) for _ in range(PROCESSES_COUNT)] 
    rewards_queue = mp.Queue(maxsize=ITERS_PER_UPDATE) 
    workers = [] 

    for params_queue in params_queues: 
        p_args = (params_queue, rewards_queue, device, args.noise_std) 
        proc = mp.Process(target=worker_func, args=p_args) 
        proc.start() 
        workers.append(proc) 

    print("All started!") 
    optimizer = optim.Adam(net.parameters(), lr=args.lr)
```

åœ¨ä¸»è¿›ç¨‹å¼€å§‹æ—¶ï¼Œæˆ‘ä»¬åˆ›å»ºæ‰€æœ‰é˜Ÿåˆ—ï¼Œå¯åŠ¨å·¥ä½œè¿›ç¨‹ï¼Œå¹¶åˆ›å»ºä¼˜åŒ–å™¨ã€‚

æ¯æ¬¡è®­ç»ƒè¿­ä»£å¼€å§‹æ—¶ï¼Œç½‘ç»œå‚æ•°ä¼šå¹¿æ’­åˆ°å·¥ä½œè¿›ç¨‹ï¼š

```py
 for step_idx in range(args.iters): 
        params = net.state_dict() 
        for q in params_queues: 
            q.put(params)
```

ç„¶åï¼Œåœ¨å¾ªç¯ä¸­ï¼Œä¸»è¿›ç¨‹ç­‰å¾…ä»å·¥ä½œè¿›ç¨‹è·å–è¶³å¤Ÿçš„æ•°æ®ï¼š

```py
 t_start = time.time() 
        batch_noise = [] 
        batch_reward = [] 
        results = 0 
        batch_steps = 0 
        while True: 
            while not rewards_queue.empty(): 
                reward = rewards_queue.get_nowait() 
                np.random.seed(reward.seed) 
                noise, neg_noise = common.sample_noise(net) 
                batch_noise.append(noise) 
                batch_reward.append(reward.pos_reward) 
                batch_noise.append(neg_noise) 
                batch_reward.append(reward.neg_reward) 
                results += 1 
                batch_steps += reward.steps 

            if results == PROCESSES_COUNT * ITERS_PER_UPDATE: 
                break 
            time.sleep(0.01)
```

æ¯å½“æ–°ç»“æœåˆ°è¾¾æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨éšæœºç§å­é‡æ–°ç”Ÿæˆå™ªå£°ã€‚

ä½œä¸ºè®­ç»ƒå¾ªç¯çš„æœ€åä¸€æ­¥ï¼Œæˆ‘ä»¬è°ƒç”¨ `train_step()` å‡½æ•°ï¼š

```py
 train_step(optimizer, net, batch_noise, batch_reward, 
                   writer, step_idx, args.noise_std)
```

ä½ å·²ç»è§è¿‡è¿™ä¸ªå‡½æ•°ï¼Œå®ƒè®¡ç®—æ¥è‡ªå™ªå£°å’Œå¥–åŠ±çš„æ›´æ–°ï¼Œå¹¶è°ƒç”¨ä¼˜åŒ–å™¨è°ƒæ•´æƒé‡ã€‚

## HalfCheetah ç»“æœ

è¯¥ä»£ç æ”¯æŒå¯é€‰çš„ `--dev` æ ‡å¿—ï¼Œä½†æ ¹æ®æˆ‘çš„å®éªŒï¼Œå¦‚æœå¯ç”¨äº† GPUï¼Œé€Ÿåº¦ä¼šå˜æ…¢ï¼šæ²¡æœ‰ GPU æ—¶ï¼Œå¹³å‡é€Ÿåº¦æ˜¯æ¯ç§’ 20-21k æ¬¡è§‚å¯Ÿï¼Œä½†å¯ç”¨ CUDA ååªæœ‰ 9kã€‚è¿™çœ‹èµ·æ¥å¯èƒ½æœ‰äº›åç›´è§‰ï¼Œä½†æˆ‘ä»¬å¯ä»¥ç”¨éå¸¸å°çš„ç½‘ç»œå’Œå•æ¬¡è§‚å¯Ÿçš„æ‰¹é‡å¤§å°æ¥è§£é‡Šè¿™ä¸€ç‚¹ã€‚å¯èƒ½é€šè¿‡å¢åŠ æ‰¹é‡å¤§å°æ¥å‡å°‘è¿™ä¸€å·®è·ï¼ˆç”šè‡³å¯èƒ½å®ç°åŠ é€Ÿï¼‰ï¼Œä½†è¿™ä¼šä½¿æˆ‘ä»¬çš„ä»£ç å˜å¾—æ›´åŠ å¤æ‚ã€‚

åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å±•ç¤ºå¹³å‡å¥–åŠ±ã€è®­ç»ƒé€Ÿåº¦ï¼ˆæ¯ç§’è§‚å¯Ÿæ¬¡æ•°ï¼‰ä»¥åŠä¸¤ä¸ªæ—¶é—´å€¼ï¼ˆæ˜¾ç¤ºæ”¶é›†æ•°æ®å’Œæ‰§è¡Œè®­ç»ƒæ­¥éª¤æ‰€èŠ±è´¹çš„æ—¶é—´ï¼‰ï¼š

```py
$ ./02_cheetah_es.py 
Net( 
Â Â (mu): Sequential( 
Â Â Â (0): Linear(in_features=17, out_features=64, bias=True) 
Â Â Â (1): Tanh() 
Â Â Â (2): Linear(in_features=64, out_features=6, bias=True) 
Â Â Â (3): Tanh() 
Â Â ) 
) 
All started! 
0: reward=-505.09, speed=17621.60 f/s, data_gather=6.792, train=0.018 
1: reward=-440.50, speed=20609.56 f/s, data_gather=5.815, train=0.007 
2: reward=-383.76, speed=20568.74 f/s, data_gather=5.827, train=0.007 
3: reward=-326.02, speed=20413.63 f/s, data_gather=5.871, train=0.007 
4: reward=-259.58, speed=20181.74 f/s, data_gather=5.939, train=0.007 
5: reward=-198.80, speed=20496.81 f/s, data_gather=5.848, train=0.007 
6: reward=-113.22, speed=20467.71 f/s, data_gather=5.856, train=0.007
```

è®­ç»ƒçš„åŠ¨æ€æ˜¾ç¤ºå‡ºå¼€å§‹æ—¶ç­–ç•¥çš„å¿«é€Ÿæ”¹è¿›ï¼šä»…åœ¨ 100 æ¬¡æ›´æ–°å†…ï¼Œè®­ç»ƒ 9 åˆ†é’Ÿï¼Œä»£ç†å°±èƒ½å¤Ÿè¾¾åˆ° 1,500-1,600 çš„åˆ†æ•°ã€‚30 åˆ†é’Ÿåï¼Œå³°å€¼å¥–åŠ±ä¸º 2,833ï¼›ä½†éšç€æ›´å¤šè®­ç»ƒï¼Œç­–ç•¥å¼€å§‹é€€åŒ–ã€‚

å¥–åŠ±çš„æœ€å¤§å€¼ã€å‡å€¼å’Œæ ‡å‡†å·®å¦‚å›¾ 17.3 å’Œå›¾ 17.4 æ‰€ç¤ºã€‚

![å›¾ç‰‡](img/B22150_17_03.png)

å›¾ 17.3ï¼šES åœ¨ HalfCheetah ä¸Šçš„æœ€å¤§å¥–åŠ±ï¼ˆå·¦ï¼‰å’Œç­–ç•¥æ›´æ–°ï¼ˆå³ï¼‰

![å›¾ç‰‡](img/B22150_17_04.png)

å›¾ 17.4ï¼šES åœ¨ HalfCheetah ä¸Šçš„å¥–åŠ±å‡å€¼ï¼ˆå·¦ï¼‰å’Œæ ‡å‡†å·®ï¼ˆå³ï¼‰

# é—ä¼ ç®—æ³•

å¦ä¸€ç±»æµè¡Œçš„é»‘ç®±æ–¹æ³•æ˜¯é—ä¼ ç®—æ³•ï¼ˆGAï¼‰ã€‚å®ƒæ˜¯ä¸€ä¸ªå†å²æ‚ ä¹…ã€æ‹¥æœ‰äºŒåå¤šå¹´å†å²çš„å¤§å‹ä¼˜åŒ–æ–¹æ³•å®¶æ—ï¼Œæ ¸å¿ƒæ€æƒ³ç®€å•ï¼Œå³ç”Ÿæˆä¸€ä¸ª N ä¸ªä¸ªä½“ï¼ˆå…·ä½“æ¨¡å‹å‚æ•°ï¼‰çš„äººå£ï¼Œæ¯ä¸ªä¸ªä½“éƒ½é€šè¿‡é€‚åº”åº¦å‡½æ•°è¿›è¡Œè¯„ä¼°ã€‚ç„¶åï¼Œéƒ¨åˆ†è¡¨ç°æœ€å¥½çš„ä¸ªä½“ç”¨äºç”Ÿæˆä¸‹ä¸€ä»£ç§ç¾¤ï¼ˆæ­¤è¿‡ç¨‹ç§°ä¸ºå˜å¼‚ï¼‰ã€‚è¿™ä¸€è¿‡ç¨‹ä¼šä¸€ç›´é‡å¤ï¼Œç›´åˆ°æˆ‘ä»¬å¯¹ç§ç¾¤çš„è¡¨ç°æ„Ÿåˆ°æ»¡æ„ä¸ºæ­¢ã€‚

é—ä¼ ç®—æ³•ï¼ˆGAï¼‰å®¶æ—ä¸­æœ‰è®¸å¤šä¸åŒçš„æ–¹æ³•ï¼Œä¾‹å¦‚ï¼Œå¦‚ä½•æ‰§è¡Œä¸ªä½“çš„å˜å¼‚ä»¥ç”Ÿæˆä¸‹ä¸€ä»£ï¼Œæˆ–è€…å¦‚ä½•å¯¹è¡¨ç°è€…è¿›è¡Œæ’åã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†è€ƒè™‘ä¸€äº›æ‰©å±•çš„ç®€å• GA æ–¹æ³•ï¼Œæœ€æ—©ç”± Such ç­‰äººå‘å¸ƒï¼Œåä¸ºâ€œæ·±åº¦ç¥ç»è¿›åŒ–ï¼šé—ä¼ ç®—æ³•æ˜¯è®­ç»ƒæ·±åº¦ç¥ç»ç½‘ç»œè¿›è¡Œå¼ºåŒ–å­¦ä¹ çš„æœ‰åŠ›ç«äº‰è€…â€[Suc+17]ã€‚

åœ¨æœ¬æ–‡ä¸­ï¼Œä½œè€…åˆ†æäº†ç®€å•çš„ GA æ–¹æ³•ï¼Œè¯¥æ–¹æ³•é€šè¿‡å¯¹çˆ¶ä»£æƒé‡æ–½åŠ é«˜æ–¯å™ªå£°æ‰°åŠ¨æ¥æ‰§è¡Œå˜å¼‚ã€‚åœ¨æ¯æ¬¡è¿­ä»£ä¸­ï¼Œè¡¨ç°æœ€å¥½çš„ä¸ªä½“ä¼šè¢«å¤åˆ¶ä¸”ä¸åšä¿®æ”¹ã€‚ç®€å• GA æ–¹æ³•çš„æ­¥éª¤å¯ä»¥ç”¨ç®—æ³•å½¢å¼å†™æˆå¦‚ä¸‹ï¼š

1.  åˆå§‹åŒ–å˜å¼‚å¼ºåº¦ Ïƒã€ç§ç¾¤å¤§å° Nã€é€‰æ‹©ä¸ªä½“çš„æ•°é‡ T å’Œåˆå§‹ç§ç¾¤ Pâ°ï¼Œå…¶ä¸­ Pâ° æ˜¯éšæœºåˆå§‹åŒ–çš„ N ä¸ªç­–ç•¥åŠå…¶é€‚åº”åº¦ï¼šFâ° = {F(P[i]â°)|i = 1â€¦N}

1.  å¯¹äºä»£æ•° g = 1â€¦Gï¼š

    1.  æŒ‰ç…§é€‚åº”åº¦å‡½æ•°å€¼ F^(gâˆ’1) çš„é™åºå¯¹ä¸Šä¸€ä»£ P^(nâˆ’1) è¿›è¡Œæ’åº

    1.  å¤åˆ¶ç²¾è‹± P[1]^g = P[1]^(gâˆ’1)ï¼ŒF[1]^g = F[1]^(gâˆ’1)

    1.  å¯¹äºä¸ªä½“ i = 2â€¦Nï¼š

        1.  é€‰æ‹© kï¼šä» 1â€¦T ä¸­éšæœºé€‰æ‹©çˆ¶ä»£

        1.  é‡‡æ · ğœ– âˆ¼ğ’©(0,I)

        1.  å˜å¼‚çˆ¶ä»£ï¼šP[i]^g = P[i]^(gâˆ’1) + Ïƒğœ–

        1.  è·å–å…¶é€‚åº”åº¦ï¼šF[i]^g = F(P[i]^g)

æ¥è‡ªæ–‡çŒ®[2]çš„åŸºç¡€æ–¹æ³•å·²æœ‰å¤šä¸ªæ”¹è¿›ï¼Œæˆ‘ä»¬å°†åœ¨åæ–‡è®¨è®ºã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹æ ¸å¿ƒç®—æ³•çš„å®ç°ã€‚

## CartPole ä¸Šçš„ GA

æºä»£ç ä½äº Chapter17/03_cartpole_ga.pyï¼Œä¸æˆ‘ä»¬çš„ ES ç¤ºä¾‹æœ‰å¾ˆå¤šç›¸ä¼¼ä¹‹å¤„ã€‚ä¸åŒä¹‹å¤„åœ¨äºç¼ºå°‘æ¢¯åº¦ä¸Šå‡ä»£ç ï¼Œè€Œæ˜¯ç”¨ç½‘ç»œå˜å¼‚å‡½æ•°ä»£æ›¿ï¼š

```py
def mutate_parent(net: Net) -> Net: 
    new_net = copy.deepcopy(net) 
    for p in new_net.parameters(): 
        noise = np.random.normal(size=p.data.size()) 
        noise_t = torch.FloatTensor(noise) 
        p.data += NOISE_STD * noise_t 
    return new_net
```

è¯¥å‡½æ•°çš„ç›®æ ‡æ˜¯é€šè¿‡å‘æ‰€æœ‰æƒé‡æ·»åŠ éšæœºå™ªå£°ï¼Œåˆ›å»ºç»™å®šç­–ç•¥çš„å˜å¼‚å‰¯æœ¬ã€‚çˆ¶ä»£çš„æƒé‡ä¿æŒä¸å˜ï¼Œå› ä¸ºçˆ¶ä»£æ˜¯é€šè¿‡æ›¿æ¢æ–¹å¼éšæœºé€‰æ‹©çš„ï¼Œå› æ­¤è¯¥ç½‘ç»œç¨åå¯èƒ½ä¼šå†æ¬¡ä½¿ç”¨ã€‚

è¶…å‚æ•°çš„æ•°é‡ç”šè‡³æ¯” ES æ–¹æ³•è¿˜è¦å°‘ï¼ŒåŒ…æ‹¬å˜å¼‚æ—¶æ·»åŠ å™ªå£°çš„æ ‡å‡†å·®ã€ç§ç¾¤å¤§å°å’Œç”¨äºç”Ÿæˆåç»­ä¸–ä»£çš„é¡¶çº§è¡¨ç°è€…æ•°é‡ï¼š

```py
NOISE_STD = 0.01 
POPULATION_SIZE = 50 
PARENTS_COUNT = 10
```

åœ¨è®­ç»ƒå¾ªç¯ä¹‹å‰ï¼Œæˆ‘ä»¬åˆ›å»ºéšæœºåˆå§‹åŒ–çš„ç½‘ç»œç§ç¾¤ï¼Œå¹¶è·å–å®ƒä»¬çš„é€‚åº”åº¦ï¼š

```py
if __name__ == "__main__": 
    env = gym.make("CartPole-v1") 
    writer = SummaryWriter(comment="-cartpole-ga") 

    gen_idx = 0 
    nets = [ 
        Net(env.observation_space.shape[0], env.action_space.n) 
        for _ in range(POPULATION_SIZE) 
    ] 
    population = [ 
        (net, common.evaluate(env, net)) 
        for net in nets 
    ]
```

åœ¨æ¯ä¸€ä»£å¼€å§‹æ—¶ï¼Œæˆ‘ä»¬æ ¹æ®ä¸Šä¸€ä»£çš„é€‚åº”åº¦å¯¹å…¶è¿›è¡Œæ’åºï¼Œå¹¶è®°å½•å…³äºæœªæ¥çˆ¶ä»£çš„ç»Ÿè®¡æ•°æ®ï¼š

```py
 while True: 
        population.sort(key=lambda p: p[1], reverse=True) 
        rewards = [p[1] for p in population[:PARENTS_COUNT]] 
        reward_mean = np.mean(rewards) 
        reward_max = np.max(rewards) 
        reward_std = np.std(rewards) 

        writer.add_scalar("reward_mean", reward_mean, gen_idx) 
        writer.add_scalar("reward_std", reward_std, gen_idx) 
        writer.add_scalar("reward_max", reward_max, gen_idx) 
        print("%d: reward_mean=%.2f, reward_max=%.2f, reward_std=%.2f" % ( 
            gen_idx, reward_mean, reward_max, reward_std)) 
        if reward_mean > 199: 
            print("Solved in %d steps" % gen_idx) 
            break
```

åœ¨ä¸€ä¸ªå•ç‹¬çš„å¾ªç¯ä¸­ï¼Œæˆ‘ä»¬éšæœºé€‰å–ä¸€ä¸ªçˆ¶ä»£ï¼Œè¿›è¡Œå˜å¼‚ï¼Œå¹¶è¯„ä¼°å…¶é€‚åº”åº¦å¾—åˆ†ï¼š

```py
 prev_population = population 
        population = [population[0]] 
        for _ in range(POPULATION_SIZE-1): 
            parent_idx = np.random.randint(0, PARENTS_COUNT) 
            parent = prev_population[parent_idx][0] 
            net = mutate_parent(parent) 
            fitness = common.evaluate(env, net) 
            population.append((net, fitness)) 
        gen_idx += 1
```

å¯åŠ¨å®ç°åï¼Œä½ åº”è¯¥èƒ½çœ‹åˆ°å¦‚ä¸‹å†…å®¹ï¼ˆå…·ä½“è¾“å‡ºå’Œæ­¥éª¤æ•°å¯èƒ½å› æ‰§è¡Œä¸­çš„éšæœºæ€§è€Œæœ‰æ‰€ä¸åŒï¼‰ï¼š

```py
Chapter17$ ./03_cartpole_ga.py 
0: reward_mean=29.50, reward_max=109.00, reward_std=27.86 
1: reward_mean=65.50, reward_max=111.00, reward_std=27.61 
2: reward_mean=149.10, reward_max=305.00, reward_std=57.76 
3: reward_mean=175.00, reward_max=305.00, reward_std=47.35 
4: reward_mean=200.50, reward_max=305.00, reward_std=39.98 
Solved in 4 steps
```

å¦‚ä½ æ‰€è§ï¼ŒGA æ–¹æ³•æ¯” ES æ–¹æ³•æ›´é«˜æ•ˆã€‚

## GA æ”¹è¿›

Such ç­‰äººæå‡ºäº†å¯¹åŸºæœ¬ GA ç®—æ³•çš„ä¸¤é¡¹æ”¹è¿›ï¼š

+   ç¬¬ä¸€ä¸ªæ–¹æ³•ï¼Œåä¸ºæ·±åº¦ GAï¼Œæ—¨åœ¨æé«˜å®ç°çš„å¯æ‰©å±•æ€§ã€‚æˆ‘ä»¬å°†åœ¨åé¢çš„ GA on HalfCheetah éƒ¨åˆ†å®ç°è¿™ä¸€ç‚¹ã€‚

+   ç¬¬äºŒä¸ªæ–¹æ³•ï¼Œå«åšæ–°é¢–æ€§æœç´¢ï¼Œæ˜¯å°è¯•ç”¨ä¸åŒçš„æŒ‡æ ‡æ›¿ä»£å¥–åŠ±ç›®æ ‡ã€‚æˆ‘ä»¬å°†è¿™ä¸€éƒ¨åˆ†ç•™ç»™ä½ ä½œä¸ºä¸€ä¸ªç»ƒä¹ æ¥å°è¯•ã€‚

åœ¨æ¥ä¸‹æ¥çš„ GA on HalfCheetah éƒ¨åˆ†ä½¿ç”¨çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†å®ç°ç¬¬ä¸€ä¸ªæ”¹è¿›ï¼Œè€Œç¬¬äºŒä¸ªæ”¹è¿›åˆ™ä½œä¸ºä¸€ä¸ªå¯é€‰ç»ƒä¹ ã€‚

### æ·±åº¦ GA

ä½œä¸ºä¸€ç§æ— æ¢¯åº¦æ–¹æ³•ï¼ŒGA åœ¨é€Ÿåº¦ä¸Šå¯èƒ½æ¯” ES æ–¹æ³•æ›´å…·å¯æ‰©å±•æ€§ï¼Œå› ä¸ºä¼˜åŒ–è¿‡ç¨‹æ¶‰åŠæ›´å¤šçš„ CPUã€‚ç„¶è€Œï¼Œä½ çœ‹åˆ°çš„ç®€å• GA ç®—æ³•åœ¨ä¸ ES æ–¹æ³•ç›¸ä¼¼çš„ç“¶é¢ˆä¸Šä¹Ÿå­˜åœ¨é—®é¢˜ï¼šç­–ç•¥å‚æ•°å¿…é¡»åœ¨å·¥ä½œè€…ä¹‹é—´äº¤æ¢ã€‚Such ç­‰äººï¼ˆä½œè€…ï¼‰æå‡ºäº†ä¸€ä¸ªç±»ä¼¼äºå…±äº«ç§å­æ–¹æ³•çš„æŠ€å·§ï¼Œä½†ä»–ä»¬å°†å…¶æ¨å‘äº†æé™ï¼ˆå› ä¸ºæˆ‘ä»¬ä½¿ç”¨ç§å­æ¥è·Ÿè¸ªæˆåƒä¸Šä¸‡çš„å˜å¼‚ï¼‰ã€‚ä»–ä»¬ç§°ä¹‹ä¸ºæ·±åº¦ GAï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œç­–ç•¥å‚æ•°è¢«è¡¨ç¤ºä¸ºä¸€ç»„éšæœºç§å­çš„åˆ—è¡¨ï¼Œè¿™äº›ç§å­ç”¨äºåˆ›å»ºè¯¥ç­–ç•¥çš„æƒé‡ã€‚

äº‹å®ä¸Šï¼Œåˆå§‹ç½‘ç»œçš„æƒé‡æ˜¯åœ¨ç¬¬ä¸€æ¬¡ç§ç¾¤ä¸­éšæœºç”Ÿæˆçš„ï¼Œå› æ­¤åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªç§å­å®šä¹‰äº†è¿™ç§åˆå§‹åŒ–ã€‚åœ¨æ¯ä¸€ä»£ç§ç¾¤ä¸­ï¼Œå˜å¼‚ä¹Ÿå®Œå…¨ç”±æ¯ä¸ªå˜å¼‚çš„éšæœºç§å­æ¥æŒ‡å®šã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦é‡æ„æƒé‡çš„å”¯ä¸€ä¿¡æ¯å°±æ˜¯è¿™äº›ç§å­æœ¬èº«ã€‚åœ¨è¿™ç§æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ¯ä¸ªå·¥ä½œè€…ä¸Šé‡æ„æƒé‡ï¼Œä½†é€šå¸¸ï¼Œè¿™ç§å¼€é”€è¿œå°äºåœ¨ç½‘ç»œä¸­ä¼ è¾“å®Œæ•´æƒé‡çš„å¼€é”€ã€‚

### æ–°é¢–æ€§æœç´¢

åŸºæœ¬é—ä¼ ç®—æ³•ï¼ˆGAï¼‰æ–¹æ³•çš„å¦ä¸€ä¸ªä¿®æ”¹æ˜¯æ–°é¢–æ€§æœç´¢ï¼ˆNSï¼‰ï¼Œè¿™æ˜¯ Lehman å’Œ Stanley åœ¨ä»–ä»¬çš„è®ºæ–‡ã€Šæ”¾å¼ƒç›®æ ‡ï¼šä»…é€šè¿‡å¯»æ‰¾æ–°é¢–æ€§è¿›è¡Œè¿›åŒ–ã€‹ï¼ˆAbandoning objectives: Evolution through the search for novelty aloneï¼‰ä¸­æå‡ºçš„ï¼Œè¯¥è®ºæ–‡äº 2011 å¹´å‘å¸ƒ[LS11]ã€‚

NS çš„æ€æƒ³æ˜¯æ”¹å˜æˆ‘ä»¬ä¼˜åŒ–è¿‡ç¨‹ä¸­çš„ç›®æ ‡ã€‚æˆ‘ä»¬ä¸å†è¯•å›¾å¢åŠ æ¥è‡ªç¯å¢ƒçš„æ€»å¥–åŠ±ï¼Œè€Œæ˜¯å¥–åŠ±ä»£ç†æ¢ç´¢å®ƒä»¥å‰ä»æœªæ£€æŸ¥è¿‡çš„è¡Œä¸ºï¼ˆå³æ–°é¢–çš„è¡Œä¸ºï¼‰ã€‚æ ¹æ®ä½œè€…åœ¨è¿·å®«å¯¼èˆªé—®é¢˜ä¸­çš„å®éªŒï¼Œè¿·å®«ä¸­æœ‰è®¸å¤šé™·é˜±ï¼ŒNS æ¯”å…¶ä»–åŸºäºå¥–åŠ±çš„ç®—æ³•è¡¨ç°å¾—æ›´å¥½ã€‚

ä¸ºäº†å®ç°æ–°é¢–æ€§æœç´¢ï¼ˆNSï¼‰ï¼Œæˆ‘ä»¬å®šä¹‰äº†æ‰€è°“çš„è¡Œä¸ºç‰¹å¾ï¼ˆBCï¼‰ï¼ˆÏ€ï¼‰ï¼Œå®ƒæè¿°äº†ç­–ç•¥çš„è¡Œä¸ºå’Œä¸¤ä¸ª BC ä¹‹é—´çš„è·ç¦»ã€‚ç„¶åï¼Œä½¿ç”¨ k è¿‘é‚»æ–¹æ³•æ£€æŸ¥æ–°ç­–ç•¥çš„æ–°é¢–æ€§ï¼Œå¹¶æ ¹æ®è¿™ä¸ªè·ç¦»é©±åŠ¨é—ä¼ ç®—æ³•ã€‚åœ¨ Such ç­‰äººçš„è®ºæ–‡ä¸­ï¼Œä»£ç†çš„å……åˆ†æ¢ç´¢æ˜¯å¿…éœ€çš„ã€‚NS æ–¹æ³•æ˜¾è‘—ä¼˜äºè¿›åŒ–ç­–ç•¥ï¼ˆESï¼‰ã€é—ä¼ ç®—æ³•ï¼ˆGAï¼‰å’Œå…¶ä»–æ›´ä¼ ç»Ÿçš„å¼ºåŒ–å­¦ä¹ ï¼ˆRLï¼‰æ–¹æ³•ã€‚

## åŠçŒè±¹ä¸Šçš„é—ä¼ ç®—æ³•ï¼ˆGAï¼‰

åœ¨æœ¬ç« çš„æœ€åä¸€ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨åŠçŒè±¹ç¯å¢ƒä¸­å®ç°å¹¶è¡ŒåŒ–æ·±åº¦é—ä¼ ç®—æ³•ï¼ˆGAï¼‰ã€‚å®Œæ•´ä»£ç è§ 04_cheetah_ga.pyã€‚æ¶æ„ä¸å¹¶è¡Œè¿›åŒ–ç­–ç•¥ï¼ˆESï¼‰ç‰ˆæœ¬éå¸¸ç›¸ä¼¼ï¼Œæœ‰ä¸€ä¸ªä¸»è¿›ç¨‹å’Œå¤šä¸ªå·¥ä½œè¿›ç¨‹ã€‚æ¯ä¸ªå·¥ä½œè¿›ç¨‹çš„ç›®æ ‡æ˜¯è¯„ä¼°ä¸€æ‰¹ç½‘ç»œå¹¶å°†ç»“æœè¿”å›ç»™ä¸»è¿›ç¨‹ï¼Œä¸»è¿›ç¨‹å°†éƒ¨åˆ†ç»“æœåˆå¹¶æˆå®Œæ•´çš„ç§ç¾¤ï¼Œå¹¶æ ¹æ®è·å¾—çš„å¥–åŠ±å¯¹ä¸ªä½“è¿›è¡Œæ’åºï¼Œç”Ÿæˆä¸‹ä¸€ä¸ªå¾…è¯„ä¼°çš„ç§ç¾¤ã€‚

æ¯ä¸ªä¸ªä½“ç”±ä¸€ä¸ªéšæœºç§å­åˆ—è¡¨ç¼–ç ï¼Œç”¨äºåˆå§‹åŒ–åˆå§‹ç½‘ç»œæƒé‡å’Œæ‰€æœ‰åç»­å˜å¼‚ã€‚è¿™ç§è¡¨ç¤ºæ–¹å¼å…è®¸éå¸¸ç´§å‡‘åœ°ç¼–ç ç½‘ç»œï¼Œå³ä½¿åœ¨ç­–ç•¥ä¸­å‚æ•°æ•°é‡ä¸å¤šçš„æƒ…å†µä¸‹ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä¾‹å¦‚ï¼Œåœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ªåŒ…å« 64 ä¸ªç¥ç»å…ƒçš„éšè—å±‚çš„ç½‘ç»œä¸­ï¼Œæˆ‘ä»¬æœ‰ 1542 ä¸ªæµ®åŠ¨å€¼ï¼ˆè¾“å…¥ä¸º 17 ä¸ªå€¼ï¼ŒåŠ¨ä½œä¸º 6 ä¸ªæµ®åŠ¨å€¼ï¼Œå› æ­¤ 17 Ã— 64 + 64 + 64 Ã— 6 + 6 = 1542ï¼‰ã€‚æ¯ä¸ªæµ®åŠ¨å€¼å ç”¨ 4 ä¸ªå­—èŠ‚ï¼Œè¿™ä¸éšæœºç§å­ä½¿ç”¨çš„å¤§å°ç›¸åŒã€‚å› æ­¤ï¼Œè®ºæ–‡æå‡ºçš„æ·±åº¦é—ä¼ ç®—æ³•è¡¨ç¤ºæ–¹å¼å°†ä½¿ä¼˜åŒ–è¿‡ç¨‹ä¸­çš„ç§ç¾¤è§„æ¨¡æœ€å¤šç¼©å°åˆ° 1542 ä»£ã€‚

### å®ç°

åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨æœ¬åœ° CPU ä¸Šè¿›è¡Œå¹¶è¡ŒåŒ–å¤„ç†ï¼Œå› æ­¤æ•°æ®æ¥å›ä¼ è¾“çš„æ•°é‡å¹¶ä¸å¤ªé‡è¦ï¼›ç„¶è€Œï¼Œå¦‚æœä½ æœ‰å‡ ç™¾ä¸ªæ ¸å¿ƒå¯ç”¨ï¼Œé‚£ä¹ˆè¿™ç§è¡¨ç¤ºæ–¹å¼å¯èƒ½ä¼šæˆä¸ºä¸€ä¸ªæ˜¾è‘—çš„é—®é¢˜ã€‚

è¶…å‚æ•°é›†ä¸ CartPole ç¤ºä¾‹ç›¸åŒï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯ç§ç¾¤è§„æ¨¡è¾ƒå¤§ï¼š

```py
NOISE_STD = 0.01 
POPULATION_SIZE = 2000 
PARENTS_COUNT = 10 
WORKERS_COUNT = 6 
SEEDS_PER_WORKER = POPULATION_SIZE // WORKERS_COUNT 
MAX_SEED = 2**32 - 1
```

æœ‰ä¸¤ä¸ªå‡½æ•°ç”¨äºæ ¹æ®ç»™å®šçš„ç§å­æ„å»ºç½‘ç»œã€‚ç¬¬ä¸€ä¸ªå‡½æ•°å¯¹å·²ç»åˆ›å»ºçš„ç­–ç•¥ç½‘ç»œæ‰§è¡Œä¸€æ¬¡å˜å¼‚æ“ä½œï¼š

```py
def mutate_net(net: Net, seed: int, copy_net: bool = True) -> Net: 
    new_net = copy.deepcopy(net) if copy_net else net 
    np.random.seed(seed) 
    for p in new_net.parameters(): 
        noise = np.random.normal(size=p.data.size()) 
        noise_t = torch.FloatTensor(noise) 
        p.data += NOISE_STD * noise_t 
    return new_net
```

å‰é¢çš„å‡½æ•°å¯ä»¥åŸåœ°æ‰§è¡Œå˜å¼‚ï¼Œæˆ–è€…æ ¹æ®å‚æ•°å¤åˆ¶ç›®æ ‡ç½‘ç»œï¼ˆå¯¹äºç¬¬ä¸€ä»£éœ€è¦å¤åˆ¶ï¼‰ã€‚

ç¬¬äºŒä¸ªå‡½æ•°ä»å¤´å¼€å§‹ä½¿ç”¨ç§å­åˆ—è¡¨åˆ›å»ºç½‘ç»œï¼š

```py
def build_net(env: gym.Env, seeds: tt.List[int]) -> Net: 
    torch.manual_seed(seeds[0]) 
    net = Net(env.observation_space.shape[0], env.action_space.shape[0]) 
    for seed in seeds[1:]: 
        net = mutate_net(net, seed, copy_net=False) 
    return net
```

è¿™é‡Œï¼Œç¬¬ä¸€ä¸ªç§å­ä¼ é€’ç»™ PyTorchï¼Œç”¨äºå½±å“ç½‘ç»œåˆå§‹åŒ–ï¼Œåç»­çš„ç§å­ç”¨äºåº”ç”¨ç½‘ç»œçªå˜ã€‚

worker å‡½æ•°è·å–å¾…è¯„ä¼°çš„ç§å­åˆ—è¡¨ï¼Œå¹¶ä¸ºæ¯ä¸ªè·å¾—çš„ç»“æœè¾“å‡ºå•ç‹¬çš„ OutputItem æ•°æ®ç±»é¡¹ï¼š

```py
@dataclass 
class OutputItem: 
    seeds: tt.List[int] 
    reward: float 
    steps: int 

def worker_func(input_queue: mp.Queue, output_queue: mp.Queue): 
    env = gym.make("HalfCheetah-v4") 
    cache = {} 

    while True: 
        parents = input_queue.get() 
        if parents is None: 
            break 
        new_cache = {} 
        for net_seeds in parents: 
            if len(net_seeds) > 1: 
                net = cache.get(net_seeds[:-1]) 
                if net is not None: 
                    net = mutate_net(net, net_seeds[-1]) 
                else: 
                    net = build_net(env, net_seeds) 
            else: 
                net = build_net(env, net_seeds) 
            new_cache[net_seeds] = net 
            reward, steps = common.evaluate(env, net, get_max_action=False) 
            output_queue.put(OutputItem(seeds=net_seeds, reward=reward, steps=steps)) 
        cache = new_cache
```

è¿™ä¸ªå‡½æ•°ç»´æŠ¤äº†ç½‘ç»œçš„ç¼“å­˜ï¼Œä»¥æœ€å°åŒ–é‡æ–°åˆ›å»ºç§å­åˆ—è¡¨ä¸­å‚æ•°æ‰€èŠ±è´¹çš„æ—¶é—´ã€‚æ¯æ¬¡ç”Ÿæˆéƒ½ä¼šæ¸…é™¤ç¼“å­˜ï¼Œå› ä¸ºæ¯ä¸€ä»£æ–°ç½‘ç»œéƒ½æ˜¯ä»å½“å‰ä»£çš„èµ¢å®¶ä¸­åˆ›å»ºçš„ï¼Œæ‰€ä»¥æ—§ç½‘ç»œä»ç¼“å­˜ä¸­å¤ç”¨çš„å¯èƒ½æ€§éå¸¸å°ã€‚

ä¸»è¿›ç¨‹çš„ä»£ç ä¹Ÿå¾ˆç®€å•ï¼š

```py
 batch_steps = 0 
        population = [] 
        while len(population) < SEEDS_PER_WORKER * WORKERS_COUNT: 
            out_item = output_queue.get() 
            population.append((out_item.seeds, out_item.reward)) 
            batch_steps += out_item.steps 
        if elite is not None: 
            population.append(elite) 
        population.sort(key=lambda p: p[1], reverse=True) 
        elite = population[0] 
        for worker_queue in input_queues: 
            seeds = [] 
            for _ in range(SEEDS_PER_WORKER): 
                parent = np.random.randint(PARENTS_COUNT) 
                next_seed = np.random.randint(MAX_SEED) 
                s = list(population[parent][0]) + [next_seed] 
                seeds.append(tuple(s)
```

å¯¹äºæ¯ä¸€ä»£ï¼Œæˆ‘ä»¬å°†å½“å‰ç§ç¾¤çš„ç§å­å‘é€ç»™å·¥ä½œè€…è¿›è¡Œè¯„ä¼°ï¼Œå¹¶ç­‰å¾…ç»“æœã€‚ç„¶åï¼Œæˆ‘ä»¬å¯¹ç»“æœè¿›è¡Œæ’åºï¼Œå¹¶åŸºäºè¡¨ç°æœ€å¥½çš„ä¸ªä½“ç”Ÿæˆä¸‹ä¸€ä»£ã€‚åœ¨ä¸»è¿›ç¨‹ç«¯ï¼Œçªå˜åªæ˜¯ä¸€ä¸ªéšæœºç”Ÿæˆçš„ç§å­ç¼–å·ï¼Œè¿½åŠ åˆ°çˆ¶ä»£çš„ç§å­åˆ—è¡¨ä¸­ã€‚

### ç»“æœ

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ MuJoCo HalfCheetah ç¯å¢ƒï¼Œå®ƒå†…éƒ¨æ²¡æœ‰å¥åº·æ£€æŸ¥ï¼Œå› æ­¤æ¯ä¸ªå›åˆéœ€è¦ 2,000 æ­¥ã€‚ç”±äºè¿™ä¸ªåŸå› ï¼Œæ¯ä¸ªè®­ç»ƒæ­¥éª¤å¤§çº¦éœ€è¦ä¸€åˆ†é’Ÿï¼Œå› æ­¤éœ€è¦è€å¿ƒç­‰å¾…ã€‚åœ¨ 300 è½®çªå˜åï¼ˆå¤§çº¦ç”¨äº† 7 å°æ—¶ï¼‰ï¼Œæœ€ä½³ç­–ç•¥è·å¾—äº† 6454 çš„å¥–åŠ±ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç»“æœã€‚å¦‚æœä½ è¿˜è®°å¾—æˆ‘ä»¬åœ¨ä¸Šä¸€ç« çš„å®éªŒï¼Œåªæœ‰ SAC æ–¹æ³•èƒ½åœ¨ MuJoCo HalfCheetah ä¸Šè·å¾—æ›´é«˜çš„å¥–åŠ± 7063ã€‚å½“ç„¶ï¼ŒHalfCheetah çš„æŒ‘æˆ˜æ€§ä¸å¤§ï¼Œä½†ä»ç„¶â€”â€”éå¸¸å¥½ã€‚

å›¾è¡¨è§å›¾ 17.5 å’Œå›¾ 17.6ã€‚

![PIC](img/B22150_17_05.png)

å›¾ 17.5ï¼šGA åœ¨ HalfCheetah ä¸Šçš„æœ€å¤§ï¼ˆå·¦ï¼‰å’Œå¹³å‡ï¼ˆå³ï¼‰å¥–åŠ±

![PIC](img/B22150_17_06.png)

å›¾ 17.6ï¼šGA åœ¨ HalfCheetah ä¸Šçš„å¥–åŠ±æ ‡å‡†å·®

# æ€»ç»“

åœ¨è¿™ä¸€ç« ä¸­ï¼Œä½ çœ‹åˆ°äº†ä¸¤ç§é»‘ç›’ä¼˜åŒ–æ–¹æ³•çš„ç¤ºä¾‹ï¼šè¿›åŒ–ç­–ç•¥å’Œé—ä¼ ç®—æ³•ï¼Œå®ƒä»¬å¯ä»¥ä¸å…¶ä»–åˆ†ææ¢¯åº¦æ–¹æ³•ç«äº‰ã€‚å®ƒä»¬çš„ä¼˜åŠ¿åœ¨äºå¯ä»¥åœ¨å¤§é‡èµ„æºä¸Šè¿›è¡Œè‰¯å¥½çš„å¹¶è¡ŒåŒ–ï¼Œå¹¶ä¸”å¯¹å¥–åŠ±å‡½æ•°çš„å‡è®¾è¾ƒå°‘ã€‚

åœ¨ä¸‹ä¸€ç« ï¼Œæˆ‘ä»¬å°†æ¢è®¨å¼ºåŒ–å­¦ä¹ ä¸­çš„ä¸€ä¸ªéå¸¸é‡è¦çš„æ–¹é¢ï¼šé«˜çº§æ¢ç´¢æ–¹æ³•ã€‚
