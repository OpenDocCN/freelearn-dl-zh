# 前言

想象一下在没有蓝图的情况下建造摩天大楼——每一层都是即时构建的，没有任何明确的计划来确保稳定性、效率，甚至功能。没有结构化方法来开发**大型语言模型**（**LLMs**）可能会感觉非常相似。这些强大的模型能够改变行业并重新定义人机交互，它们是复杂的结构，需要细致的计划和执行。没有框架来导航其复杂性，从业者可能会创建出低效、不可靠或无法达到其潜力的系统。

这本书，《LLM 设计模式》，提供了您需要的蓝图。它是一本面向工程师、研究人员和寻求有效设计、构建和实施 LLMs 的革新者的实用指南。它侧重于四个关键支柱：准备和预处理数据、训练和优化模型、评估和解释其行为，以及与高级知识检索技术无缝集成。这些领域通过设计模式的角度进行探索，为 LLM 开发中反复出现的挑战提供经过验证的解决方案。

LLM 的快速演进带来了非凡的机会和艰巨的挑战。数据质量、可扩展性和可解释性问题需要适应性方法和创新策略。这本书为所有级别的从业者提供了应对这些挑战的设计模式，提供了可操作的见解和框架，不仅可以帮助构建模型，还能在快速发展的 LLM 世界中脱颖而出。无论您是在构建您的第一个模型还是在改进尖端应用，这本书都确保了您的做法与您寻求利用的技术一样稳健。

# 本书面向对象

这本书面向所有参与 LLM 开发、部署或应用的人，包括以下内容：

+   **AI 工程师和研究人员**：在项目中实施 LLM 技术的个人

+   **数据科学家和机器学习从业者**：寻求关于数据准备、模型训练和优化 LLMs 指导的专业人士

+   **软件架构师和项目经理**：那些旨在构建和管理基于 LLM（大型语言模型）的项目，确保与商业和技术目标一致的人

# 本书涵盖内容

*第一章*，《LLM 设计模式简介》，提供了对 LLMs 的基础理解，并介绍了设计模式在其开发中的关键作用。

*第二章*《LLM 训练数据清理》，为您提供了实用的工具和技术，使您能够有效地清理数据以进行 LLM 训练。

*第三章*《数据增强》，帮助您深入了解数据增强模式，从增加训练数据集的多样性到维护其完整性。

*第四章*，*处理 LLM 训练的大型数据集*，让你学习管理和处理对训练最先进的 LLM 至关重要的海量数据集的高级技术。

*第五章*，*数据版本控制*，展示了如何实施有效的数据版本控制策略以用于 LLM 开发。

*第六章*，*数据集标注与标记*，让你探索创建高质量标注数据集的高级技术，这些数据集可以显著影响 LLM 在各种任务上的性能。

*第七章*，*训练流程*，帮助你理解 LLM 训练流程的关键组件，从数据摄入和预处理到模型架构和优化策略。

*第八章*，*超参数调整*，展示了 LLM 中的超参数是什么以及优化它们的策略。

*第九章*，*正则化*，展示了针对 LLM 量身定制的不同正则化技术。

*第十章*，*检查点和恢复*，概述了确定最佳检查点频率、大型模型的有效存储格式以及从各种类型的故障中恢复的技术。

*第十一章*，*微调*，教你有效的微调预训练语言模型的策略。

*第十二章*，*模型剪枝*，让你探索旨在在保持性能的同时减少模型大小的模型剪枝技术。

*第十三章*，*量化*，让你了解量化方法，这些方法可以优化 LLM 以在资源受限的设备上部署。

*第十四章*，*评估指标*，探讨了评估 LLM 在不同领域中最新的和常用的基准。

*第十五章*，*交叉验证*，展示了如何探索专门为 LLM 设计的交叉验证策略。

*第十六章*，*可解释性*，帮助你理解在 LLM 中可解释性指的是模型理解并解释模型如何处理输入和生成输出的能力。

*第十七章*，*公平性与偏见检测*，证明了在 LLM 中的公平性涉及确保模型的输出和决策不会基于受保护属性歧视或不公平地对待个人或群体。

*第十八章*，*对抗鲁棒性*，帮助你理解针对 LLM 的对抗攻击是如何通过在输入上做出微小、通常难以察觉的更改来操纵模型输出的。

*第十九章*, *从人类反馈中进行强化学习*，带你了解一种强大的技术，用于使 LLMs 与人类偏好保持一致。

*第二十章*, *思维链提示*，展示了如何利用思维链提示来提高 LLMs 在复杂推理任务上的性能。

*第二十一章*, *思维树提示*，允许你实现思维树提示，以处理 LLMs 的复杂推理任务。

*第二十二章*, *推理与行动*，介绍了 ReAct 框架，这是一种强大的技术，可以提示你的 LLMs 不仅通过复杂场景进行推理，还可以规划和模拟行动的执行，类似于人类在现实世界中的操作方式。

*第二十三章*, *无观察推理*，教你如何为 LLMs 提供框架，使其能够对假设情况进行推理并有效地利用外部工具。

*第二十四章*, *反思技术*，展示了在 LLMs 中的反思，这指的是模型分析、评估和改进其自身输出的能力。

*第二十五章*, *自动多步推理和工具使用*，帮助你理解自动多步推理和工具使用如何显著扩展 LLMs 的解决问题的能力，使它们能够处理复杂、现实世界的任务。

*第二十六章*, *检索增强生成*，带你了解一种增强 Al 模型性能的技术，尤其是在需要模型预训练参数中不包含的知识或数据的任务中。

*第二十七章*, *基于图的 RAG*，展示了如何利用图结构知识在 RAG 中为 LLMs 提供支持。

*第二十八章*, *高级 RAG*，展示了如何超越这些基本的 RAG 方法，探索旨在增强 LLMs 在广泛任务上性能的更复杂技术。

*第二十九章*, *评估 RAG 系统*，为你提供了评估 RAG 系统产生准确、相关和事实依据的响应能力所需的知识。

*第三十章*, *代理模式*，展示了如何设计使用 LLMs 的代理 Al 系统以自主运行、做出决策并采取行动以实现特定目标。

# 为了充分利用这本书

为了最大限度地利用本书，您最好对机器学习概念有基础的了解，并在 Python 编程方面有基本的熟练度。这些先决条件将有助于掌握章节中讨论的技术方法和实施策略。机器学习知识对于理解 LLM 开发的关键方面，如模型训练、超参数调整、正则化技术和优化过程，是必不可少的。Python 编程技能尤其宝贵，因为它们使您能够实现和实验书中提出的设计模式、工作流程和算法。

熟悉自然语言处理（NLP）框架和工具，例如 Hugging Face Transformers、spaCy 或 NLTK，将进一步增强学习体验。这些框架在 LLM 开发中常用，并提供了一种实际的方法来处理预训练模型、标记文本和处理语言数据。了解这些工具的工作原理将使您能够专注于高级概念和设计模式，而无需被基础编程或 NLP 操作所困扰。

对于对这些领域不太熟悉的人，建议补充学习机器学习基础知识、Python 编程和 NLP 工具的资源。本书的方法确保通过一些努力弥合知识差距，您可以成功理解其概念并在实际项目中有效应用。

注意

本书提供了代码片段来展示 LLM 设计模式和实现概念。代码有意集中于以简洁和可读的方式展示想法，而不是提供完整、可执行的程序。它不打算直接部署或集成到生产环境中。鼓励您研究和适应代码以适应自己的环境，而不是直接复制粘贴。因此，没有配套的 GitHub 仓库；书中提供的示例包含在书中，足以理解预期的概念，无需外部代码库。

# 下载彩色图像

我们还提供了一份包含本书中使用的图表彩色图像的 PDF 文件。您可以从这里下载：[`packt.link/gbp/9781836207030`](https://packt.link/gbp/9781836207030)。

# 使用的约定

本书使用了多种文本约定。

文本中的代码：表示文本中的代码单词、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 处理/X 用户名。以下是一个示例：“将下载的 WebStorm-10*.dmg 磁盘镜像文件作为系统中的另一个磁盘挂载。”

代码块设置如下：

```py

# Model Architecture
model = AutoModelForCausalLM.from_pretrained(“gpt2”)
# Optimization
optimizer = AdamW(model.parameters(), lr=5e-5)
```

任何命令行输入或输出都如下所示：

```py

pip install faiss-cpu sentence-transformers
```

粗体：表示新术语、重要单词或屏幕上看到的单词。

小贴士或重要提示

看起来像这样。

# 联系我们

欢迎读者反馈。

一般反馈：如果您对本书的任何方面有疑问，请通过电子邮件发送至 customercare@packtpub.com，并在邮件主题中提及书名。

错误清单：尽管我们已经尽一切努力确保内容的准确性，但错误仍然可能发生。如果您在这本书中发现了错误，如果您能向我们报告，我们将不胜感激。请访问[www.packtpub.com/support/errata](http://www.packtpub.com/support/errata)并填写表格。

侵权：如果您在互联网上发现任何形式的我们作品的非法副本，如果您能提供位置地址或网站名称，我们将不胜感激。请通过 copyright@packt.com 与我们联系，并提供材料的链接。

如果您有兴趣成为作者：如果您在某个主题上具有专业知识，并且您有兴趣撰写或为书籍做出贡献，请访问[authors.packtpub.com](http://authors.packtpub.com)。

# 分享您的想法

一旦您阅读了*LLM 设计模式*，我们很乐意听听您的想法！请[点击此处直接进入此书的亚马逊评论页面](https://packt.link/r/1-836-20703-4)并分享您的反馈。

您的评论对我们和科技社区非常重要，并将帮助我们确保我们提供高质量的内容。

# 下载本书的免费 PDF 副本

感谢您购买此书！

您喜欢随时随地阅读，但又无法携带您的印刷书籍到处走吗？

您的电子书购买是否与您选择的设备不兼容？

别担心，现在，每购买一本 Packt 书籍，您都可以免费获得该书的 DRM 免费 PDF 版本。

在任何地方、任何时间、任何设备上阅读。直接从您最喜欢的技术书籍中搜索、复制和粘贴代码到您的应用程序中。

优惠不止于此，您还可以获得独家访问折扣、时事通讯和每日收件箱中的精彩免费内容。

按照以下简单步骤获取好处：

1.  扫描下面的二维码或访问以下链接

![二维码](img/B31249_QR_Free_PDF.jpg)

[`packt.link/free-ebook/978-1-83620-703-0`](https://packt.link/free-ebook/978-1-83620-703-0)

1.  提交您的购买证明

1.  就这些！我们将直接将您的免费 PDF 和其他好处发送到您的邮箱

# 第一部分：简介和数据准备

我们这本书从介绍理解和操作大型语言模型（LLMs）所需的基础概念开始。在本部分，你将探索数据准备在构建高质量 LLMs 中的关键作用。从理解设计模式在模型开发中的重要性到处理训练所需的庞大数据集，我们引导你通过 LLM 管道的初始步骤。本部分中的章节将帮助你掌握数据清洗技术以提升数据质量，数据增强方法以增强数据集多样性，以及数据集版本化策略以确保可重复性。你还将学习如何高效地处理大型数据集并为特定任务创建良好标注的语料库。到本部分结束时，你将具备准备稳健且可扩展的数据集的技能，为高级 LLM 开发提供坚实的基础。

本部分包含以下章节：

+   *第一章*，*LLM 设计模式介绍*

+   *第二章*，*LLM 训练的数据清洗*

+   *第三章*，*数据增强*

+   *第四章*，*处理 LLM 训练的大型数据集*

+   *第五章*，*数据版本化*

+   *第六章*，*数据集标注和标记*
