# 前言

随着 **大型语言模型** (**LLMs**) 现在为从客户服务聊天机器人到复杂的代码生成系统的一切提供动力，生成式 AI 已迅速从研究实验室的奇思妙想转变为生产工作马。然而，实验原型和生产就绪 AI 应用之间存在一个显著的差距。根据行业研究，尽管对生成式 AI 的热情很高，但超过 30% 的项目因可靠性问题、评估复杂性和集成挑战而未能超越概念验证。LangChain 框架已成为跨越这一鸿沟的关键桥梁，为开发者提供了构建稳健、可扩展和实用 LLM 应用的工具。

本书旨在帮助您缩小这一差距。它是您构建在生产环境中真正起作用的 LLM 应用的实用指南。我们关注大多数生成式 AI 项目会遭遇的现实问题：输出不一致、调试困难、脆弱的工具集成和扩展瓶颈。通过使用 LangChain、LangGraph 和不断增长的生成式 AI 生态系统中的其他工具的动手示例和经过测试的模式，您将学会构建您的组织可以自信部署和维护以解决实际问题的系统。

# 本书面向对象

本书主要面向具有基本 Python 知识的软件开发人员，他们希望使用 LLMs 构建生产就绪的应用程序。您不需要广泛的机器学习专业知识，但一些对 AI 概念的了解将帮助您更快地通过材料。到本书结束时，您将能够自信地实施需要专门 AI 知识的其他高级 LLM 架构。

如果您是一位正在转向 LLM 应用开发的数据科学家，您会发现实际的实施模式特别有价值，因为它们弥合了实验笔记本和可部署系统之间的差距。本书对 RAG 实施、评估框架和可观察性实践的系统方法解决了您在尝试将有希望的原型扩展为可靠服务时可能遇到的常见挫折。

对于在其组织中评估 LLM 技术的技术决策者，本书提供了关于成功 LLM 项目实施的策略洞察。您将了解区分实验系统与生产就绪系统的架构模式，学习识别高价值用例，并发现如何避免导致大多数项目失败的集成和扩展问题。本书提供了评估实施方法和做出明智技术决策的明确标准。

# 本书涵盖内容

*第一章*，*生成式 AI 的崛起：从语言模型到智能体*，介绍了现代 LLM 的景观，并将 LangChain 定位为构建生产就绪 AI 应用的框架。你将了解基本 LLM 的实用局限性以及像 LangChain 这样的框架如何帮助标准化和克服这些挑战。这个基础将帮助你就针对特定用例实施哪些智能体技术做出明智的决定。

*第二章*，*LangChain 的入门步骤*，通过实际动手示例让你立即开始构建。你将设置合适的发展环境，理解 LangChain 的核心组件（模型接口、提示、模板和 LCEL），并创建简单的链。本章展示了如何运行基于云和本地的模型，根据项目需求，为你提供了平衡成本、隐私和性能的选项。你还将探索结合文本和视觉理解的简单多模态应用。这些基础知识为日益复杂的 AI 应用提供了构建块。

*第三章*，*使用 LangGraph 构建工作流程*，深入探讨了使用 LangChain 和 LangGraph 创建复杂工作流程。你将学习如何使用节点和边构建工作流程，包括基于状态的分支条件边。本章涵盖了输出解析、错误处理、提示工程技术（零样本和动态少量样本提示）以及使用 Map-Reduce 模式处理长上下文。你还将实现用于管理聊天历史的内存机制。这些技能解决了为什么许多 LLM 应用在现实条件下失败的原因，并为你提供了构建可靠性能系统的工具。

*第四章*，*构建智能 RAG 系统*，通过将 LLM 建立在可靠的外部知识上解决了“幻觉问题”。你将掌握向量存储、文档处理和检索策略，这些策略可以提高响应准确性。本章的企业级文档聊天机器人项目展示了如何实施保持一致性和合规性的企业级 RAG 管道——这一能力直接针对行业调查中提到的数据质量问题。故障排除部分涵盖了七个常见的 RAG 故障点，并为每个故障点提供了实用的解决方案。

*第五章*，*构建智能体*，探讨了工具使用脆弱性问题——这是智能体自主性的核心瓶颈。你将实现 ReACT 模式来提高智能体的推理和决策能力，开发稳健的定制工具，并构建容错性工具调用流程。通过生成结构化输出和构建研究智能体的实际示例，你将了解智能体是什么，并使用 LangGraph 实现你的第一个计划-求解智能体，为更高级的智能体架构奠定基础。

*第六章*，*高级应用和多智能体系统*，涵盖了用于智能体 AI 应用的架构模式。你将探索多智能体架构以及组织智能体之间通信的方法，实现一个具有自我反思能力的先进智能体，该智能体使用工具来回答复杂问题。本章还涵盖了 LangGraph 流处理、高级控制流、闭环中的人类自适应系统以及思维树模式。你将了解 LangChain 和 LangGraph 中的记忆机制，包括缓存和存储，这将使你能够创建能够处理单智能体方法无法应对的复杂问题的系统——这是生产就绪系统的一项关键能力。

*第七章*，*软件开发和数据分析智能体*，展示了自然语言如何成为编程和数据分析的有力接口。你将实现基于 LLM 的代码生成、使用 RAG 进行代码检索和文档搜索的解决方案。这些示例展示了如何将 LLM 智能体集成到现有的开发和数据工作流程中，说明了它们如何补充而不是取代传统的编程技能。

*第八章*，*评估和测试*，概述了在生产部署前评估 LLM 应用的方法。你将了解系统级评估、评估驱动设计以及离线和在线方法。本章提供了使用精确匹配和 LLM 作为裁判的评估方法来实现正确性评估的实用示例，并展示了 LangSmith 等工具进行综合测试和监控。这些技术直接提高了可靠性，并有助于证明你的 LLM 应用的商业价值。

*第九章*，*可观察性和生产部署*，提供了将 LLM 应用程序部署到生产的指南，重点关注系统设计、扩展策略、监控和确保高可用性。本章涵盖了针对 LLM 的日志记录、API 设计、成本优化和冗余策略。您将探索模型上下文协议（MCP）并学习如何实施解决部署生成式 AI 系统独特挑战的可观察性实践。本章中的实际部署模式有助于您避免许多 LLM 项目无法达到生产阶段的常见陷阱。

*第十章*，*LLM 应用的未来*，展望了生成式 AI 中出现的趋势、演变的架构和伦理考量。本章探讨了新技术、市场发展、潜在的社会影响和负责任开发的指南。您将深入了解该领域可能如何发展，以及如何定位您的技能和应用以适应未来的进步，完成从基本 LLM 理解到构建和部署生产就绪、未来证明的 AI 系统的旅程。

# 为了充分利用这本书

在深入之前，确保您有一些事情准备好以充分利用您的学习体验是有帮助的。这本书旨在实用和动手操作，因此拥有正确的环境、工具和心态将帮助您顺利跟随并从每一章中获得最大价值。以下是我们的建议：

+   **环境要求**：在 Windows、macOS 或 Linux 等任何主要操作系统上设置一个 Python 3.10+的开发环境。所有代码示例都是跨平台兼容的，并且经过彻底测试。

+   **API 访问（可选但推荐）**：虽然我们展示了使用可以在本地运行的开源模型，但访问像 OpenAI、Anthropic 或其他 LLM 提供商这样的商业 API 提供商将允许您使用更强大的模型。许多示例包括本地和基于 API 的方法，因此您可以根据您的预算和性能需求进行选择。

+   **学习方法**：我们建议您亲自输入代码而不是复制粘贴。这种动手实践强化了学习并鼓励实验。每一章都是基于之前引入的概念，因此按顺序完成它们将为您打下最坚实的基础。

+   **背景知识**：需要基本的 Python 熟练度，但不需要机器学习或 LLM 的先前经验。我们会在适当的时候解释关键概念。如果您已经熟悉 LLM，您可以专注于区分这本书的实现模式和部署就绪方面的内容。

    | 书中涵盖的**软件/硬件** |
    | --- |
    | Python 3.10+ |
    | LangChain 0.3.1+ |
    | LangGraph 0.2.10+ |
    | 不同的 LLM 提供商（Anthropic、Google、OpenAI、本地模型） |

您将在*第一章*中找到有关环境设置的详细指南，以及清晰的解释和逐步说明，以帮助您开始。鉴于 LangChain、LangGraph 和更广泛生态系统的快速变化性质，我们强烈建议遵循这些设置步骤——跳过这些步骤可能会导致未来出现可避免的问题。

## 下载示例代码文件

本书代码包托管在 GitHub 上，网址为[`github.com/benman1/generative_ai_with_langchain`](https://github.com/benman1/generative_ai_with_langchain)。我们建议您在阅读章节时自行输入代码或使用存储库。如果代码有更新，它将在 GitHub 存储库中更新。

我们还有其他来自我们丰富的图书和视频目录的代码包，可在[`github.com/PacktPublishing`](https://github.com/PacktPublishing)找到。查看它们吧！

## 下载彩色图像

我们还提供了一份包含本书中使用的截图/图表的彩色图像的 PDF 文件。您可以从这里下载：[`packt.link/gbp/9781837022014`](https://packt.link/gbp/9781837022014)。

## 使用的约定

本书使用了多种文本约定。

`CodeInText`：表示文本中的代码词汇、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 昵称。例如：“让我们也从`thread-a`的初始检查点恢复。我们会看到我们从一个空的历史记录开始：”

代码块设置如下：

```py
checkpoint_id = checkpoints[-1].config["configurable"]["checkpoint_id"]
_ = graph.invoke(
   [HumanMessage(content="test")],
   config={"configurable": {"thread_id": "thread-a", "checkpoint_id": checkpoint_id}})
```

任何命令行输入或输出都应如下所示：

```py
$ pip install langchain langchain-openai
```

**粗体**：表示新术语、重要词汇或屏幕上出现的词汇。例如，菜单或对话框中的文字会以这种方式显示。例如：“谷歌研究团队在 2022 年初引入了**思维链**（**CoT**）技术。”

警告或重要提示如下所示。

小贴士和技巧如下所示。

# 联系我们

订阅 AI_Distilled，这是 AI 专业人士、研究人员和创新者的首选通讯简报，

在[`packt.link/Q5UyU`](https://packt.link/Q5UyU)。

![Newsletter_QRcode.jpg](img/Newsletter_QRcode.jpg)

欢迎读者反馈。

如果您发现任何错误或有建议，请通过 GitHub 问题、discord 聊天或 Packt 网站上的勘误表单报告，最好是通过 GitHub 问题报告。

关于 GitHub 上的问题，请参阅[`github.com/benman1/generative_ai_with_langchain/issues`](https://github.com/benman1/generative_ai_with_langchain/issues)。

如果您对本书的内容或定制项目有任何疑问，请随时通过`ben@chelseaai.co.uk`联系我们。

**一般反馈**：请发送电子邮件至`feedback@packtpub.com`，并在邮件主题中提及本书的标题。如果您对本书的任何方面有疑问，请发送电子邮件至`questions@packtpub.com`。

**勘误表**：尽管我们已经尽最大努力确保内容的准确性，但错误仍然可能发生。如果您在此书中发现错误，我们将不胜感激，如果您能向我们报告，我们将非常感谢。请访问[`www.packtpub.com/submit-errata`](http://www.packtpub.com/submit-errata)，点击**提交勘误**，并填写表格。

**盗版**：如果您在互联网上以任何形式发现我们作品的非法副本，我们将不胜感激，如果您能提供位置地址或网站名称，我们将非常感谢。请通过`copyright@packtpub.com`与我们联系，并提供材料的链接。

**如果您有兴趣成为作者**：如果您在某个领域有专业知识，并且您有兴趣撰写或为书籍做出贡献，请访问[`authors.packtpub.com/`](http://authors.packtpub.com/)。

# 分享您的想法

一旦您阅读了《使用 LangChain 的生成式 AI，第二版》，我们非常乐意听听您的想法！请[点击此处直接进入此书的亚马逊评论页面](https://packt.link/r/1837022011)并分享您的反馈。

您的评论对我们和科技社区非常重要，并将帮助我们确保我们提供高质量的内容。

# 下载此书的免费 PDF 副本

感谢您购买此书！

您喜欢在旅途中阅读，但无法携带您的印刷书籍到处走吗？

您的电子书购买是否与您选择的设备不兼容？

别担心，现在每购买一本 Packt 书籍，您都可以免费获得该书的 DRM 免费 PDF 版本。

在任何地方、任何时间、任何设备上阅读。直接从您最喜欢的技术书籍中搜索、复制和粘贴代码到您的应用程序中。

优惠远不止于此，您还可以获得独家折扣、时事通讯和丰富的免费内容，每天直接发送到您的邮箱。

按照以下简单步骤获取优惠：

1.  扫描下面的二维码或访问以下链接：

![`packt.link/free-ebook/9781837022014`](img/B32363_Free_PDF_QR.png)

[`packt.link/free-ebook/9781837022014`](https://packt.link/free-ebook/9781837022014)

1.  提交您的购买证明。

1.  就这些！我们将直接将您的免费 PDF 和其他优惠发送到您的邮箱。
