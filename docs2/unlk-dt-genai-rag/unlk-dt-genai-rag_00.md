# 前言

在人工智能（**AI**）快速发展的领域中，**检索增强生成（RAG**）作为一种突破性的技术已经出现，正在改变我们与 AI 系统互动和利用 AI 系统的方式。 RAG 结合了信息检索和生成式 AI 模型的优势，创建出能够访问和利用大量数据以生成高度准确、上下文相关和**信息丰富**的响应的强大应用。 RAG 的重要性不容小觑。

随着 AI 继续渗透到各个行业和领域，理解和掌握 RAG 对于开发者、研究人员和商业人士都变得越来越重要。 RAG 使 AI 系统能够超越其训练数据的限制，访问最新和特定领域的知识，使它们在现实世界场景中更加灵活、适应性强且更有价值。

随着本书的深入，它成为 RAG 世界的全面指南，涵盖了基本概念和高级技术。 书中充满了详细的编码示例，展示了最新的工具和技术，如 LangChain、Chroma 的向量存储和 OpenAI 的 ChatGPT-4o 和 ChatGPT-4o 迷你模型。 我们将涵盖包括向量存储、向量化、向量搜索技术、提示工程和设计、RAG 相关应用的 AI 代理以及评估和可视化 RAG 结果的方法等基本主题。

学习 RAG 的重要性不容忽视。 RAG 被视为定制化、高效和有洞察力的 AI 解决方案的关键推动者，架起了生成式 AI 的潜力与具体商业需求之间的桥梁。 无论你是希望提升 AI 技能的开发者，探索 AI 新领域的学者，还是寻求利用 AI 促进增长和创新的商业领袖，这本书都将为你提供利用 RAG 的力量并解锁项目中 AI 全部潜力的知识和实用技能。 和计划。

# 本书面向对象

本书的目标受众包括一群广泛的职业人士和爱好者，他们热衷于探索 RAG 和生成式 AI 的尖端交汇点。 这包括以下人群： 以下人群：

+   **AI 研究人员和学者**：那些致力于 AI 研究和进步的个人，他们对最新的方法和技术，如 RAG，以及其在 AI 领域的意义感兴趣。

+   **数据科学家和人工智能工程师**：与大型数据集一起工作的专业人士，旨在利用生成式人工智能和 RAG 实现更高效的数据检索、提高人工智能响应的准确性，以及解决复杂问题的创新解决方案。

+   **软件开发人员和技术人员**：设计和构建人工智能驱动应用程序的从业者，希望将 RAG 集成到他们的系统中以提高性能、相关性和用户参与度。

+   **商业分析师和策略师**：寻求理解如何在组织中战略性地应用人工智能以推动创新、运营效率和竞争优势的个人。

+   **技术产品经理**：负责监督人工智能产品开发的专业人士，对了解 RAG 如何有助于更智能、更响应式的应用程序与业务目标保持一致感兴趣。

+   **人工智能爱好者及爱好者**：对人工智能有浓厚兴趣的更广泛受众，渴望了解塑造人工智能应用未来的最新趋势、工具和技术。

本书特别适合对人工智能有基础了解并希望深入了解 RAG 如何改变商业应用、增强数据驱动洞察力和促进创新的读者。 它吸引那些重视实践、动手学习的读者，提供现实世界的编码示例、案例研究和实施 RAG 的有效策略。 RAG

# 本书涵盖内容

*第一章*，*什么是检索增强生成（RAG）*，介绍了 RAG，这是一种结合 **大型语言模型** (**LLMs**)和公司内部数据以增强人工智能生成输出的准确性、相关性和定制化的技术。 它讨论了 RAG 的优势，如改进的性能和灵活性，以及挑战，如数据质量和复杂性。 本章还涵盖了关键 RAG 词汇、向量的重要性以及各行业的实际应用。 它将 RAG 与传统的生成式人工智能和微调进行比较，并概述了 RAG 系统的架构，该架构由索引、检索和 生成阶段组成。

*第二章*, *代码实验室 – 整个 RAG 管道*，提供了一个全面的代码实验室，通过 Python、LangChain 和 Chroma 展示了完整 RAG 管道的实现。 它涵盖了安装必要的包、设置 OpenAI API 密钥、从网页加载和预处理文档、将它们分割成可管理的块、将它们嵌入到向量表示中，并将它们存储在向量数据库中。 然后，本章演示了如何执行向量相似性搜索，根据查询检索相关文档，并使用预构建的提示模板和 LangChain 链中的语言模型生成响应。 最后，它展示了如何向 RAG 管道提交问题并接收一个 信息丰富的响应。

*第三章*, *RAG 的实用应用*，探讨了 RAG 在商业中的各种实用应用，包括增强客户支持聊天机器人、自动化报告、电子商务产品描述和推荐、利用内部和外部知识库、创新侦察、趋势分析、内容个性化以及员工培训。 它强调了 RAG 如何将非结构化数据转化为可操作的见解，改善决策，并在不同领域提供个性化体验。 本章最后通过一个代码示例演示了如何向 RAG 生成的响应添加来源，强调了在法律文件分析或 科学研究等应用中引用信息以增强可信度和支持的重要性。

*第四章*, *RAG 系统组件*，提供了对构成 RAG 系统的关键组件的全面概述。 它涵盖了三个主要阶段：索引、检索和生成，解释了它们如何协同工作以向用户查询提供增强的响应。 本章还强调了**用户界面**（**UI**）和评估组件的重要性，其中 UI 作为用户与系统之间交互的主要点，而评估对于通过指标和用户反馈评估和改进 RAG 系统的性能至关重要。 虽然不是详尽的，但这些组件构成了大多数成功 RAG 系统的基础。

*第五章*, *在 RAG 应用中管理安全*，探讨了 RAG 应用特有的安全方面。 它讨论了如何通过限制数据访问、确保可靠响应和提供来源透明度，将 RAG 作为安全解决方案来利用。 然而，它也承认了 LLMs 的黑盒性质带来的挑战以及保护用户数据和隐私的重要性。 它介绍了红队概念，以主动识别和缓解漏洞，并通过动手代码实验室，展示了如何通过红队与蓝队的对抗练习来实施安全最佳实践，例如安全存储 API 密钥和防御提示注入攻击。 本章强调了面对不断演变的 安全威胁，持续警惕和适应的重要性。

*第六章*, *与 RAG 和 Gradio 交互*，提供了使用 RAG 和 Gradio 作为 UI 创建交互式应用的实用指南。 它涵盖了设置 Gradio 环境、集成 RAG 模型以及创建一个用户友好的界面，使用户能够像典型网络应用一样与 RAG 系统交互。 本章讨论了使用 Gradio 的好处，如其开源性质、与流行机器学习框架的集成、协作功能，以及与 Hugging Face 的集成以托管演示。 代码实验室演示了如何向 RAG 应用添加 Gradio 界面，创建一个过程问题函数，该函数调用 RAG 管道并显示系统返回的相关度分数、最终答案和来源。

*第七章*，*向量和向量存储在 RAG 中的关键作用*，探讨了向量和向量存储在 RAG 系统中的关键作用。 它解释了向量是什么，它们是如何通过各种嵌入技术创建的，以及它们在表示语义信息中的重要性。 本章涵盖了不同的向量化方法，从传统的 TF-IDF 到现代基于 transformer 的模型，如 BERT 和 OpenAI 的嵌入。 它讨论了在选择向量化选项时需要考虑的因素，包括质量、成本、网络可用性、速度和兼容性。 本章还探讨了向量存储、其架构以及 Chroma、Pinecone 和 pgvector 等流行选项。 它通过概述选择正确向量存储的关键考虑因素来结束，强调需要与特定项目需求和 现有基础设施相一致。

*第八章*，*基于向量的相似性搜索*，专注于 RAG 系统中基于向量的相似性搜索的复杂性。 它涵盖了距离度量、向量空间和相似性搜索算法，如 k-NN 和 ANN。 本章解释了用于提高搜索效率的索引技术，包括 LSH、基于树的索引和 HNSW。 它讨论了密集（语义）和稀疏（关键词）向量类型，介绍了结合两种方法的混合搜索方法。 通过代码实验室，本章演示了自定义混合搜索实现以及 LangChain 的 `EnsembleRetriever` 作为混合检索器的使用。 最后，它概述了各种向量搜索工具选项，如 pgvector、Elasticsearch、FAISS 和 Chroma DB，突出它们的功能和用例，以帮助选择最适合 RAG 项目的解决方案。

*第九章*, *定量评估和可视化评估 RAG*，重点关注评估在构建和维护 RAG 管道中的关键作用。 它涵盖了开发期间和部署后的评估，强调其在优化性能和确保可靠性方面的重要性。 本章讨论了各种 RAG 组件的标准化评估框架和真实数据的重要性。 一个代码实验室演示了 ragas 评估平台的集成，生成合成真实数据并建立全面的指标来比较混合搜索与基于密集向量语义的搜索。 本章探讨了检索、生成和端到端评估阶段，分析结果并可视化它们。 它还展示了 ragas 联合创始人的见解，并讨论了额外的评估技术，如 BLEU、ROUGE、语义相似性和人工评估，强调了使用多个指标对 RAG 系统进行全面评估的重要性。

*第十章*, *LangChain 中的关键 RAG 组件*，探讨了 LangChain 中的关键 RAG 组件：向量存储、检索器和 LLM。 它讨论了各种向量存储选项，如 Chroma、Weaviate 和 FAISS，强调了它们的特性和与 LangChain 的集成。 本章接着涵盖了不同的检索器类型，包括密集型、稀疏型（BM25）、集成检索器和专门的检索器，如`WikipediaRetriever` `和` `KNNRetriever`。它解释了这些检索器的工作原理及其在 RAG 系统中的应用。 最后，本章检查了 LangChain 中的 LLM 集成，重点关注 OpenAI 和 Together AI 模型。 它演示了如何在不同的 LLM 之间切换，并讨论了扩展功能，如异步、流式和批量支持。 本章提供了使用 LangChain 在 RAG 应用中实现这些组件的代码示例和实用见解。 。

*第十一章*, *利用 LangChain 从 RAG 中获得更多*，探讨了如何使用 LangChain 组件增强 RAG 应用。 它涵盖了处理各种文件格式的文档加载器、将文档分割成可管理块的分词器以及结构化 LLM 响应的输出解析器。 本章提供了代码实验室，展示了不同文档加载器（HTML、PDF、Word、JSON）、分词器（字符、递归字符、语义）和输出解析器（字符串、JSON）的实现。 它强调了根据文档特征和语义关系选择合适的分词器的重要性。 本章还展示了如何将这些组件集成到 RAG 管道中，强调了 LangChain 在定制 RAG 应用中的灵活性和强大功能。 总的来说，它提供了使用 LangChain 的多样化工具包优化 RAG 系统的实用见解。

*第十二章*, *结合 RAG 与 AI 代理和 LangGraph 的力量*，探讨了将 AI 代理和 LangGraph 整合到 RAG 应用中的方法。 它解释了 AI 代理是具有决策循环的 LLM，允许处理更复杂的任务。 本章介绍了 LangGraph，它是 LCEL 的扩展，能够实现基于图的代理编排。 涵盖的关键概念包括代理状态、工具、工具包以及图论元素，如节点和边。 一个代码实验室演示了为 RAG 构建 LangGraph 检索代理的过程，展示了如何创建工具、定义代理状态、设置提示和建立循环图。 本章强调，这种方法通过允许代理进行推理、使用工具和分解复杂任务，最终为用户查询提供更全面的响应，从而增强了 RAG 应用。 。

*第十三章*, *利用提示工程改进 RAG 效果*，专注于利用提示工程来增强 RAG 系统。 它涵盖了关键概念，如提示参数（温度、top-p、种子）、射击设计以及提示设计的根本。 本章强调了为不同 LLM 调整提示的重要性以及迭代以改进结果。 通过代码实验室，它展示了创建自定义提示模板和应用各种提示技术，如迭代、总结、推断、转换和扩展。 这些技术通过实际示例进行说明，展示了如何针对不同的目的调整提示，例如语气调整、语言翻译和数据提取。 本章强调了在 RAG 应用中战略性地制定提示对于提高信息检索和文本生成质量的重要性。

*第十四章*, *用于改进结果的先进 RAG 相关技术*, 探讨了增强 RAG 应用的高级技术。 它涵盖了查询扩展、查询分解，以及 **多模态 RAG** (**MM-RAG**)，并通过代码实验室展示了它们的实现。 查询扩展通过增强原始查询来提高检索效果，而查询分解则是将复杂问题分解成更小、更易于管理的子问题。 MM-RAG 结合了多种数据类型，包括图像，以提供更全面的响应。 本章还讨论了其他用于改进 RAG 管道的索引、检索和生成阶段的先进技术。 这些技术包括深度分块、嵌入适配器、假设文档嵌入和自反 RAG。 本章强调了 RAG 技术的快速演变，并鼓励读者探索和调整这些方法以适应他们的 特定应用。

# 为了充分利用这本书

读者应具备基本的 Python 编程知识，并熟悉机器学习概念。了解**自然语言处理**（**NLP**）和 LLMs 将有所帮助。具备数据处理和数据库管理经验也将很有帮助。本书假设读者在 AI 开发环境方面有一些经验，能够舒适地使用 API，并在 Jupyter 笔记本环境中工作。

| **本书涵盖的软件/硬件**** | **操作系统要求**** |
| --- | --- |
| Python 3.x | Windows, macOS, 或 Linux |
| LangChain | Windows, macOS, 或 Linux |
| OpenAI API | Windows, macOS, 或 Linux |
| Jupyter 笔记本 | Windows, macOS, 或 Linux |

您需要一个支持 Jupyter 笔记本的开发环境。许多示例都需要 OpenAI API 密钥。某些章节可能需要额外的 API 密钥，例如 Tavily 或 Together AI 的服务，但您将在那些章节中学习如何设置这些密钥。建议运行更复杂的示例，特别是涉及 LLMs 的示例，需要至少 8 GB 的 RAM。

**如果您正在使用本书的数字版，我们建议您亲自输入代码或从本书的 GitHub 仓库（下一节中提供链接）获取代码。 **这样做将帮助您避免与代码的复制和粘贴相关的任何潜在错误。**

# 下载示例代码文件。

您可以从 GitHub 下载本书的示例代码文件[`github.com/PacktPublishing/Generative-AI-with-Retrieval-Augmented-Generation`](https://github.com/PacktPublishing/Generative-AI-with-Retrieval-Augmented-Generation)。如果代码有更新，它将在 GitHub 仓库中更新。[`github.com/PacktPublishing/Unlocking-Data-with-Generative-AI-and-RAG`](https://github.com/PacktPublishing/Unlocking-Data-with-Generative-AI-and-RAG)

我们还有来自我们丰富的图书和视频目录的其他代码包，可在[`github.com/PacktPublishing/`](https://github.com/PacktPublishing/)找到。查看它们吧！

# 使用的约定。

本书使用了多种文本约定。

`文本中的代码`：表示文本中的代码单词、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 昵称。 以下是一个示例：“将下载的 `WebStorm-10*.dmg` 磁盘映像文件作为系统中的另一个磁盘挂载。”

代码块如下设置：

```py
 os.environ['OPENAI_API_KEY'] = 'sk-###################'
openai.api_key = os.environ['OPENAI_API_KEY']
```

当我们希望您注意代码块中的特定部分时，相关的行或项目将被 加粗：

```py
 [default]
exten => s,1,Dial(Zap/1|30)
exten => s,2,Voicemail(u100) exten => s,102,Voicemail(b100) exten => i,1,Voicemail(s0)
```

任何命令行输入或输出都 如下所示：

```py
 $ mkdir css
$ cd css
```

**粗体**：表示新术语、重要单词或您在屏幕上看到的单词。 例如，菜单或对话框中的单词以 **粗体**显示。以下是一个示例：“从 **系统信息** 中选择 **管理** 面板。”

提示或重要说明

看起来像这样。

# 取得联系

我们欢迎读者的反馈。 总是欢迎。

**总体反馈**：如果您对本书的任何方面有疑问，请通过以下邮箱联系我们 customercare@packtpub.com 并在邮件主题中提及书名。

**勘误表**：尽管我们已经尽最大努力确保内容的准确性，但错误仍然可能发生。 如果您在这本书中发现了错误，我们非常感谢您向我们报告。 请访问 [www.packtpub.com/support/errata](http://www.packtpub.com/support/errata) 并填写表格。

**盗版**：如果您在互联网上以任何形式发现我们作品的非法副本，如果您能提供位置地址或网站名称，我们将不胜感激。 请通过以下邮箱联系我们 copyright@packt.com 并提供链接到 相关材料。

**如果您有兴趣成为作者**：如果您在某个领域有专业知识，并且您有兴趣撰写或为书籍做出贡献，请 访问 [authors.packtpub.com](http://authors.packtpub.com)。

# 分享您的想法

一旦您阅读了 *使用生成式 AI 和 RAG 解锁数据*，我们很乐意听听您的想法！ 请 [点击此处直接进入该书的亚马逊评论页面](https://packt.link/r/1-835-88791-0) 并分享 您的反馈。

您的评论对我们和科技社区非常重要，并将帮助我们确保我们提供的是高质量的内容。 内容。

# 下载此书的免费 PDF 副本

感谢购买 此书！

您喜欢在旅途中阅读，但无法随身携带您的印刷书籍吗？ 到处走动？

您的电子书购买是否与您选择的设备不兼容？ 的？

不用担心，现在每购买一本 Packt 书籍，您都可以免费获得该书的 DRM 免费 PDF 版本。 无需付费。

在任何地方、任何地点、任何设备上阅读。直接从您最喜欢的技术书籍中搜索、复制和粘贴代码到您的应用程序中。

好处远不止于此，您还可以获得独家折扣、时事通讯和每日收件箱中的优质免费内容。 的

遵循以下简单步骤以获得 以下好处：

1.  扫描下面的二维码或访问以下 链接

![](img/B22475_QR_Free_PDF.jpg)

[https://packt.link/free-ebook/978-1-83588-790-5](https://packt.link/free-ebook/978-1-83588-790-5)

1.  提交您的购买证明 的

1.  这就完了！ 我们将直接将您的免费 PDF 和其他福利发送到您的 电子邮件

# 第一部分 – 检索增强生成（RAG）简介

在本部分中，您将了解 **检索增强生成** (**RAG**)，涵盖其基础知识、优势、挑战以及跨各个行业的实际应用。 您将学习如何使用 Python 实现完整的 RAG 管道，管理安全风险，并使用 Gradio 构建交互式应用程序。 我们还将探讨 RAG 系统的关键组件，包括索引、检索、生成和评估，并展示如何优化每个阶段以增强性能和 用户体验。

本部分包含以下章节：

+   *第一章*， *什么是检索增强生成（RAG）*

+   *第二章*， *代码实验室 – 整个 RAG 管道*

+   *第三章*, *RAG 的实际应用*

+   *第四章*, *RAG 系统的组成部分*

+   *第五章*, *在 RAG 应用中管理安全*
