

# RAG 的实际应用

在第 *1 章中，我们列举了多种方式 **检索增强生成** (**RAG**)正在 AI 应用中实施，例如聊天机器人的客户支持、自动化报告、产品描述、知识库的可搜索性和实用性、创新侦察、内容个性化、产品推荐和培训 和教育。

在本章中，我们将涵盖以下主题：

+   客户支持和聊天机器人 与 RAG

+   RAG 用于 自动化报告

+   电子商务支持

+   利用 RAG 的知识库 进行操作

+   创新侦察和 趋势分析

+   媒体和 内容平台的内容个性化

+   利用 RAG 在 营销沟通中进行个性化推荐

+   培训和 教育

+   代码实验室 3.1 – 向你的 RAG 添加来源

这些主题应提供对 RAG 广泛范围和多功能性的全面理解。

本章中提供的示例并非旨在详尽无遗，而是为了提供具体的、现实世界的场景，以展示 RAG 的潜力并激发您将这项技术应用于特定企业环境的创造力。 RAG 的惊人灵活性使其能够针对广泛的行业和用例进行定制，已有无数具体示例在各种组织中投入使用。 通过研究这些示例中的一些，您将获得宝贵的见解，了解如何利用 RAG 来提升现有流程，提高效率，并 推动创新。

为了结束本章，我们将展示一个代码示例，它代表了这些应用中许多的共同方法：在响应中添加更多相关数据的一个元素。 此代码将从第二章的代码继续，并添加在 RAG 响应中返回检索到的文档来源的这一宝贵步骤。 和添加在 RAG 响应中返回检索到的文档来源的这一宝贵步骤。

我们首先讨论如何利用 RAG 和**生成式** **人工智能** (**GenAI**)**的力量显著提升聊天机器人。

# 技术要求

本章的代码放置在以下 GitHub 仓库中： [https://github.com/PacktPublishing/Unlocking-Data-with-Generative-AI-and-RAG/tree/main/Chapter_03](https://github.com/PacktPublishing/Unlocking-Data-with-Generative-AI-and-RAG/tree/main/Chapter_03)

# 使用 RAG 的客服和聊天机器人

**聊天机器人** 已经从简单的脚本响应发展到我们今天看到的复杂、由 RAG 驱动的对话代理。 RAG 为聊天机器人带来了下一波创新，将高级问答系统整合到聊天机器人的功能中，使其对用户来说在对话性和自然性方面有显著提升。 RAG 结合了两者之长：从关于您公司和客户的大量数据集中检索信息的能力，以及生成连贯、上下文相关的响应的能力。 这在客户支持场景中显示出巨大的潜力，其中快速访问和利用特定于公司的数据，如过去客户互动、常见问题解答和支持文档，显著提高了客户服务的质量。

RAG 使聊天机器人能够以远超早期仅依赖预编程响应的模型性能的方式，为用户查询提供个性化、高效且高度相关的响应。 或基本 **自然语言处理** **（NLP）**(**NLP**).

考虑这一点不仅仅是一个技术改进。 聊天机器人的水平代表着企业与其客户互动方式的变革性转变。 通用人工智能（GenAI）使公司能够深入挖掘每个客户的所有数据，例如阅读所有 PDF 格式的银行对账单，使每个客户获得真正的 1 对 1 服务定制成为可能。 增强型 RAG 聊天机器人可以筛选大量数据以找到最相关的信息，有效地回答用户可能提出的许多问题，并确保响应准确且针对每次交互的具体情境。 客户期望快速、相关且高度个性化的查询响应，而使用 RAG 无疑是实现这一目标的最有效方式。 交付它。

请记住，基于 RAG 的系统仍处于起步阶段。在短短几年内，预计基于 RAG 的聊天机器人将大大拓展边界。 您可能会看到能够处理最独特和具体查询的对话聊天机器人，而无需任何人工干预。 它们的 **自然语言** (**NL****)，处理大多数语言的能力，以及访问大量内存和计算能力将彻底改变公司如何以非常定制化和个人化的方式与每一位客户互动。

RAG 在问答和聊天机器人中的优势跨越多个行业，如技术支持、金融服务、医疗保健和电子商务。我们将简要介绍一些这些流行示例，从技术支持开始。

## 技术支持

考虑 一个存在重复技术问题的案例。 例如，向有线电视提供商的咨询中有很大一部分与相同的技术问题相关。 一个增强型 RAG 的聊天机器人可以根据之前的互动识别问题，并立即提供一套定制的故障排除步骤，承认客户过去尝试解决问题的尝试，并调整当前响应。 这不仅展示了对客户体验的理解，而且也在支持过程中建立了信任和信心。

## 金融服务

金融服务 增强型 RAG 的聊天机器人还可以协助处理账户查询、交易问题和个性化财务建议，利用客户的交易历史和账户详情。 您上次尝试在您的 信用卡上查找利率是什么时候？

这个问题看起来很容易回答，但对于银行来说，客户服务代表帮助解答通常并不容易，因为数据隐藏在数据库、PDF 文档和安全性措施之后。 但一旦您在线安全地确认了您的身份，银行聊天机器人可以使用 RAG 访问您所有的财务文件，并快速回答 21.9%，同时提供相关信息，例如： `作为客户，您在任职期间只支付了两次余额利息。` 如果您需要讨论您的抵押贷款账户，您不需要切换到不同的代理，因为基于 RAG 的聊天机器人也可以帮助您处理这一点！ 它可以处理更 复杂的查询，例如： `我的信用卡利率比我的抵押贷款利率高多少？` 此外，如果您提出后续问题，它理解整个对话的上下文，并以非常人性化和自然的方式与您讨论您的财务账户。 这种级别的支持可以显著提升客户体验，培养对公司的服务忠诚度和信任，比当前系统 能够处理的要更多。

## 医疗保健

在医疗保健领域，由 RAG 驱动的聊天机器人 可以通过访问医疗记录（在适当的权限下）来提供个性化的健康建议或协助预约安排。 如果患者询问如何管理他们新诊断的糖尿病，聊天机器人可以分析他们的医疗历史、药物和最近的实验室结果，以提供关于生活方式改变、饮食和药物管理的定制建议。 聊天机器人甚至可以安排与他们的医疗提供者的后续预约并发送提醒，从而创造一个更全面和吸引人的患者支持体验。 这种程度的个性化护理可以显著改善患者结果，增强对医疗体系的信任，并减轻对 医疗专业人员的工作负担。

尽管 RAG 不仅仅用于聊天机器人。 让我们讨论另一个具有显著 RAG 活动的领域：自动化数据分析报告。

# 用于自动报告的 RAG

使用 RAG 结合数据分析并通过其自动化报告功能进行报告的公司，在他们的能力和执行分析所需的时间上看到了显著的提升。 这种 RAG 的创新应用在无结构数据的广阔数据湖和业务每天需要的关键决策和创新洞察之间架起了一座桥梁。 通过利用 RAG 进行自动化报告，公司可以显著简化他们的报告流程，提高准确性，并揭示隐藏在数据中的宝贵洞察。 让我们从它在 这个环境中如何被利用开始。

## 如何利用自动化报告来应用 RAG

虽然 有无数种设置此类自动化报告的方法，但通常目标是那些报告相对标准化的领域，这使得将其编码到 RAG 环境中变得更加容易。 通常，您从一个已经在代码层面上存在的自动化报告开始，但您可以使用 GenAI 和/或 RAG-like 技术来帮助使这种自动化更加有效。 例如，一组初始分析问题可以馈送到 RAG 系统，而无需用户输入，这些内容被添加到初始报告中。 这种初始分析不仅可以包括图表和图形，还可以包括来自 **大型语言模型** (**LLM**) 的评论，所有这些都作为 RAG 管道的初始组件。

在许多自动化报告场景中，自动化报告通常是帮助决策者，即 *自动化报告的使用者 ，理解数据的第一个步骤。 决策者通常会根据他们在自动化报告中看到的内容要求进行更多分析。 将您的自动化报告作为更大 RAG 系统的一部分，基本上可以替代和/或加速这些数据分析场景中通常存在的来回沟通，帮助重要的决策者更快地获取关键数据分析，并做出更有效的决策。 您可以将报告数据和生成该报告的基础数据提供给 RAG 系统，这反过来又允许非技术员工提出大量非常广泛的问题，而无需等待数据分析师进行额外的分析。 可以向 RAG 系统添加额外的数据源，使讨论和分析更加深入，可能远远超出简单 自动化分析所能提供的。

其中大部分数据隐藏在非结构化数据中，这已被证明是公司难以利用的数据类型。 让我们谈谈 RAG 如何帮助支持自动化报告的非结构化数据。

## 将非结构化数据转化为可操作的见解

当今组织可用的绝大多数数据都是非结构化的，范围从文章和研究论文到社交媒体内容和网络内容。 这种非结构化特性使得通过传统数据分析手段进行处理和分析变得具有挑战性。 RAG 作为一种强大的方法介入其中，可以解析这些数据，从传统上难以触及的数据中提取信息，创建初始草案和摘要，甚至可以根据个人需求进行定制，并基于个人的角色或兴趣突出显示最关键的信息。 与直接使用 LLM 相比，RAG 可以作为一个更复杂的工具为用户服务，因为它可以替代他们在与 LLM 交互时通常需要手动完成的许多任务。 在数据分析自动化报告的世界中，这一概念也可以应用，其中许多步骤可以在 RAG 系统中复制，使它们更快、更有效。 这个过程不仅节省了时间，还确保决策者可以快速抓住数据的精髓，而不会被其数量所困扰。

值得注意的是，当涉及到非结构化数据时，这通常是 RAG 索引阶段的一个步骤，其中这些数据被转换成一种新的格式，使其对整个 RAG 系统更有帮助。 例如，一个 PDF 可能被提取成具有不同重要级别的各种不同元素。 标题和标题可能比段落在重要性级别上更有权重。 图像可能被检测为表格，然后可以提取为表格摘要，向量化，并在 RAG 系统中稍后使用。 正是这些步骤使得非结构化数据更容易被自动化报告所访问。

在寻找组织内自动化报告应关注的领域时，从及时信息最关键的区域开始。 例如，在市场分析中，RAG 可以迅速总结新闻文章、财务报告和竞争对手信息，为公司提供市场趋势和动态的浓缩视图。 这种快速处理允许用户迅速对市场变化做出反应，抓住机会或迅速为您的公司减轻风险。

## 提高决策和战略规划

RAG 的自动化报告和创新侦察能力显著提高了决策和战略规划过程。通过为高管和策略家提供关于行业趋势、技术进步和竞争格局的简洁、总结性报告和见解，RAG 使决策更加明智和战略化。 通过添加针对这些报告生成数据提出额外问题的 RAG 导向能力，这些用户的价值得到了极大的提升。

RAG 在这个领域的倡议依赖于它们快速吸收和分析多样化数据集的能力。这 使得使用 RAG 进行此目的的公司能够采取更积极主动的战略制定方法。 企业不再对行业变化做出反应，而是可以预测市场或技术的变化，并相应地调整其战略，确保他们始终领先于 其竞争对手。

由于基于 RAG 的应用程序，自动化数据分析和报告的世界大幅扩张，我们看到的另一个增长领域是在电子商务网站上动态生成产品描述和推荐，我们将在下一节中介绍。 这一节。

# 电子商务支持

电子商务是一个 可以从 RAG 应用中显著受益的关键领域。 让我们回顾一下 RAG 可以应用的几个领域，从 产品描述 开始。

## 动态在线产品描述

RAG 生成个性化产品描述的能力对电子商务企业来说是一个颠覆性的变革。通过利用 RAG 的力量，公司可以创建高度针对性和有说服力的产品描述，这些描述与个别客户产生共鸣，最终推动销售并培养品牌忠诚度。 RAG 可以生成针对用户过去行为和偏好的个性化产品描述或突出功能，考虑到 RAG 分析大量客户数据的能力，包括浏览历史、过去购买，甚至社交媒体互动。

例如，假设 Rylee 是一位经常购买环保产品的用户。 当 Rylee 浏览电子商务网站时，RAG 可以用来说明产品的可持续性方面。 这为 Rylee 提供了更好的用户体验，同时也提高了她购买该产品的可能性。 现在，假设 Rylee 之前购买过跑步鞋，并且经常参与与马拉松训练相关的活动。 当 Rylee 在由 RAG 驱动的电子商务网站上浏览跑步鞋时，产品描述可以动态生成，强调如缓震、稳定性和耐用性等关键因素——这些都是长跑运动员的关键因素。 描述还可能包括与 Rylee 的兴趣相关的额外信息，例如鞋子是如何被马拉松运动员测试的，或者它们是如何设计来降低常见跑步伤害风险的。

此外，RAG 还可以用于分析客户评论和反馈，以确定产品最常提到的优缺点。 这些信息可以融入产品描述中，为潜在买家提供更平衡和全面的产品概述。 通过解决常见问题或突出高度赞扬的特点，RAG 生成的描述可以帮助客户做出更明智的购买决策，减少退货或 负面评论的可能性。

RAG 还可以用于生成多语言的产品描述，这使得企业更容易进入国际市场。 通过在多样化的语言数据集上训练 RAG，公司可以确保其产品描述符合文化规范，并与不同地区的客户产生共鸣。 。

产品描述是电子商务中受益于 RAG 的一个领域。 让我们也谈谈推荐引擎 是如何受益的。

## 电子商务网站的产品推荐

**推荐引擎** 是商业世界中人工智能的一个重要应用。 通用人工智能和 RAG 有潜力使这些推荐引擎更加有效。 使用 RAG 进行产品推荐的一个关键优势是其分析大量客户数据的能力，包括浏览历史、过去的购买记录、搜索查询，甚至社交媒体互动。 通过理解客户的独特兴趣、风格偏好和购物习惯，RAG 可以生成不仅相关而且对每个个体都极具吸引力的产品推荐。 RAG 可以比以前的方法更深入地识别模式和偏好，最终推荐用户可能觉得最具吸引力的产品。 RAG 使我们能够远远超出传统的推荐引擎，整合对个人用户偏好的更深入理解，从而实现更准确和个性化的推荐。

例如，假设 Aubri 是我们的一位 VIP 客户，她经常购买户外装备，最近在我们的电子商务网站上浏览了徒步靴。 RAG 可以分析 Aubri 的数据，并根据她的偏好和过去的购买记录推荐最合适的徒步靴，以及互补产品，如徒步袜、背包和登山杖。 通过展示与 Aubri 兴趣相符的产品精选，RAG 可以增加她进行多件商品购买的可能性，并提升整体 购物体验。

此外，RAG 可以通过考虑除客户的购买历史之外的更多因素，将产品推荐提升到新的水平。 例如，RAG 可以分析客户的产品评论和评分，以了解他们对以前购买的满意度。 这些信息可用于改进未来的推荐，确保客户看到的产品不仅符合他们的兴趣，也满足他们的 质量期望。

RAG 在个性化产品推荐中的应用不仅限于电子商务网站。 通过利用 RAG 的力量，公司可以在各种接触点提供高度针对性和吸引人的体验，包括媒体、内容平台和数字 营销活动。

随着电子商务的持续增长和发展，个性化的引人注目的产品描述的重要性不容忽视。通过利用 RAG 的力量，企业可以创建不仅提供信息而且具有说服力的描述，最终推动销售并建立持久的客户关系。 其中很大一部分得益于 RAG 搜索大量数据的能力。 接下来，让我们讨论这些相同的搜索和数据访问能力如何通过 员工帮助公司更好地利用内部知识。

# 利用 RAG 的知识库

RAG 可以访问和利用知识库，无论是内部还是外部。让我们从 **内部** **知识库**开始。

## 内部知识库的可搜索性和实用性

将高级信息检索的概念与最先进的 LLMs 相结合，RAG 在内部搜索引擎领域带来显著进步毫不奇怪。高级搜索和智能能力的结合通过允许我们以更复杂的方式访问数据，更好地利用企业积累的大量数据，正在改变企业运营。 这项变革性技术不仅简化了信息的检索，还丰富了呈现数据的质量，成为多个行业决策和运营效率的基石。

RAG 显著增强了内部知识库的可搜索性和实用性，作为改善信息访问和管理的重要催化剂。内部知识库包括各种非结构化格式的广泛文档（如 PDF、Word、Google Docs、电子表格、演示文稿等），由于规模庞大且提取困难，往往被利用率不高。 RAG 可以通过多种方式解决这一挑战，通过提取数据并以多种先进方式处理。 例如，生成文档的简洁摘要，使员工能够更容易地把握内容的精髓，而无需阅读整个文档。 此外，RAG 可以通过分析这些资源的内容并利用 LLM 的生成能力，从埋藏在数百万页非结构化数据中的内容中提供连贯且准确的答案，从而直接回答查询。 这种直接回答能力对于快速解决特定查询特别有用，有可能显著减少员工在搜索信息上花费的时间。 此外，RAG 还可以通过分析这些资源的内容并利用 LLM 的生成能力，从埋藏在数百万页非结构化数据中的内容中提供连贯且准确的答案，从而直接回答查询。 这种直接回答能力对于快速解决特定查询特别有用，有可能显著减少员工在搜索信息上花费的时间。 这种直接回答能力对于快速解决特定查询特别有用，有可能显著减少员工在搜索信息上花费的时间。 这种直接回答能力对于快速解决特定查询特别有用，有可能显著减少员工在搜索信息上花费的时间。

RAG 在内置搜索引擎中的应用也促进了知识管理的更规范和高效方式。通过实现更好的信息分类和检索，员工可以更快地访问相关数据，从而实现更流畅的工作流程。 这在时间紧迫的环境中尤其有益，快速获取准确信息可以显著影响决策和项目成果。 这在时间紧迫的环境中尤其有益，快速获取准确信息可以显著影响决策和项目成果。

虽然内部知识对于大多数公司来说是关键的战略优势，但外部知识在保持行业竞争优势中也起着重要作用。让我们回顾一下 RAG 如何帮助公司更好地利用外部数据，使其员工能够使用。 让我们回顾一下 RAG 如何帮助公司更好地利用外部数据，使其员工能够使用。 让我们回顾一下 RAG 如何帮助公司更好地利用外部数据，使其员工能够使用。

## 扩展和增强私有数据与通用外部知识库

除了内部 资源之外，RAG 还将其益处扩展到一般 **外部知识库**，这对于需要了解最新法律、法规和行业标准、合规性、研发、医疗领域、学术界和与专利相关的行业至关重要。 这些领域，信息量不仅庞大，而且不断发布和变化，使得保持最新状态变得具有挑战性。 RAG 通过从这些庞大的数据库中检索和总结相关信息来简化这一任务。 例如，在法律和合规领域，RAG 可以快速筛选数千份文件，以找到相关的案例法、法规和合规指南，显著减少法律专业人士和合规官员在研究上花费的时间。 的时间。

同样，在研发过程中，RAG 可以通过为研究人员提供快速访问现有和最新研究、专利和技术文档的能力来加速这一过程。 这种能力对于避免重复劳动和通过建立现有知识来激发新想法至关重要。 在医疗领域，RAG 能够检索相关案例研究、研究论文和治疗指南，可以帮助医疗专业人员做出明智的决定，从而改善患者的护理。 的护理。

使用 LLM（如 ChatGPT）进行自己的研究的一个主要问题是，它们往往会提供虚构但令人信服的信息（称为 **幻觉**）。 RAG 是一种减少这些幻觉的绝佳方式，因为它将 RAG 管道中的 LLM 组件建立在真实数据的基础上，从而减少了您验证回复所需的时间。 您可以在 RAG 管道中添加多个对 LLM 的调用，这不仅可以帮助回答您的研究问题，还可以在提供回复之前验证回复与原始问题的高度相关性。 您还可以定制输出，以提供所有支持性文档 和引用。

除了访问一般知识库之外，RAG 还可以通过其他方式利用外部数据。 让我们讨论创新侦察的概念，以及组织如何使用 RAG 来进一步推动创新并更快地检测其行业中的趋势。 他们的行业。

# 创新侦察和趋势分析

扫描 并总结来自各种质量来源的信息，在创新侦察和趋势分析中也可以发挥关键作用。RAG 可以帮助公司识别与其专业领域相符的新兴趋势和潜在创新领域。 这在快速发展的行业中尤为重要，因为保持领先对于保持 竞争优势至关重要。

在技术领域，RAG 可以分析专利、技术新闻和研究出版物，以识别新兴技术和创新模式。这使公司能够更有效地指导他们的研发工作，专注于具有高增长潜力和 市场颠覆性的领域。

在我目前所在的行业，制药行业，RAG 正被用来通过不断分析医学期刊的最新发布、临床试验报告和专利数据库，来加速识别新的研究成果和潜在药物开发机会的过程。这正在加快创新步伐，并帮助制药公司更有效地分配他们的研究预算和资源。

RAG 的应用范围不仅限于创新侦察和趋势分析。 RAG 在内容个性化方面也取得了显著的进展，特别是在媒体和内容平台领域。 在当今用户被大量内容淹没的数字景观中，RAG 提供了一个强大的解决方案，以突破噪音并交付高度针对性的、个性化的体验。 这是在当今用户被大量内容淹没的数字景观中，RAG 提供了一个强大的解决方案，以突破噪音并交付高度针对性的、个性化的体验。

接下来，让我们讨论这种个性化的整体方法，它可以导致客户忠诚度的提高、更高的转化率，最终是一个更 成功的业务。

# 利用 RAG 在营销沟通中进行个性化推荐

RAG 还可以代表采用它来增强跨媒体、内容平台和数字营销活动中的用户参与度和满意度的公司的一个重要进步。RAG 可以根据客户的偏好创建个性化的产品组合或系列，这些可以用于针对每个客户的数字活动进行广告宣传和包含。 通过分析客户数据并识别互补产品，RAG 可以建议预组装的捆绑包，提供便利 和价值。

RAG 还可以 通过在营销通信中直接提供个性化的产品推荐来提高电子邮件营销活动的有效性。 通过分析客户数据并根据他们的兴趣定制产品建议，电子商务网站可以创建高度针对性和吸引人的电子邮件内容，从而 推动 **点击率** (**CTRs**)** 和转化率。

随着营销不断发展和企业寻求新的方式来吸引客户，RAG 的潜力不仅限于在网站上提供个性化的产品推荐。 RAG 可以被利用来在各种数字接触点上创建定制体验，增强用户参与度并培养长期的 客户忠诚度。

接下来，让我们回顾一下 RAG 的能力如何应用于企业另一个关键领域：员工培训和 教育。

# 培训和教育工作

RAG 可以被教育机构，如大学和中等教育机构使用。 它还可以被内部企业培训项目使用，以保持员工对大量不断变化的概念的最新了解。 RAG 可以根据学习者的具体需求、知识水平和职能生成或定制学习材料。 的。

RAG 在显著提高企业环境中的学习和发展中展现出了巨大的潜力。 对于企业来说，保持员工了解最新的行业知识和技能往往是一项具有挑战性的任务，尤其是在许多行业变化如此之快的今天。 RAG 通过提供个性化的学习体验来帮助解决这一挑战，这些体验根据每个员工的具体需求、学习风格和进度来调整其内容。 内容。

RAG 可以分析员工的职位、经验水平和学习历史，以定制一个专注于他们特定职位最相关和基本技能的学习路径。 这种个性化的方法确保员工接受到的培训直接有助于他们的职业成长并与公司的 目标保持一致。

此外，RAG 还可以用于生成针对每个员工的学习风格和进度的交互式学习材料，例如测验、案例研究和模拟。 这种适应性学习方法使员工保持参与和动力，因为他们会收到挑战他们正确水平的内容，并立即获得关于 他们表现的反馈。

RAG 能够快速总结和展示从庞大的知识库中提取的相关信息，这也使其成为在职学习和绩效支持的无价工具。 员工可以使用 RAG 系统快速获取他们解决问题、做出决策和更高效完成任务所需的信息。 这种 **即时** (**JIT**) 学习方法减少了长时间正式培训的需求，并赋予员工控制他们学习和发展的权力。 和

除了个性化学习外，RAG 还能使员工之间的协作和知识共享更加有效。 通过分析每个个体的知识和技能，RAG 可以 识别 **主题专家** (**SMEs**) 并促进可以相互学习的员工之间的联系。 这种内部知识流动促进了持续学习的文化，并帮助组织保留和利用他们的 集体专业知识。

正如我们所见，RAG 具有巨大的潜力来改变公司运营的各个方面，从个性化学习和员工发展，到客户参与和流程优化。 然而，RAG 的成功实施需要与公司目标和优先事项相一致的战略方法。

之前提到的许多 RAG 应用的一个关键方面是将相关数据和来源包含在生成的回复中。 例如，当使用 RAG 爬取法律文件或科学研究论文时，引用来源对于提供信息的可信度和支持至关重要。 让我们探讨如何将 *第二章* 的代码示例扩展 以包含此功能。

# 代码实验室 3.1 – 向您的 RAG 添加来源

许多 之前提到的 应用中包括向响应中添加更多数据的元素。 例如，如果你有一个 RAG 管道，它会爬取法律文件或科学论文作为在*扩展和增强私人数据**基础**或*创新侦察和趋势* *分析**部分描述的努力的一部分，你可能会想要引用你响应的来源。

我们将继续从 *第二章* 的代码，并添加在 RAG 响应中返回检索到的文档的这个有价值的步骤。

从 *第二章*的代码开始，我们需要将这些元素引入到这段代码中，我将逐一解释正在发生的事情： 这是：

```py
 from langchain_core.runnables import RunnableParallel
```

这是一个新的导入：来自 LangChain runnables 的 `RunnableParallel` 对象。 这引入了并行运行检索器和问题的概念。 这可以通过允许检索器在同时处理问题时获取上下文来提高性能：

```py
 rag_chain_from_docs = (
    RunnablePassthrough.assign(context=(
        lambda x: format_docs(x["context"])))
    | prompt
    | llm
    | StrOutputParser()
)
rag_chain_with_source = RunnableParallel(
    {"context": retriever,
     "question": RunnablePassthrough()}
).assign(answer=rag_chain_from_docs)
```

与我们的原始 `rag_chain` 对象进行比较：

```py
 rag_chain = (
    {"context": retriever | format_docs,
     "question": RunnablePassthrough()}
    | prompt
    | llm
    | StrOutputParser()
)
```

在原始代码中， `rag_chain` 是通过一个字典构建的，该字典结合了检索器和 `format_docs` 函数用于 `"context"，以及 `RunnablePassthrough()` 用于 `"question"。然后，这个字典通过`|`)传递给 `prompt`，`llm`，和 `StrOutputParser()`。

在这个新版本中，称为 `rag_chain_from_docs`， `rag_chain` 的构建被分为 两部分：

+   使用 `rag_chain_from_docs` 链是通过 `RunnablePassthrough.assign()` 创建的，用于格式化从上下文中检索到的文档。 然后通过 `prompt`， `llm`， 和 `StrOutputParser()`将格式化的上下文传递。

+   使用 `rag_chain_with_source` 链是通过 `RunnableParallel()` 创建的，以并行运行检索器和 `RunnablePassthrough()` ，分别用于 `"context"` 和 `"question"`。 然后将结果分配给 `"answer"` ，使用 `rag_chain_from_docs`。

这两种方法在功能上的主要区别在于，新方法将上下文的检索与检索文档的格式化和处理分离。 这在使用提示、LLM 和输出解析器之前处理检索到的上下文时提供了更大的灵活性。

最后，我们必须更改传递给用户的查询的链名称，以匹配新的链名称， `rag_chain_with_source`。就像我们过去做的那样，我们调用 invoke 方法， `rag_chain_with_source.invoke()`，传递问题，这 触发了检索器和问题的并行执行，然后使用 `rag_chain_from_docs` 对检索到的上下文进行格式化和处理，以生成 最终答案：

```py
 rag_chain_with_source.invoke(
    "What are the Advantages of using RAG?")
```

输出将看起来像这样（我缩短了一些文本以适应这本书，但您应该在代码运行时看到完整的打印输出！）：

```py
 {'context': [Document(page_content='Can you imagine what you could do with all of the benefits mentioned above…', metadata={'source': 'https://kbourne.github.io/chapter1.html'}),
 Document(page_content='Maintaining this integration over time, especially as data sources evolve or expand…', metadata={'source': 'https://kbourne.github.io/chapter1.html'}),…}
```

这段代码看起来比我们之前的最终输出更像代码，但它包含了您需要提供给用户的所有信息，以表明您提供的响应的来源。 对于许多用例，这种材料的来源对于帮助用户理解为什么响应是这样的非常重要，实际上检查它，以及如果他们需要添加其他内容，可以在此基础上进行扩展。 。

注意在每个 `page_content` 实例之后列出的元数据来源，这就是您作为源链接提供的内容。 在您有多个文档在结果中出现的情况下，这可能在检索步骤中返回的每个单独文档中有所不同，但我们在这里只使用一个 文档。

# 摘要

RAG 的实际应用多种多样且影响深远，从增强聊天机器人和自动化报告到个性化客户体验以及颠覆各个领域的支持。 RAG 可以帮助您弥合非结构化数据与可操作见解之间的差距，增强决策和战略规划。 RAG 可以帮助您生成动态、个性化的产品描述和推荐，推动您的销售并培养 品牌忠诚度。

RAG 可以增强内部知识库的可搜索性和实用性，并可以通过外部通用知识扩展私有数据，这对于法律、合规、研发和医疗保健等领域的至关重要。 它可以帮助您进行创新侦察和趋势分析，并通过内容个性化为您提供高度定制、引人入胜的体验。 RAG 还可以为您的公司提供个性化的学习体验，适应每位员工的需求和 学习风格。

随着本章的结束，很明显，RAG 有潜力改变您业务运营的各个方面，我们期待着与您共同开启这段冒险 之旅！

在下一章中，我们将更深入地探讨构成 RAG 系统的技术组件，探索索引、检索和生成的复杂性以及这些阶段如何整合以提供本章中讨论的强大功能。 通过分解每个组件，您将获得对内部运作的详细理解以及它们如何相互作用以产生增强的 生成输出。
