- en: Clients Subscription Assessment for Bank Telemarketing using Deep Neural Networks
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用深度神经网络评估银行电话营销客户订阅情况
- en: In this chapter, we will see two examples of how to build very robust and accurate
    predictive models for predictive analytics using H2O on a bank marketing dataset.
    The data is related to the direct marketing campaigns of a Portuguese banking
    institution. The marketing campaigns were based on phone calls. The goal of this
    end-to-end project is to predict that the client will subscribe to a term deposit.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 本章将展示两个例子，说明如何使用H2O在银行营销数据集上构建非常稳健且准确的预测模型进行预测分析。数据与葡萄牙一家银行机构的直接营销活动相关，这些营销活动基于电话进行。这个端到端项目的目标是预测客户是否会订阅定期存款。
- en: 'Throughout this project, the following topics will be covered in this chapter:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 本项目将涵盖以下主题：
- en: Client subscription assessment
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 客户订阅评估
- en: Dataset description
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据集描述
- en: Exploratory analysis of the dataset
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 数据集的探索性分析
- en: Client subscription assessment using H2O
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用H2O进行客户订阅评估
- en: Tuning hyperparameters
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 调整超参数
- en: Client subscription assessment through telemarketing
  id: totrans-8
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 通过电话营销进行客户订阅评估
- en: Some time ago, due to the global financial crisis, getting credit in international
    markets became more restricted for banks. This turned attention to internal customers
    and their deposits to gather funds. This led to a demand for information about
    a client's behavior for their deposits and their response to telemarketing campaigns
    conducted by the banks periodically. Often, more than one contact to the same
    client is required in order to assess whether the product (bank term deposit)
    will be (**yes**) or will be (**no**) subscribed.
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: 一段时间前，由于全球金融危机，银行在国际市场获得信贷的难度加大。这使得银行开始关注内部客户及其存款以筹集资金。这导致了对客户存款行为及其对银行定期电话营销活动响应的需求。通常，为了评估产品（银行定期存款）是否会被（**是**）或（**否**）订阅，需要与同一客户进行多次联系。
- en: The aim of this project is to implement an ML model that predicts that the client
    will subscribe to a term deposit (variable `y`). In short, this is a binary classification
    problem. Now, before we start implementing our application, we need to know about
    the dataset. Then we will see an explanatory analysis of the dataset.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 本项目的目的是实现一个机器学习模型，预测客户是否会订阅定期存款（变量`y`）。简而言之，这是一个二分类问题。在开始实现应用之前，我们需要了解数据集。接着，我们将进行数据集的解释性分析。
- en: Dataset description
  id: totrans-11
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 数据集描述
- en: 'There are two sources that I would like to acknowledge. This dataset was used
    in a research paper published by Moro et al, *A Data-Driven Approach to Predict
    the Success of Bank Telemarketing*, Decision Support Systems, Elsevier, June 2014\.
    Later on, it was donated to the UCI Machine Learning repository and can be downloaded
    from [https://archive.ics.uci.edu/ml/datasets/bank+marketing](https://archive.ics.uci.edu/ml/datasets/bank+marketing).
    According to the dataset description, there are four datasets:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
  zh: 我想感谢两个数据来源。此数据集曾被Moro等人在论文《A Data-Driven Approach to Predict the Success of
    Bank Telemarketing》中使用，发表在《决策支持系统》期刊（Elsevier，2014年6月）。之后，它被捐赠到UCI机器学习库，并可以从[https://archive.ics.uci.edu/ml/datasets/bank+marketing](https://archive.ics.uci.edu/ml/datasets/bank+marketing)下载。根据数据集描述，数据集包括四个子集：
- en: '`bank-additional-full.csv`: This includes all examples (41,188) and 20 inputs,
    ordered by date (from May 2008 to November 2010), very close to the data analyzed
    by Moro et al, 2014'
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`bank-additional-full.csv`：包含所有示例（41,188个）和20个输入，按日期排序（从2008年5月到2010年11月），与Moro等人2014年分析的数据非常接近'
- en: '`bank-additional.csv`: This includes 10% of the examples (4,119), randomly
    selected from 1 and 20 inputs'
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`bank-additional.csv`：包含10%的示例（4,119个），从1和20个输入中随机选择'
- en: '`bank-full.csv`: This includes all the examples and 17 inputs, ordered by date
    (an older version of this dataset with fewer inputs)'
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`bank-full.csv`：包含所有示例和17个输入，按日期排序（该数据集的旧版本，输入较少）'
- en: '`bank.csv`: This includes 10% of the examples and 17 inputs randomly selected
    from three (an older version of this dataset with fewer inputs)'
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`bank.csv`：包含10%的示例和17个输入，随机选择自三个输入（该数据集的旧版本，输入较少）'
- en: 'There are 21 attributes in the dataset. The independent variables, that is,
    features, can be further categorized as bank-client-related data (attributes 1
    to 7), related to the last contact with the current campaign (attributes 8 to
    11), other attributes (attributes 12 to 15), and social and economic context attributes
    (attributes 16 to 20). The dependent variable is specified by `y`, the last attribute
    (21):'
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 数据集包含21个属性。独立变量，即特征，可以进一步分类为与银行客户相关的数据（属性1到7），与本次活动的最后一次联系相关的数据（属性8到11），其他属性（属性12到15），以及社会和经济背景属性（属性16到20）。因变量由`y`指定，即最后一个属性（21）：
- en: '| **ID** | **Attribute** | **Explanation** |'
  id: totrans-18
  prefs: []
  type: TYPE_TB
  zh: '| **ID** | **属性** | **解释** |'
- en: '| 1 | `age` | Age in numbers. |'
  id: totrans-19
  prefs: []
  type: TYPE_TB
  zh: '| 1 | `age` | 年龄（数值）。 |'
- en: '| 2 | `job` | This is the type of job in a categorical format, with these possible
    values: `admin`, `blue-collar`, `entrepreneur`, `housemaid`, `management`, `retired`,
    `self-employed`, `services`, `student`, `technician`, `unemployed`, and `unknown`.
    |'
  id: totrans-20
  prefs: []
  type: TYPE_TB
  zh: '| 2 | `job` | 这是工作类型的分类格式，可能的值有：`admin`、`blue-collar`、`entrepreneur`、`housemaid`、`management`、`retired`、`self-employed`、`services`、`student`、`technician`、`unemployed`和`unknown`。
    |'
- en: '| 3 | `marital` | This is the marital status in a categorical format, with
    these possible values: `divorced`, `married`, `single`, and `unknown`. Here, `divorced`
    means divorced or widowed. |'
  id: totrans-21
  prefs: []
  type: TYPE_TB
  zh: '| 3 | `marital` | 这是婚姻状况的分类格式，可能的值有：`divorced`、`married`、`single`和`unknown`。其中，`divorced`表示离婚或丧偶。
    |'
- en: '| 4 | `education` | This is the educational background in categorical format,
    with possible values as follows: `basic.4y`, `basic.6y`, `basic.9y`, `high.school`, `illiterate`, `professional.course`, `university.degree`,
    and `unknown`. |'
  id: totrans-22
  prefs: []
  type: TYPE_TB
  zh: '| 4 | `education` | 这是教育背景的分类格式，可能的值如下：`basic.4y`、`basic.6y`、`basic.9y`、`high.school`、`illiterate`、`professional.course`、`university.degree`和`unknown`。
    |'
- en: '| 5 | `default` | This is a categorical format with possible values in credit
    in default as `no`, `yes`, and `unknown`. |'
  id: totrans-23
  prefs: []
  type: TYPE_TB
  zh: '| 5 | `default` | 这是一个分类格式，表示信用是否违约，可能的值为`no`、`yes`和`unknown`。 |'
- en: '| 6 | `housing` | Does the customer have a housing loan? |'
  id: totrans-24
  prefs: []
  type: TYPE_TB
  zh: '| 6 | `housing` | 客户是否有住房贷款？ |'
- en: '| 7 | `loan` | The personal loan in a categorical format, with possible values
    as `no`, `yes`, and `unknown`. |'
  id: totrans-25
  prefs: []
  type: TYPE_TB
  zh: '| 7 | `loan` | 个人贷款的分类格式，可能的值为`no`、`yes`和`unknown`。 |'
- en: '| 8 | `contact` | This is the contact communication type in a categorical format.
    The possible values are `cellular` and `telephone`. |'
  id: totrans-26
  prefs: []
  type: TYPE_TB
  zh: '| 8 | `contact` | 这是联系的沟通方式，采用分类格式。可能的值有`cellular`和`telephone`。 |'
- en: '| 9 | `month` | This is the last contact month of the year in a categorical
    format with possible values `jan`, `feb`, `mar`, ..., `nov`, and `dec`. |'
  id: totrans-27
  prefs: []
  type: TYPE_TB
  zh: '| 9 | `month` | 这是最后一次联系的月份，采用分类格式，可能的值为`jan`、`feb`、`mar`、...、`nov`和`dec`。
    |'
- en: '| 10 | `day_of_week` | This is the last contact day of the week in a categorical
    format with possible values `mon`, `tue`, `wed`, `thu`, and `fri`. |'
  id: totrans-28
  prefs: []
  type: TYPE_TB
  zh: '| 10 | `day_of_week` | 这是最后一次联系的星期几，采用分类格式，可能的值有`mon`、`tue`、`wed`、`thu`和`fri`。
    |'
- en: '| 11 | `duration` | This is the last contact duration, in seconds (numerical
    value). This attribute highly affects the output target (for example, if `duration=0`,
    then `y=no`). Yet, the duration is not known before a call is performed. Also,
    after the end of the call, `y` is obviously known. Thus, this input should only
    be included for benchmark purposes and should be discarded if the intention is
    to have a realistic predictive model. |'
  id: totrans-29
  prefs: []
  type: TYPE_TB
  zh: '| 11 | `duration` | 这是最后一次联系的持续时间，单位为秒（数值）。这个属性对输出目标有很大影响（例如，如果`duration=0`，则`y=no`）。然而，持续时间在通话之前是未知的。此外，通话结束后，`y`显然已知。因此，只有在基准测试时才应包括此输入，如果目的是建立一个现实的预测模型，则应丢弃此输入。
    |'
- en: '| 12 | `campaign` | This is the number of contacts performed during this campaign
    and for this client. |'
  id: totrans-30
  prefs: []
  type: TYPE_TB
  zh: '| 12 | `campaign` | 这是本次活动中与此客户进行的联系次数。 |'
- en: '| 13 | `pdays` | This is the number of days that passed by after the client
    was last contacted by a previous campaign (numeric; 999 means client was not previously
    contacted). |'
  id: totrans-31
  prefs: []
  type: TYPE_TB
  zh: '| 13 | `pdays` | 这是自上次与客户的前一个活动联系以来经过的天数（数值；999表示客户之前没有被联系过）。 |'
- en: '| 14 | `previous` | This is the number of contacts performed before this campaign
    and for this client (numeric). |'
  id: totrans-32
  prefs: []
  type: TYPE_TB
  zh: '| 14 | `previous` | 这是此客户在本次活动之前进行的联系次数（数值）。 |'
- en: '| 15 | `poutcome` | The outcome of the previous marketing campaign (categorical:
    `failure`, `nonexistent`, and `success`). |'
  id: totrans-33
  prefs: []
  type: TYPE_TB
  zh: '| 15 | `poutcome` | 上一次营销活动的结果（分类：`failure`、`nonexistent`和`success`）。 |'
- en: '| 16 | `emp.var.rate` | Employment variation rate—quarterly indicator (numeric).
    |'
  id: totrans-34
  prefs: []
  type: TYPE_TB
  zh: '| 16 | `emp.var.rate` | 就业变化率—季度指标（数值）。 |'
- en: '| 17 | `cons.price.idx` | Consumer price index—monthly indicator (numeric).
    |'
  id: totrans-35
  prefs: []
  type: TYPE_TB
  zh: '| 17 | `cons.price.idx` | 消费者价格指数—月度指标（数字）。 |'
- en: '| 18 | `cons.conf.idx` | Consumer confidence index—monthly indicator (numeric).
    |'
  id: totrans-36
  prefs: []
  type: TYPE_TB
  zh: '| 18 | `cons.conf.idx` | 消费者信心指数—月度指标（数字）。 |'
- en: '| 19 | `euribor3m` | Euribor 3 month rate—daily indicator (numeric). |'
  id: totrans-37
  prefs: []
  type: TYPE_TB
  zh: '| 19 | `euribor3m` | 欧元区 3 个月利率—每日指标（数字）。 |'
- en: '| 20 | `nr.employed` | Number of employees—quarterly indicator (numeric). |'
  id: totrans-38
  prefs: []
  type: TYPE_TB
  zh: '| 20 | `nr.employed` | 员工人数—季度指标（数字）。 |'
- en: '| 21 | `y` | Signifies whether the client has subscribed a term deposit. It
    has possible binary (`yes` and `no`) values. |'
  id: totrans-39
  prefs: []
  type: TYPE_TB
  zh: '| 21 | `y` | 表示客户是否订阅了定期存款。其值为二进制（`yes` 和 `no`）。 |'
- en: 'Table 1: Description of the bank marketing dataset'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 表 1：银行营销数据集描述
- en: For the exploratory analysis of the dataset, we will be using Apache Zeppelin
    and Spark. We'll start by visualizing the distributions of the categorical features,
    and then the numeric features. At the end, we'll compute some statistics that
    describe numeric features. But before that, let's configure Zeppelin.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 对于数据集的探索性分析，我们将使用 Apache Zeppelin 和 Spark。我们将首先可视化分类特征的分布，然后是数值特征。最后，我们将计算一些描述数值特征的统计信息。但在此之前，让我们配置
    Zeppelin。
- en: Installing and getting started with Apache Zeppelin
  id: totrans-42
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 安装并开始使用 Apache Zeppelin
- en: Apache Zeppelin is a web-based notebook that enables you to do data analytics
    in an interactive way. Using Zeppelin, you can make beautiful, data-driven, interactive,
    and collaborative documents with SQL, Scala, and more. The Apache Zeppelin interpreter
    concept allows any language/data processing backend to be plugged into Zeppelin.
    Currently, Apache Zeppelin supports many interpreters such as Apache Spark, Python,
    JDBC, Markdown, and Shell.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: Apache Zeppelin 是一个基于 Web 的笔记本，允许您以交互方式进行数据分析。使用 Zeppelin，您可以制作美丽的、数据驱动的、互动的和协作的文档，支持
    SQL、Scala 等。Apache Zeppelin 的解释器概念允许将任何语言/数据处理后端插件集成到 Zeppelin 中。目前，Apache Zeppelin
    支持许多解释器，如 Apache Spark、Python、JDBC、Markdown 和 Shell。
- en: 'Apache Zeppelin is a relatively newer technology from Apache Software Foundation
    that enables the data scientist, engineer, and practitioner to do data exploration,
    visualization, sharing, and collaboration with multiple programming language backends
    (such as Python, Scala, Hive, SparkSQL, Shell, Markdown, and more). Since using
    other interpreters is not the goal of this book, we''ll be using Spark on Zeppelin,
    and all the codes will be written using Scala. In this section, therefore, we
    will show you how to configure Zeppelin using a binary package that contains only
    the Spark interpreter. Apache Zeppelin officially supports, and is tested in,
    the following environments:'
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: Apache Zeppelin 是 Apache 软件基金会推出的一项相对较新的技术，它使数据科学家、工程师和从业者能够进行数据探索、可视化、共享和协作，支持多种编程语言的后端（如
    Python、Scala、Hive、SparkSQL、Shell、Markdown 等）。由于本书的目标不是使用其他解释器，因此我们将在 Zeppelin
    上使用 Spark，所有代码将使用 Scala 编写。因此，在本节中，我们将向您展示如何使用仅包含 Spark 解释器的二进制包配置 Zeppelin。Apache
    Zeppelin 官方支持并在以下环境中经过测试：
- en: '| **Requirements** | **Value/Version** |'
  id: totrans-45
  prefs: []
  type: TYPE_TB
  zh: '| **要求** | **值/版本** |'
- en: '| Oracle JDK | 1.7+ (set `JAVA_HOME`) |'
  id: totrans-46
  prefs: []
  type: TYPE_TB
  zh: '| Oracle JDK | 1.7+（设置 `JAVA_HOME`） |'
- en: '| OS | Mac OS X Ubuntu 14.X+'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: '| 操作系统 | Mac OS X Ubuntu 14.X+'
- en: CentOS 6.X+
  id: totrans-48
  prefs: []
  type: TYPE_NORMAL
  zh: CentOS 6.X+
- en: Windows 7 Pro SP1+ |
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: Windows 7 Pro SP1+ |
- en: 'As shown in the preceding table, Java is required to execute Spark code on
    Zeppelin. Therefore, if it is not set up, install and set up java on any of the
    platforms mentioned earlier. The latest release of Apache Zeppelin can be downloaded
    from [https://zeppelin.apache.org/download.html](https://zeppelin.apache.org/download.html).
    Each release has three options:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 如上表所示，执行 Spark 代码需要 Java。因此，如果未设置 Java，请在前述任何平台上安装并配置 Java。可以从 [https://zeppelin.apache.org/download.html](https://zeppelin.apache.org/download.html)
    下载 Apache Zeppelin 的最新版本。每个版本都有三种选项：
- en: '**Binary package with all interpreters**: Contains all the support for many
    interpreters. For example, Spark, JDBC, Pig, Beam, Scio, BigQuery, Python, Livy,
    HDFS, Alluxio, Hbase, Scalding, Elasticsearch, Angular, Markdown, Shell, Flink,
    Hive, Tajo, Cassandra, Geode, Ignite, Kylin, Lens, Phoenix, and PostgreSQL are
    currently supported in Zeppelin.'
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**包含所有解释器的二进制包**：包含对多个解释器的支持。例如，Zeppelin 目前支持 Spark、JDBC、Pig、Beam、Scio、BigQuery、Python、Livy、HDFS、Alluxio、Hbase、Scalding、Elasticsearch、Angular、Markdown、Shell、Flink、Hive、Tajo、Cassandra、Geode、Ignite、Kylin、Lens、Phoenix
    和 PostgreSQL 等。'
- en: '**Binary package with Spark interpreter**: Usually, this contains only the Spark
    interpreter. It also contains an interpreter net-install script.'
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**包含 Spark 解释器的二进制包**：通常，这仅包含 Spark 解释器。它还包含一个解释器网络安装脚本。'
- en: '**Source**: You can also build Zeppelin with all the latest changes from the
    GitHub repository (more on this later). To show you how to install and configure
    Zeppelin, we have downloaded the binary package from this site''s mirror. Once
    you have downloaded it, unzip it somewhere on your machine. Suppose the path where
    you have unzipped the file is `/home/Zeppelin/`.'
  id: totrans-53
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Source**：你也可以从GitHub仓库构建带有所有最新更改的Zeppelin（稍后详细讲解）。为了向你展示如何安装和配置Zeppelin，我们从此网站的镜像下载了二进制包。下载后，将其解压到你的机器上的某个位置。假设你解压的路径是`/home/Zeppelin/`。'
- en: Building from the source
  id: totrans-54
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 从源代码构建
- en: 'You can also build Zeppelin with all the latest changes from the GitHub repository.
    If you want to build from the source, you must first install the following dependencies:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 你还可以从GitHub仓库构建带有所有最新更改的Zeppelin。如果你想从源代码构建，必须首先安装以下依赖项：
- en: '**Git**: Any version'
  id: totrans-56
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Git**：任何版本'
- en: '**Maven**: 3.1.x or higher'
  id: totrans-57
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Maven**：3.1.x或更高版本'
- en: '**JDK**: 1.7 or higher'
  id: totrans-58
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**JDK**：1.7或更高版本'
- en: If you haven't installed Git and Maven yet, check out the Build requirements
    at [http://zeppelin.apache.org/docs/latest/install/build.html#build-requirements](http://zeppelin.apache.org/docs/latest/install/build.html#build-requirements).
    Due to page limitations, we have not discussed all the steps in detail. Interested
    readers should refer to this URL more details on Apache Zeppelin website at [http://zeppelin.apache.org/](http://zeppelin.apache.org/).
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你还没有安装Git和Maven，可以查看[http://zeppelin.apache.org/docs/latest/install/build.html#build-requirements](http://zeppelin.apache.org/docs/latest/install/build.html#build-requirements)中的构建要求。由于页面限制，我们没有详细讨论所有步骤。感兴趣的读者应参考此URL，获取更多关于Apache
    Zeppelin的信息：[http://zeppelin.apache.org/](http://zeppelin.apache.org/)。
- en: Starting and stopping Apache Zeppelin
  id: totrans-60
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 启动和停止Apache Zeppelin
- en: 'On all UNIX-like platforms (such as Ubuntu, Mac, and so on), use the following
    command:'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 在所有类Unix平台（如Ubuntu、Mac等）上，使用以下命令：
- en: '[PRE0]'
  id: totrans-62
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'If the preceding command is successfully executed, you should observe the following
    logs on the terminal:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 如果前面的命令成功执行，你应该在终端中看到以下日志：
- en: '![](img/f2e1f12f-b74a-47d1-93bb-e67096f361ad.png)'
  id: totrans-64
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f2e1f12f-b74a-47d1-93bb-e67096f361ad.png)'
- en: 'Figure 1: Starting Zeppelin from the Ubuntu terminal'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 图1：从Ubuntu终端启动Zeppelin
- en: 'If you are on Windows, use the following command:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你使用Windows，使用以下命令：
- en: '[PRE1]'
  id: totrans-67
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'After Zeppelin has started successfully, go to `http://localhost:8080` with
    your web browser and you will see that Zeppelin is running. More specifically,
    you''ll see this on your browser:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 在Zeppelin成功启动后，使用你的网页浏览器访问`http://localhost:8080`，你将看到Zeppelin正在运行。更具体地说，你将在浏览器中看到以下内容：
- en: '![](img/25a4ebe1-b037-46ed-8396-897842d096bf.png)'
  id: totrans-69
  prefs: []
  type: TYPE_IMG
  zh: '![](img/25a4ebe1-b037-46ed-8396-897842d096bf.png)'
- en: 'Figure 2: Zeppelin is running on http://localhost:8080'
  id: totrans-70
  prefs: []
  type: TYPE_NORMAL
  zh: 图2：Zeppelin正在`http://localhost:8080`上运行
- en: 'Congratulations! You have successfully installed Apache Zeppelin! Now let''s
    access Zeppelin on the browser at `http://localhost:8080/` and get started on
    our data analytics once we have configured the preferred interpreter. Now, to
    stop Zeppelin from the command line, issue this command:'
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 恭喜！你已经成功安装了Apache Zeppelin！现在，让我们在浏览器中访问Zeppelin，地址是`http://localhost:8080/`，并在配置好首选解释器后开始我们的数据分析。现在，要从命令行停止Zeppelin，请执行以下命令：
- en: '[PRE2]'
  id: totrans-72
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Creating notebooks
  id: totrans-73
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建笔记本
- en: 'Once you are on `http://localhost:8080/`, you can explore different options
    and menus that help you understand how to get familiar with Zeppelin. For more
    information on Zeppelin and its user-friendly UI, interested readers can refer
    to [http://zeppelin.apache.org/docs/latest/](http://zeppelin.apache.org/docs/latest/).
    Now let''s first create a sample notebook and get started. As shown in the following
    figure, you can create a new notebook by clicking on the Create new note option
    in *Figure 2*:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦你进入`http://localhost:8080/`，你可以探索不同的选项和菜单，帮助你了解如何熟悉Zeppelin。有关Zeppelin及其用户友好界面的更多信息，感兴趣的读者可以参考[http://zeppelin.apache.org/docs/latest/](http://zeppelin.apache.org/docs/latest/)。现在，首先让我们创建一个示例笔记本并开始使用。如下图所示，你可以通过点击*图2*中的“Create
    new note”选项来创建一个新的笔记本：
- en: '![](img/c900fcff-1938-4c1b-9163-da82e72ff41b.png)'
  id: totrans-75
  prefs: []
  type: TYPE_IMG
  zh: '![](img/c900fcff-1938-4c1b-9163-da82e72ff41b.png)'
- en: 'Figure 3: Creating a sample Zeppelin notebook'
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 图3：创建示例Zeppelin笔记本
- en: As shown in *Figure 3*, the default interpreter is selected as Spark. In the
    drop-down list, you will see only Spark since you have downloaded the Spark-only
    binary package for Zeppelin.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 如*图3*所示，默认解释器被选为Spark。在下拉列表中，你只会看到Spark，因为你已下载了仅包含Spark的Zeppelin二进制包。
- en: Exploratory analysis of the dataset
  id: totrans-78
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 数据集的探索性分析
- en: 'Well done! We have been able to install, configure, and get started with Zeppelin.
    Now let''s get going. We will see how the variables are correlated with the label.
    We start by loading the dataset in Apache, as follows:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 做得好！我们已经能够安装、配置并开始使用 Zeppelin。现在我们开始吧。我们将看到变量与标签之间的关联。首先，我们在 Apache 中加载数据集，如下所示：
- en: '[PRE3]'
  id: totrans-80
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: Label distribution
  id: totrans-81
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 标签分布
- en: 'Let''s see the class distribution. We will use the SQL interpreter for this.
    Just execute the following SQL query on the Zeppelin notebook:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 我们来看看类别分布。我们将使用 SQL 解释器来进行此操作。在 Zeppelin 笔记本中执行以下 SQL 查询：
- en: '[PRE4]'
  id: totrans-83
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: '![](img/f96956b3-12cf-4c1e-9024-0f97366e8cf1.png)'
  id: totrans-84
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f96956b3-12cf-4c1e-9024-0f97366e8cf1.png)'
- en: Job distribution
  id: totrans-85
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 职业分布
- en: 'Now let''s see whether the job titles have any correlation with the subscription
    decision:'
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们来看看职位名称是否与订阅决策相关：
- en: '[PRE5]'
  id: totrans-87
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '![](img/532371f6-b5a0-4848-9ae2-d887205ec555.png)'
  id: totrans-88
  prefs: []
  type: TYPE_IMG
  zh: '![](img/532371f6-b5a0-4848-9ae2-d887205ec555.png)'
- en: From the chart we can see that most of the clients have jobs as admin, blue-collar,
    or technician, while students and retired clients have the biggest *count(y) /
    count (n)* ratio.
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 从图表中可以看到，大多数客户的职位是行政人员、蓝领工人或技术员，而学生和退休客户的*计数(y) / 计数(n)*比率最高。
- en: Marital distribution
  id: totrans-90
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 婚姻分布
- en: 'Does marital status have a correlation with the subscription decision? Let''s
    see:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 婚姻状况与订阅决策有关吗？让我们看看：
- en: '[PRE6]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: '![](img/1ff14701-0f9b-44b3-8397-eb053becfa63.png)'
  id: totrans-93
  prefs: []
  type: TYPE_IMG
  zh: '![](img/1ff14701-0f9b-44b3-8397-eb053becfa63.png)'
- en: The distribution shows that the subscriptions are proportional to the number
    of instances regardless of the marital status of the client.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 分布显示，订阅与实例数量成比例，而与客户的婚姻状况无关。
- en: Education distribution
  id: totrans-95
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 教育分布
- en: 'Now let''s see whether educational status has a correlation with the subscription
    decision:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们来看看教育水平是否与订阅决策有关：
- en: '[PRE7]'
  id: totrans-97
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: '![](img/37719635-692d-47e2-bc3a-2975491b4102.png)'
  id: totrans-98
  prefs: []
  type: TYPE_IMG
  zh: '![](img/37719635-692d-47e2-bc3a-2975491b4102.png)'
- en: Thus, similar to marital status, the education level gives no clue about the
    subscriptions. Now let's keep exploring other variables.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，与婚姻状况类似，教育水平并不能揭示关于订阅的任何线索。现在我们继续探索其他变量。
- en: Default distribution
  id: totrans-100
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 默认分布
- en: 'Let''s check whether default credit has a correlation with the subscription
    decision:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 我们来检查默认信用是否与订阅决策相关：
- en: '[PRE8]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '![](img/fae02864-02b6-43f0-a1a9-3ab41e0559ff.png)'
  id: totrans-103
  prefs: []
  type: TYPE_IMG
  zh: '![](img/fae02864-02b6-43f0-a1a9-3ab41e0559ff.png)'
- en: This chart shows there are almost no clients with default credit and clients
    with no default credit have a slight subscription ratio.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 该图表显示几乎没有客户有默认信用，而没有默认信用的客户有轻微的订阅比率。
- en: Housing distribution
  id: totrans-105
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 住房分布
- en: 'Now let''s see whether having a house has an interesting correlation with the
    subscription decision:'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们来看看是否拥有住房与订阅决策之间有趣的关联：
- en: '[PRE9]'
  id: totrans-107
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '![](img/41a17ae7-7cc5-470e-9c42-04bf60185643.png)'
  id: totrans-108
  prefs: []
  type: TYPE_IMG
  zh: '![](img/41a17ae7-7cc5-470e-9c42-04bf60185643.png)'
- en: The preceding figures say that housing also gives no clue about subscription.
  id: totrans-109
  prefs: []
  type: TYPE_NORMAL
  zh: 以上图表显示住房也不能揭示关于订阅的线索。
- en: Loan distribution
  id: totrans-110
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 贷款分布
- en: 'Now let''s look at loan distribution:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们来看看贷款分布：
- en: '[PRE10]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '![](img/0952fe25-77cb-45e5-a45a-59606d69a87f.png)'
  id: totrans-113
  prefs: []
  type: TYPE_IMG
  zh: '![](img/0952fe25-77cb-45e5-a45a-59606d69a87f.png)'
- en: The chart shows that most of the clients have no personal loan and loans have
    no effect on the subscription ratio.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 图表显示大多数客户没有个人贷款，贷款对订阅比率没有影响。
- en: Contact distribution
  id: totrans-115
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 联系方式分布
- en: 'Now let''s check whether the medium of contact has a significant correlation
    with the subscription decision:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们来检查联系方式是否与订阅决策有显著关联：
- en: '[PRE11]'
  id: totrans-117
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: '![](img/91093805-6701-40b3-8197-760d5d51be4d.png)'
  id: totrans-118
  prefs: []
  type: TYPE_IMG
  zh: '![](img/91093805-6701-40b3-8197-760d5d51be4d.png)'
- en: Month distribution
  id: totrans-119
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 月份分布
- en: 'It might sound funny, but the month of telemarketing can have a significant
    correlation with the subscription decision:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 这可能听起来有些奇怪，但电话营销的月份与订阅决策可能有显著的关联：
- en: '[PRE12]'
  id: totrans-121
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: '![](img/3d762f6c-9761-4bba-931f-1a56c2264df1.png)'
  id: totrans-122
  prefs: []
  type: TYPE_IMG
  zh: '![](img/3d762f6c-9761-4bba-931f-1a56c2264df1.png)'
- en: So, the preceding chart shows that the highest subscription ratios are obtained
    for months that have fewer instances (for example, December, March, October, and
    September).
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 所以，之前的图表显示，在实例较少的月份（例如 12 月、3 月、10 月和 9 月）中，订阅比率最高。
- en: Day distribution
  id: totrans-124
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 日期分布
- en: 'Now, what about the day of the week and its correlation with the subscription
    decision:'
  id: totrans-125
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，星期几与订阅决策之间有何关联：
- en: '[PRE13]'
  id: totrans-126
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: '![](img/83409632-61b3-45f3-bfca-d347404f5ce9.png)'
  id: totrans-127
  prefs: []
  type: TYPE_IMG
  zh: '![](img/83409632-61b3-45f3-bfca-d347404f5ce9.png)'
- en: The day feature has a uniform distribution, so it's not that significant.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 日期特征呈均匀分布，因此不那么显著。
- en: Previous outcome distribution
  id: totrans-129
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 之前的结果分布
- en: 'What about the previous outcome and its correlation with the subscription decision:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 那么，先前的结果及其与订阅决策的关联情况如何呢：
- en: '[PRE14]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: '![](img/63c6ed5f-083c-42c5-8f2b-15a6fa28cca1.png)'
  id: totrans-132
  prefs: []
  type: TYPE_IMG
  zh: '![](img/63c6ed5f-083c-42c5-8f2b-15a6fa28cca1.png)'
- en: The distribution shows that clients with a successful outcome from the previous
    marketing campaign will most likely subscribe. At the same time, those clients
    represent the minority of the dataset.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 分布显示，来自上次营销活动的成功结果的客户最有可能订阅。同时，这些客户代表了数据集中的少数。
- en: Age feature
  id: totrans-134
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 年龄特征
- en: 'Let us see how age correlates with the subscription decision:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看年龄与订阅决策的关系：
- en: '[PRE15]'
  id: totrans-136
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: '![](img/131b8d6e-2689-49ce-b137-cfbfc515e96c.png)'
  id: totrans-137
  prefs: []
  type: TYPE_IMG
  zh: '![](img/131b8d6e-2689-49ce-b137-cfbfc515e96c.png)'
- en: The normalized chart shows that most of the clients are aged between **25**
    and **60**.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 标准化图表显示，大多数客户的年龄在**25**到**60**岁之间。
- en: The following chart shows that the bank gets a high subscription ratio with
    clients in the age interval *(25, 60)*.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 以下图表显示，银行在年龄区间*(25, 60)*内的客户有较高的订阅率。
- en: '![](img/edd13366-b56b-4710-8695-f48b18c45f3f.png)'
  id: totrans-140
  prefs: []
  type: TYPE_IMG
  zh: '![](img/edd13366-b56b-4710-8695-f48b18c45f3f.png)'
- en: Duration distribution
  id: totrans-141
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 持续时间分布
- en: 'Let us now take a look at how the duration of calls is related to subscription:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们来看看通话时长与订阅之间的关系：
- en: '[PRE16]'
  id: totrans-143
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: '![](img/ac6d0053-9163-4cdc-81da-7eab79b18b99.png)'
  id: totrans-144
  prefs: []
  type: TYPE_IMG
  zh: '![](img/ac6d0053-9163-4cdc-81da-7eab79b18b99.png)'
- en: 'The charts show that most of the calls are short and the subscription ratio
    is proportional to the call duration. The expanded version provides better insight:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 图表显示，大多数通话时间较短，并且订阅率与通话时长成正比。扩展版提供了更深入的见解：
- en: '![](img/43a919d0-cf55-4db3-9fa9-26f3b90b2d42.png)'
  id: totrans-146
  prefs: []
  type: TYPE_IMG
  zh: '![](img/43a919d0-cf55-4db3-9fa9-26f3b90b2d42.png)'
- en: Campaign distribution
  id: totrans-147
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 活动分布
- en: 'Now we will see how campaign distribution is correlated to subscription:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们来看一下活动分布与订阅之间的相关性：
- en: '[PRE17]'
  id: totrans-149
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: '![](img/57baabd2-03b5-41e0-972c-b4cbd34b151f.png)'
  id: totrans-150
  prefs: []
  type: TYPE_IMG
  zh: '![](img/57baabd2-03b5-41e0-972c-b4cbd34b151f.png)'
- en: 'The charts show that most of the clients are contacted less than five times
    and the more a client is contacted, the less he/she is likely to subscribe. Now
    the expanded version provides better insight:'
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 图表显示，大多数客户的联系次数少于五次，而客户被联系的次数越多，他们订阅的可能性就越低。现在，扩展版提供了更深入的见解：
- en: '![](img/0a935ae2-27e5-4156-a391-ceb1c3e7bfc0.png)'
  id: totrans-152
  prefs: []
  type: TYPE_IMG
  zh: '![](img/0a935ae2-27e5-4156-a391-ceb1c3e7bfc0.png)'
- en: Pdays distribution
  id: totrans-153
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Pdays 分布
- en: 'Lets us now take a look at how the `pdays` distribution is correlated to subscription:'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们来看看 `pdays` 分布与订阅之间的关系：
- en: '[PRE18]'
  id: totrans-155
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: '![](img/23830f8d-4edf-4be9-a0ce-d255e0d5be8f.png)'
  id: totrans-156
  prefs: []
  type: TYPE_IMG
  zh: '![](img/23830f8d-4edf-4be9-a0ce-d255e0d5be8f.png)'
- en: The chart shows that most of the clients were not previously contacted.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 图表显示，大多数客户此前没有被联系过。
- en: Previous distribution
  id: totrans-158
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 先前分布
- en: 'In the following command, we can see how the previous distribution affects
    the subscription:'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 在以下命令中，我们可以看到之前的分布如何影响订阅：
- en: '[PRE19]'
  id: totrans-160
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: '![](img/c9251b02-5d01-4058-a0ea-4e682fd557d5.png)'
  id: totrans-161
  prefs: []
  type: TYPE_IMG
  zh: '![](img/c9251b02-5d01-4058-a0ea-4e682fd557d5.png)'
- en: Like the previous chart, this one confirms that most of the clients were not
    previously contacted for this campaign.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 与之前的图表类似，这张图表确认大多数客户在此次活动前没有被联系过。
- en: emp_var_rate distributions
  id: totrans-163
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: emp_var_rate 分布
- en: 'The following command shows how `emp_var_rate` distributions correlate with
    the subscription:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 以下命令显示了 `emp_var_rate` 分布与订阅之间的相关性：
- en: '[PRE20]'
  id: totrans-165
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: '![](img/c1bdd55d-b703-423e-8cfc-2f1b003b66c7.png)'
  id: totrans-166
  prefs: []
  type: TYPE_IMG
  zh: '![](img/c1bdd55d-b703-423e-8cfc-2f1b003b66c7.png)'
- en: 'The charts show that clients with a less common employment variation rate will
    be more likely to subscribe than other clients. Now the expanded version provides
    a better insight:'
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 图表显示，雇佣变动率较少见的客户更可能订阅。现在，扩展版提供了更深入的见解：
- en: '![](img/810f87cd-3a6a-4004-a436-784f78bb8091.png)'
  id: totrans-168
  prefs: []
  type: TYPE_IMG
  zh: '![](img/810f87cd-3a6a-4004-a436-784f78bb8091.png)'
- en: cons_price_idx features
  id: totrans-169
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: cons_price_idx 特征
- en: 'The correlation between `con_price_idx` features and subscription can be computed
    by the following command:'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: '`con_price_idx` 特征与订阅之间的相关性可以通过以下命令计算：'
- en: '[PRE21]'
  id: totrans-171
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: '![](img/6cac30e0-83dc-4271-be8e-f136816db9a9.png)'
  id: totrans-172
  prefs: []
  type: TYPE_IMG
  zh: '![](img/6cac30e0-83dc-4271-be8e-f136816db9a9.png)'
- en: 'The charts show that clients with a less common consumer price index are more
    likely to subscribe compared to other clients. Now, the expanded version provides
    better insight:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 图表显示，消费者价格指数较少见的客户相比其他客户更有可能订阅。现在，扩展版提供了更深入的见解：
- en: '![](img/e1158e07-d282-4269-b3de-bb6fcfbe9133.png)'
  id: totrans-174
  prefs: []
  type: TYPE_IMG
  zh: '![](img/e1158e07-d282-4269-b3de-bb6fcfbe9133.png)'
- en: cons_conf_idx distribution
  id: totrans-175
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: cons_conf_idx 分布
- en: 'The correlation between `cons_conf_idx` distribution and subscription can be
    computed by the following command:'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: '`cons_conf_idx` 分布与订阅之间的相关性可以通过以下命令计算：'
- en: '[PRE22]'
  id: totrans-177
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: '![](img/d57b72e9-5e2d-4b6a-97e7-64d876d2f5c1.png)'
  id: totrans-178
  prefs: []
  type: TYPE_IMG
  zh: '![](img/d57b72e9-5e2d-4b6a-97e7-64d876d2f5c1.png)'
- en: Clients with less common consumer confidence index are more likely to subscribe
    compared to other clients.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 消费者信心指数较少见的客户相比其他客户更有可能订阅。
- en: Euribor3m distribution
  id: totrans-180
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Euribor3m分布
- en: 'Let us see how `euribor3m` distribution is correlated to subscription:'
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们看看`euribor3m`的分布与订阅之间的相关性：
- en: '[PRE23]'
  id: totrans-182
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: '![](img/08a74d07-cf57-43a2-8d3c-f289b2137fd7.png)'
  id: totrans-183
  prefs: []
  type: TYPE_IMG
  zh: '![](img/08a74d07-cf57-43a2-8d3c-f289b2137fd7.png)'
- en: This chart shows that the euribor 3-month rate has a large range and most of
    the clients cluster around four or five values of that feature.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 该图表显示，euribor三个月期利率的范围较大，大多数客户聚集在该特征的四个或五个值附近。
- en: nr_employed distribution
  id: totrans-185
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: nr_employed分布
- en: 'The correlation between `nr_employed` distribution and subscription can be
    seen with the help of the following command:'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: '`nr_employed`分布与订阅的相关性可以通过以下命令查看：'
- en: '[PRE24]'
  id: totrans-187
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: '![](img/2345643f-0898-408b-98b3-0b9c37b36312.png)'
  id: totrans-188
  prefs: []
  type: TYPE_IMG
  zh: '![](img/2345643f-0898-408b-98b3-0b9c37b36312.png)'
- en: The chart shows that the subscription rate is inversely proportional to the
    number of employees.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 图表显示，订阅率与员工数量呈反比。
- en: Statistics of numeric features
  id: totrans-190
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 数值特征统计
- en: 'We will now take a look at the statistics of numeric features:'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们来看一下数值特征的统计数据：
- en: '[PRE25]'
  id: totrans-192
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: '| `summary` | `age` | `duration` | `campaign` | `pdays` | `previous` |'
  id: totrans-193
  prefs: []
  type: TYPE_TB
  zh: '| `summary` | `age` | `duration` | `campaign` | `pdays` | `previous` |'
- en: '| `count` | 41188.00 | 41188.00 | 41188.00 | 41188.00 | 41188.00 |'
  id: totrans-194
  prefs: []
  type: TYPE_TB
  zh: '| `count` | 41188.00 | 41188.00 | 41188.00 | 41188.00 | 41188.00 |'
- en: '| `mean` | 40.02 | 258.29 | 2.57 | 962.48 | 0.17 |'
  id: totrans-195
  prefs: []
  type: TYPE_TB
  zh: '| `mean` | 40.02 | 258.29 | 2.57 | 962.48 | 0.17 |'
- en: '| `stddev` | 10.42 | 259.28 | 2.77 | 186.91 | 0.49 |'
  id: totrans-196
  prefs: []
  type: TYPE_TB
  zh: '| `stddev` | 10.42 | 259.28 | 2.77 | 186.91 | 0.49 |'
- en: '| `min` | 17.00 | 0.00 | 1.00 | 0.00 | 0.00 |'
  id: totrans-197
  prefs: []
  type: TYPE_TB
  zh: '| `min` | 17.00 | 0.00 | 1.00 | 0.00 | 0.00 |'
- en: '| `max` | 98.00 | 4918.00 | 56.00 | 999.00 | 7.00 |'
  id: totrans-198
  prefs: []
  type: TYPE_TB
  zh: '| `max` | 98.00 | 4918.00 | 56.00 | 999.00 | 7.00 |'
- en: '| `q1` | 32.00 | 102.00 | 1.00 | 999.00 | 0.00 |'
  id: totrans-199
  prefs: []
  type: TYPE_TB
  zh: '| `q1` | 32.00 | 102.00 | 1.00 | 999.00 | 0.00 |'
- en: '| `median` | 38.00 | 180.00 | 2.00 | 999.00 | 0.00 |'
  id: totrans-200
  prefs: []
  type: TYPE_TB
  zh: '| `median` | 38.00 | 180.00 | 2.00 | 999.00 | 0.00 |'
- en: '| `q3` | 47.00 | 319.00 | 3.00 | 999.00 | 0.00 |'
  id: totrans-201
  prefs: []
  type: TYPE_TB
  zh: '| `q3` | 47.00 | 319.00 | 3.00 | 999.00 | 0.00 |'
- en: '|  |  |  |  |  |  |'
  id: totrans-202
  prefs: []
  type: TYPE_TB
  zh: '|  |  |  |  |  |  |'
- en: '| `summary` | `emp_var_rate` | `cons_price_idx` | `cons_conf_idx` | `euribor3m`
    | `nr_employed` |'
  id: totrans-203
  prefs: []
  type: TYPE_TB
  zh: '| `summary` | `emp_var_rate` | `cons_price_idx` | `cons_conf_idx` | `euribor3m`
    | `nr_employed` |'
- en: '| `count` | 41188.00 | 41188.00 | 41188.00 | 41188.00 | 41188.00 |'
  id: totrans-204
  prefs: []
  type: TYPE_TB
  zh: '| `count` | 41188.00 | 41188.00 | 41188.00 | 41188.00 | 41188.00 |'
- en: '| `mean` | 0.08 | 93.58 | -40.50 | 3.62 | 5167.04 |'
  id: totrans-205
  prefs: []
  type: TYPE_TB
  zh: '| `mean` | 0.08 | 93.58 | -40.50 | 3.62 | 5167.04 |'
- en: '| `stddev` | 1.57 | 0.58 | 4.63 | 1.73 | 72.25 |'
  id: totrans-206
  prefs: []
  type: TYPE_TB
  zh: '| `stddev` | 1.57 | 0.58 | 4.63 | 1.73 | 72.25 |'
- en: '| `min` | -3.40 | 92.20 | -50.80 | 0.63 | 4963.60 |'
  id: totrans-207
  prefs: []
  type: TYPE_TB
  zh: '| `min` | -3.40 | 92.20 | -50.80 | 0.63 | 4963.60 |'
- en: '| `max` | 1.40 | 94.77 | -26.90 | 5.05 | 5228.10 |'
  id: totrans-208
  prefs: []
  type: TYPE_TB
  zh: '| `max` | 1.40 | 94.77 | -26.90 | 5.05 | 5228.10 |'
- en: '| `q1` | -1.80 | 93.08 | -42.70 | 1.34 | 5099.10 |'
  id: totrans-209
  prefs: []
  type: TYPE_TB
  zh: '| `q1` | -1.80 | 93.08 | -42.70 | 1.34 | 5099.10 |'
- en: '| `median` | 1.10 | 93.75 | -41.80 | 4.86 | 5191.00 |'
  id: totrans-210
  prefs: []
  type: TYPE_TB
  zh: '| `median` | 1.10 | 93.75 | -41.80 | 4.86 | 5191.00 |'
- en: '| `q3` | 1.40 | 93.99 | -36.40 | 4.96 | 5228.10 |'
  id: totrans-211
  prefs: []
  type: TYPE_TB
  zh: '| `q3` | 1.40 | 93.99 | -36.40 | 4.96 | 5228.10 |'
- en: Implementing a client subscription assessment model
  id: totrans-212
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 实现客户订阅评估模型
- en: 'To predict a client subscription assessment, we use the deep learning classifier
    implementation from H2O. First, we set up and create a Spark session:'
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
  zh: 为了预测客户订阅评估，我们使用H2O中的深度学习分类器实现。首先，我们设置并创建一个Spark会话：
- en: '[PRE26]'
  id: totrans-214
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'Then we load the dataset as a data frame:'
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们将数据集加载为数据框：
- en: '[PRE27]'
  id: totrans-216
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: Although there are categorical features in this dataset, there is no need to
    use a `StringIndexer` since the categorical features have small domains. By indexing
    them, an order relationship that does not exist is introduced. Thus, a better
    solution is to use One Hot Encodng, and it turns out that H2O, by default, uses
    this encoding strategy for enumerations.
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管这个数据集中包含了分类特征，但由于这些分类特征的域较小，因此无需使用`StringIndexer`。如果将其索引，会引入一个并不存在的顺序关系。因此，更好的解决方案是使用One
    Hot Encoding，事实证明，H2O默认使用此编码策略处理枚举。
- en: 'In the dataset description, I have already stated that the `duration` feature
    is only available after the label is known. So it can''t be used for prediction.
    Therefore, we should drop it as unavailable before calling the client:'
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 在数据集描述中，我已经说明了`duration`特征只有在标签已知后才可用，因此不能用于预测。因此，在调用客户之前，我们应该丢弃它作为不可用的特征：
- en: '[PRE28]'
  id: totrans-219
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'So far, we have used Sparks built-in methods for loading the dataset and dropping
    unwanted features, but now we need to set up `h2o` and import its implicits:'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们已经使用Spark的内置方法加载了数据集并删除了不需要的特征，但现在我们需要设置`h2o`并导入其隐式功能：
- en: '[PRE29]'
  id: totrans-221
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'We then shuffle the training dataset and transform it into an H2O frame:'
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们将训练数据集打乱，并将其转换为H2O框架：
- en: '[PRE30]'
  id: totrans-223
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'String features are then converted into categorical (type "2 Byte" stands for
    the String type of H2O):'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 字符串特征随后被转换为分类特征（"2 Byte"类型表示H2O中的字符串类型）：
- en: '[PRE31]'
  id: totrans-225
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'In the preceding line of code, `toCategorical()` is a user-defined function
    used to transform a string feature into a categorical feature. Here''s the signature
    of the method:'
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的代码行中，`toCategorical()`是一个用户定义的函数，用于将字符串特征转换为类别特征。以下是该方法的签名：
- en: '[PRE32]'
  id: totrans-227
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'Now it''s time to split the dataset into 60% training, 20% validation, and
    20% test datasets:'
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
  zh: 现在是时候将数据集分为60%的训练集、20%的验证集和20%的测试集：
- en: '[PRE33]'
  id: totrans-229
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'Then we train the deep learning model using the training set and validate the
    training using the validation set, as follows:'
  id: totrans-230
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们使用训练集训练深度学习模型，并使用验证集验证训练，具体如下：
- en: '[PRE34]'
  id: totrans-231
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'In the preceding line, `buildDLModel()` is a user-defined function that sets
    up a deep learning model and trains it using the train and validation data frames:'
  id: totrans-232
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的代码行中，`buildDLModel()`是一个用户定义的函数，用于设置深度学习模型并使用训练和验证数据框架进行训练：
- en: '[PRE35]'
  id: totrans-233
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'In this code, we have instantiated a deep learning (that is, MLP) network of
    three hidden layers, L1 regularization and that intended to iterate the training
    for only 10 times. Note that these are hyperparameters and nothing is tuned. So
    feel free to change this and see the performance to get a set of the most optimized
    parameters. Once the training phase is completed, we print the training metrics
    (that is, AUC):'
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: 在这段代码中，我们实例化了一个具有三层隐藏层的深度学习（即MLP）网络，L1正则化，并且仅计划迭代训练10次。请注意，这些是超参数，尚未调优。因此，您可以自由更改这些参数并查看性能，以获得一组最优化的参数。训练阶段完成后，我们打印训练指标（即AUC）：
- en: '[PRE36]'
  id: totrans-235
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'About 81% accuracy does not seem good. We now evaluate the model on the test
    set. We predict the labels of the testing dataset:'
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: 大约81%的准确率看起来并不好。现在我们在测试集上评估模型。我们预测测试数据集的标签：
- en: '[PRE37]'
  id: totrans-237
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'Then we add the original labels to the result:'
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们将原始标签添加到结果中：
- en: '[PRE38]'
  id: totrans-239
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'Transform the result into a Spark DataFrame and print the confusion matrix:'
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 将结果转换为Spark DataFrame并打印混淆矩阵：
- en: '[PRE39]'
  id: totrans-241
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: '![](img/82558f0e-ad15-4fa7-bdd4-36432e211d52.png)'
  id: totrans-242
  prefs: []
  type: TYPE_IMG
  zh: '![](img/82558f0e-ad15-4fa7-bdd4-36432e211d52.png)'
- en: 'Now, the preceding confusion matrix can be represented by the following plot
    using Vegas:'
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，前面的混淆矩阵可以通过以下图表在Vegas中表示：
- en: '[PRE40]'
  id: totrans-244
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: '![](img/c8fe633b-61e1-4663-aaca-6ec8241b7655.png)'
  id: totrans-245
  prefs: []
  type: TYPE_IMG
  zh: '![](img/c8fe633b-61e1-4663-aaca-6ec8241b7655.png)'
- en: 'Figure 4: Graphical representation of the confusion matrix—normalized (left)
    versus un-normalized (right)'
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 图4：混淆矩阵的图形表示——归一化（左）与未归一化（右）
- en: 'Now let''s see the overall performance summary on the test set—that is, test
    AUC:'
  id: totrans-247
  prefs: []
  type: TYPE_NORMAL
  zh: 现在让我们看看测试集上的整体性能摘要——即测试AUC：
- en: '[PRE41]'
  id: totrans-248
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: '![](img/f70bf664-ff77-4418-8449-e73fd44992dd.png)'
  id: totrans-249
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f70bf664-ff77-4418-8449-e73fd44992dd.png)'
- en: 'So the test accuracy in terms of AUC is 76%, which is not that great. But why
    don''t we iterate the training an additional number of times (say, 1,000 times)?
    Well, I leave it up to you. But still, we can visually inspect the precision-recall
    curve to see how the evaluation phase went:'
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 所以，AUC测试准确率为76%，这并不是特别好。但为什么我们不再迭代训练更多次（比如1000次）呢？嗯，这个问题留给你去决定。但我们仍然可以直观地检查精确度-召回率曲线，以看看评估阶段的情况：
- en: '[PRE42]'
  id: totrans-251
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: '![](img/f0e403c2-05c7-459c-b50d-34ab5e5340fa.png)'
  id: totrans-252
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f0e403c2-05c7-459c-b50d-34ab5e5340fa.png)'
- en: 'Figure 5: Precision-recall curve'
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 图5：精确度-召回率曲线
- en: 'We then compute and draw the sensitivity specificity curve:'
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 然后我们计算并绘制敏感度特异度曲线：
- en: '[PRE43]'
  id: totrans-255
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: '![](img/0c6c8a6a-1879-4928-af84-cd455a2b3eec.png)'
  id: totrans-256
  prefs: []
  type: TYPE_IMG
  zh: '![](img/0c6c8a6a-1879-4928-af84-cd455a2b3eec.png)'
- en: 'Figure 6: Sensitivity specificity curve'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 图6：敏感度特异度曲线
- en: Now the sensitivity specificity curve tells us the relationship between correctly
    predicted classes from both labels. For example, if we have 100% correctly predicted
    fraud cases, there will be no correctly classified non-fraud cases and vice versa.
    Finally, it would be great to take a closer look at this a little differently,
    by manually going through different prediction thresholds and calculating how
    many cases were correctly classified in the two classes.
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，敏感度特异度曲线告诉我们正确预测的类别与两个标签之间的关系。例如，如果我们正确预测了100%的欺诈案例，那么就不会有正确分类的非欺诈案例，反之亦然。最后，从另一个角度仔细观察这个问题，手动遍历不同的预测阈值，计算在两个类别中正确分类的案例数量，将会非常有益。
- en: 'More specifically, we can visually inspect true positives, false positives,
    true negatives, and false negatives over different prediction thresholds, say
    **0.0** to **1.0**:'
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 更具体地说，我们可以通过不同的预测阈值（例如**0.0**到**1.0**）来直观检查真正例、假正例、真负例和假负例：
- en: '[PRE44]'
  id: totrans-260
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: 'First, let''s draw the true positive one:'
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，让我们绘制真正例：
- en: '[PRE45]'
  id: totrans-262
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: '![](img/651bd9cd-c73d-453f-9ee9-3b8a3cff2c1c.png)'
  id: totrans-263
  prefs: []
  type: TYPE_IMG
  zh: '![](img/651bd9cd-c73d-453f-9ee9-3b8a3cff2c1c.png)'
- en: Figure 7: True positives across different prediction thresholds in [0.0, 1.0]
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 图7：在[0.0, 1.0]之间不同预测阈值下的真正例
- en: 'Secondly, let''s draw the false positive one:'
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 第二步，让我们绘制假阳性：
- en: '[PRE46]'
  id: totrans-266
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: '![](img/92ccd496-3fee-4774-b0ef-bfd227041d9d.png)'
  id: totrans-267
  prefs: []
  type: TYPE_IMG
  zh: '![](img/92ccd496-3fee-4774-b0ef-bfd227041d9d.png)'
- en: 'Figure 8: False positives across different prediction thresholds in [0.0, 1.0]'
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 图 8：在[0.0, 1.0]范围内，不同预测阈值下的假阳性
- en: 'Then, it''s the turn of the true negative ones:'
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来是正确的负类：
- en: '[PRE47]'
  id: totrans-270
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: '![](img/bc6a1193-63f9-428f-9637-c077bc88c951.png)'
  id: totrans-271
  prefs: []
  type: TYPE_IMG
  zh: '![](img/bc6a1193-63f9-428f-9637-c077bc88c951.png)'
- en: 'Figure 9: False positives across different prediction thresholds in [0.0, 1.0]'
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 图 9：在[0.0, 1.0]范围内，不同预测阈值下的假阳性
- en: 'Finally, let''s draw the false negative ones as follows:'
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，让我们绘制假阴性：
- en: '[PRE48]'
  id: totrans-274
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: '![](img/721dfd31-3f89-4e42-9afa-9001575bec49.png)'
  id: totrans-275
  prefs: []
  type: TYPE_IMG
  zh: '![](img/721dfd31-3f89-4e42-9afa-9001575bec49.png)'
- en: 'Figure 10: False positives across different prediction thresholds in [0.0,
    1.0]'
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
  zh: 图 10：在[0.0, 1.0]范围内，不同预测阈值下的假阳性
- en: Therefore, the preceding plots tell us that we can increase the number of correctly
    classified non-fraud cases without losing correctly classified fraud cases when
    we increase the prediction threshold from the default **0.5** to **0.6**.
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，前面的图表告诉我们，当我们将预测阈值从默认的**0.5**提高到**0.6**时，可以在不丢失正确分类的欺诈案例的情况下，增加正确分类的非欺诈案例数量。
- en: 'Apart from these two auxiliary methods, I have defined three Scala case classes
    for computing `precision`, `recall`, `sensitivity`, `specificity`, true positives
    (`tp`), true negatives (`tn`), false positives (`fp`), false negatives (`fn`),
    and so on. The signature is as follows:'
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: 除了这两种辅助方法外，我还定义了三个Scala case类来计算`precision`、`recall`、`sensitivity`、`specificity`、真正例（`tp`）、真负例（`tn`）、假阳性（`fp`）、假阴性（`fn`）等。其签名如下：
- en: '[PRE49]'
  id: totrans-279
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: 'Finally, stop the Spark session and H2O context. The `stop()` method invocation
    will shut down the H2O context and Spark cluster respectively:'
  id: totrans-280
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，停止Spark会话和H2O上下文。`stop()`方法调用将分别关闭H2O上下文和Spark集群：
- en: '[PRE50]'
  id: totrans-281
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: The first one especially is more important; otherwise, it sometimes does not
    stop the H2O flow but still holds the computing resources.
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: 第一个尤其重要；否则，有时它并不会停止H2O流，但仍会占用计算资源。
- en: Hyperparameter tuning and feature selection
  id: totrans-283
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 超参数调优和特征选择
- en: 'The flexibility of neural networks is also one of their main drawbacks: there
    are many hyperparameters to tweak. Even in a simple MLP, you can change the number
    of layers, the number of neurons per layer, the type of activation function to
    use in each layer, the number of epochs, the learning rate, weight initialization
    logic, drop-out keep probability, and so on. How do you know what combination
    of hyperparameters is best for your task?'
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 神经网络的灵活性也是它们的主要缺点之一：有许多超参数需要调整。即使在一个简单的MLP中，你也可以更改层数、每层的神经元数量、每层使用的激活函数类型、训练轮次、学习率、权重初始化逻辑、丢弃保持概率等。那么，如何知道哪种超参数组合最适合你的任务呢？
- en: Of course, you can use grid search with cross-validation to find the right hyperparameters
    for linear machine learning models, but for deep learning models, there are many
    hyperparameters to tune. And since training a neural network on a large dataset
    takes a lot of time, you will only be able to explore a tiny part of the hyperparameter
    space in a reasonable amount of time. Here are some useful insights.
  id: totrans-285
  prefs: []
  type: TYPE_NORMAL
  zh: 当然，你可以使用网格搜索结合交叉验证来为线性机器学习模型寻找合适的超参数，但对于深度学习模型来说，有很多超参数需要调优。而且，由于在大数据集上训练神经网络需要大量时间，你只能在合理的时间内探索超参数空间的一小部分。以下是一些有用的见解。
- en: Number of hidden layers
  id: totrans-286
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 隐藏层数量
- en: For many problems, you can start with one or two hidden layers and it will work
    just fine using two hidden layers with the same total amount of neurons, in roughly
    the same amount of training time. For more complex problems, you can gradually
    ramp up the number of hidden layers until you start overfitting the training set.
    Very complex tasks, such as large image classification or speech recognition,
    typically require networks with dozens of layers and they need a large amount
    of training data.
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: 对于许多问题，你可以从一两个隐藏层开始，使用两个隐藏层并保持相同的神经元总数，训练时间大致相同，效果也很好。对于更复杂的问题，你可以逐渐增加隐藏层的数量，直到开始出现过拟合。非常复杂的任务，如大规模图像分类或语音识别，通常需要几十层的网络，并且需要大量的训练数据。
- en: Number of neurons per hidden layer
  id: totrans-288
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 每个隐藏层的神经元数量
- en: Obviously, the number of neurons in the input and output layers is determined
    by the type of input and output your task requires. For example, if your dataset
    has a shape of 28 x 28, it should expect to have input neurons of size 784, and
    the output neurons should be equal to the number of classes to be predicted.
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: 显然，输入层和输出层的神经元数量是由任务所需的输入和输出类型决定的。例如，如果你的数据集形状为28 x 28，那么它的输入神经元数量应该是784，输出神经元数量应等于要预测的类别数。
- en: We have seen in this project how it works in practice in the next example using
    MLP, where we set 256 neurons, four each for the hidden layers; that's just one
    hyperparameter to tune instead of one per layer. Just like the number of layers,
    you can try increasing the number of neurons gradually until the network starts
    overfitting.
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个项目中，我们通过下一个使用MLP的示例，展示了它在实践中的运作方式，我们设置了256个神经元，每个隐藏层4个；这只是一个需要调节的超参数，而不是每层一个。就像层数一样，你可以逐渐增加神经元的数量，直到网络开始过拟合。
- en: Activation functions
  id: totrans-291
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 激活函数
- en: In most cases, you can use the ReLU activation function in the hidden layers.
    It is a bit faster to compute than other activation functions, and gradient descent
    does not get stuck as much on plateaus compared to the logistic function or the
    hyperbolic tangent function, which usually saturated at one.
  id: totrans-292
  prefs: []
  type: TYPE_NORMAL
  zh: 在大多数情况下，你可以在隐藏层使用ReLU激活函数。它比其他激活函数计算速度更快，而且与逻辑函数或双曲正切函数相比，梯度下降在平坦区域更不容易停滞，因为后者通常在1处饱和。
- en: 'For the output layer, the softmax activation function is generally a good choice
    for classification tasks. For regression tasks, you can simply use no activation
    function. Other activation functions include Sigmoid and Tanh. The current implementation
    of the H2O-based deep learning model supports the following activation functions:'
  id: totrans-293
  prefs: []
  type: TYPE_NORMAL
  zh: 对于输出层，softmax激活函数通常是分类任务的不错选择。对于回归任务，你可以简单地不使用任何激活函数。其他激活函数包括Sigmoid和Tanh。当前基于H2O的深度学习模型支持以下激活函数：
- en: ExpRectifier
  id: totrans-294
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 指数线性整流器（ExpRectifier）
- en: ExpRectifierWithDropout
  id: totrans-295
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 带Dropout的指数线性整流器（ExpRectifierWithDropout）
- en: Maxout
  id: totrans-296
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Maxout
- en: MaxoutWithDropout
  id: totrans-297
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 带Dropout的Maxout（MaxoutWithDropout）
- en: Rectifier
  id: totrans-298
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 线性整流器（Rectifier）
- en: RectifierWthDropout
  id: totrans-299
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 带Dropout的线性整流器（RectifierWthDropout）
- en: Tanh
  id: totrans-300
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Tanh
- en: TanhWithDropout
  id: totrans-301
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 带Dropout的Tanh（TanhWithDropout）
- en: Apart from Tanh (the default one in H2O), I have not tried any other activation
    functions for this project. However, you should definitely try.
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
  zh: 除了Tanh（H2O中的默认函数），我没有尝试过其他激活函数用于这个项目。然而，你应该肯定尝试其他的。
- en: Weight and bias initialization
  id: totrans-303
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 权重和偏置初始化
- en: 'Initializing the weight and biases for the hidden layers is an important hyperparameter
    to be taken care of:'
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
  zh: 初始化隐藏层的权重和偏置是需要注意的一个重要超参数：
- en: '**Do not do all-zero initialization**: A reasonable-sounding idea might be
    to set all the initial weights to zero, but it does not work in practice because
    if every neuron in the network computes the same output, there will be no source
    of asymmetry between neurons as their weights are initialized to be the same.'
  id: totrans-305
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**不要进行全零初始化**：一个看似合理的想法是将所有初始权重设置为零，但实际上并不可行，因为如果网络中的每个神经元计算相同的输出，那么它们的权重初始化为相同的值时，就不会有神经元之间的对称性破坏。'
- en: '**Small random numbers**: It is also possible to initialize the weights of
    the neurons to small numbers but not identically zero. Alternatively, it is also
    possible to use small numbers drawn from a uniform distribution.'
  id: totrans-306
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**小随机数**：也可以将神经元的权重初始化为小数值，而不是完全为零。或者，也可以使用从均匀分布中抽取的小数字。'
- en: '**Initializing the biases**: It is possible, and common, to initialize the
    biases to zero since the asymmetry breaking is provided by small random numbers
    in the weights. Setting the biases to a small constant value, such as 0.01 for
    all biases, ensures that all ReLU units can propagate a gradient. However, it
    neither performs well nor does consistent improvement. Therefore, sticking to
    zero is recommended.'
  id: totrans-307
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**初始化偏置**：将偏置初始化为零是可能的，且很常见，因为破坏对称性是通过权重中的小随机数来完成的。将偏置初始化为一个小常数值，例如将所有偏置设为0.01，确保所有ReLU单元能够传播梯度。然而，这种做法既不能很好地执行，也没有持续的改进效果。因此，推荐将偏置设为零。'
- en: Regularization
  id: totrans-308
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 正则化
- en: 'There are several ways of controlling the training of neural networks to prevent
    overfitting in the training phase, for example, L2/L1 regularization, max-norm
    constraints, and dropout:'
  id: totrans-309
  prefs: []
  type: TYPE_NORMAL
  zh: 有几种方法可以控制神经网络的训练，防止在训练阶段过拟合，例如L2/L1正则化、最大范数约束和Dropout：
- en: '**L2 regularization**: This is probably the most common form of regularization.
    Using the gradient descent parameter update, L2 regularization signifies that
    every weight will be decayed linearly towards zero.'
  id: totrans-310
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**L2正则化**：这可能是最常见的正则化形式。通过梯度下降参数更新，L2正则化意味着每个权重都会线性衰减到零。'
- en: '**L1 regularization**: For each weight *w*, we add the term λ∣w∣ to the objective.
    However, it is also possible to combine L1 and L2 regularization *to achieve*
    elastic net regularization.'
  id: totrans-311
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**L1正则化**：对于每个权重*w*，我们将项λ∣w∣添加到目标函数中。然而，也可以结合L1和L2正则化*以实现*弹性网正则化。'
- en: '**Max-norm constraints**: Used to enforce an absolute upper bound on the magnitude
    of the weight vector for each hidden layer neuron. Projected gradient descent
    can then be used further to enforce the constraint.'
  id: totrans-312
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**最大范数约束**：用于对每个隐藏层神经元的权重向量的大小施加绝对上限。然后，可以使用投影梯度下降进一步强制执行该约束。'
- en: '**Dropout**: When working with a neural network, we need another placeholder
    for dropout, which is a hyperparameter to be tuned and the training time but not
    the test time. It is implemented by only keeping a neuron active with some probability,
    say *p<1.0*, or setting it to zero otherwise. The idea is to use a single neural
    net at test time without dropout. The weights of this network are scaled-down
    versions of the trained weights. If a unit is retained with `dropout_keep_prob`
    *< 1.0* during training, the outgoing weights of that unit are multiplied by *p*
    at test time (*Figure 17*).'
  id: totrans-313
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Dropout（丢弃法）**：在使用神经网络时，我们需要另一个占位符用于丢弃法，这是一个需要调优的超参数，它仅影响训练时间而非测试时间。其实现方式是通过以某种概率（假设为*p<1.0*）保持一个神经元活跃，否则将其设置为零。其理念是在测试时使用一个没有丢弃法的神经网络。该网络的权重是经过训练的权重的缩小版。如果在训练过程中一个单元在`dropout_keep_prob`
    *< 1.0*时被保留，那么该单元的输出权重在测试时会乘以*p*（*图17*）。'
- en: Apart from these hyperparameters, another advantage of using H2O-based deep
    learning algorithms is that we can take the relative variable/feature importance.
    In previous chapters, we saw that by using the random forest algorithm in Spark,
    it is also possible to compute the variable importance.
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
  zh: 除了这些超参数，使用基于H2O的深度学习算法的另一个优点是我们可以得到相对变量/特征的重要性。在之前的章节中，我们看到通过在Spark中使用随机森林算法，也可以计算变量重要性。
- en: 'So, the idea is that if your model does not perform well, it would be worth
    dropping the less important features and doing the training again. Now, it is
    possible to find the feature importance during supervised training. I have observed
    this feature importance:'
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: 所以，基本思想是，如果你的模型表现不佳，去掉不太重要的特征然后重新训练可能会有所帮助。现在，在监督学习过程中是可以找到特征重要性的。我观察到的特征重要性如下：
- en: '![](img/39aee4cf-5a16-4e45-80de-72b7c9e6ca4e.png)'
  id: totrans-316
  prefs: []
  type: TYPE_IMG
  zh: '![](img/39aee4cf-5a16-4e45-80de-72b7c9e6ca4e.png)'
- en: 'Figure 25: Relative variable importance'
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: 图25：相对变量重要性
- en: 'Now the question would be: why don''t you drop them and try training again
    to see if the accuracy has increased or not? Well, I leave it up to the readers.'
  id: totrans-318
  prefs: []
  type: TYPE_NORMAL
  zh: 现在问题是：为什么不去掉它们，再次训练看看准确性是否有所提高？嗯，我将这个问题留给读者自己思考。
- en: Summary
  id: totrans-319
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we saw how to develop a **machine learning** (**ML**) project
    using H2O on a bank marketing dataset for predictive analytics. We were able to
    predict that the client would subscribe to a term deposit with an accuracy of
    80%. Furthermore, we saw how to tune typical neural network hyperparameters. Considering
    the fact that this small-scale dataset, final improvement suggestion would be
    using Spark based Random Forest, Decision trees or gradient boosted trees for
    better accuracy.
  id: totrans-320
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们展示了如何使用H2O在银行营销数据集上开发一个**机器学习**（**ML**）项目来进行预测分析。我们能够预测客户是否会订阅定期存款，准确率达到80%。此外，我们还展示了如何调优典型的神经网络超参数。考虑到这是一个小规模数据集，最终的改进建议是使用基于Spark的随机森林、决策树或梯度提升树来提高准确性。
- en: In the next chapter, we will use a dataset having more than 284,807 instances
    of credit card use, where only 0.172% of transactions are fraudulent—that is,
    highly unbalanced data. So it would make sense to use autoencoders to pretrain
    a classification model and apply anomaly detection to predict possible fraud transaction—that
    is, we expect our fraud cases to be anomalies within the whole dataset.
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章中，我们将使用一个包含超过284,807个信用卡使用实例的数据集，其中只有0.172%的交易是欺诈的——也就是说，这是一个高度不平衡的数据集。因此，使用自编码器预训练一个分类模型并应用异常检测来预测可能的欺诈交易是有意义的——也就是说，我们预期我们的欺诈案件将是整个数据集中的异常。
