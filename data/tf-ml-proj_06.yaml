- en: Predicting Stock Prices using Gaussian Process Regression
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用高斯过程回归预测股市价格
- en: In this chapter, we will learn about a new model for forecasting known as **Gaussian
    processes**, popularly abbreviated as **GPs**, this is extremely popular in forecasting
    applications where we want to model non-linear functions with a few data points
    and also to quantify uncertainty in predictions.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将学习一种新的预测模型，叫做**高斯过程**，通常简称为**GPs**，它在预测应用中非常流行，尤其是在我们希望通过少量数据点建模非线性函数并量化预测的不确定性时。
- en: We will use Gaussian processes to predict the stock prices of three major stocks,
    namely, Google, Netflix, and the **General Electric** (GE) company.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用高斯过程来预测三只主要股票的股价，即谷歌、Netflix和**通用电气**（GE）公司。
- en: 'The rest of this chapter is divided into the following sections:'
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 本章其余部分分为以下几节：
- en: Understanding Bayes' rule
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 理解贝叶斯定理
- en: Bayesian inference
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 贝叶斯推断
- en: Introducing Gaussian processes
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 引入高斯过程
- en: Understanding the stock market dataset
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 理解股市数据集
- en: Applying Gaussian processes to predict stock market prices
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 应用高斯过程预测股市价格
- en: Understanding Bayes' rule
  id: totrans-9
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 理解贝叶斯定理
- en: Let us begin by reviewing the Bayes' rule and it's associated terminology, before
    we start with our project.
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
  zh: 在开始我们的项目之前，我们先回顾一下贝叶斯定理及其相关术语。
- en: 'Bayes'' rule is used to describe the probability of an event, based on prior
    knowledge of conditions that might be related to the event. For example, let''s
    say we want to predict the probability a person having diabetes. If we know the
    preliminary medical test results, we can hope to get a more accurate prediction
    than when we don''t know results of the test. Let''s put some numbers around this
    to understand mathematically:'
  id: totrans-11
  prefs: []
  type: TYPE_NORMAL
  zh: 贝叶斯定理用于描述一个事件的概率，基于与该事件可能相关的条件的先验知识。例如，假设我们想预测一个人是否患有糖尿病。如果我们知道初步的医学检查结果，我们就能比不知道检查结果时得到更准确的预测。让我们通过一些数字来从数学角度理解这个问题：
- en: 1% of population has diabetes ( and therefore 99% do not)
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 1%的人口患有糖尿病（因此99%的人没有）。
- en: Preliminary tests detect diabetes 80% of the time when it is there ( therefore
    20% of time we require advanced tests)
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 初步测试在糖尿病存在时80%的概率能检测出来（因此20%的时间我们需要进行更高级的测试）
- en: '10% of time preliminary test detect diabetes even when it is not there (therefore
    90% of time they give the correct result):'
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 初步检查在糖尿病不存在时有10%的时间会误判为糖尿病（因此90%的时间能给出正确结果）：
- en: '|  | **Diabetes (1%)** | **No diabetes (99%)** |'
  id: totrans-15
  prefs: []
  type: TYPE_TB
  zh: '|  | **糖尿病（1%）** | **无糖尿病（99%）** |'
- en: '| **Test Positive** | 80% | 10% |'
  id: totrans-16
  prefs: []
  type: TYPE_TB
  zh: '| **检测阳性** | 80% | 10% |'
- en: '| **Test Negative** | 20% | 90% |'
  id: totrans-17
  prefs: []
  type: TYPE_TB
  zh: '| **检测阴性** | 20% | 90% |'
- en: So, if a person has diabetes, we will be looking at first column and he has
    80% chance of being detected. And if a person doesn't have diabetes, we will be
    looking at second column and he has 10% chance of testing positive for diabetes
    from preliminary tests.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 所以，如果一个人患有糖尿病，我们将查看第一列，他有80%的机会被检测出糖尿病。而如果一个人没有糖尿病，我们将查看第二列，他有10%的机会在初步测试中被误诊为糖尿病阳性。
- en: Now let's say a person was detected positively for diabetes from preliminary
    test. What are the chances that he actually has diabetes?
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 假设一个人在初步检测中被诊断为糖尿病阳性。那么他实际上患糖尿病的几率有多大？
- en: 'As it turns out, a renowned scientist Thomas Bayes'' ( 171-1761) provided a
    mathematical framework to compute probability in the cases like above. His mathematical
    formula can be given as:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 事实证明，著名科学家托马斯·贝叶斯（171-1761年）提供了一个数学框架，用于在上述情况下计算概率。他的数学公式可以表示为：
- en: '![](img/951a9bc4-f393-4cca-b9ec-ec069aa20acc.png)'
  id: totrans-21
  prefs: []
  type: TYPE_IMG
  zh: '![](img/951a9bc4-f393-4cca-b9ec-ec069aa20acc.png)'
- en: 'Where:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 其中：
- en: '![](img/9b5a1e8a-8850-47f6-af12-bdfefc76b742.png) denotes the probability of
    diabetes in a randomly selected person which is 1% in this case.![](img/3ed237e2-b687-4dce-9b02-5cfc221d8105.png) is
    also known as **prior** in Bayesian terminology which denotes our belief for an
    event without any additional information.'
  id: totrans-23
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '![](img/9b5a1e8a-8850-47f6-af12-bdfefc76b742.png)表示随机选中一个人患糖尿病的概率，这里是1%。![](img/3ed237e2-b687-4dce-9b02-5cfc221d8105.png)也被称为贝叶斯术语中的**先验**，它表示我们在没有任何额外信息时对一个事件的信念。'
- en: '![](img/a8e2c941-82d0-4bce-8131-7003c7d02c84.png) denotes the probability of
    a person having diabetes given that he was detected positive by preliminary search
    results. In Bayesian terminology, this is also known as **posterior **which denotes
    the updated probability of an event after having obtained additional information.'
  id: totrans-24
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '![](img/a8e2c941-82d0-4bce-8131-7003c7d02c84.png)表示在初步测试中，假设某人被检测出阳性结果后，该人患有糖尿病的概率。在贝叶斯术语中，这也称为**后验概率**，它表示在获得附加信息后，事件的更新概率。'
- en: '![](img/2da3eb1b-c253-48d6-a05c-5bceeaef1d24.png) denotes the probability of
    getting a positive result in preliminary test given a person has diabetes. It
    is 80% in this case.'
  id: totrans-25
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '![](img/2da3eb1b-c253-48d6-a05c-5bceeaef1d24.png)表示在初步测试中，假设某人患有糖尿病的情况下，获得阳性结果的概率。在此情况下为80%。'
- en: '![](img/57855b2f-e2c4-4b39-980f-f4b984330f3c.png) denotes the probability that
    a random person will be tested positive in preliminary test. This can also be
    written down as:'
  id: totrans-26
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '![](img/57855b2f-e2c4-4b39-980f-f4b984330f3c.png)表示在初步测试中，随机一个人被检测为阳性的概率。这也可以写作：'
- en: '![](img/651f55bb-405e-4212-8f20-32b7567eff2e.png)'
  id: totrans-27
  prefs: []
  type: TYPE_IMG
  zh: '![](img/651f55bb-405e-4212-8f20-32b7567eff2e.png)'
- en: '![](img/29bff235-bef5-4999-977b-54d6c0121efa.png)'
  id: totrans-28
  prefs: []
  type: TYPE_IMG
  zh: '![](img/29bff235-bef5-4999-977b-54d6c0121efa.png)'
- en: Bayes' rule is used heavily to quantify uncertainty in predictions of machine
    learning systems.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: 贝叶斯法则在量化机器学习系统的预测不确定性中被广泛使用。
- en: Introducing Bayesian inference
  id: totrans-30
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 介绍贝叶斯推断
- en: Now that we know about the basics of Bayes' rule, let's try to understand the
    concept of Bayesian inference or modeling.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 既然我们已经了解了贝叶斯法则的基础知识，接下来让我们尝试理解贝叶斯推断或建模的概念。
- en: As we know, real-world environments are always dynamic, noisy, observation costly,
    and time-sensitive. When business decisions are based on forecasting in these
    environments, we want to not only produce better forecasts, but also quantify
    the uncertainty in these forecasts. For this reason, the theory of Bayesian inferences
    is extremely handy as it provides a principled approach to such problems.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 如我们所知，现实世界的环境始终是动态的、嘈杂的、观测代价高昂且时间敏感的。当商业决策基于这些环境中的预测时，我们不仅希望产生更好的预测结果，还希望量化这些预测结果中的不确定性。因此，贝叶斯推断理论在这种情况下非常有用，因为它提供了一个有原则的解决方法。
- en: 'For a typical time series model, we effectively carry out curve fitting based
    on *y* when given the *x* variable. This helps to fit a curve based on past observations.
    Let''s try to understand its limitations. Consider the following example of temperature
    in a city:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 对于典型的时间序列模型，我们在给定*x*变量时，实际上是基于*y*进行曲线拟合。这有助于根据过去的观测数据拟合曲线。让我们尝试理解其局限性。考虑以下城市温度的例子：
- en: '| **Day** | **Temperature** |'
  id: totrans-34
  prefs: []
  type: TYPE_TB
  zh: '| **日期** | **温度** |'
- en: '| May 1 10 AM | 10.5 degrees Celsius |'
  id: totrans-35
  prefs: []
  type: TYPE_TB
  zh: '| 5月1日 10 AM | 10.5摄氏度 |'
- en: '| May 15 10 AM | 17.5 degrees Celsius |'
  id: totrans-36
  prefs: []
  type: TYPE_TB
  zh: '| 5月15日 10 AM | 17.5摄氏度 |'
- en: '| May 30 10 AM | 25 degrees Celsius |'
  id: totrans-37
  prefs: []
  type: TYPE_TB
  zh: '| 5月30日 10 AM | 25摄氏度 |'
- en: 'Using curve fitting, we obtain the following model:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 使用曲线拟合，我们得到以下模型：
- en: '![](img/7ad60f2e-4859-40f2-9249-754813b4c20e.png)'
  id: totrans-39
  prefs: []
  type: TYPE_IMG
  zh: '![](img/7ad60f2e-4859-40f2-9249-754813b4c20e.png)'
- en: However, this will imply that the temperature function is linear, and, on tenth
    day, we expect the temperature to be 15 degrees Celsius. It is common knowledge
    that the temperature of a city fluctuates a lot during a day and it depends on
    when we take the readings. Curve fitting defines one of the functions over a given
    set of readings.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，这意味着温度函数是线性的，在第十天时，我们预计温度为15摄氏度。常识告诉我们，城市的温度在一天中波动较大，而且它依赖于我们何时进行测量。曲线拟合定义了在给定的一组读数下的某一函数。
- en: 'This example leads us to the conclusion that there is a family of curves that
    can model the given observations. The idea of the distribution of curves that
    model the given observation is central to Bayesian inference or modeling. The
    question now is: what should be the process of choosing one function over this
    family of functions? Or whether we should, in fact, choose one?'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 这个例子使我们得出结论，存在一组曲线可以建模给定的观测数据。建模这些观测数据的曲线分布的概念是贝叶斯推断或建模的核心。现在的问题是：我们应该如何从这一组函数中选择一个？或者，事实上，我们是否应该选择一个？
- en: One way to narrow down this family of functions is to short list a subset of
    them based on our prior knowledge about the problem. For example, we know that
    in May we don't expect temperatures to go below zero degrees Celsius. We can use
    this knowledge and discard all the functions which have points below zero degrees.
    Another popular way to think about this problem is to define a distribution over
    a function space based on our prior knowledge. Furthermore, the job of modeling,
    in this case, is to refine the distribution over possible functions based on the
    observed data points. Since these models don't have any defined parameters, they
    are popularly known as **Bayesian non-parametric models**.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 缩小函数族范围的一种方法是基于我们对问题的先验知识，筛选出其中的一个子集。例如，我们知道在五月份，我们不期望气温降到零摄氏度以下。我们可以利用这个知识，排除所有包含零度以下点的函数。另一种常见的思路是基于我们的先验知识在函数空间上定义一个分布。此外，在这种情况下，建模的任务就是根据观察到的数据点，细化可能函数的分布。由于这些模型没有定义的参数，因此它们通常被称为**贝叶斯非参数模型**。
- en: Introducing Gaussian processes
  id: totrans-43
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 引入高斯过程
- en: The Gaussian process (GP) can be thought of as an alternative Bayesian approach
    to regression problems. They are also referred to as infinite dimensional Gaussian
    distributions. GP defines a priori over functions that can be converted into a
    posteriori once we have observed a few data points. Although it doesn’t seem possible
    to define distributions over functions, it turns out that we only need to define
    distributions over a function's values at observed data points.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 高斯过程（GP）可以被看作是一种替代的贝叶斯回归方法。它们也被称为无限维高斯分布。GP 定义了函数的先验分布，一旦我们观察到一些数据点，就可以将其转化为后验分布。尽管看起来无法对函数定义分布，但实际上我们只需要在观察到的数据点上定义函数值的分布。
- en: Formally, let's say that we observed a function, ![](img/a278cd36-da50-4984-b8a2-a5a31a0f41d5.png),
    at n values ![](img/8038a339-08c0-4bd9-bec2-d847bcdd5923.png) as ![](img/2de559fe-a00c-4832-acc5-2500e03fe6a6.png).
    The function is a GP if all of the values, ![](img/272f6482-2994-476c-95d1-50943eb6a3ea.png), are
    jointly Gaussian, with a mean of ![](img/694a4dd4-0161-4ce4-94bb-13b0eb5de4cd.png) and
    a covariance of ![](img/688c125d-6b48-472b-b56c-8840ca089f5b.png)  given by ![](img/0efeffbe-fa9f-424b-9683-1e937eb3cdec.png).
    Here, the ![](img/1c3d2b1a-ad87-4bf6-89ff-553cd3009dcf.png) function defines how
    two variables are related to each other. We will discuss different kinds of kernels
    later in this section. The joint Gaussian distribution of many Gaussian variables
    is also known as Multivariate Gaussian.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 形式上，假设我们在 n 个值 ![](img/8038a339-08c0-4bd9-bec2-d847bcdd5923.png) 上观察到一个函数 ![](img/a278cd36-da50-4984-b8a2-a5a31a0f41d5.png)，并且在这些点上获得了
    ![](img/2de559fe-a00c-4832-acc5-2500e03fe6a6.png) 的值。该函数是一个高斯过程（GP），如果所有值 ![](img/272f6482-2994-476c-95d1-50943eb6a3ea.png)
    是联合高斯分布，其均值为 ![](img/694a4dd4-0161-4ce4-94bb-13b0eb5de4cd.png)，协方差为 ![](img/688c125d-6b48-472b-b56c-8840ca089f5b.png)，由
    ![](img/0efeffbe-fa9f-424b-9683-1e937eb3cdec.png) 给出。在这里，![](img/1c3d2b1a-ad87-4bf6-89ff-553cd3009dcf.png)
    函数定义了两个变量之间的关系。我们将在本节后面讨论不同类型的核函数。多个高斯变量的联合高斯分布也被称为多元高斯分布。
- en: From the previous temperature example, we can imagine that various functions
    can be fit to the given observations on temperature. Some functions are smoother
    than others. One way to capture smoothness is by using the covariance matrix.
    The covariance matrix ensures that two values (![](img/2c19505a-d914-41fb-b347-50ac27de6216.png))
    close in the input space produce closer values in the output space (![](img/dff74ee8-c4bb-4b6e-b92b-df324c62a94c.png)).
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 从前面的温度示例中，我们可以想象多种函数可以拟合给定的温度观测值。有些函数比其他函数更加平滑。捕捉平滑度的一种方法是使用协方差矩阵。协方差矩阵确保输入空间中相近的两个值（![](img/2c19505a-d914-41fb-b347-50ac27de6216.png)）在输出空间中产生相近的值（![](img/dff74ee8-c4bb-4b6e-b92b-df324c62a94c.png)）。
- en: 'Essentially, the problem we are trying to solve through GP is as follows: given
    a set of inputs, ![](img/22a0a040-b0f1-4ee4-a7df-4d05f59026ab.png), and its values, ![](img/b78eee49-4717-466d-a15d-e549943f25c3.png),
    we are trying to estimate the distribution over outputs, ![](img/1a8e2103-1df5-43e0-b5b9-a0110238c6ed.png), for
    a new set of inputs, ![](img/1e052223-2b40-49aa-8eec-84799a90fb52.png). Mathematically,
    the quantity we are trying to estimate can be written as follows:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 本质上，我们试图通过 GP 解决的问题是：给定一组输入值 ![](img/22a0a040-b0f1-4ee4-a7df-4d05f59026ab.png)
    及其对应的值 ![](img/b78eee49-4717-466d-a15d-e549943f25c3.png)，我们试图估计新一组输入值 ![](img/1e052223-2b40-49aa-8eec-84799a90fb52.png)
    的输出值分布 ![](img/1a8e2103-1df5-43e0-b5b9-a0110238c6ed.png)。从数学角度看，我们试图估计的量可以表示为：
- en: '![](img/fb393d3a-f09d-488f-8ad2-609f363feadb.png)'
  id: totrans-48
  prefs: []
  type: TYPE_IMG
  zh: '![](img/fb393d3a-f09d-488f-8ad2-609f363feadb.png)'
- en: 'To obtain this, we model ![](img/f0780df4-977d-42b6-ad5b-cbcdbd14ea16.png) as
    a GP so that we know that both ![](img/8e69496e-df16-4a8c-8aff-03c2682fc80f.png) and
    ![](img/90734fc7-ecae-44f7-8d7a-a1414ba3a81f.png) are coming from a multivariate
    Gaussian with the following mean and covariance function:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 为了得到这个结果，我们将 ![](img/f0780df4-977d-42b6-ad5b-cbcdbd14ea16.png) 建模为 GP，这样我们就知道
    ![](img/8e69496e-df16-4a8c-8aff-03c2682fc80f.png) 和 ![](img/90734fc7-ecae-44f7-8d7a-a1414ba3a81f.png)
    都来自一个具有以下均值和协方差函数的多元高斯分布：
- en: '![](img/4effe6bc-fa12-4378-89ce-144622aec16e.png)'
  id: totrans-50
  prefs: []
  type: TYPE_IMG
  zh: '![](img/4effe6bc-fa12-4378-89ce-144622aec16e.png)'
- en: Where ![](img/1b140f99-0195-4a9c-a7f9-fadd2dc131fa.png) and ![](img/7c45a81a-67c0-4dae-971b-009496dafd32.png) represent
    the prior mean of the distribution of ![](img/f0780df4-977d-42b6-ad5b-cbcdbd14ea16.png) and ![](img/1a8e2103-1df5-43e0-b5b9-a0110238c6ed.png) over
    observed and unobserved function values, respectively, ![](img/26a39e62-f73f-45b1-8f00-383feb03aeca.png) represents
    the matrix obtained after applying the kernel function to each of the observed
    values, ![](img/22a0a040-b0f1-4ee4-a7df-4d05f59026ab.png).
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 其中，![](img/1b140f99-0195-4a9c-a7f9-fadd2dc131fa.png) 和 ![](img/7c45a81a-67c0-4dae-971b-009496dafd32.png)
    分别表示 ![](img/f0780df4-977d-42b6-ad5b-cbcdbd14ea16.png) 的先验均值，以及观察和未观察到的函数值上 ![](img/1a8e2103-1df5-43e0-b5b9-a0110238c6ed.png)
    的先验均值，![](img/26a39e62-f73f-45b1-8f00-383feb03aeca.png) 表示应用核函数于每个观察值后得到的矩阵，![](img/22a0a040-b0f1-4ee4-a7df-4d05f59026ab.png)。
- en: Kernel function tries to map the similarity between two data points in the input
    space to the output space. Let's assume, there are two data points ![](img/52170400-b12c-4c42-bb24-a55a896d7743.png) and ![](img/8f98f264-1213-4dc6-902c-e0a1c367f07f.png) with
    corresponding function values as ![](img/d44d4d04-8614-4401-8287-44f8ac6a7d78.png) and ![](img/5fa623e9-d9e4-4274-aaf2-f1cd53fe6392.png).
    The Kernel function measures how the closeness between two points ![](img/52170400-b12c-4c42-bb24-a55a896d7743.png) and ![](img/8f98f264-1213-4dc6-902c-e0a1c367f07f.png) in
    the input space maps to the similarity or correlation between their function values ![](img/b7e763af-d663-46c2-ac24-12eaf5ad80d7.png) and ![](img/12d419c0-ad2c-4b7b-a0b6-63af38e88879.png).
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 核函数尝试将输入空间中两个数据点之间的相似性映射到输出空间。假设有两个数据点 ![](img/52170400-b12c-4c42-bb24-a55a896d7743.png)
    和 ![](img/8f98f264-1213-4dc6-902c-e0a1c367f07f.png)，其对应的函数值分别为 ![](img/d44d4d04-8614-4401-8287-44f8ac6a7d78.png)
    和 ![](img/5fa623e9-d9e4-4274-aaf2-f1cd53fe6392.png)。核函数测量输入空间中两个点 ![](img/52170400-b12c-4c42-bb24-a55a896d7743.png)
    和 ![](img/8f98f264-1213-4dc6-902c-e0a1c367f07f.png) 之间的接近度是如何映射到它们的函数值 ![](img/b7e763af-d663-46c2-ac24-12eaf5ad80d7.png)
    和 ![](img/12d419c0-ad2c-4b7b-a0b6-63af38e88879.png) 之间的相似性或相关性的。
- en: We apply this kernel function to all the pairs of observations in the dataset,
    thereby, creating a matrix of similarities known as Kernel/Covariance matrix (*K*). Assuming,
    there are 10 input data points, the kernel function will be applied to each pair
    of data points leading to a 10x10 Kernel Matrix (*K*). If the function values
    at two data points ![](img/52170400-b12c-4c42-bb24-a55a896d7743.png) and ![](img/8f98f264-1213-4dc6-902c-e0a1c367f07f.png)
    is expected to be similar, kernel is expected to have high value at *(i,j)* in
    the matrix. We do a detailed discussion on different kernels in GPs in the next
    section.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将这个核函数应用于数据集中所有观测值对，从而创建一个被称为核/协方差矩阵 (*K*) 的相似度矩阵。假设有 10 个输入数据点，核函数将应用于每一对数据点，生成一个
    10x10 的核矩阵 (*K*)。如果两个数据点 ![](img/52170400-b12c-4c42-bb24-a55a896d7743.png) 和 ![](img/8f98f264-1213-4dc6-902c-e0a1c367f07f.png)
    的函数值预计相似，那么在矩阵的 *(i,j)* 位置，核值预计会很高。在下一节中，我们将详细讨论 GP 中的不同核函数。
- en: In the equation, ![](img/db2e0ad6-026c-43cc-86be-aeb8a27e9bef.png) represents
    the matrix obtained by applying the same kernel function to values in the training
    and testing dataset, and ![](img/8061a3b0-c2f5-4795-b4a8-d3d2a3c94b18.png) is
    the matrix obtained by measuring the similarity between the input values in the
    test set.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个方程中，![](img/db2e0ad6-026c-43cc-86be-aeb8a27e9bef.png) 代表通过对训练集和测试集中的值应用相同的核函数得到的矩阵，而
    ![](img/8061a3b0-c2f5-4795-b4a8-d3d2a3c94b18.png) 是通过测量测试集中的输入值之间的相似性得到的矩阵。
- en: 'At this point, we will assume that there is some linear algebra magic that
    can help us to achieve the conditional distribution of ![](img/fb393d3a-f09d-488f-8ad2-609f363feadb.png) from
    the joint distribution and obtain the following:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 此时，我们假设有一些线性代数魔法可以帮助我们从联合分布中获得条件分布 ![](img/fb393d3a-f09d-488f-8ad2-609f363feadb.png)，并得到以下结果：
- en: '![](img/e2639840-4335-48e2-840c-4ffe2865b2d2.png)'
  id: totrans-56
  prefs: []
  type: TYPE_IMG
  zh: '![](img/e2639840-4335-48e2-840c-4ffe2865b2d2.png)'
- en: We are going to skip the derivations, but if you would like to know more, you
    can visit Rasmussen and Williams ([http://www.gaussianprocess.org/gpml/chapters/RW.pdf](http://www.gaussianprocess.org/gpml/chapters/RW.pdf)).
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将跳过推导过程，但如果你想了解更多，可以访问Rasmussen和Williams的资料([http://www.gaussianprocess.org/gpml/chapters/RW.pdf](http://www.gaussianprocess.org/gpml/chapters/RW.pdf))。
- en: With this analytical result, we have access to the entire distribution of function
    values over the testing dataset. Modeling the predictions as distributions also
    helps in quantifying the uncertainty surrounding the predictions, which is quite
    important in many time series applications.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 有了这个解析结果，我们可以访问整个测试数据集上的函数值分布。将预测建模为分布也有助于量化预测的不确定性，这在许多时间序列应用中非常重要。
- en: Choosing kernels in GPs
  id: totrans-59
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在高斯过程（GPs）中选择核函数
- en: In many applications, we find that the prior mean is always set to zero as it
    is simple, convenient and works well for many applications. However, choosing
    the appropriate kernels for the task is not always straightforward. As mentioned
    in the previous section, kernels effectively try to map the similarity between
    two input data points in the input space to the output (function) space. The only
    requirement for the kernel function (![](img/66ba8791-225f-4f4e-93a7-079e2199a612.png))
    is that it should map any two input values ![](img/8f12aaf0-d55b-4194-b4d7-89dbc34c2dae.png) and ![](img/bfad4856-888b-4329-84c0-ba9970c3aadc.png) to
    a scalar such that Kernel Matrix (![](img/83a5b785-4c39-456a-8f54-52ba57395735.png))
    is a positive/semi-definite for it to be a valid covariance function.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 在许多应用中，我们发现先验均值通常设置为零，因为它简单、方便且在许多应用中效果良好。然而，为任务选择合适的核函数并不总是直观的。如前所述，核函数实际上试图将输入数据点之间的相似性映射到输出（函数）空间。核函数（![](img/66ba8791-225f-4f4e-93a7-079e2199a612.png)）的唯一要求是，它应该将任何两个输入值
    ![](img/8f12aaf0-d55b-4194-b4d7-89dbc34c2dae.png) 和 ![](img/bfad4856-888b-4329-84c0-ba9970c3aadc.png)
    映射到一个标量，使得核矩阵（![](img/83a5b785-4c39-456a-8f54-52ba57395735.png)）是正定/半正定的，从而使其成为有效的协方差函数。
- en: For sake of brevity, we exclude explanation of fundamental concepts of Covariance
    matrices and how they are always positive semi-definite. We encourage the readers
    to refer to lecture notes from [MIT](https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-436j-fundamentals-of-probability-fall-2008/lecture-notes/MIT6_436JF08_lec15.pdf)
    (https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-436j-fundamentals-of-probability-fall-2008/lecture-notes/MIT6_436JF08_lec15.pdf)
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: 为了简洁起见，我们省略了协方差矩阵的基本概念及其如何始终是半正定矩阵的解释。我们鼓励读者参考[MIT](https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-436j-fundamentals-of-probability-fall-2008/lecture-notes/MIT6_436JF08_lec15.pdf)的讲义。
- en: 'While a complete discussion of all of the types of kernels is beyond the scope
    of this chapter, we will discuss the two kernels used to build this project:'
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 尽管对所有类型的核函数的完整讨论超出了本章的范围，但我们将讨论用于构建该项目的两种核函数：
- en: '**White noise kernel: **As the name suggests, the white noise kernel adds a
    white noise (of variance) to the existing covariance matrix. Mathematically, it
    is given as follows:'
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**白噪声核：**顾名思义，白噪声核将白噪声（方差）添加到现有的协方差矩阵中。从数学上讲，它可以表示为：'
- en: '![](img/dba08700-b379-4d43-bdca-a513b15a2d9b.png)'
  id: totrans-64
  prefs: []
  type: TYPE_IMG
  zh: '![](img/dba08700-b379-4d43-bdca-a513b15a2d9b.png)'
- en: If there are many settings, the data points are not accurate and are corrupted
    by some random noise. Noise in the input data can be modeled by adding a white
    noise kernel to the covariance matrix.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 如果有很多设置，数据点不准确并且被一些随机噪声污染。输入数据中的噪声可以通过将白噪声核添加到协方差矩阵中来建模。
- en: '**Squared exponential (SE) kernel:** Given two scalars, ![](img/7d0effde-cd01-4263-a54c-7c95219de40a.png) and
    ![](img/2d724806-82a9-4682-85eb-865b58604c98.png), the squared exponential kernel
    is given by the following equation:'
  id: totrans-66
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**平方指数（SE）核：** 给定两个标量， ![](img/7d0effde-cd01-4263-a54c-7c95219de40a.png) 和
    ![](img/2d724806-82a9-4682-85eb-865b58604c98.png)，平方指数核由以下公式给出：'
- en: '![](img/360c9c14-b89e-4808-9583-3aa0d293ffe5.png)'
  id: totrans-67
  prefs: []
  type: TYPE_IMG
  zh: '![](img/360c9c14-b89e-4808-9583-3aa0d293ffe5.png)'
- en: Here, ![](img/3c68e226-e471-4656-9a57-905bb111b4ff.png) is a scaling factor
    and ![](img/240d0539-3f80-4c0f-9079-a7efc4089974.png) which is the smoothness
    parameter determines the smoothness of kernel function. It is quite a popular
    kernel because the functions drawn from the GP through this kernel are infinitely
    differentiable, which makes it suitable for many applications.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 这里，![](img/3c68e226-e471-4656-9a57-905bb111b4ff.png)是一个缩放因子，而![](img/240d0539-3f80-4c0f-9079-a7efc4089974.png)是平滑参数，它决定了核函数的平滑度。这个核函数非常流行，因为通过这个核得到的高斯过程函数是无限可微的，这使得它适用于许多应用。
- en: 'Here are some samples that have been drawn from a GP with an SE kernel that
    has ![](img/3c68e226-e471-4656-9a57-905bb111b4ff.png) fixed to 1:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 这里是从具有SE核的高斯过程抽取的一些样本，![](img/3c68e226-e471-4656-9a57-905bb111b4ff.png)固定为1：
- en: '![](img/eefbb334-ce35-454c-b87d-1b8ac9cdacc6.png)'
  id: totrans-70
  prefs: []
  type: TYPE_IMG
  zh: '![](img/eefbb334-ce35-454c-b87d-1b8ac9cdacc6.png)'
- en: We can observe that the functions become smoother as ![](img/c616a4ff-2e8f-4c08-9ce5-816548dadc00.png) increases.
    For more information on different kinds of kernels, refer to *The Kernel Cookbook*
    ([https://www.cs.toronto.edu/~duvenaud/cookbook/](https://www.cs.toronto.edu/~duvenaud/cookbook/)https://www.cs.toronto.edu/~duvenaud/cookbook/)
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以观察到，随着![](img/c616a4ff-2e8f-4c08-9ce5-816548dadc00.png)的增加，函数变得更加平滑。有关不同类型核函数的更多信息，请参阅*The
    Kernel Cookbook* ([https://www.cs.toronto.edu/~duvenaud/cookbook/](https://www.cs.toronto.edu/~duvenaud/cookbook/))
- en: Choosing the hyper parameters of a kernel
  id: totrans-72
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 选择核函数的超参数
- en: So far, we have defined kernels with different parameters. For example, in a
    squared exponential kernel, we have the parameters ![](img/e2c9b8c5-d9d5-4682-ad41-55184f6e0f33.png) and ![](img/a76bfe27-56de-458c-afc8-d2f256a4a6ee.png).
    Let's denote the parameter set of any kernel as ![](img/0c20142e-ae5a-453a-83f3-4da976648679.png).
    The question now is, how do we estimate ![](img/4f6c6973-0029-47aa-b77a-23a0aab277e6.png)?
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 到目前为止，我们已经定义了具有不同参数的核函数。例如，在平方指数核中，我们有参数![](img/e2c9b8c5-d9d5-4682-ad41-55184f6e0f33.png)和![](img/a76bfe27-56de-458c-afc8-d2f256a4a6ee.png)。我们将任何核函数的参数集表示为![](img/0c20142e-ae5a-453a-83f3-4da976648679.png)。现在的问题是，如何估计![](img/4f6c6973-0029-47aa-b77a-23a0aab277e6.png)？
- en: As mentioned previously, we model the distribution of the output of ![](img/93fd2135-8859-4e8d-80d0-ecbbcb8d9237.png) function to
    be a random sample from a multivariate Gaussian distribution. In this manner,
    the marginal likelihood of observed data points is a multivariate Gaussian that's
    been conditioned on the input points ![](img/4b1002f7-07c2-4b86-bc5e-a630fc9b13d1.png) and
    the parameter ![](img/4f6c6973-0029-47aa-b77a-23a0aab277e6.png). Thus, we can
    choose ![](img/4f6c6973-0029-47aa-b77a-23a0aab277e6.png) by maximizing the likelihood
    of the observed data points over this assumption.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，我们将![](img/93fd2135-8859-4e8d-80d0-ecbbcb8d9237.png)函数的输出分布建模为从多元高斯分布中随机抽取的样本。这样，观察数据点的边际似然是一个条件化于输入点![](img/4b1002f7-07c2-4b86-bc5e-a630fc9b13d1.png)和参数![](img/4f6c6973-0029-47aa-b77a-23a0aab277e6.png)的多元高斯分布。因此，我们可以通过最大化观察数据点在此假设下的似然来选择![](img/4f6c6973-0029-47aa-b77a-23a0aab277e6.png)。
- en: Now that we have understood how GPs make predictions, let's see how we can make
    predictions on the stock market using GPs and potentially make some money.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经理解了高斯过程是如何进行预测的，让我们看看如何利用高斯过程在股票市场进行预测，并可能赚取一些钱。
- en: Applying GPs to stock market prediction
  id: totrans-76
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 将高斯过程应用于股票市场预测
- en: 'In this project, we will try to predict the prices of three major stocks in
    the market. The dataset for this exercise can be downloaded from Yahoo Finance
    ([https://finance.yahoo.com](https://finance.yahoo.com)). We downloaded the entire
    stock history for three companies:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个项目中，我们将尝试预测市场中三只主要股票的价格。该练习的数据集可以从Yahoo Finance下载([https://finance.yahoo.com](https://finance.yahoo.com))。我们下载了三家公司完整的股票历史数据：
- en: Google ([https://finance.yahoo.com/quote/GOOG](https://finance.yahoo.com/quote/GOOG))
  id: totrans-78
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Google ([https://finance.yahoo.com/quote/GOOG](https://finance.yahoo.com/quote/GOOG))
- en: Netflix ([https://finance.yahoo.com/quote/NFLX](https://finance.yahoo.com/quote/NFLX))
  id: totrans-79
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Netflix ([https://finance.yahoo.com/quote/NFLX](https://finance.yahoo.com/quote/NFLX))
- en: General Electric company ([https://finance.yahoo.com/quote/GE](https://finance.yahoo.com/quote/GE))
  id: totrans-80
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 通用电气公司 ([https://finance.yahoo.com/quote/GE](https://finance.yahoo.com/quote/GE))
- en: We choose three datasets to compare GP performance across different stocks.
    Feel free to try this for more stocks.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 我们选择了三个数据集来比较不同股票的高斯过程性能。欢迎尝试更多的股票。
- en: All of these datasets are present in the GitHub repository. Thus, there is no
    need to download them again to run the code.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 所有这些数据集都存在于GitHub仓库中。因此，运行代码时无需再次下载它们。
- en: 'The CSV files in the dataset have multiple columns. They are as follows:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 数据集中的CSV文件包含多个列，内容如下：
- en: '**Date**: Calendar date when the price of the stock was measured.'
  id: totrans-84
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Date:** 股票价格测量的日历日期。'
- en: '**Open**: The opening price of the day.'
  id: totrans-85
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Open:** 当天的开盘价。'
- en: '**High:** The highest price of the day.'
  id: totrans-86
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**High:** 当天的最高价。'
- en: '**Low:** The lowest price of the day.'
  id: totrans-87
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Low:** 当天的最低价。'
- en: '**Close:** The closing price of the day.'
  id: totrans-88
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Close:** 当天的收盘价。'
- en: '**Adj Close:** The adjusted closing price is the closing price of the stock
    that has been amended to include any dividends or other corporate actions before
    the following day''s opening. This is our target variable or Y in the dataset.'
  id: totrans-89
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Adj Close:** 调整后的收盘价是股票的收盘价，在下一个交易日开盘前，已被修正以包含任何股息或其他公司行动。这是我们的目标变量或数据集中的Y。'
- en: '**Volume:** The volume denotes the number of shares traded during a day.'
  id: totrans-90
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Volume:** 交易量表示当天交易的股票数量。'
- en: 'To begin our project, we will consider two forecasting problems each, for all
    three stock datasets:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 为了开始我们的项目，我们将考虑每个股票数据集的两个预测问题：
- en: In the first problem, we will train on prices from the years 2008-2016 and predict
    for the entire year of 2017
  id: totrans-92
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在第一个问题中，我们将使用2008-2016年的价格进行训练，并预测2017年的所有价格。
- en: In the second problem, we will train on prices from the years 2008-2018 (up
    to the third quarter) and predict the fourth quarter of 2018
  id: totrans-93
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在第二个问题中，我们将使用2008-2018年（至第三季度）的价格进行训练，并预测2018年第四季度的价格。
- en: For predicting stock prices, we don't need to model the entire time series of
    a stock as a single time series, as in many classical methods (an example of this
    is regression). For GP, each time series is divided into several time series (one
    for each year) for every stock. Intuitively, this makes sense, as each stock follows
    a yearly cycle.
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 对于股票价格预测，我们不需要像许多经典方法（例如回归）那样将股票的整个时间序列建模为一个单一的时间序列。对于高斯过程（GP），每只股票的时间序列会被分割成多个时间序列（每年一个时间序列）。直观地讲，这是合理的，因为每只股票都遵循一个年度周期。
- en: 'The time series of each year of a stock is an input to the model as a separate
    time series. Therefore, the forecasting problem becomes as follows: predict future
    prices of the stock given multiple yearly time series (one for each historical
    year) as the input. As GP models are distributions over functions, we want to
    predict the mean and uncertainty at each data point in the future.'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 每年股票的时间序列作为输入，作为独立的时间序列输入到模型中。因此，预测问题变成了：给定多个年度时间序列（每个历史年份一个），预测股票的未来价格。由于高斯过程模型是函数的分布，我们希望预测未来每个数据点的均值和不确定性。
- en: 'Before modeling, we need to normalize the prices to be zero mean and unit standard
    deviation. This is a requirement in Gaussian processes because of the following:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 在建模之前，我们需要将价格标准化为零均值和单位标准差。这是高斯过程的要求，原因如下：
- en: We assume the prior on the output distribution to be zero mean, so normalization
    is required to match our assumption.
  id: totrans-97
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 我们假设输出分布的先验为零均值，因此需要进行标准化以匹配我们的假设。
- en: Many kernels for the covariance matrix have scale parameters in them. Normalizing
    the input helps us to get better estimates of kernel parameters.
  id: totrans-98
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 许多协方差矩阵的核函数中有尺度参数。标准化输入有助于我们更好地估计核函数参数。
- en: For obtaining the posterior distribution in Gaussian processes, we have to invert
    the covariance matrix. Normalization helps to avoid any kind of numerical issues
    with this procedure. Note that we haven't discussed the linear algebra of obtaining
    the posterior in detail in this chapter.
  id: totrans-99
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 要获得高斯过程中的后验分布，我们必须反转协方差矩阵。标准化有助于避免此过程中出现任何数值问题。请注意，在本章中我们没有详细讨论获取后验的线性代数。
- en: Once the data has been normalized, we can train our model and predict prices
    using Gaussian processes. For modeling, we use the plug, and play functions from
    the GPflow ([https://github.com/GPflow/GPflow](https://github.com/GPflow/GPflow))
    library, which is a wrapper on top of TensorFlow for Gaussian processes.
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 一旦数据被标准化，我们就可以训练我们的模型并使用高斯过程预测价格。对于建模，我们使用来自GPflow库的插件和即插即用功能（[https://github.com/GPflow/GPflow](https://github.com/GPflow/GPflow)），它是一个基于TensorFlow的高斯过程封装库。
- en: 'The independent variable (X) in the prediction problem is comprised of two
    factors:'
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 预测问题中的自变量（X）由两个因素组成：
- en: The year
  id: totrans-102
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 每年
- en: The day of the year
  id: totrans-103
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 每年的日期
- en: The dependent variable (Y) in the problem is the normalized adjusted closing
    price for each day in a year as mentioned before.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 问题中的因变量（Y）是每年每天的标准化调整后收盘价，如前所述。
- en: 'Before training the model, we need to define the prior and kernel function
    for Gaussian Processes. For this problem, we use the standard zero mean prior.
    We use a kernel function for the covariance matrix that is generated as the sum
    of two kernels which are defined as follows:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 在训练模型之前，我们需要为高斯过程定义先验和核函数。对于这个问题，我们使用标准的零均值先验。我们使用一个核函数来生成协方差矩阵，该矩阵是两个核函数的和，定义如下：
- en: Squared exponential (or RBF, as mentioned in the GPflow package) kernel with
    `lengthscale` = `1` and `variance` = 63.
  id: totrans-106
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 平方指数（或RBF，如在GPflow包中所提到）核函数，`lengthscale` = `1` 和 `variance` = 63。
- en: White noise with initial `variance` to be very low, such as *1e-10.*
  id: totrans-107
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 白噪声的初始`variance`非常低，如*1e-10*。
- en: The idea behind choosing squared exponential is that it is infinitely differentiable
    and it's the easiest one to understand. White noise is used to account for any
    systemic noise we might observe in our target variables. While it may not be the
    best choice of kernels, it is good for understanding purposes. Feel free to experiment
    with other kernels and see whether they work well.
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 选择平方指数核函数的思路是它是无限可微的，并且是最容易理解的。白噪声用于考虑我们在目标变量中可能观察到的任何系统性噪声。虽然它可能不是最好的核函数选择，但它有助于理解。您可以自由尝试其他核函数，看看它们是否效果良好。
- en: Creating a stock price prediction model
  id: totrans-109
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 创建股票价格预测模型
- en: 'We will begin our project by processing the data present in the dataset:'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将通过处理数据集中的数据开始我们的项目：
- en: Create a dataframe with yearly time series for each stock. Represent each year's
    stock price by an individual column in that dataframe. Restrict number of rows
    in the dataframe to 252 which is roughly the number of trading days in a year.
    Also add the fiscal quarter associated with each row of data as a separate column.
  id: totrans-111
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个数据框，其中包含每只股票的年度时间序列。每年的股票价格在数据框中由单独的列表示。将数据框中的行数限制为252行，这大约是每年的交易日数。还要为每行数据添加与之相关的财务季度，作为一个单独的列。
- en: '[PRE0]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: Note that there are almost 252 trading days in a year, as stock markets are
    closed on weekends.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 请注意，一年中大约有252个交易日，因为股市在周末休市。
- en: 'Even if there are more trading days in a particular year (like leap year), limit data
    to 252 days to ensure consistency across the years. In case the number of trading
    days is less than 252 in a particular year, extrapolate the data to 252 days by
    imputing the mean price of the year for missing days. Implement the following
    code to achieve this:'
  id: totrans-114
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 即使某一年的交易日数更多（例如闰年），也将数据限制为252天，以确保各年份之间的一致性。如果某一年份的交易日数少于252天，则通过对缺失的天数进行填补（使用该年的均值价格）来外推数据以达到252天。请使用以下代码来实现此功能：
- en: '[PRE1]'
  id: totrans-115
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: For each year, normalize the prices to transform the yearly series to zero mean
    and unit standard deviation. Also, subtract the first day price from all of the
    data points in that year. This basically forces a yearly time series to start
    from zero, thereby avoiding any influence of previous year's prices on it.
  id: totrans-116
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对每一年进行价格归一化，将年度数据转化为零均值和单位标准差。同时，从该年所有数据点中减去第一天的价格。这基本上强制每年的时间序列从零开始，从而避免了前一年价格对其的影响。
- en: '[PRE2]'
  id: totrans-117
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: Please make sure to install this library as mentioned in the **README** file
    in the repository for this chapter, before executing the code.
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 在执行代码之前，请确保按照**README**文件中的说明安装本章的相关库。
- en: 'As mentioned in the previous section, generate the covariance matrix as a sum
    of two kernels:'
  id: totrans-119
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如前节所述，生成协方差矩阵作为两个核函数的和：
- en: '[PRE3]'
  id: totrans-120
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: We use the SciPy optimizer in GPflow package to optimize hyper parameters using
    maximum likelihood estimation. Scipy is a standard optimizer from Python library
    Scipy. If you are not familiar with Scipy optimizer, please refer to the official
    page ([https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.minimize.html](https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.minimize.html)).
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 我们使用GPflow包中的SciPy优化器，通过最大似然估计来优化超参数。SciPy是Python库中的标准优化器。如果您不熟悉SciPy优化器，请参考官方页面（[https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.minimize.html](https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.minimize.html)）。
- en: 'Implement the final wrapper function `make_gp_predictions` to train a GP model
    and make future price predictions. Following are the steps that the function implements:'
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 实现最终的包装函数`make_gp_predictions`来训练高斯过程模型并进行未来价格预测。该函数实现的步骤如下：
- en: Takes the input of training data, start and end of training period and prediction
    year and quarter.
  id: totrans-123
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 输入训练数据、训练周期的开始和结束日期以及预测年份和季度。
- en: Constructs 2 separate series using data from the start year of the training
    period, one for the independent variables (X) and one for the target (Y). Each
    element in series (X) represents each day of the year and consists of two independent
    variables, year and day of the year. For example, for start year 2008, X looks
    like [[2008,1], [2008,2],[2008,3].......[2008,252]].
  id: totrans-124
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用训练周期的起始年份数据构建2个独立的系列，一个用于自变量（X），一个用于目标变量（Y）。系列（X）中的每个元素代表年份中的每一天，并由两个自变量组成：年份和该年的第几天。例如，对于起始年份2008年，X的形式为[[2008,1],
    [2008,2], [2008,3], ...... [2008,252]]。
- en: Appends the independent and target variables for each subsequent year to list
    X and Y respectively.
  id: totrans-125
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将每个后续年份的自变量和目标变量分别附加到列表X和Y中。
- en: If input `pred_quarters` is not None, predicts for the quarters specified instead
    of the entire year. For example, if `pred_quarters` is [4] and `pred_year `is
    2018, the function will predict for Quarter 4 of 2018 using all the data till
    Quarter 3 of 2018.
  id: totrans-126
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 如果输入`pred_quarters`不为None，则根据指定的季度进行预测，而不是整个年份。例如，如果`pred_quarters`为[4]且`pred_year`为2018年，则该函数会使用2018年第三季度之前的所有数据来预测2018年第四季度的股价。
- en: Defines the kernel function as mentioned before and trains the GP model using
    Scipy optimizer.
  id: totrans-127
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义如前所述的核函数，并使用Scipy优化器训练GP模型。
- en: Predicts the stock prices for the prediction period.
  id: totrans-128
  prefs:
  - PREF_IND
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对预测期内的股票价格进行预测。
- en: '[PRE4]'
  id: totrans-129
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Understanding the results obtained
  id: totrans-130
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 理解所得结果
- en: 'Let''s try to understand how good our predictions are for each of the stocks:'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们尝试了解我们对每只股票的预测效果如何：
- en: '**Netflix (NFLX)**: The following diagram illustrates the prices of the Netflix
    stock from **2002** through **2018**:'
  id: totrans-132
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Netflix (NFLX)**：以下图表展示了**2002**年到**2018**年期间Netflix股票的价格：'
- en: '![](img/cb7fcc4b-bb57-4b83-ae7f-7270e5ed0165.png)'
  id: totrans-133
  prefs: []
  type: TYPE_IMG
  zh: '![](img/cb7fcc4b-bb57-4b83-ae7f-7270e5ed0165.png)'
- en: The price for the year **2018** is defined using the two vertical lines. It
    shows the growth in the price of the stock throughout the entire year.
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: '**2018**年的价格通过两条垂直线定义，显示了整个年度股票价格的增长情况。'
- en: 'As per the first problem case, we consider the period from **2008-2016** for
    training:'
  id: totrans-135
  prefs: []
  type: TYPE_NORMAL
  zh: 根据第一个问题案例，我们考虑**2008-2016**年间的数据进行训练：
- en: '![](img/fd1a998d-3f38-4faa-a166-0525b69a5fe4.png)'
  id: totrans-136
  prefs: []
  type: TYPE_IMG
  zh: '![](img/fd1a998d-3f38-4faa-a166-0525b69a5fe4.png)'
- en: 'Normalizing the prices by each year for modeling gives us the following plot:'
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 对每年的价格进行标准化建模，得到以下图表：
- en: '![](img/f737d653-8cb7-4ae2-9ac8-75e5ac1c1db7.png)'
  id: totrans-138
  prefs: []
  type: TYPE_IMG
  zh: '![](img/f737d653-8cb7-4ae2-9ac8-75e5ac1c1db7.png)'
- en: 'Predicting the prices of the stock for the whole year of **2017** with a **95%
    confidence interval** gives us the following plot:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 对**2017**年整个年度股票价格进行预测，并给出**95%置信区间**的结果，得到以下图表：
- en: '![](img/7811b0b1-6932-4e9c-ada7-77b8e03e74bd.png)'
  id: totrans-140
  prefs: []
  type: TYPE_IMG
  zh: '![](img/7811b0b1-6932-4e9c-ada7-77b8e03e74bd.png)'
- en: Comparing of the generated values with the actual values, it is clear that the
    model falters by predicting the value to be less than the actual value. However,
    the reason for this could be the highs and lows of the prices of Netflix in the
    year **2016**. These are not captured through the basic-level kernel used in this
    project.
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 将生成的值与实际值进行比较，可以看出该模型预测的值低于实际值。然而，造成这种情况的原因可能是**2016**年Netflix股票价格的波动。这些波动没有通过该项目中使用的基础核函数捕捉到。
- en: 'For the second problem case, we consider the train period from **2008-2018**,
    including the first three quarters. The plot for the Netflix stock price during
    this period is as follows:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 对于第二个问题案例，我们考虑**2008-2018**年的训练周期，包括前三个季度。此期间Netflix股票价格的图表如下：
- en: '![](img/6d5f521d-56ef-49e0-bf1b-bce74fb8e187.png)'
  id: totrans-143
  prefs: []
  type: TYPE_IMG
  zh: '![](img/6d5f521d-56ef-49e0-bf1b-bce74fb8e187.png)'
- en: 'Using the normalized values, we achieve the following plot:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 使用标准化值，我们得到以下图表：
- en: '![](img/db9c27fd-f922-4581-8a9d-d366987faffe.png)'
  id: totrans-145
  prefs: []
  type: TYPE_IMG
  zh: '![](img/db9c27fd-f922-4581-8a9d-d366987faffe.png)'
- en: As we can see, the trend is very well captured in this prediction, along with
    uncertainty.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 正如我们所见，这一预测很好地捕捉了趋势，同时也体现了不确定性。
- en: '**General Electric company** (**GE**): To understand the difference between
    the actual and the predicted prices, it is necessary to plot the graph that has
    the actual values. Here is the plot that illustrates the historical prices of
    GE stock:'
  id: totrans-147
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**通用电气公司**（**GE**）：为了理解实际价格与预测价格之间的差异，有必要绘制包含实际值的图表。以下是展示GE股票历史价格的图表：'
- en: '![](img/98fb46c8-2454-4644-aa7a-8b94f92a6d24.png)'
  id: totrans-148
  prefs: []
  type: TYPE_IMG
  zh: '![](img/98fb46c8-2454-4644-aa7a-8b94f92a6d24.png)'
- en: As mentioned previously, the dotted vertical lines represent the prices in the
    year **2018**.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，虚线垂直线表示**2018**年的股价。
- en: 'As per our first problem case, we consider the period from **2008-2016** for
    training. The chart for that period is as follows:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 根据我们的第一个问题案例，我们考虑了**2008-2016**年期间的训练数据。该期间的图表如下：
- en: '![](img/1c0b1610-d4b0-4b19-a6ae-fa7136effc43.png)'
  id: totrans-151
  prefs: []
  type: TYPE_IMG
  zh: '![](img/1c0b1610-d4b0-4b19-a6ae-fa7136effc43.png)'
- en: There was a huge dip in **2009**, but since then, the stock has been growing
    steadily.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: '**2009**年出现了一个巨大的跌幅，但从那时起，股票价格一直在稳步增长。'
- en: 'Since we used normalized prices for every year for modeling purposes, let''s
    look at the input data for our model:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们在建模时使用了每年标准化价格，让我们来看一下模型的输入数据：
- en: '![](img/e5192d44-9ff1-42c2-96d7-19cb2d86e7d2.png)'
  id: totrans-154
  prefs: []
  type: TYPE_IMG
  zh: '![](img/e5192d44-9ff1-42c2-96d7-19cb2d86e7d2.png)'
- en: 'The predictions with normalized prices for the whole of **2017** with a **95%
    confidence interval** are as follows:'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 对于**2017**年的标准化价格预测，**95%置信区间**的结果如下：
- en: '![](img/0a7e5592-8b81-429c-bca4-702e1235d8e7.png)'
  id: totrans-156
  prefs: []
  type: TYPE_IMG
  zh: '![](img/0a7e5592-8b81-429c-bca4-702e1235d8e7.png)'
- en: As we can see, the model has captured an accurate trend of the stock.
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 如我们所见，模型准确地捕捉到了股票的趋势。
- en: 'For the second prediction, we consider the train period from **2008-2018**,
    including the first three quarters of **2018**. The plot for the GE stock price
    during that period is as follows:'
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 对于第二次预测，我们考虑了**2008-2018**年期间的训练数据，包括**2018**年前三个季度。在此期间，GE股票的价格图如下：
- en: '![](img/85e5b5bc-822e-4d47-82fc-7b68fadb8ce4.png)'
  id: totrans-159
  prefs: []
  type: TYPE_IMG
  zh: '![](img/85e5b5bc-822e-4d47-82fc-7b68fadb8ce4.png)'
- en: 'The predicted prices for that period with a **95% confidence interval** are
    as follows:'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 该期间的预测价格，**95%置信区间**为：
- en: '![](img/cd225648-98fe-4d6c-8db8-06b1229778a6.png)'
  id: totrans-161
  prefs: []
  type: TYPE_IMG
  zh: '![](img/cd225648-98fe-4d6c-8db8-06b1229778a6.png)'
- en: '**Google** (**GOOG**): The following chart illustrates the historical prices
    of Google stock:'
  id: totrans-162
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Google**（**GOOG**）：以下图表展示了谷歌股票的历史价格：'
- en: '**![](img/59c4504b-3445-44a0-af60-f9b932723bdb.png)**'
  id: totrans-163
  prefs: []
  type: TYPE_NORMAL
  zh: '**![](img/59c4504b-3445-44a0-af60-f9b932723bdb.png)**'
- en: As specified previously, the dotted vertical lines represent the prices for **2018**.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 如前所述，虚线垂直线代表的是**2018**年的价格。
- en: 'As per the first problem case, the period from **2008-2016** is essential for
    training, so let''s look at the chart for this period:'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 根据第一个问题案例，**2008-2016**年期间对于训练至关重要，让我们来看一下这个期间的图表：
- en: '![](img/39bbfb2c-a830-425f-97c6-7fbf49be392a.png)'
  id: totrans-166
  prefs: []
  type: TYPE_IMG
  zh: '![](img/39bbfb2c-a830-425f-97c6-7fbf49be392a.png)'
- en: There was a huge dip in **2009** and since then, the stock has been growing
    steadily, except during **2015**.
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: '**2009**年出现了巨大的跌幅，之后股票价格稳步上涨，除非在**2015**年。'
- en: 'Since we used normalized prices by year for modeling, let''s look at the input
    data for our model:'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们在建模时使用了按年标准化的价格，让我们来看一下模型的输入数据：
- en: '![](img/efd040ee-dcf9-409a-9b3b-ab13c4378d12.png)'
  id: totrans-169
  prefs: []
  type: TYPE_IMG
  zh: '![](img/efd040ee-dcf9-409a-9b3b-ab13c4378d12.png)'
- en: 'Predictions (normalized prices) for a complete year, **2017**, with a **95%
    confidence interval**, are as follows:'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 对于整年**2017**的预测（标准化价格），**95%置信区间**的结果如下：
- en: '![](img/36c9abde-18a1-4d39-bed8-808fca53dcb5.png)'
  id: totrans-171
  prefs: []
  type: TYPE_IMG
  zh: '![](img/36c9abde-18a1-4d39-bed8-808fca53dcb5.png)'
- en: We were able to capture the overall upward trend of the price, but with very
    wide confidence bands.
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 我们能够捕捉到价格的整体上升趋势，但置信区间非常宽。
- en: 'For the next prediction, we considered the train period from **2008-2018**,
    including the first three quarters. A plot of the Google stock price during that
    period is as follows:'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 对于下一个预测，我们考虑了**2008-2018**年的训练期，包括前三个季度。在此期间的谷歌股票价格图如下：
- en: '![](img/57e40b7a-b603-4f75-aafd-1a67782d40c5.png)'
  id: totrans-174
  prefs: []
  type: TYPE_IMG
  zh: '![](img/57e40b7a-b603-4f75-aafd-1a67782d40c5.png)'
- en: 'The predicted prices for that period with a **95% confidence interval** are
    as follows:'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 该期间的预测价格，**95%置信区间**为：
- en: '![](img/fd5abf5d-fa5a-4e41-9983-ad3ff9162666.png)'
  id: totrans-176
  prefs: []
  type: TYPE_IMG
  zh: '![](img/fd5abf5d-fa5a-4e41-9983-ad3ff9162666.png)'
- en: In 2018, the trend has been better captured overall.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 2018年，整体趋势得到了更好的捕捉。
- en: Summary
  id: totrans-178
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter, we learned about a very popular Bayesian forecasting model
    known as the Gaussian process and used it to predict stock prices.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 在这一章中，我们了解了一种非常流行的贝叶斯预测模型——高斯过程，并使用它来预测股票价格。
- en: In the first part of this chapter, we looked at the forecasting problem by sampling
    an appropriate function from a multivariate Gaussian rather than use predicting
    point forecasts. We looked at a special kind of non-parametric Bayesian model
    named Gaussian processes.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章的第一部分，我们通过从多变量高斯分布中采样一个合适的函数来研究预测问题，而不是使用单点预测。我们研究了一种特殊的非参数贝叶斯模型，称为高斯过程。
- en: Thereafter, we used GP to predict the prices of three stocks, namely Google,
    Netflix, and GE, for 2017 and Q4 2018\. We observed that our predictions were
    mostly within a 95% confidence interval, but far from perfect.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 随后，我们使用高斯过程（GP）预测了三只股票——即谷歌、奈飞和GE——在2017年和2018年第四季度的价格。我们观察到，预测结果大多数落在95%的置信区间内，但仍远非完美。
- en: Gaussian processes are used widely in applications where we need to model non-linear
    functions with uncertainty with very few data points. However, they sometimes
    fail to scale to very high dimensional problems in which other deep learning algorithms,
    such as LSTM, would perform better.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 高斯过程广泛应用于需要在数据点非常少的情况下建模带有不确定性的非线性函数的场景。然而，在面对维度极高的问题时，它们有时会失效，而其他深度学习算法，如LSTM，可能表现得更好。
- en: In the next chapter, we will take a closer look at an unsupervised approach
    to detecting credit card frauds using auto-encoders.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章，我们将深入探讨一种无监督的方法，通过自动编码器检测信用卡欺诈行为。
- en: Questions
  id: totrans-184
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 问题
- en: What are Gaussian processes?
  id: totrans-185
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 什么是高斯过程？
- en: Can you improve the predictions by trying out different kernels?
  id: totrans-186
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你能通过尝试不同的核函数来改善预测结果吗？
- en: Can you apply GP model to other stocks in S&P 500 and compare its performance
    with the ones mentioned here?
  id: totrans-187
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 你能将高斯过程模型应用于标准普尔500指数中的其他股票，并与这里提到的股票表现进行比较吗？
